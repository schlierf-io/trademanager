"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[44112],{228804:(e,t,i)=>{function s(e,t,i){const s=e.get(t);return void 0!==s?s:(e.set(t,i),i)}function n(e,t,i){const s=e.get(t);if(void 0!==s)return s;const n=i();return e.set(t,n),n}function o(e,t,i,n){const o=s(e,t,new Map);return s(o,i,n)}function r(e,t,i,o){return n(s(e,t,new Map),i,o)}function a(e,t,i,n,o){const r=s(e,t,new Map),a=s(r,i,new Map);return s(a,n,o)}i.d(t,{getDefault2:()=>o,getDefault2Lazy:()=>r,getDefault3:()=>a,AbstractMapContainer:()=>l});class l{constructor(){this._map=new Map,this._size=0}size(){return this._size}clear(){this._map.clear(),this._size=0}}},923195:(e,t,i)=>{i.d(t,{lowerboundExt:()=>o,lowerbound:()=>r,upperbound:()=>l,subtract:()=>h,moveToHead:()=>d,moveAfter:()=>c,moveBefore:()=>u,intersect:()=>_,removeItemFromArray:()=>p});var s=i(650151);function n(e,t){return e<t}function o(e,t,i,s,n){let o=n-s;for(;0<o;){const n=o>>1,r=s+n;i(e(r),t)?(s=r+1,o-=n+1):o=n}return s}function r(e,t,i,s=0,n=e.length){return o((t=>e[t]),t,i,s,n)}function a(e,t,i=0,s=e.length){return r(e,t,n,i,s)}function l(e,t,i,s=0,n=e.length){let o=n-s;for(;0<o;){const n=o>>1,r=s+n;i(t,e[r])?o=n:(s=r+1,o-=n+1)}return s}function h(e,t){return e.filter((e=>!t.includes(e)))}function d(e,t){const i=e.indexOf(t);return i<0?e.slice():[t].concat(e.slice(0,i)).concat(e.slice(i+1))}function c(e,t,i){const s=new Set(t),n=[],o=[],r=[];return e.forEach(((e,t)=>{s.has(e)?o.push(e):(n.push(e),r.push(t))})),i=i<e.length-1?a(r,i+1):n.length,n.splice(i,0,...o),{newItems:n,movedItemsStartIndex:i}}function u(e,t,i){const s=new Set(t),n=[],o=[],r=[];return e.forEach(((e,t)=>{s.has(e)?o.push(e):(n.push(e),r.push(t))})),i=i<=e.length-1?a(r,i):n.length,n.splice(i,0,...o),{newItems:n,movedItemsStartIndex:i}}function _(e,t){const i=new Set;return e.forEach((e=>{t.has(e)&&i.add(e)})),i}function p(e,t){const i=e.indexOf(t);(0,s.assert)(-1!==i,"Item is not found"),e.splice(i,1)}},166097:(e,t,i)=>{i.d(t,{triesTranslateError:()=>n});var s=i(777754);function n(e){return o.get(e)||e}const o=new Map([["You cannot see this pivot timeframe on this resolution",s.t(null,void 0,i(717126))],["The data vendor doesn't provide volume data for this symbol.",s.t(null,void 0,i(529198))],['Histogram is too large, please increase "Row Size" input.',s.t(null,void 0,i(369085))],["Histogram is too large, please reduce 'Row Size' input.",s.t(null,void 0,i(808122))],["This script is invite-only. To request access, please contact its author.",s.t(null,void 0,i(874986))],["Volume Profile indicator available only on our upgraded plans.",s.t(null,void 0,i(961022))]])},332679:(e,t,i)=>{i.d(t,{TextImageCachesContainer:()=>a});var s=i(650151),n=i(228804),o=i(538708),r=i(482152);class a extends n.AbstractMapContainer{constructor(e){super(),this._maxSize=e,this._keysQueue=[]}get(e){const{fontSize:t,text:i,align:s,font:a,lineSpacing:l=0}=e;if(!i||!t||!s)return null;const h=(0,o.makeFont)(t,a),d=(0,n.getDefault3)(this._map,l,s,h,new Map);let c=d.get(i)
;return void 0!==c||(this._size>=this._maxSize?this._deleteFirstKey():++this._size,this._keysQueue.push([h,s,l,i]),c=new r.TextImageCache(i,e.bold,e.italic,a,t,s,l),d.set(i,c)),c}_deleteFirstKey(){const e=this._keysQueue.shift(),[t,i,n,o]=e,r=(0,s.ensureDefined)(this._map.get(n)),a=(0,s.ensureDefined)(r.get(i)),l=(0,s.ensureDefined)(a.get(t));l.delete(o),0===l.size&&a.delete(t),0===a.size&&r.delete(i),0===r.size&&this._map.delete(n)}}},482152:(e,t,i)=>{i.d(t,{HorizontalAlign:()=>s,VerticalAlign:()=>n,TextImageCache:()=>d});var s,n,o=i(327714),r=i(650151),a=i(538708),l=i(741341);!function(e){e.Left="left",e.Right="right",e.Center="center"}(s||(s={})),function(e){e.Top="top",e.Bottom="bottom",e.Middle="middle"}(n||(n={}));const h=(0,l.createDisconnectedCanvas)(document,(0,o.size)({width:0,height:0}),1);class d{constructor(e,t,i,s,n,o="center",l=0){this._lines=e.split(/[^\S\r\n]*(?:\r\n|\r|\n)/),this._font=function(e,t,i,s){return(0,a.makeFont)(s,i,`${e?"bold ":""}${t?"italic ":""}`)}(t,i,s,n),this._fontSize=n,this._verticalPadding=~~(n/6),this._textAlign=o,this._lineSpacing=l;const d=(0,r.ensureNotNull)(h.getContext("2d"));d.font=this._font,d.textBaseline="top";let c=0;for(let e=0;e<this._lines.length;++e){const t=this._lines[e],i=d.measureText(t).width;c=Math.max(c,i)}this.textImageWidth=c+1,this.textImageHeight=this._lines.length*n+(this._lines.length-1)*this._lineSpacing+this._verticalPadding}paintTo(e,t,i){e.save();const s=t.pixelRatio,n=i.location;e.translate(Math.round(function(e,t,i){let s=e;switch(t){case"left":break;case"right":s-=i;break;case"center":s-=i/2}return Math.round(s)}(n.x,n.horzAlign,this.textImageWidth)*s),Math.round(function(e,t,i){let s=e;switch(t){case"top":break;case"bottom":s-=i;break;case"middle":s-=i/2}return Math.round(s)}(n.y,n.vertAlign,this.textImageHeight)*s));const o=i.style;let r;switch(e.textBaseline="top",e.font=this._font,e.lineJoin="round",e.fillStyle=o.fillStyle,o.strokeStyle&&(e.strokeStyle=o.strokeStyle),o.lineWidth&&(e.lineWidth=o.lineWidth),this._textAlign){case"left":r=0,e.textAlign="left";break;case"right":r=this.textImageWidth-1,e.textAlign="right";break;default:r=this.textImageWidth/2,e.textAlign="center"}let a=this._verticalPadding;(0,l.drawScaled)(e,s,(()=>{for(const t of this._lines)o.strokeStyle&&e.strokeText(t,r,a),e.fillText(t,r,a),a+=this._fontSize,a+=this._lineSpacing})),e.restore()}}},736887:(e,t,i)=>{i.d(t,{currencyUnitVisibilityProperty:()=>r,currencyUnitVisibilityOptions:()=>a,migrateShowCurrencyAndShowUnitProperties:()=>h,restoreCurrencyUnitVisibilitySettingsValue:()=>d});var s=i(831356),n=i(62802),o=i.n(n);const{property:r,availableValues:a}=(0,s.createVisibilityController)("PriceAxisCurrencyAndUnit.visibility");let l=!1;function h(e,t){l||(l=!0,void 0===o().getValue("PriceAxisCurrencyAndUnit.visibility")&&r().setValue(e||t?"alwaysOn":"alwaysOff"))}function d(){r().setValue("visibleOnMouseOver"),o().remove("PriceAxisCurrencyAndUnit.visibility")}},194405:(e,t,i)=>{i.d(t,{DataWindowItem:()=>s,DataWindowView:()=>n});class s{constructor(e,t,i,s=!1){
this._visible=!0,this._id=e,this._title=t,this._value=i,this._unimportant=s}id(){return this._id}title(){return this._title}setTitle(e){this._title=e}text(){return this._value}value(){return this._value}setValue(e){this._value=e}visible(){return this._visible}setVisible(e){this._visible=e}color(){return this._color}setColor(e){this._color=e}unimportant(){return this._unimportant}}class n{constructor(){this._items=[],this._header="",this._title=""}header(){return this._header}title(){return this._title}items(){return this._items}update(){}}},594358:(e,t,i)=>{i.d(t,{HorizontalLinePaneView:()=>o});var s=i(803936),n=i(631586);class o{constructor(){this._lineRendererData={y:0,color:"rgba(0, 0, 0, 0)",linewidth:1,linestyle:n.LINESTYLE_SOLID,visible:!1},this._lineRenderer=new s.HorizontalLineRenderer,this._invalidated=!0,this._lineRenderer.setData(this._lineRendererData)}update(e){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._lineRenderer}}},477679:(e,t,i)=>{var s;i.d(t,{SymbolErrorPermissionDeniedReason:()=>s,permissionDenied:()=>n,invalidSymbol:()=>o}),function(e){e.Symbol="symbol",e.GroupPermission="group"}(s||(s={}));const n="permission denied",o="invalid symbol"},586299:(e,t,i)=>{i.d(t,{ensureTimePointIndexIndex:()=>o,unpackNonSeriesData:()=>r});var s=i(130551),n=i(695810);function o(e){if(e<0)throw new Error("TimePointIndexIndex should be non-negative integer");return e}async function r(e){if(""===e)return null;const t=JSON.parse(e);if(!(0,s.isObject)(t)||"function"==typeof t)throw new Error("Non-object content in the non-series envelope");if((0,s.hasProperty)(t,"indexes_replace"))return{indexes_replace:!0};const o={indexes_replace:!1};if((0,s.hasProperty)(t,"offsets")&&(o.offsets=t.offsets),(0,s.hasProperty)(t,"isUpdate")){if("boolean"!=typeof t.isUpdate)throw new Error('Invalid type of "isUpdate" field');o.isUpdate=t.isUpdate}if((0,s.hasProperty)(t,"data")&&(o.data=t.data),(0,s.hasProperty)(t,"graphicsCmds")&&(o.graphicsCmds=(0,n.validateGraphicsCommands)(t.graphicsCmds)),(0,s.hasProperty)(t,"dataCompressed")||(0,s.hasProperty)(t,"graphicsCmdsCompressed")){const{default:e}=await Promise.all([i.e(93194),i.e(81578)]).then(i.t.bind(i,593194,23));if((0,s.hasProperty)(t,"dataCompressed")){const i=await(new e).loadAsync(t.dataCompressed,{base64:!0});o.data=JSON.parse(await i.file("").async("text"))}if((0,s.hasProperty)(t,"graphicsCmdsCompressed")){const i=await(new e).loadAsync(t.graphicsCmdsCompressed,{base64:!0});o.graphicsCmds=(0,n.validateGraphicsCommands)(JSON.parse(await i.file("").async("text")))}return o}return o}},943546:(e,t,i)=>{i.d(t,{notAvailable:()=>s});i(777754),i(87476);const s="âˆ…"},733352:(e,t,i)=>{i.d(t,{PanePriceAxisView:()=>o});var s=i(837512);class n{constructor(e){this._priceAxisViewRenderer=null,this._rendererOptions=null,this._align="right",this._width=0,this._height=0,this._textWidthCache=e}setParams(e,t,i,s,n){this._priceAxisViewRenderer=e,this._rendererOptions=t,this._width=i,this._height=s,this._align=n}draw(e,t){
null!==this._rendererOptions&&null!==this._priceAxisViewRenderer&&this._priceAxisViewRenderer.draw(e,this._rendererOptions,this._textWidthCache,this._width,this._height,this._align,t.pixelRatio)}hitTest(e){var t,i;return void 0===(null===(t=this._priceAxisViewRenderer)||void 0===t?void 0:t.hitTest)?null:null===(i=this._priceAxisViewRenderer)||void 0===i?void 0:i.hitTest(e,this._width,this._align)}}class o{constructor(e,t,i){this._renderer=null,this._invalidated=!0,this._priceAxisView=e,this._textWidthCache=new s.TextWidthCache(100),this._dataSource=t,this._chartModel=i,this._fontSize=-1,this._panePriceAxisViewRenderer=new n(this._textWidthCache)}update(e){this._invalidated=!0}renderer(e,t){return this._invalidated&&this._updateImpl(e,t),this._renderer}_updateImpl(e,t){this._renderer=null;const i=this._chartModel.crossHairSource(),s=this._dataSource===i?i.pane:this._chartModel.paneForSource(this._dataSource);if(null===s)return;const n=this._priceScale();if(null===n)return;let o=s.priceScalePosition(n);if("overlay"===o&&(o=s.priceScalePosition(s.defaultPriceScale())),"overlay"===o)return;const r=this._chartModel.priceAxisRendererOptions();r.fontSize!==this._fontSize&&(this._fontSize=r.fontSize,this._textWidthCache.reset()),this._panePriceAxisViewRenderer.setParams(this._priceAxisView.paneRenderer(),r,t,e,o),this._renderer=this._panePriceAxisViewRenderer,this._invalidated=!1}_priceScale(){return this._dataSource.priceScale()}}},906778:(e,t,i)=>{i.d(t,{PaneRendererArea:()=>a});var s=i(650151),n=i(943498),o=i(837291),r=i(914679);class a extends n.PaneRendererLine{constructor(e){e.forceLineColor=!1,super(e)}_drawImpl(e){var t,i,n,a,l;const h=this._data;if(0===h.items.length)return;let d=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,c=(null!==(a=null===(n=this._data.visibleItemsRange)||void 0===n?void 0:n.endItemIndex)&&void 0!==a?a:this._data.items.length)-1;for(;d<c&&!(0,o.coordinateIsValid)(h.items[d].y);)d++;for(;c>=0&&!(0,o.coordinateIsValid)(h.items[c].y);)c--;if(d>c)return;const{context:u,horizontalPixelRatio:_,verticalPixelRatio:p}=e;u.save(),u.scale(_,p),u.lineCap="round",u.strokeStyle=h.lineColor,u.lineWidth=h.lineWidth,(0,r.setLineStyle)(u,h.lineStyle),u.lineWidth=1;const f={},m=h.items;for(let e=d;e<=c;e++){const t=m[e];let i;if(i=t.style?t.style.color:h.lineColor,e<c&&m[e+1].style){const n=(0,s.ensureDefined)(m[e+1].style).color;if(i!==n){const e=f[n]||[];e.push(t),f[n]=e}}const n=f[i]||[];n.push(t),f[i]=n}for(const e of Object.keys(f)){const t=f[e];u.beginPath();let i=0;for(let s=0;s<t.length;s++)t[s].style&&(null===(l=t[s].style)||void 0===l?void 0:l.color)!==e&&(u.moveTo(Math.round(t[i].x),h.bottom),this._walkLine(u,t.slice(i,s),!0,h.bottom,!0),i=s);if(u.moveTo(Math.round(t[i].x),h.bottom),this._walkLine(u,t.slice(i,t.length),!0,h.bottom,!0),u.closePath(),h.isSeries){const e=u.createLinearGradient(0,0,0,h.bottom);e.addColorStop(0,h.color1),e.addColorStop(1,h.color2),u.fillStyle=e,h.simpleMode=!0}else u.fillStyle=e;u.fill()}u.lineWidth=h.lineWidth,
u.restore(),super._drawImpl(e)}}},756740:(e,t,i)=>{i.d(t,{BitmapCoordinatesPaneRenderer:()=>n});var s=i(327714);class n{draw(e,t){new s.CanvasRenderingTarget2D(e,(0,s.size)({width:t.cssWidth,height:t.cssHeight}),(0,s.size)({width:t.physicalWidth,height:t.physicalHeight})).useBitmapCoordinateSpace((e=>this._drawImpl(e)))}drawBackground(e,t){new s.CanvasRenderingTarget2D(e,(0,s.size)({width:t.cssWidth,height:t.cssHeight}),(0,s.size)({width:t.physicalWidth,height:t.physicalHeight})).useBitmapCoordinateSpace((e=>this._drawBackgroundImpl(e)))}_drawBackgroundImpl(e){}}},28035:(e,t,i)=>{i.d(t,{CompositeRenderer:()=>s});class s{constructor(){this._renderers=[],this._globalAlpha=1}setGlobalAlpha(e){this._globalAlpha=e}append(e){this._renderers.push(e)}insert(e,t){this._renderers.splice(t,0,e)}clear(){this._renderers.length=0}isEmpty(){return 0===this._renderers.length}draw(e,t){for(let i=0;i<this._renderers.length;i++)e.save(),e.globalAlpha=this._globalAlpha,this._renderers[i].draw(e,t),e.restore()}drawBackground(e,t){e.save(),e.globalAlpha=this._globalAlpha;for(let i=0;i<this._renderers.length;i++){const s=this._renderers[i];s.drawBackground&&s.drawBackground(e,t)}e.restore()}hitTest(e,t){let i=null;for(let s=this._renderers.length-1;s>=0;s--){const n=this._renderers[s].hitTest(e,t);null!==n&&(null===i||n.result()>i.result())&&(i=n)}return i}doesIntersectWithBox(e){return this._renderers.some((t=>!!t.doesIntersectWithBox&&t.doesIntersectWithBox(e)))}}},803936:(e,t,i)=>{i.d(t,{HorizontalLineRenderer:()=>l});var s=i(858063),n=i(914679),o=i(837291),r=i(756740),a=i(741341);class l extends r.BitmapCoordinatesPaneRenderer{constructor(){super(...arguments),this._data=null,this._hitTest=new s.HitTestResult(s.HitTestResult.REGULAR)}setData(e){this._data=e}setHitTest(e){this._hitTest=e}hitTest(e){if(null===this._data||!1===this._data.visible||null===this._hitTest)return null;const t=(0,o.interactionTolerance)().line,i=Math.abs(e.y-this._data.y)<=t+this._data.linewidth/2,s=void 0===this._data.left||this._data.left-e.x<=t,n=void 0===this._data.right||e.x-this._data.right<=t;return i&&s&&n?this._hitTest:null}_drawImpl(e){if(null===this._data||!1===this._data.visible)return;const{context:t,horizontalPixelRatio:i,verticalPixelRatio:s,mediaSize:o}=e;if(this._data.y<-this._data.linewidth/2||this._data.y>o.height+this._data.linewidth/2)return;t.lineCap="butt",t.strokeStyle=this._data.color,t.lineWidth=Math.max(1,Math.floor(this._data.linewidth*i)),void 0!==this._data.linestyle&&(0,n.setLineStyle)(t,this._data.linestyle);const r=void 0!==this._data.left?Math.max(this._data.left,0):0,l=void 0!==this._data.right?Math.min(this._data.right,o.width):o.width,h=Math.round(this._data.y*s),d=Math.round(r*i),c=Math.round(l*i),u=this._data.excludeBoundaries;void 0!==u&&(0,a.addExclusionAreaByScope)(e,u),(0,n.drawHorizontalLine)(t,h,d,c)}}},943498:(e,t,i)=>{i.d(t,{PaneRendererLine:()=>h});var s=i(86441),n=i(204652),o=i(858063),r=i(837291),a=i(914679),l=i(756740);class h extends l.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}
hitTest(e){var t,i,a,l;const h=(0,r.interactionTolerance)().series+this._data.lineWidth/2;let d=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,c=(null!==(l=null===(a=this._data.visibleItemsRange)||void 0===a?void 0:a.endItemIndex)&&void 0!==l?l:this._data.items.length)-1;for(;c-d>2;){const t=Math.round((c+d)/2);this._data.items[t].x<=e.x?d=t:c=t}d=Math.max(1,d-1),c=Math.min(this._data.items.length-1,c+1);for(let t=d;t<=c;++t){const i=this._data.items[t-1],r=this._data.items[t],a=i.x,l=r.x;if((0,n.distanceToSegment)(new s.Point(a,i.y),new s.Point(l,r.y),new s.Point(e.x,e.y)).distance<=h)return this._data.hittest?this._data.hittest:new o.HitTestResult(o.HitTestResult.REGULAR)}return null}_drawImpl(e){const{context:t,horizontalPixelRatio:i,verticalPixelRatio:s}=e;t.scale(i,s),t.lineCap="round",t.lineJoin="round",t.strokeStyle=this._data.lineColor,t.fillStyle=this._data.lineColor,t.lineWidth=this._data.lineWidth,(0,a.setLineStyle)(t,this._data.lineStyle),(0,r.setValidLineStyle)(t,this._data.lineStyle),this._data.simpleMode?this._drawSimpleMode(t,i,s):this._drawLines(t)}_drawSimpleMode(e,t,i){var s,n,o,r;if(e.beginPath(),this._walkLine(e,this._data.items,!1,NaN),e.stroke(),this._data.withMarkers){e.scale(1/t,1/i);const a=Math.max(1,Math.floor(t))%2/2,l=(this._data.lineWidth+2)*i+a,h=2*Math.PI;e.beginPath();const d=null!==(n=null===(s=this._data.visibleItemsRange)||void 0===s?void 0:s.startItemIndex)&&void 0!==n?n:0;for(let s=(null!==(r=null===(o=this._data.visibleItemsRange)||void 0===o?void 0:o.endItemIndex)&&void 0!==r?r:this._data.items.length)-1+1;s-- >=d;){const n=this._data.items[s];if(n){const s=Math.round(n.x*t)+a,o=n.y*i;e.moveTo(s,o),e.arc(s,o,l,0,h)}}e.fill()}}_walkLine(e,t,i,s,n){var o,a,l,h;if(!t)return;const d=.25*this._data.barSpacing;let c,u,_,p,f;const m=r.coordinateIsValid,v=n?0:null!==(a=null===(o=this._data.visibleItemsRange)||void 0===o?void 0:o.startItemIndex)&&void 0!==a?a:0,g=n?t.length-1:Math.min((null!==(h=null===(l=this._data.visibleItemsRange)||void 0===l?void 0:l.endItemIndex)&&void 0!==h?h:t.length)-1,t.length-1);for(let e=v;e<=g;e++){const i=t[e];if(m(i.y)){u=i,c=e;break}}if(void 0!==c&&void 0!==u)for(let n=c;n<=g;n++){p=t[n],f=t[n+1]||{};const o=Math.round(p.x);if(m(p.y))if(_&&m(_.y))e.lineTo(o,p.y),i&&!m(f.y)&&e.lineTo(o,s);else if(f&&m(f.y))i?(n!==c&&e.lineTo(o,s),e.lineTo(o,p.y)):e.moveTo(o,p.y);else if(i){if(0===n)continue;n!==c&&e.lineTo(o-d,s),e.lineTo(o-d,p.y),e.lineTo(o+d,p.y),e.lineTo(o+d,s)}else e.moveTo(o-d,p.y),e.lineTo(o+d,p.y);_=p}}_drawLines(e){var t,i,s,n;if(!this._data.items.length)return;let o,a,l;const h=.25*this._data.barSpacing,d=r.coordinateIsValid;e.beginPath();const c=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,u=(null!==(n=null===(s=this._data.visibleItemsRange)||void 0===s?void 0:s.endItemIndex)&&void 0!==n?n:this._data.items.length)-1,_=this._data.items[c];_&&e.moveTo(_.x,_.y);let p,f=e.strokeStyle,m=e.lineWidth;for(let t=c+1;t<=u;++t){let i,s,n
;o=this._data.items[t-1],a=this._data.items[t],l=this._data.items[t+1],a.style&&!this._data.forceLineColor?(i=a.style.color,s=a.style.width,n=a.style.style):(i=this._data.lineColor,s=this._data.lineWidth,n=this._data.lineStyle),this._data.ignorePaletteLineWidth&&(s=this._data.lineWidth);(i!==f||s!==m||n!==p)&&(f=i,m=s,p=n,e.stroke(),e.beginPath(),e.strokeStyle=i,e.lineWidth=s,(0,r.setValidLineStyle)(e,n),e.moveTo(o.x,o.y)),v=o,y=l,d((g=a).y)&&(d(v.y)?e.lineTo(g.x,g.y):y&&d(y.y)?e.moveTo(g.x,g.y):(e.moveTo(g.x-h,g.y),e.lineTo(g.x+h,g.y)))}var v,g,y;e.stroke()}}},904244:(e,t,i)=>{i.d(t,{MediaCoordinatesPaneRenderer:()=>n});var s=i(327714);class n{draw(e,t){new s.CanvasRenderingTarget2D(e,(0,s.size)({width:t.cssWidth,height:t.cssHeight}),(0,s.size)({width:t.physicalWidth,height:t.physicalHeight})).useMediaCoordinateSpace((e=>this._drawImpl(e)))}drawBackground(e,t){new s.CanvasRenderingTarget2D(e,(0,s.size)({width:t.cssWidth,height:t.cssHeight}),(0,s.size)({width:t.physicalWidth,height:t.physicalHeight})).useMediaCoordinateSpace((e=>this._drawBackgroundImpl(e)))}_drawBackgroundImpl(e){}}},764372:(e,t,i)=>{i.d(t,{StepLineDecoration:()=>s,PaneRendererStepLine:()=>m});var s,n=i(204652),o=i(86441),r=i(114123),a=i(858063),l=i(923195),h=i(837291),d=i(914679),c=i(756740);!function(e){e[e.None=0]="None",e[e.Diamonds=1]="Diamonds"}(s||(s={}));class u{initialize(e,t,i){var s,n,o,r;const{context:a,horizontalPixelRatio:l,verticalPixelRatio:h}=t,c=e.lineStyle;a.lineCap="butt",a.lineJoin="round";const u=Math.max(Math.floor(null!==(n=null===(s=i.style)||void 0===s?void 0:s.width)&&void 0!==n?n:e.lineWidth*l));void 0!==c&&(0,d.setLineStyle)(a,c);const _=u%2?.5:0;a.moveTo(Math.round(i.x*l)+_,Math.round(i.y*h)+_),a.strokeStyle=null!==(r=null===(o=i.style)||void 0===o?void 0:o.color)&&void 0!==r?r:e.lineColor,a.lineWidth=u}finishFragment(e){e.stroke()}hitTest(e,t,i,s,n){return u.hitTest(e,t,i,s,n)}applyColor(e,t){e.strokeStyle=t}applyLineWidth(e,t){e.lineWidth=t}drawItem(e,t,i){const s=e.context;s.lineTo(t.x,t.y),void 0!==i&&(s.lineTo(i.x,t.y),s.lineTo(i.x,i.y))}static hitTest(e,t,i,s,r){var a,l;const d=t.pixelRatio,c=null!==(l=null===(a=i.style)||void 0===a?void 0:a.width)&&void 0!==l?l:e.lineWidth,u=Math.max(1,Math.floor(c*d))%2?.5:0,_=(0,h.interactionTolerance)().series+c/2;let p;if(isNaN(s.y)){const e=i.x+u,t=s.x+u,a=new o.Point(e,i.y),l=new o.Point(t,i.y);p=(0,n.distanceToSegment)(a,l,r).distance}else{const t=Math.round(s.x-e.barSpacing/2*d)+u,a=new o.Point(t,i.y),l=new o.Point(t,s.y);p=Math.min((0,n.distanceToSegment)(i,a,r).distance,(0,n.distanceToSegment)(a,l,r).distance,(0,n.distanceToSegment)(l,s,r).distance)}return p<=_}}class _{constructor(){this._lineWidth=1}initialize(e,t,i){var s,n,o,r;const{context:a,horizontalPixelRatio:l}=t;this.applyColor(a,null!==(n=null===(s=i.style)||void 0===s?void 0:s.color)&&void 0!==n?n:e.lineColor),this._lineWidth=Math.max(Math.floor(null!==(r=null===(o=i.style)||void 0===o?void 0:o.width)&&void 0!==r?r:e.lineWidth*l))}finishFragment(e){e.fill()}drawItem(e,t,i,s){
if(s&&void 0!==i&&!Number.isNaN(i.y)){const t=e.context;t.save(),t.translate(i.x,i.y),t.rotate(Math.PI/4);const s=this._scaleByLineWidth(this._lineWidth);t.scale(s,s),this._drawItemRotatedAndTranslated(e),t.restore()}}applyLineWidth(e,t){this._lineWidth=t}hitTest(e,t,i,s,n){var r,a;if(!s.valIsNotSameAsPrev)return!1;const l=Math.round((i.x+s.x)/2),h=new o.Point(l,s.y),d=n.subtract(h),c=Math.max(Math.floor(null!==(a=null===(r=i.style)||void 0===r?void 0:r.width)&&void 0!==a?a:e.lineWidth*t.pixelRatio));return this._hitTestTranslated(d,c)}_scaleByLineWidth(e){return Math.sqrt(e)}}class p extends _{applyColor(e,t){e.fillStyle=t}_hitTestTranslated(e,t){return Math.abs(e.x)+Math.abs(e.y)<8*this._scaleByLineWidth(t)/2}_drawItemRotatedAndTranslated(e){(0,d.drawRoundRect)(e.context,-4,-4,8,8,2,!0)}}class f extends _{applyColor(e,t){e.fillStyle=(0,r.applyTransparency)(t,85)}_hitTestTranslated(e,t){return Math.abs(e.x)+Math.abs(e.y)<21*this._scaleByLineWidth(t)/2}_drawItemRotatedAndTranslated(e){(0,d.drawRoundRect)(e.context,-10.5,-10.5,21,21,5,!0)}}class m extends c.BitmapCoordinatesPaneRenderer{constructor(e,t){super(),this._data=null,this._data=null!=e?e:null,this._extendLineToLastConfirmedBar=Boolean(t)}setData(e){this._data=e}hitTest(e,t){const i=this._data;if(null===i||0===i.items.length)return null;const{items:n,items:{length:r},lastConfirmedSeriesBarCoordinate:h,visibleItemsRange:{startItemIndex:d,endItemIndex:c}={startItemIndex:0,endItemIndex:r}}=i,_=i.decoration===s.Diamonds?[new u,new f]:[new u];const p=(0,l.lowerbound)(n,e,((e,t)=>e.x<=t.x),d,c),m=Math.max(0,p-1),v=Math.min(r,p+1);for(let s=m;s<v;s++){const l=n[s],d=n[s+1];if(d){if(_.some((s=>s.hitTest(i,t,l,d,e))))return new a.HitTestResult(a.HitTestResult.REGULAR)}else if(this._extendLineToLastConfirmedBar&&void 0!==h&&v===r&&l.x<t.cssWidth&&l.x<h){const s=(0,o.point)(h,l.y);if(u.hitTest(i,t,l,s,e))return new a.HitTestResult(a.HitTestResult.REGULAR)}}return null}_drawImpl(e){if(null===this._data||0===this._data.items.length)return;(this._data.decoration===s.Diamonds?[new u,new p,new f]:[new u]).forEach((t=>this._drawDecorationItem(e,t)))}_drawDecorationItem(e,t){var i,s,n,r,a,l,h,d,c,u,_,p,f,m,v,g;if(null===this._data||0===this._data.items.length)return;const{lineWidth:y,lineColor:x,items:b}=this._data,{context:w,horizontalPixelRatio:S,verticalPixelRatio:P,bitmapSize:I}=e;let C=Math.max(Math.floor(null!==(s=null===(i=b[0].style)||void 0===i?void 0:i.width)&&void 0!==s?s:y*S)),M=C%2?.5:0;t.initialize(this._data,e,b[0]);const R=null!==(r=null===(n=this._data.visibleItemsRange)||void 0===n?void 0:n.startItemIndex)&&void 0!==r?r:0,T=null!==(l=null===(a=this._data.visibleItemsRange)||void 0===a?void 0:a.endItemIndex)&&void 0!==l?l:b.length,B=this._data.barSpacing;if(!(T<=R)){w.beginPath(),t.applyColor(w,null!==(d=null===(h=b[R].style)||void 0===h?void 0:h.color)&&void 0!==d?d:x);for(let i=R;i<T;i++){const s=b[i],n=i===T-1?null:b[i+1];let r=0;this._data.extendToBarsEndings&&(i===R&&(r=-this._data.barSpacing/2),i===T-1&&(r=this._data.barSpacing/2))
;const a=Math.round((s.x+r)*S)+M,l=Math.round(s.y*P)+M;if(!n){if(t.drawItem(e,(0,o.point)(a,l)),this._extendLineToLastConfirmedBar&&void 0!==this._data.lastConfirmedSeriesBarCoordinate&&a<I.width&&s.x<this._data.lastConfirmedSeriesBarCoordinate){const i=Math.round((this._data.lastConfirmedSeriesBarCoordinate+r)*S)+M;a<i&&t.drawItem(e,(0,o.point)(Math.min(I.width,i),l),void 0,!0)}continue}const h=isNaN(n.y),d=Math.round((n.x-B/2)*S)+M,V=Math.round(n.y*P)+M;t.drawItem(e,(0,o.point)(a,l),(0,o.point)(d,V),n.valIsNotSameAsPrev);const D=null!==(u=null===(c=s.style)||void 0===c?void 0:c.color)&&void 0!==u?u:x,L=null!==(p=null===(_=s.style)||void 0===_?void 0:_.width)&&void 0!==p?p:y,N=null!==(m=null===(f=n.style)||void 0===f?void 0:f.color)&&void 0!==m?m:x,k=null!==(g=null===(v=n.style)||void 0===v?void 0:v.width)&&void 0!==g?g:y,A=D!==N,O=L!==k;(A||O||h)&&(t.finishFragment(w),A&&t.applyColor(w,N),O&&(C=Math.max(1,Math.floor(k*S)),M=C%2?.5:0,t.applyLineWidth(w,C)),w.beginPath(),w.moveTo(d,V))}t.finishFragment(w)}}}},719684:(e,t,i)=>{i.d(t,{PriceLineAxisRenderer:()=>r});var s=i(650151),n=i(631586),o=i(914679);class r{constructor(e,t){this.setData(e,t)}setData(e,t){this._data=e,this._commonData=t}draw(e,t,i,r,a,l,h){var d;if(!this._data.visible)return;const c=null!==(d=this._commonData.fixedCoordinate)&&void 0!==d?d:this._commonData.coordinate;e.lineWidth=Math.max(1,Math.floor((0,s.ensureDefined)(this._data.linewidth)*h)),e.lineCap="butt",(0,o.setLineStyle)(e,void 0===this._data.linestyle?n.LINESTYLE_DOTTED:this._data.linestyle),e.strokeStyle=this._commonData.textColor,(0,o.drawHorizontalLine)(e,Math.round(c*h),0,Math.ceil(r*h))}topBottomTotalHeight(e){return{top:0,bottom:0,total:0}}}},471502:(e,t,i)=>{i.d(t,{PriceLineAxisView:()=>r,SeriesPriceLineAxisView:()=>a,StudyPriceLineAxisView:()=>l});var s=i(841404),n=i(719684),o=i(631586);class r extends s.PriceAxisView{constructor(e){super(e||n.PriceLineAxisRenderer)}ignoreAlignment(){return!0}_updateRendererData(e,t,i){if(t.visible=!1,e.visible=!1,!this._isVisible())return;const s=this._value();s.noData||(i.background="",i.textColor=this._priceLineColor(s.color),i.coordinate=s.coordinate,i.floatCoordinate=s.floatCoordinate,e.linewidth=this._lineWidth(),e.linestyle=this._lineStyle(),e.backgroundAreaVisible=this._backgroundAreaVisible(),e.backgroundAreaColor=this._backgroundAreaColor(),e.backgroundAreaHeight=this._backgroundAreaHeight(),e.visible=!0)}_lineStyle(){return o.LINESTYLE_DOTTED}_backgroundAreaVisible(){return!1}_backgroundAreaColor(){return""}_backgroundAreaHeight(){return 0}}class a extends r{constructor(e){super(),this._series=e}_value(){return this._series.lastValueData(void 0,!0)}_priceLineColor(e){return this._series.priceLineColor(e)}_lineWidth(){return this._series.properties().childs().priceLineWidth.value()}_isVisible(){const e=this._series.model().properties().childs().scalesProperties.childs().showSeriesLastValue.value();return this._series.properties().childs().showPriceLine.value()&&e}}class l extends r{constructor(e,t){super(),this._study=e,this._plotname=t}
_value(){return this._study.lastValueData(this._plotname,!0)}_lineWidth(){return this._study.properties().childs().styles.childs()[this._plotname].childs().linewidth.value()}_lineStyle(){return o.LINESTYLE_DOTTED}_priceLineColor(e){return e}_isVisible(){const e=this._study.model().properties().childs().scalesProperties.childs().showStudyLastValue.value(),t=this._study.isPlotVisibleAt(this._plotname,1);return this._study.properties().childs().styles.childs()[this._plotname].childs().trackPrice.value()&&e&&t}}},847314:(e,t,i)=>{i.d(t,{SelectionIndexes:()=>n});var s=i(650151);class n{constructor(e){this._baseIndex=null,this._offsetInBar=null,this._offsetInTime=null,this._barsBetweenPoints=null,this._timescale=e}indexes(){const e=this._timescale.visibleBarsStrictRange();if(null===e)return[];const t=e.firstBar(),i=e.lastBar();if(null===this._offsetInTime||null===this._barsBetweenPoints){const e=this._timescale.barSpacing();this._barsBetweenPoints=Math.floor(120/e),this._offsetInBar=i%this._barsBetweenPoints,this._offsetInTime=this._timescale.indexToTimePoint(this._offsetInBar),this._baseIndex=this._timescale.baseIndex()}const n=this._timescale.baseIndex();this._baseIndex!==n&&(this._baseIndex=n,this._offsetInBar=(0,s.ensureNotNull)(this._timescale.timePointToIndex(this._offsetInTime)));const o=(0,s.ensureNotNull)(this._offsetInBar),r=[];let a=Math.floor((t-o)/this._barsBetweenPoints);const l=Math.floor((i-o)/this._barsBetweenPoints);for(;a<=l;a++)r.push(o+a*this._barsBetweenPoints);return r}clear(){this._offsetInBar=null,this._offsetInTime=null,this._baseIndex=null,this._barsBetweenPoints=null}}},583110:(e,t,i)=>{i.d(t,{SelectionRenderer:()=>h});var s=i(934026),n=i(551238),o=i(858063),r=i(854905),a=i(756740);const l=n.colorsPalette["color-tv-blue-600"];class h extends a.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e||null}setData(e){this._data=e}hitTest(e){if(!this._data||!this._data.visible)return null;for(let t=0;t<this._data.points.length;t++){const i=this._data.points[t];if(i.subtract(e).length()<=5.5){const e=void 0!==this._data.pointsCursorType?this._data.pointsCursorType[t]:r.PaneCursorType.Default;return new o.HitTestResult(this._data.hittestResult,{pointIndex:i.data,cursorType:e})}}return null}doesIntersectWithBox(e){return!!this._data&&this._data.points.some((t=>(0,s.pointInBox)(t,e)))}_drawImpl(e){if(null===this._data||!this._data.visible)return;const{context:t,horizontalPixelRatio:i}=e;t.strokeStyle=void 0!==this._data.color?this._data.color:l,t.lineCap="butt";const s=Math.max(1,Math.floor(i));t.lineWidth=s;const n=this._data.vertOffset||0;for(let i=0;i<this._data.points.length;++i){const r=this._data.points[i];(o=r,Number.isFinite(o.x)&&Number.isFinite(o.y))&&(t.fillStyle=this._data.bgColors[i],this._drawMarker(e,r,n,s))}var o}_drawMarker(e,t,i,s){const{context:n,horizontalPixelRatio:o,verticalPixelRatio:r}=e;let a=Math.round(3.5*o*2);a%2!=s%2&&(a+=1);let l=Math.round(a+2*(.5*s+.75*o));l%2!=s%2&&(l+=1);const h=Math.round(t.x*o),d=Math.round((t.y+i)*r),c=s%2/2;n.beginPath(),
n.arc(h+c,d+c,l/2,0,2*Math.PI,!0),n.closePath(),n.fill(),n.beginPath(),n.arc(h+c,d+c,a/2,0,2*Math.PI,!0),n.closePath(),n.stroke()}}},311854:(e,t,i)=>{i.d(t,{seriesPlotFunctionMap:()=>h,barFunction:()=>d,SeriesData:()=>_});var s,n=i(650151),o=i(884566),r=i(923195);!function(e){e[e.FromLeft=-1]="FromLeft",e[e.FromRight=1]="FromRight"}(s||(s={}));const a={open:e=>e[1],high:e=>e[2],low:e=>e[3],close:e=>e[4],hl2:e=>(e[2]+e[3])/2,hlc3:e=>(e[2]+e[3]+e[4])/3,ohlc4:e=>(e[1]+e[2]+e[3]+e[4])/4},l=["open","high","low","close","hl2","hlc3","ohlc4"];function h(){const e=new Map;return l.forEach(((t,i)=>{e.set(t,d(t))})),e}function d(e,t,i){const s=a[null!=t?t:e],n=a[e],o=a[null!=i?i:e];return(e,t)=>{switch(t){case 0:return s(e);case 2:return o(e);default:return n(e)}}}function c(e,t){return null==e[t]}const u=[{barsToMerge:10,forBarspacingLargerThen:.03},{barsToMerge:30,forBarspacingLargerThen:.01},{barsToMerge:100,forBarspacingLargerThen:.003},{barsToMerge:500,forBarspacingLargerThen:0}];class _{constructor(){this._pressedChunks={chunks:new Map,priceSource:"uninitialized"},this.m_bars=new o.PlotList(h(),c),this.m_nsBars=new o.PlotList(h(),c),this._clearPressedChunks()}bars(){return this.m_bars}nsBars(){return this.m_nsBars}pressedChunks(e,t){if(t!==this._pressedChunks.priceSource){this._pressedChunks.priceSource=t;const e=this.m_bars.first();e&&(this._clearPressedChunks(),this._rebuildPressedChunks(e))}const i=(0,n.ensureDefined)(u.find((t=>t.forBarspacingLargerThen<=e)));return(0,n.ensureDefined)(this._pressedChunks.chunks.get(i.barsToMerge))}mergeRegularBars(e){const t=this.m_bars.size(),i=this.m_bars.merge(e);return i&&"uninitialized"!==this._pressedChunks.priceSource&&(t===this.m_bars.size()&&i.index===this.m_bars.lastIndex()?this._updateLatestChunks():this._rebuildPressedChunks(i)),i}size(){return this.m_bars.size()+this.m_nsBars.size()}each(e){this.m_bars.each(e),this.m_nsBars.each(e)}clear(){this.m_bars.clear(),this.m_nsBars.clear(),this.lastProjectionPrice=void 0,this._clearPressedChunks()}isEmpty(){return this.m_bars.isEmpty()&&this.m_nsBars.isEmpty()}first(){return this.m_bars.isEmpty()?this.m_nsBars.first():this.m_bars.first()}last(){return this.m_nsBars.isEmpty()?this.m_bars.last():this.m_nsBars.last()}search(e,t){return this.nsBars().isEmpty()?this.bars().search(e,t):this.bars().isEmpty()||(0,n.ensureNotNull)(this.nsBars().firstIndex())<=e?this.nsBars().search(e,t):this.bars().search(e,t)}valueAt(e){const t=this.search(e);return null!==t?t.value:null}plotValueToTimePointIndex(e,t,i){if(i===s.FromRight){const i=(i,s)=>{const n=s[t];return null!=n&&e>=n},s=this.m_bars.findLast(i);if(null!==s)return s.index;const n=this.m_nsBars.findLast(i);return null!==n?n.index:this.m_bars.firstIndex()}if(i===s.FromLeft){const i=(i,s)=>{const n=s[t];return null!=n&&e<=n},s=this.m_bars.findFirst(i);if(null!==s)return s.index;const n=this.m_nsBars.findFirst(i);return null!==n?n.index:this.m_bars.lastIndex()}throw new Error("plotValueToTimePointIndex: unsupported search mode")}moveData(e){this.m_bars.move(e),this.m_nsBars.move(e),
this.m_bars.size()>0&&this._rebuildPressedChunks((0,n.ensureNotNull)(this.m_bars.first()))}_rebuildPressedChunks(e){const t=this._pressedChunks.priceSource;if("uninitialized"===t)return;const i=e.index,s=a[t],o=(e,t,i)=>{let n=null;for(;e.hasNext();){const o=e.next(),r=s(o.value);n&&o.index-n.startTime>=i.barsToMerge&&(t.push(n),n=null),n?(n.endTime=o.index,n.high=Math.max(n.high,r),n.low=Math.min(n.low,r),n.close=r):n={startTime:o.index,endTime:o.index,open:r,high:r,low:r,close:r}}n&&t.push(n)};u.forEach((e=>{const t=(0,n.ensureDefined)(this._pressedChunks.chunks.get(e.barsToMerge)),s=(0,r.lowerbound)(t,i,((e,t)=>e.endTime<t));if(0===s&&t.length>0){const i=t[0].startTime-1,s=(0,n.ensureNotNull)(this.m_bars.firstIndex()),r=this.m_bars.rangeIterator(s,i),a=[];o(r,a,e);const l=a.concat(t);this._pressedChunks.chunks.set(e.barsToMerge,l)}else{const i=(0,n.ensureNotNull)(this.m_bars.lastIndex());t.splice(s);let r=(0,n.ensureNotNull)(this.m_bars.firstIndex());t.length&&(r=t[t.length-1].endTime+1);const a=this.m_bars.rangeIterator(r,i);o(a,t,e)}}))}_updateLatestChunks(){const e=(0,n.ensureNotNull)(this.m_bars.lastIndex());u.forEach((t=>{const i=(0,n.ensureDefined)(this._pressedChunks.chunks.get(t.barsToMerge)),s=this.m_bars.rangeIterator(e,e).next(),o=s.value[4],r=i[i.length-1];r.high=Math.max(r.high,o),r.low=Math.min(r.low,o),r.close=o,r.endTime=s.index}))}_clearPressedChunks(){u.forEach((e=>this._pressedChunks.chunks.set(e.barsToMerge,[])))}}},352566:(e,t,i)=>{i.d(t,{PaneRendererBars:()=>o});var s=i(837291),n=i(991410);class o extends n.PaneRendererSeriesBase{constructor(e){super(),this._bars=e.bars,this._barSpacing=e.barSpacing,this._dontDrawOpen=e.dontDrawOpen,this._thinBars=e.thinBars}draw(e,t){e.save();const i=t.pixelRatio;if(this._barWidth=this._calcBarWidth(i),this._barWidth>=2){Math.max(1,Math.floor(i))%2!=this._barWidth%2&&this._barWidth--}this._barLineWidth=this._thinBars?Math.min(this._barWidth,Math.floor(i)):this._barWidth;let s=null;const n=this._barLineWidth<=this._barWidth&&this._barSpacing>=Math.floor(1.5*t.pixelRatio);for(const t of this._bars){s!==t.color&&(e.fillStyle=t.color,s=t.color);const o=Math.floor(.5*this._barLineWidth),r=Math.round(t.time*i),a=r-o,l=this._barLineWidth,h=a+l-1,d=Math.min(t.high,t.low),c=Math.max(t.high,t.low),u=Math.round(d*i)-o,_=Math.round(c*i)+o,p=Math.max(_-u,this._barLineWidth);e.fillRect(a,u,l,p);const f=Math.ceil(1.5*this._barWidth);if(n){const s=r-f,n=r+f,d=Math.min(a-s,n-h);if(!this._dontDrawOpen){let n=Math.max(u,Math.round(t.open*i)-o),r=n+l-1;r>u+p-1&&(r=u+p-1,n=r-l+1),e.fillRect(s,n,d,r-n+1)}let c=Math.max(u,Math.round(t.close*i)-o),_=c+l-1;_>u+p-1&&(_=u+p-1,c=_-l+1),e.fillRect(h+1,c,d,_-c+1)}}e.restore()}_getTolerance(){const e=this._calcBarWidth(1),t=this._thinBars?Math.min(e,1):e;return(0,s.interactionTolerance)().series+t/2}_getBarSpacing(){return this._barSpacing}_calcBarWidth(e){const t=Math.floor(e);return Math.max(t,Math.floor((0,s.optimalBarWidth)(this._barSpacing,e)))}}},991410:(e,t,i)=>{i.d(t,{PaneRendererSeriesBase:()=>n});var s=i(858063);class n{
constructor(){this._bars=[]}hitTest(e){const t=this._bars,i=this._getBarSpacing(),s=i/2;if(0===t.length)return null;const n=this._getTolerance(),o=t[0],r=t[t.length-1];if(e.x<o.time-s-n)return null;if(e.x>r.time+s+n)return null;let a=0,l=t.length-1,h=-1;for(;a<=l;){const i=Math.floor((a+l)/2),d=t[i];let c=s;if(d!==o&&d!==r||(c+=n),Math.abs(d.time-e.x)<=c){h=i;break}e.x-d.time>s?a=i+1:l=i-1}if(-1!==h){const o=Math.ceil(n/i);if(0!==o){const i=Math.max(0,h-o),r=Math.min(t.length-1,h+o);for(let o=i;o<=r;o++)if(Math.abs(e.x-t[o].time)<=s+n&&this._isPointAtBar(t[o],e.y,n))return this._getHitTest()}else if(this._isPointAtBar(t[h],e.y,n))return this._getHitTest()}return null}_getHitTest(){return new s.HitTestResult(s.HitTestResult.REGULAR)}_isPointAtBar(e,t,i){const s=Math.min(e.high,e.low),n=Math.max(e.high,e.low);return s-i<=t&&t<=n+i}}},916716:(e,t,i)=>{i.d(t,{PaneRendererCandles:()=>l});var s=i(650151),n=i(858063),o=i(914679),r=i(837291),a=i(991410);class l extends a.PaneRendererSeriesBase{constructor(e){super(),this._barSpacing=1,this._barWidth=1,this._borderVisible=!1,this._barBorderWidth=1,this._wickVisible=!1,this._bodyVisible=!0,this._borderColor=void 0,this._wickColor=void 0,this._hittest=void 0,this._isPriceScaleInverted=!1,e&&this.setData(e)}setData(e){this._bars=e.bars,this._barSpacing=e.barSpacing,this._borderVisible=e.borderVisible,this._bodyVisible=e.bodyVisible,this._wickVisible=e.wickVisible,this._borderColor=e.borderColor,this._wickColor=e.wickColor,this._hittest=e.hittest,this._isPriceScaleInverted=e.isPriceScaleInverted}hitTest(e){return this._wickVisible||this._borderVisible||this._bodyVisible?super.hitTest(e):null}draw(e,t){if(0===this._bars.length)return;const i=t.pixelRatio;if(this._barWidth=(0,r.optimalCandlestickWidth)(this._barSpacing,i),this._barWidth>=2){Math.floor(i)%2!=this._barWidth%2&&this._barWidth--}this._wickVisible&&this._drawWicks(e,i),this._borderVisible&&this._drawBorder(e,i),this._bodyVisible&&this._drawCandles(e,i)}_getTolerance(){return(0,r.interactionTolerance)().series+this._barBorderWidth/2}_getBarSpacing(){return this._barSpacing}_getHitTest(){return this._hittest||new n.HitTestResult(n.HitTestResult.REGULAR)}_isPointAtBar(e,t,i){const s=this._bodyVisible||this._borderVisible,n=this._wickVisible;if(!s&&!n)return!1;if(s){const s=n?Math.min(e.high,e.low):Math.min(e.open,e.close),o=n?Math.max(e.high,e.low):Math.max(e.open,e.close);return s-i<=t&&t<=o+i}{const s=Math.min(e.open,e.close),n=Math.max(e.open,e.close);return e.high-i<=t&&t<=s+i||n-i<=t&&t<=e.low+i}}_drawWicks(e,t){const i=this._bars;let n="",o=Math.min(Math.floor(t),Math.floor(this._barSpacing*t));o=Math.max(Math.floor(t),Math.min(o,this._barWidth));const r=Math.floor(.5*o);let a=null;for(const l of i){const i=l.wickColor?l.wickColor:(0,s.ensureDefined)(this._wickColor);i!==n&&(e.fillStyle=i,n=i);let h=Math.round(Math.min(l.open,l.close)*t),d=Math.round(Math.max(l.open,l.close)*t);this._isPriceScaleInverted&&([d,h]=[h,d]);const c=Math.round(l.high*t),u=Math.round(l.low*t);let _=Math.round(t*l.time)-r;const p=_+o-1
;null!==a&&(_=Math.max(a+1,_),_=Math.min(_,p));const f=p-_+1;e.fillRect(_,c,f,h-c),e.fillRect(_,d+1,f,u-d-1),a=p}}_calculateBorderWidth(e){let t=Math.floor(1*e);this._barWidth<=2*t&&(t=Math.floor(.5*(this._barWidth-1)));const i=Math.max(Math.floor(e),t);return this._barWidth<=2*i?Math.max(Math.floor(e),Math.floor(1*e)):i}_drawBorder(e,t){let i="";const n=this._calculateBorderWidth(t);let r=null;for(const a of this._bars){if(a.borderColor!==i&&(e.fillStyle=a.borderColor?a.borderColor:(0,s.ensureDefined)(this._borderColor),i=a.borderColor),this._bodyVisible&&a.hollow)continue;let l=Math.round(a.time*t)-Math.floor(.5*this._barWidth);const h=l+this._barWidth-1,d=Math.round(Math.min(a.open,a.close)*t),c=Math.round(Math.max(a.open,a.close)*t);if(null!==r&&(l=Math.max(r+1,l),l=Math.min(l,h)),this._barSpacing*t>2*n)(0,o.fillRectInnerBorder)(e,l,d,h-l+1,c-d+1,n);else{const t=h-l+1;e.fillRect(l,d,t,c-d+1)}r=h}}_drawCandles(e,t){let i="";const s=this._calculateBorderWidth(t);for(const n of this._bars){if(this._borderVisible&&this._barWidth<=2*s&&!n.hollow)continue;let r=Math.round(Math.min(n.open,n.close)*t),a=Math.round(Math.max(n.open,n.close)*t),l=Math.round(n.time*t)-Math.floor(.5*this._barWidth),h=l+this._barWidth-1;if(n.color!==i){const t=n.color;e.fillStyle=t,i=t}if(n.hollow)e.fillStyle=n.color,(0,o.fillRectInnerBorder)(e,l,r,h-l+1,a-r+1,s);else{if(this._borderVisible&&(l+=s,r+=s,h-=s,a-=s),r>a)continue;e.fillRect(l,r,h-l+1,a-r+1)}}}}},618258:(e,t,i)=>{i.d(t,{StatusProviderBase:()=>s});class s{constructor(e){this._colorProperty=e}size(){return"13px"}bold(){return!1}color(){return this._colorProperty.value()}}},337720:(e,t,i)=>{i.d(t,{StatusView:()=>s});class s{constructor(e){this._text="",this._color="",this._size="13px",this._bold=!1,this._statusProvider=e}text(){return this._text}getSplitTitle(){return[this._text]}color(){return this._statusProvider.color()}bold(){return this._bold}size(){return this._size}}},43239:(e,t,i)=>{i.d(t,{AbstractFilledAreaPaneView:()=>v});var s=i(650151),n=i(114123),o=i(43329);class r{constructor(){this._items=[],this._actualLength=0,this._invalidations=0}push(e){this._items.length===this._actualLength?this._items.push(e):this._items[this._actualLength]!==e&&(this._items[this._actualLength]=e),this._actualLength+=1}newItem(){const e=this._items.length>this._actualLength?this._items[this._actualLength]:null;return null!==e&&Boolean(e.invalidateCache)&&e.invalidateCache(),e}invalidateCache(){this._invalidations+=1,3e3===this._invalidations&&(this._items.splice(this._actualLength),this._invalidations=0),this._actualLength=0}at(e){return this._items[e]}data(){return this._items}length(){return this._actualLength}}class a extends r{constructor(e){super(),this.color=e}}class l{constructor(){this._map=new Map,this._usedKeys=new Set,this._invalidations=0}invalidateCache(){this._invalidations+=1,50===this._invalidations&&(this._deleteUnused(),this._invalidations=0),this._usedKeys.clear(),this._map.forEach(((e,t)=>e.invalidateCache()))}get(e){const t=this._map.get(e)
;return void 0!==t&&this._usedKeys.add(e),t}set(e,t){this._usedKeys.add(e),this._map.set(e,t)}forEach(e){this._map.forEach(((t,i)=>{this._usedKeys.has(i)&&e(t,i)}))}delete(e){const t=this._map.get(e);void 0!==t&&t.invalidateCache(),this._usedKeys.delete(e)}_deleteUnused(){const e=[];this._map.forEach(((t,i)=>{this._usedKeys.has(i)||e.push(i)}));for(const t of e)this._map.delete(t)}}class h extends r{constructor(){super(),this.points1=new r,this.points2=new r,this.push(this.points1),this.push(this.points2)}addPoints1Point(e,t){let i=this.points1.newItem();null!==i?(i.x=e,i.y=t):i={x:e,y:t},this.points1.push(i)}addPoints2Point(e,t){let i=this.points2.newItem();null!==i?(i.x=e,i.y=t):i={x:e,y:t},this.points2.push(i)}invalidateCache(){this.points1.invalidateCache(),this.points2.invalidateCache()}}class d{constructor(){this._data=null}setData(e){this._data=e}hitTest(e,t){return null}draw(e,t){if(null===this._data)return;const i=t.pixelRatio,s=.25*this._data.barSpacing;this._data.colorAreas.forEach((t=>{var n,o;e.beginPath();for(let n=0;n<t.length();n++){const o=t.at(n);if(0===o.points1.length()||0===o.points2.length())continue;const r=o.points1.at(0).x,a=o.points1.at(0).y;if(e.moveTo(Math.round(r*i),a*i),1!==o.points1.length()&&1!==o.points2.length()){for(let t=1;t<o.points1.length();t++)e.lineTo(Math.round(o.points1.at(t).x*i),o.points1.at(t).y*i);for(let t=o.points2.length()-1;t>=0;t--)e.lineTo(Math.round(o.points2.at(t).x*i),o.points2.at(t).y*i)}else{const t=o.points2.at(0).x,n=o.points2.at(0).y;e.lineTo(Math.round((r+s)*i),a*i),e.lineTo(Math.round((t+s)*i),n*i),e.lineTo(Math.round((t-s)*i),n*i),e.lineTo(Math.round((r-s)*i),a*i)}}if(e.closePath(),0===t.color.type)e.fillStyle=t.color.color;else{const s=e.createLinearGradient(0,t.color.value1*i,0,t.color.value2*i);s.addColorStop(0,null!==(n=t.color.color1)&&void 0!==n?n:"transparent"),s.addColorStop(1,null!==(o=t.color.color2)&&void 0!==o?o:"transparent"),e.fillStyle=s}e.fill()}))}}var c=i(812363),u=i(837291);function _(e){return 0===e.type?`${e.color}`:`${e.color1}:${e.color2}:${e.value1}:${e.value2}`}class p extends r{constructor(){super(...arguments),this._startIndex=0}setStartIndex(e){this._startIndex=e}isValidIndex(e){return e>=this._startIndex}at(e){const t=e-this._startIndex;for(;t>=this._actualLength;)this._items.length<=t?this._items.push(this._newObject()):this._clearObject(this._items[this._actualLength]),this._actualLength+=1;return this._items[t]}}class f extends p{_newObject(){return{plot1Value:void 0,plot2Value:void 0,colorValue:void 0}}_clearObject(e){e.plot1Value=void 0,e.plot2Value=void 0,e.colorValue=void 0}}class m extends p{_newObject(){return{type:void 0,colorIndexOrRgba:void 0,colorIndexOrRgba1:void 0,colorIndexOrRgba2:void 0,value1:void 0,value2:void 0}}_clearObject(e){const t=e;t.type=void 0,t.colorIndexOrRgba=void 0,t.colorIndexOrRgba1=void 0,t.colorIndexOrRgba2=void 0,t.value1=void 0,t.value2=void 0}}class v{constructor(e,t,i=!1){this._isHlineFill=!1,this._bandAKey=null,this._bandBKey=null,this._colorPlotIndex=null,this._colors=new r,
this._areaRenderer=new d,this._invalidated=!0,this._plIndex1=null,this._plIndex2=null,this._level1=0,this._level2=0,this._studyValuesCache=new f,this._colorValuesCache=new m,this._points1=new r,this._points2=new r,this._timePoints=new r,this._colorAreas=new l,this._source=e,this._model=t,this._fillGaps=i}update(){this._invalidated=!0}renderer(e,t){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._areaRenderer}_correctVisibleRange(e,t){var i,s,n,o;const r=this._source.data().plottableRange(),a=e.firstBar()+Math.min(0,t)-1,l=e.lastBar()-t+1,h=this._plotIndex1(),d=this._plotIndex2(),u=r.search(a,c.PlotRowSearchMode.NearestLeft,h),_=r.search(a,c.PlotRowSearchMode.NearestLeft,d),p=r.search(l,c.PlotRowSearchMode.NearestRight,h),f=r.search(l,c.PlotRowSearchMode.NearestRight,d),m=Math.min(null!==(i=null==u?void 0:u.index)&&void 0!==i?i:1/0,e.firstBar()-1),v=Math.min(null!==(s=null==_?void 0:_.index)&&void 0!==s?s:1/0,e.firstBar()-1),g=Math.max(null!==(n=null==p?void 0:p.index)&&void 0!==n?n:-1/0,e.lastBar()+1),y=Math.max(null!==(o=null==f?void 0:f.index)&&void 0!==o?o:-1/0,e.lastBar()+1);let x=1/0;if(null!==this._colorPlotIndex&&(null!==u||null!==_)){const e=r.search(Math.min(m,v)-1,c.PlotRowSearchMode.NearestLeft);null!==e&&(x=e.index)}return[Math.min(m,v,x),Math.max(g,y)]}_plotNames(){return this._source.metaInfo().plots.map((e=>e.id))}_plotIndex1(){return null===this._plIndex1&&(this._plIndex1=this._plotNames().indexOf(this._plotAId())+1),this._plIndex1}_plotIndex2(){return null===this._plIndex2&&(this._plIndex2=this._plotNames().indexOf(this._plotBId())+1),this._plIndex2}_updateImpl(){var e,t;if(this._areaRenderer.setData(null),!this._visible())return;const i=this._source.priceScale(),r=this._model,a=r.timeScale();if(!i||i.isEmpty()||a.isEmpty())return;if(r.mainSeries().bars().isEmpty())return;const l=this._source.firstValue();if(null===l)return;if(this._isHlineFill){const e=this._source.properties().bands[(0,s.ensureNotNull)(this._bandAKey)],t=this._source.properties().bands[(0,s.ensureNotNull)(this._bandBKey)];this._level1=i.priceToCoordinate(e.value.value(),l),this._level2=i.priceToCoordinate(t.value.value(),l)}const h=a.visibleBarsStrictRange();if(null===h)return;const d=new Map,c=e=>{let t=d.get(e);return void 0===t&&(t=i.priceToCoordinate(e,l),d.set(e,t)),t},u=(0,o.clamp)(this._transparency(),0,100),_=new Map,p=e=>{let t=_.get(e);return void 0===t&&(t=(0,n.generateColor)(e,u),_.set(e,t)),t};this._timePoints.invalidateCache(),this._points1.invalidateCache(),this._points2.invalidateCache(),this._colors.invalidateCache(),this._colorAreas.invalidateCache();const f=this._source.offset(this._plotAId()),m=this._source.offset(this._plotBId()),v=Math.min(f,m),g=Math.max(f,m),[y,x]=this._correctVisibleRange(h,g),b=null!==this._colorPlotIndex?this._colors:null,w=this._plotIndex1(),S=this._plotIndex2(),P=this._source.data().plottableRange();if(P.isEmpty())return;let I,C;const M=(0,s.ensureNotNull)(P.firstIndex()),R=(0,
s.ensureNotNull)(P.lastIndex()),T=M-Math.max(0,-v),B=R+Math.max(0,g),V=Math.max(y,T),D=Math.min(x,B),L=this._studyValuesCache,N=this._colorValuesCache;L.invalidateCache(),N.invalidateCache();const k=V-g,A=P.rangeIterator(k,D-v);let O;for(L.setStartIndex(k),N.setStartIndex(k);A.hasNext();){const e=A.next(),t=e.index,i=e.value,n=i[w],o=i[S],r=t+f,a=t+m;if(r===a&&L.isValidIndex(r)){const e=L.at(r);e.plot1Value=n,e.plot2Value=o}else{if(L.isValidIndex(r)){L.at(r).plot1Value=n}if(L.isValidIndex(a)){L.at(a).plot2Value=o}}if(null!==b&&void 0!==O){const e=O+v;if(L.isValidIndex(e)){const t=L.at(e),n=(0,s.ensureNotNull)(this._colorPlotIndex);if(0===n.type){const s=N.at(e);t.colorValue=s,s.type=0,s.colorIndexOrRgba=i[n.colorIndexOrRgba+1]}else{const s=N.at(e);t.colorValue=s,s.colorIndexOrRgba1=void 0===n.colorIndexOrRgba1?void 0:i[n.colorIndexOrRgba1+1],s.colorIndexOrRgba2=void 0===n.colorIndexOrRgba2?void 0:i[n.colorIndexOrRgba2+1],s.value1=void 0===n.valueIndex1?void 0:i[n.valueIndex1+1],s.value2=void 0===n.valueIndex2?void 0:i[n.valueIndex2+1]}}}O=t}const W=this._timePoints,H=this._points1,E=this._points2;let z=null;const F=k+L.length();for(let i=k;i<F;i++){if(!this._fillGaps&&(null===I||null===C)){const e=i-1;W.push(e),H.push(NaN),E.push(NaN),null==b||b.push(null)}const s=L.at(i);if(null!==this._colorPlotIndex){const e=s.colorValue;void 0===e||0===e.type&&null==e.colorIndexOrRgba||1===e.type&&(void 0!==this._colorPlotIndex.valueIndex1&&null==e.value1||void 0!==this._colorPlotIndex.valueIndex2&&null==e.value2)?z=null:(z=this._getColorByPlotValue(e),null!==z&&(1===z.type?(z.value1=c(z.value1),z.value2=c(z.value2),z.color1=z.color1&&p(z.color1),z.color2=z.color2&&p(z.color2)):z.color=p(z.color)))}if(this._isHlineFill){W.push(i),null!==b&&b.push(z);continue}const n=null!==(e=s.plot1Value)&&void 0!==e?e:null,o=null!==(t=s.plot2Value)&&void 0!==t?t:null;(null!==n||null!==o||Number.isFinite(I)||Number.isFinite(C))&&(I=n,C=o,H.push(n),E.push(o),W.push(i),null!==b&&b.push(z))}i.pricesArrayToCoordinates(H.data(),l,H.length()),i.pricesArrayToCoordinates(E.data(),l,E.length()),a.indexesToCoordinates(W.data(),W.length());const U={barSpacing:this._model.timeScale().barSpacing(),colorAreas:this._getFilledAreas(W,H,E,b,c,p)};this._areaRenderer.setData(U)}_getFilledAreas(e,t,i,s,n,o){var r,d;const c=this._isHlineFill;if(!c&&(0===t.length()||0===i.length()))return new l;const p=this._colorAreas;let f=null,m=null;const v={type:0,color:""},g=this._commonColor();1===g.type?(g.value1=n(g.value1),g.value2=n(g.value2),g.color1=g.color1&&o(g.color1),g.color2=g.color2&&o(g.color2)):g.color=o(g.color);const y=e.length();for(let n=0;n<y;n++){const o=c?this._level1:t.at(n),l=c?this._level2:i.at(n),w=e.at(n),S=(0,u.coordinateIsValid)(o),P=(0,u.coordinateIsValid)(l);if(this._fillGaps?S||P:S&&P){const e=s?s.at(n)||v:g;if(b=e,!(null===(x=m)||null===b?x===b:0===x.type&&0===b.type?x.color===b.color:1===x.type&&1===b.type&&x.color1===b.color1&&x.color2===b.color2&&x.value1===b.value1&&x.value2===b.value2)||null===f){if(null!==f&&(S&&f.addPoints1Point(w,o),
P&&f.addPoints2Point(w,l)),n===y-1)continue;m=e;const t=_(e),i=null!==(r=p.get(t))&&void 0!==r?r:new a(e);f=null!==(d=i.newItem())&&void 0!==d?d:new h,i.push(f),p.set(t,i)}S&&f.addPoints1Point(w,o),P&&f.addPoints2Point(w,l)}else this._fillGaps||(m=null,f=null)}var x,b;return p.delete(_(v)),p}}},224186:(e,t,i)=>{i.d(t,{AreaBackgroundPaneView:()=>r});var s=i(650151),n=i(43329),o=i(43239);class r extends o.AbstractFilledAreaPaneView{constructor(e,t){super(e,t)}_plotAId(){return(0,s.ensureDefined)(this._source.metaInfo().area)[0].name}_plotBId(){return(0,s.ensureDefined)(this._source.metaInfo().area)[1].name}_commonColor(){return{type:0,color:this._source.properties().areaBackground.backgroundColor.value()}}_transparency(){const e=this._source.properties().areaBackground.transparency.value();return(0,n.clamp)(e,0,100)}_visible(){return this._source.properties().areaBackground.fillBackground.value()}_getColorByPlotValue(e){return this._commonColor()}}},708832:(e,t,i)=>{i.d(t,{BandBackgroundPaneView:()=>a});var s=i(650151),n=i(114123),o=i(43329),r=i(826099);class a{constructor(e){this._bandBgRenderer=new r.BandBackgroundRenderer,this._invalidated=!0,this._source=e}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._bandBgRenderer}_updateImpl(){this._bandBgRenderer.setData(null);const e=this._source.properties().childs(),t=e.bands;if(t.childCount()<2)return;const i=e.bandsBackground;if(!(null==i?void 0:i.childs().fillBackground.value()))return;const r=t[0].childs(),a=t[1].childs(),l=this._source.priceScale(),h=this._source.firstValue();if(!l||l.isEmpty()||null===h)return;const d=[l.priceToCoordinate(r.value.value(),h),l.priceToCoordinate(a.value.value(),h)],c=(0,s.ensureDefined)(e.bandsBackground).childs(),u=(0,o.clamp)(c.transparency.value(),0,100);this._bandBgRenderer.setData({gradient:!1,points:d,backcolor:(0,n.generateColor)(c.backgroundColor.value(),u)})}}},826099:(e,t,i)=>{i.d(t,{BandBackgroundRenderer:()=>n});var s=i(904244);class n extends s.MediaCoordinatesPaneRenderer{constructor(){super(),this._data=null,this._data=null}setData(e=null){this._data=e}hitTest(){return null}_drawImpl(e){var t,i;if(null===this._data||0===this._data.points.length)return;const s=e.context,n=e.mediaSize.width;if(this._data.gradient){const e=s.createLinearGradient(0,this._data.coordinate1,0,this._data.coordinate2);e.addColorStop(0,null!==(t=this._data.backColor1)&&void 0!==t?t:"transparent"),e.addColorStop(1,null!==(i=this._data.backColor2)&&void 0!==i?i:"transparent"),s.fillStyle=e}else s.fillStyle=this._data.backcolor;const o=Math.min(this._data.points[0],this._data.points[1]),r=Math.max(this._data.points[0],this._data.points[1]);s.fillRect(0,o,n,r-o)}}},307928:(e,t,i)=>{i.d(t,{BandPaneView:()=>r});var s=i(86441),n=i(758337),o=i(803936);class r{constructor(e,t){this._invalidated=!0,this._lineRenderer=new o.HorizontalLineRenderer,this._source=t,this._points=[new s.Point(-1,-1)],this._invalidated=!0,this._properties=e}update(){this._invalidated=!0}renderer(){
this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e={y:this._points[0].y,color:this._properties.childs().color.value(),linewidth:this._properties.childs().linewidth.value(),linestyle:this._properties.childs().linestyle.value()};return this._lineRenderer.setData(e),this._lineRenderer}_updateImpl(){const e=this._source.priceScale();if(!e||e.isEmpty())return void(this._points[0]=new s.Point(-1,-1));const t=this._properties.childs().value.value(),i=this._source.firstValue(),o=(0,n.isNumber)(t)&&null!==i?e.priceToCoordinate(t,i):NaN;this._points[0]=new s.Point(-1,o)}}},891526:(e,t,i)=>{i.d(t,{HlineFillPaneView:()=>a});var s=i(650151),n=i(43329),o=i(114123),r=i(826099);class a{constructor(e,t,i){var n;this._bandBgRenderer=new r.BandBackgroundRenderer,this._bandAKey=null,this._bandBKey=null,this._invalidated=!0,this._source=e,(0,s.assert)("hline_hline"===t.type,"Wrong filledArea type: "+t.type),this._initBandIndexes(t.objAId,t.objBId),this._fillStyleProps=i,this._bandBgRenderer=new r.BandBackgroundRenderer,this._gradientFillType=i.hasChild("fillType")&&"gradient"===(null===(n=i.childs().fillType)||void 0===n?void 0:n.value()),this._gradientStaticState={color1:t.topColor,color2:t.bottomColor,value1:t.topValue,value2:t.bottomValue}}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._bandBgRenderer}_updateImpl(){var e,t,i,r,a,l,h,d;if(this._bandBgRenderer.setData(null),!this._fillStyleProps.childs().visible.value())return;if(null===this._bandAKey||null===this._bandBKey)return;const c=(0,s.ensureDefined)(this._source.properties().childs().bands),u=c.childs()[this._bandAKey].childs(),_=c.childs()[this._bandBKey].childs(),p=this._source.priceScale(),f=this._source.firstValue();if(!p||p.isEmpty()||null===f)return;const m=[p.priceToCoordinate(u.value.value(),f),p.priceToCoordinate(_.value.value(),f)],v=(0,n.clamp)(this._fillStyleProps.childs().transparency.value(),0,100);let g;const y=this._fillStyleProps.childs();if(this._gradientFillType){const s=this._gradientStaticState,n=y,c=null!==(e=s.value1)&&void 0!==e?e:null===(t=n.topValue)||void 0===t?void 0:t.value(),u=null!==(i=s.value2)&&void 0!==i?i:null===(r=n.bottomValue)||void 0===r?void 0:r.value();if(void 0===c||void 0===u)return;const _=null!==(a=s.color1)&&void 0!==a?a:null===(l=n.topColor)||void 0===l?void 0:l.value(),x=null!==(h=s.color2)&&void 0!==h?h:null===(d=n.bottomColor)||void 0===d?void 0:d.value();if(void 0===_&&void 0===x)return;g={gradient:!0,points:m,backColor1:_&&(0,o.generateColor)(_,v),backColor2:x&&(0,o.generateColor)(x,v),coordinate1:p.priceToCoordinate(c,f),coordinate2:p.priceToCoordinate(u,f)}}else g={gradient:!1,points:m,backcolor:(0,o.generateColor)(y.color.value(),v)};this._bandBgRenderer.setData(g)}_initBandIndexes(e,t){this._bandAKey=null,this._bandBKey=null;(0,s.ensureDefined)(this._source.metaInfo().bands).forEach(((i,s)=>{null===this._bandAKey&&i.id===e&&(this._bandAKey=s),null===this._bandBKey&&i.id===t&&(this._bandBKey=s)}))}}},117168:(e,t,i)=>{i.d(t,{DwgExtend:()=>s,
isExtendInSameDirection:()=>r,convertPointsToScreenDimension:()=>a,doesItemAffectVisibleRange:()=>l});var s,n=i(650151);function o(e,t){return e===s.None?t:t===s.None?e:e===s.Both||t===s.Both?s.Both:e===t?t:s.Both}function r(e,t){return e===s.Both||e===t}function a(e,t,i,r,a,l,h,d,c,u){let _,p;if(null===e&&null===i){if(a!==s.Right&&a!==s.Both)return null;a=s.Both,_=0,p=d}else null===e?(_=h.indexToCoordinate((0,n.ensureNotNull)(i)-1),a=o(a,s.Left)):_=h.indexToCoordinate(e),null===i?(p=h.indexToCoordinate((0,n.ensureNotNull)(e)-1),a=o(a,s.Right)):p=h.indexToCoordinate(i);const f=_,m=l.priceToCoordinate(t,c),v=p,g=l.priceToCoordinate(r,c);return void 0!==u?(u.x1=f,u.y1=m,u.x2=v,u.y2=g,u.extend=a,u):{x1:f,y1:m,x2:v,y2:g,extend:a}}function l(e,t,i,n,o){let r=!1;switch(i){case s.Both:r=!0;break;case s.Right:r=null===t||null===e||e<=o;break;case s.Left:r=null===t||t>=n;break;default:null!==e&&null!==t?r=(e>=n||t>=n)&&(e<=o||t<=o):null!==e&&null===t?r=e<=o:null===e&&null!==t&&(r=t>=n)}return r}!function(e){e.None="n",e.Left="l",e.Right="r",e.Both="b"}(s||(s={}))},547465:(e,t,i)=>{i.d(t,{DwgLabelPaneViewConstants:()=>s,calculateLabelHeight:()=>r,calculateDwgLabelsMargins:()=>a});var s,n=i(519872),o=i(650883);function r(e,t,i){let s=i;switch(t){case n.PlotSymbolSize.Tiny:s=.6*e;break;case n.PlotSymbolSize.Small:s=.8*e;break;case n.PlotSymbolSize.Normal:s=e;break;case n.PlotSymbolSize.Large:s=1.5*e;break;case n.PlotSymbolSize.Huge:s=2*e}return s}function a(e,t,i){const n=e.model().timeScale().barSpacing(),a=Math.round(n*s.AUTO_SIZE_MULT),l=r(s.NORMAL_SIZE,t.size,a)*s.SHAPE_HEIGHT_MULT;switch(t.style){case o.DwgLabelStyle.LabelUp:case o.DwgLabelStyle.LabelLeftUp:case o.DwgLabelStyle.LabelRightUp:return{bottomPixelMargin:l,topPixelMargin:0};case o.DwgLabelStyle.LabelDown:case o.DwgLabelStyle.LabelLeftDown:case o.DwgLabelStyle.LabelRightDown:return{bottomPixelMargin:0,topPixelMargin:l};case o.DwgLabelStyle.LabelLeft:case o.DwgLabelStyle.LabelRight:case o.DwgLabelStyle.LabelCenter:return{bottomPixelMargin:.5*l,topPixelMargin:.5*l}}return{bottomPixelMargin:0,topPixelMargin:0}}!function(e){e.NORMAL_SIZE=50,e.AUTO_SIZE_MULT=1,e.SHAPE_HEIGHT_MULT=.5,e.SHAPE_WIDTH_MULT=.6,e.FONT_SIZE_MULT=.24}(s||(s={}))},772827:(e,t,i)=>{i.d(t,{LevelPriceAxisView:()=>o});var s=i(841404),n=i(114123);class o extends s.PriceAxisView{constructor(e,t){super(),this._source=e,this._data=t}_updateRendererData(e,t,i){var s,o;e.visible=!1;const r=this._source.priceScale(),a=this._source.properties().childs(),l=a.visible.value();if(!r||r.isEmpty()||!l)return;const h=null===(o=null===(s=a.graphics.childs()[this._data.lineType])||void 0===s?void 0:s.childs()[this._data.styleId])||void 0===o?void 0:o.childs();if(!(void 0!==h&&h.visible&&h.visible.value()&&h.showPrice&&h.showPrice.value()&&this._isLabelVisibleAccordinglyToProperties()))return;const d=this._source.firstValue();if(null===d)return;const c=this._data.line.level,u=(0,n.resetTransparency)(h.color.value());i.background=u,i.textColor=this.generateTextColor(u),i.coordinate=r.priceToCoordinate(c,d),
e.text=r.formatPrice(c,d,!0),e.visible=!0}_isLabelVisibleAccordinglyToProperties(){const e=this._source.model().properties().childs().scalesProperties.childs();return(e.showStudyLastValue.value()||e.showFundamentalLastValue.value())&&this._source.properties().childs().showLabelsOnPriceScale.value()}}},24668:(e,t,i)=>{i.d(t,{studyGraphicsFirstValue:()=>x,studyGraphicsPixelsMargins:()=>v,studyGraphicsPriceRange:()=>m});var s=i(650151),n=i(168210),o=i(547465);class r{constructor(e,t,i=!1){this.price=t,this.index=e,this.useMainSeriesForPriceRange=i}}var a=i(117168);function l(e,t,i,n){if(e.y1===e.y2)return function(e,t,i){return(0,s.assert)(e.y1===e.y2),(0,a.doesItemAffectVisibleRange)(e.x1,e.x2,e.extend,t,i)?[new r(t,e.y1,!1),new r(i,e.y2,!1)]:[]}(e,i,n);const o=[];return null!==e.x1&&o.push(new r(e.x1,e.y1,!1)),null!==e.x2&&o.push(new r(e.x2,e.y2,!1)),o}function h(e,t,i,s){return(0,a.doesItemAffectVisibleRange)(e.left,e.right,e.extend,i,s)?[new r(i,e.top,!1),new r(s,e.bottom,!1)]:[]}var d=i(650883);function c(e,t,i,s){let n;const o=e.yloc!==d.DwgLabelYloc.Price&&e.yloc!==d.DwgLabelYloc.Auto;if(o){const i=e.yloc===d.DwgLabelYloc.AboveBar?2:3,s=t.valueAt(e.x);null!==s&&(n=s[i])}else n=e.y;return null==n?null:[new r(e.x,n,o)]}function u(){return{topPixelMargin:0,bottomPixelMargin:0}}class _{constructor(e,t,i,n,o){this._map=e,this._study=t,this._bars=t.series().bars(),this._props=(0,s.ensureDefined)(t.properties().childs().graphics).childs()[i],this._getPoints=n,this._getMargins=o}groupPriceRange(e,t){let i=null;for(const[s,o]of this._map)if(this._props[s].visible.value())for(const s of o){const o=this._getPoints(s,this._bars,e,t);if(null===o)continue;let r=1/0,a=-1/0,l=!1,h=!1,d=!1;for(const i of o){const s=i.index<=t,n=i.index>=e;l=l||s,h=h||n,d=d||s&&n;let o=i.price,c=i.price;if(i.useMainSeriesForPriceRange){const e=this._bars.valueAt(i.index);if(null===e)continue;const t=e[2];if(null==t)continue;const s=e[3];if(null==s)continue;o=s,c=t}o<r&&(r=o),c>a&&(a=c)}if(!(d||l&&h))continue;const c=new n.PriceRange(r,a);i=null===i?c:i.merge(c)}return i}firstValue(e,t){let i=1/0,s=1/0,n=-1/0,o=1/0,a=1/0,l=1/0;for(const[r,h]of this._map)if(this._props[r].visible.value())for(const r of h){const h=this._getPoints(r,this._bars,e,t);if(null!==h)for(const r of h){const h=r.index;h>=e&&h<=t&&h<i?(i=h,s=r.price):h<e&&h>n?(n=h,o=r.price):h>t&&h<a&&(a=h,l=r.price)}}return{firstVisible:i===1/0?null:new r(i,s),leftClosest:n===-1/0?null:new r(n,o),rightClosest:a===1/0?null:new r(a,l)}}groupPixelMargins(e,t){const i={topPixelMargin:0,bottomPixelMargin:0};if(null===this._study.priceScale())return i;if(null===this._study.firstValue())return i;for(const[s,n]of this._map)if(this._props[s].visible.value())for(const s of n){const n=this._getPoints(s,this._bars,e,t);if(null===n)continue;if(0===n.filter((i=>{const s=i.index;return s>=e&&s<=t})).length)continue;const o=this._getMargins(s,this._bars);i.bottomPixelMargin=Math.max(i.bottomPixelMargin,o.bottomPixelMargin),i.topPixelMargin=Math.max(i.topPixelMargin,o.topPixelMargin)}return i}}const p=()=>({
bottomPixelMargin:0,topPixelMargin:0});function f(e,t,i){const s=e.graphics(),n=s.dwglines();let d;return[new _(s.dwglabels(),e,"dwglabels",c,o.calculateDwgLabelsMargins.bind(null,e)),new _(n,e,"dwglines",l,p),new _(s.dwgboxes(),e,"dwgboxes",h,p),new _(s.dwglinefills(),e,"dwglinefills",((e,t,i,s)=>{if(void 0===d){d=new Map;for(const[,e]of n)for(const t of e)d.set(t.id,t)}return function(e,t,i,s,n){const o=e.get(t.line1),l=e.get(t.line2);return void 0!==o&&void 0!==l&&((0,a.doesItemAffectVisibleRange)(o.x1,o.x2,o.extend,s,n)||(0,a.doesItemAffectVisibleRange)(l.x1,l.x2,l.extend,s,n))?[new r(s,o.y1,!1),new r(n,o.y2,!1),new r(s,l.y1,!1),new r(n,l.y2,!1)]:[]}(d,e,0,i,s)}),u)]}function m(e,t,i){const s=f(e);let n=null;for(const e of s){const s=e.groupPriceRange(t,i);null!==s&&(n=null===n?s:n.merge(s))}return n}function v(e,t,i){const s={topPixelMargin:0,bottomPixelMargin:0},n=f(e);for(const e of n){const n=e.groupPixelMargins(t,i);s.bottomPixelMargin=Math.max(s.bottomPixelMargin,n.bottomPixelMargin),s.topPixelMargin=Math.max(s.topPixelMargin,n.topPixelMargin)}return s}function g(e,t,i){return null===t?e:null===e?t:e.index<t.index?i?t:e:i?e:t}class y{constructor(){this.firstVisible=null,this.leftClosest=null,this.rightClosest=null}improve(e){this.firstVisible=g(this.firstVisible,e.firstVisible,!0),this.leftClosest=g(this.leftClosest,e.leftClosest,!0),this.rightClosest=g(this.rightClosest,e.rightClosest,!1)}bestPrice(){return null!==this.firstVisible?this.firstVisible.price:null!==this.leftClosest?this.leftClosest.price:null!==this.rightClosest?this.rightClosest.price:null}}function x(e){const t=e.model().timeScale();if(t.isEmpty())return null;const i=t.visibleBarsStrictRange();if(null===i)return null;const s=i.firstBar(),n=i.lastBar(),o=f(e),r=new y;for(const e of o){const t=e.firstValue(s,n);r.improve(t)}return r.bestPrice()}},695810:(e,t,i)=>{i.d(t,{validateGraphicsCommands:()=>o});var s=i(130551),n=i(650151);function o(e){if(!(0,s.isObject)(e))throw new Error("Graphics commands should be wrapped in an object");if((0,s.hasProperty)(e,"create"),(0,s.hasProperty)(e,"erase")){const t=e.erase;(0,n.assert)(Array.isArray(t),"Collection of erase commands should be array");for(const e of t){if(!(0,s.isObject)(e)||!(0,s.hasProperty)(e,"action"))throw new Error("Command should be an object with 'action' property");(0,n.assert)("all"===e.action||"one"===e.action,"Erase command action should be 'all' or 'one'")}}return e}},621803:(e,t,i)=>{i.d(t,{HHistBasedValuesProvider:()=>p});var s=i(150335),n=i(650151),o=i(638456),r=i(812363),a=i(480071),l=i(738023),h=i(406146),d=i(414805),c=i(943546);function u(e,t="",i=""){return{id:t,index:e,title:i,value:"",visible:!1}}const _=o.CheckMobile.any();class p{constructor(e,t){this._emptyValues=[],this._study=e,this._model=t,void 0!==this._study.metaInfo().graphics.hhists&&this._emptyValues.push(u(0),u(1),u(2))}getItems(){return this._emptyValues}getValues(e){var t,i;const o=this._emptyValues.map((e=>({...e})));o.forEach((e=>{e.visible=this._study.isVisible(),e.value=c.notAvailable}))
;const a=this._study.properties().childs().inputs.childs().volume.value();switch(a){case h.HHistVolumeMode.UpDown:o[0].title="Up",o[1].title="Down",o[2].title="Total";break;case h.HHistVolumeMode.Total:o[0].title="Total",o[1].visible=!1,o[2].visible=!1;break;case h.HHistVolumeMode.Delta:o[0].title="Delta",o[1].title="Max(Up, Down)",o[2].title="Total"}const d=this._study.priceScale(),u=this._model.timeScale();if(null===d||d.isEmpty()||u.isEmpty()||this._hideValues())return o;if(null===e||!isFinite(e)){const t=this._study.data().last();if(null===t)return o;e=t.index}const _=this._model.crossHairSource(),p=_.price;if(!isFinite(_.y)&&(e=function(e,t){var i;const s=null===(i=e.visibleBarsStrictRange())||void 0===i?void 0:i.lastBar();if(!s)return null;const n=t.data().search(s,r.PlotRowSearchMode.NearestLeft);return n?n.index:null}(this._model.timeScale(),this._model.mainSeries()),null===e))return o;const f=function(e,t,i,s){if(0===e.size)return null;if(!i){const e=(0,n.ensureNotNull)(s.data().valueAt(t));i=s.barFunction()(e)}const o=function(e,t){let i=null;return e.forEach(((e,s)=>{s<=t&&(null===i||s>i)&&(i=s)})),i}(e,t);if(null===o)return null;const r=e.get(o);if(!r||0===r.size)return null;return function(e,t){let i=null;return e.forEach((e=>{e.priceLow<=t&&t<e.priceHigh&&(i=e)})),i}(r,i)}(this._study.graphics().hhistsByTimePointIndex(),e,p,this._model.mainSeries());if(null===f)return o.forEach((e=>{e.value="0"})),o;const m=this._study.metaInfo().graphics.hhists;if(void 0===m)return o;if(void 0===m[f.styleId])return o;const v=null===(i=null===(t=this._study.properties().childs().graphics.childs().hhists)||void 0===t?void 0:t.childs()[f.styleId])||void 0===i?void 0:i.childs(),g=new l.VolumeFormatter,y=e=>(0,s.isNumber)(e)?g.format(e):"";if(a!==h.HHistVolumeMode.Delta){if(f.rate.forEach(((e,t)=>{o[t].value=y(e),o[t].color=(0,n.ensureDefined)(v).colors[t].value()})),a===h.HHistVolumeMode.UpDown){const e=f.rate[0]+f.rate[1];o[2].value=y(e),o[2].color=(0,n.ensureDefined)(v).valuesColor.value()}}else{const e=f.rate[0]>f.rate[1]?0:1,t=(0,n.ensureDefined)(v).colors[e].value(),i=f.rate[0]+f.rate[1];[2*f.rate[e]-i,f.rate[e],i].forEach(((e,i)=>{o[i].value=y(e),o[i].color=t}))}return o}_hideValues(){return _&&(null===this._model.crossHairSource().pane||(0,d.isLineToolName)(a.tool.value())||null!==this._model.lineBeingEdited())}}},200821:(e,t,i)=>{i.d(t,{makeNextSymbolId:()=>n,makeNextStudyId:()=>r});let s=0;function n(){return s++,"ss_"+s}let o=0;function r(){return o++,"st"+o}},708412:(e,t,i)=>{i.d(t,{PlotFillPaneView:()=>l});var s=i(650151),n=i(43239),o=i(114123),r=i(519872);const a={type:0,color:"transparent"};class l extends n.AbstractFilledAreaPaneView{constructor(e,t,i,n){var o,a,l;super(e,t,!!i.fillgaps),this._palettesInfo={},this._gradientPropsStateCache=null;const h=this._source.metaInfo();this._isRGB=Boolean(h.isRGB),this._isHlineFill="hline_hline"===i.type,(0,s.assert)(this._isHlineFill||"plot_plot"===i.type,"Wrong filledArea type: "+i.type),this._isHlineFill&&this._initBandIndexes(i.objAId,i.objBId),
this._fillMetaInfo=i,this._fillStyleProps=n,this._gradientFillType=n.hasChild("fillType")&&"gradient"===(null===(o=n.childs().fillType)||void 0===o?void 0:o.value()),this._gradientStaticState={color1:i.topColor,color2:i.bottomColor,value1:i.topValue,value2:i.bottomValue},this._hasAllGradientRequiredProps=this._gradientFillType&&(void 0!==this._gradientStaticState.color1||n.hasChild("topColor")||void 0!==this._gradientStaticState.color2||n.hasChild("bottomColor"))&&(void 0!==this._gradientStaticState.value1||n.hasChild("topValue"))&&(void 0!==this._gradientStaticState.value2||n.hasChild("bottomValue"));const d=()=>{var e;return this._colorPlotIndex=null!==(e=this._colorPlotIndex)&&void 0!==e?e:{type:1}};for(let t=0;t<h.plots.length;++t){const n=h.plots[t];if(((0,r.isColorerPlot)(n)||(0,r.isDataPlot)(n))&&n.target===i.id){if((0,r.isColorerPlot)(n)){let i;void 0!==n.targetField?"topColor"===n.targetField?(d().colorIndexOrRgba1=t,i="color1"):"bottomColor"===n.targetField&&(d().colorIndexOrRgba2=t,i="color2"):this._colorPlotIndex={type:0,colorIndexOrRgba:t},(0,r.isPaletteColorerPlot)(n)&&(this._palettesInfo[null!=i?i:"color"]={map:(0,s.ensureDefined)(null===(a=(0,s.ensureDefined)(h.palettes)[n.palette])||void 0===a?void 0:a.valToIndex),values:e.properties().palettes[n.palette].colors})}else(0,r.isDataPlot)(n)&&("topValue"===n.targetField?d().valueIndex1=t:"bottomValue"===n.targetField&&(d().valueIndex2=t));if(0===(null===(l=this._colorPlotIndex)||void 0===l?void 0:l.type))break}}}update(){super.update(),this._gradientPropsStateCache=null}_correctVisibleRange(e,t){const i=super._correctVisibleRange(e,t),s=this._source.getMinFirstBarIndexForPlot(this._fillMetaInfo.id);return[Math.max(s,i[0]),i[1]]}_getColorByPlotValue(e){var t,i,n;if(0===e.type){let i;if(this._isRGB){if(null==e.colorIndexOrRgba)return null;i=(0,o.rgbaFromInteger)(e.colorIndexOrRgba)}else{const n=(0,s.ensureDefined)(this._palettesInfo.color),o=(0,s.ensureDefined)(n.map[(0,s.ensure)(e.colorIndexOrRgba)]);i=null===(t=n.values[o])||void 0===t?void 0:t.childs().color.value()}return{type:0,color:i}}const r=this._gradientColorPropsState();let a,l;if(this._isRGB)null!=e.colorIndexOrRgba1&&(a=(0,o.rgbaFromInteger)(e.colorIndexOrRgba1)),null!=e.colorIndexOrRgba2&&(l=(0,o.rgbaFromInteger)(e.colorIndexOrRgba2));else{if(null!=e.colorIndexOrRgba1){const t=(0,s.ensureDefined)(this._palettesInfo.color1);a=t.values[(0,s.ensureDefined)(t.map[e.colorIndexOrRgba1])].childs().color.value()}if(null!=e.colorIndexOrRgba2){const t=(0,s.ensureDefined)(this._palettesInfo.color2);l=t.values[(0,s.ensureDefined)(t.map[e.colorIndexOrRgba2])].childs().color.value()}}const h=null!==(i=e.value1)&&void 0!==i?i:r.value1,d=null!==(n=e.value2)&&void 0!==n?n:r.value2;return a=null!=a?a:r.color1,l=null!=l?l:r.color2,void 0===h||void 0===d||void 0===a&&void 0===l?null:{type:1,color1:a,color2:l,value1:h,value2:d}}_plotAId(){return this._fillMetaInfo.objAId}_plotBId(){return this._fillMetaInfo.objBId}_commonColor(){const e=this._fillStyleProps.childs();if(this._gradientFillType){
if(!this._hasAllGradientRequiredProps)return a;const e=this._gradientColorPropsState();return{type:1,color1:e.color1,color2:e.color2,value1:e.value1,value2:e.value2}}return{type:0,color:e.color.value()}}_transparency(){return this._fillStyleProps.childs().transparency.value()}_visible(){return this._fillStyleProps.childs().visible.value()}_initBandIndexes(e,t){this._bandAKey=null,this._bandBKey=null;const i=this._source.metaInfo().bands;if(void 0!==i)for(let s=0;s<i.length;++s){const n=i[s];null!==this._bandAKey||n.id!==e?null===this._bandBKey&&n.id===t&&(this._bandBKey=s):this._bandAKey=s}}_gradientColorPropsState(){var e,t,i,s;if(null===this._gradientPropsStateCache){const n=this._fillStyleProps.state();this._gradientPropsStateCache={color1:null!==(e=this._gradientStaticState.color1)&&void 0!==e?e:n.topColor,color2:null!==(t=this._gradientStaticState.color2)&&void 0!==t?t:n.bottomColor,value1:null!==(i=this._gradientStaticState.value1)&&void 0!==i?i:n.topValue,value2:null!==(s=this._gradientStaticState.value2)&&void 0!==s?s:n.bottomValue}}return this._gradientPropsStateCache}}},393937:(e,t,i)=>{i.d(t,{StudyPlotArrowsPaneView:()=>v});var s=i(650151),n=i(724377),o=i(43329),r=i(114123),a=i(28035),l=i(86441),h=i(858063);class d extends l.Point{constructor(e,t,i,s){super(e,t),this.height=i,this.isUp=s,this.style={}}}function c(e){return Math.round(e/4)}function u(e){return Math.round(e/2)}class _{constructor(e){this._data=e}draw(e,t){var i;const s=t.pixelRatio,n=this._data,r=u(n.barSpacing),a=c(n.barSpacing),l=r<4,h=Math.max(r/2,1),d=(0,o.ceiledEven)(r*s),_=d/2,p=Math.round(r*s);e.lineCap="butt",e.lineWidth=Math.max(1,Math.floor(s));const f=e.lineWidth%2?.5:0;for(const t of n.items){const o=t.isUp?-1:1,r=Math.round(Math.abs(t.height)*s),c=Math.round(t.x*s)+f,u=Math.round((t.y-o*a)*s)+f;e.beginPath(),e.translate(c,u);const m=null!==(i=t.style&&t.style.color)&&void 0!==i?i:t.isUp?n.colorup:n.colordown;l?(e.moveTo(0,0),e.lineTo(-_,-_*o),e.moveTo(0,0),e.lineTo(_,-_*o),e.moveTo(0,0),e.lineTo(0,-r*o),e.moveTo(-_,-r*o),e.lineTo(_,-r*o),e.lineWidth=h,e.strokeStyle=m,e.stroke()):(e.moveTo(0,0),r<p?(e.lineTo(d,-r*o),e.lineTo(-d,-r*o)):(e.lineTo(d,-p*o),e.lineTo(_,-p*o),e.lineTo(_,-r*o),e.lineTo(-_,-r*o),e.lineTo(-_,-p*o),e.lineTo(-d,-p*o)),e.lineTo(0,0),e.strokeStyle=t.isUp?n.colorBorderUp:n.colorBorderDown,e.stroke(),e.fillStyle=m,e.fill()),e.translate(-c,-u)}}hitTest(e){const t=this._data,i=u(t.barSpacing),s=Math.round(i/2),n=Math.round(i),o=c(t.barSpacing);for(const i of t.items){if(!i)continue;if(!Number.isFinite(i.x)||!Number.isFinite(i.y))continue;const t=Math.abs(i.height),r=i.isUp?-1:1,a=t+n,l=i.y-r*o,d=l-r*a,c=i.x-s,u=i.x+s;if(c<e.x&&e.x<u&&(i.isUp?l<e.y&&e.y<d:d<e.y&&e.y<l))return new h.HitTestResult(h.HitTestResult.REGULAR)}return null}}var p=i(583110);class f extends p.SelectionRenderer{_drawMarker(e,t,i,n){const{context:o,horizontalPixelRatio:r,verticalPixelRatio:a}=e,l=(0,s.ensureNotNull)(this._data),h=t.isUp?1:-1;const d=i+h*c(l.barSpacing)+h*u(l.barSpacing);let _=Math.round(3.5*r*2);_%2!=n%2&&(_+=1)
;const p=n%2/2,f=Math.round(t.x*r)+p,m=Math.round((t.y+d)*a)+p;o.beginPath(),o.arc(f,m,_/2,0,2*Math.PI,!0),o.closePath(),o.fill(),o.stroke()}}var m=i(722922);class v extends m.StudyPlotShapesPaneViewBase{constructor(){super(...arguments),this._maxAbsValue=0}renderer(){if(!this._isPlotVisible()||!this._scalesReady())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e=this._study.properties().childs().styles.childs()[this._plotName].childs(),t={},i=(0,o.clamp)(this._getTranspValue(),0,100),s=this._model.timeScale().barSpacing();t.items=this._items,t.barSpacing=s,t.colorup=(0,r.generateColor)(e.colorup.value(),i),t.colordown=(0,r.generateColor)(e.colordown.value(),i);const l=(0,n.parseRgba)(t.colorup),h=l?100*(1-l[3]):0,d=(0,n.parseRgba)(t.colordown),c=d?100*(1-d[3]):0;t.colorBorderUp=(0,r.generateColor)("#000000",h),t.colorBorderDown=(0,r.generateColor)("#000000",c),t.minHeight=this._plotStyleInfo.minHeight,t.maxHeight=this._plotStyleInfo.maxHeight;const u=new a.CompositeRenderer;if(u.append(new _(t)),this._model.selection().isSelected(this._study)&&null!==this._selectionData){const e=this._selectionData;e.barSpacing=s,u.append(new f(e))}return u}_fillItemWithPointStyle(e,t,i){const n=(0,s.ensureDefined)(e.style);e.isUp?void 0!==t.colors[5]?n.color=(0,r.generateColor)((0,s.ensureDefined)(t.colors[5]),i):n.color=(0,r.generateColor)(this._study.properties().childs().styles.childs()[this._plotName].childs().colorup.value(),i):void 0!==t.colors[6]?n.color=(0,r.generateColor)((0,s.ensureDefined)(t.colors[6]),i):n.color=(0,r.generateColor)(this._study.properties().childs().styles.childs()[this._plotName].childs().colordown.value(),i)}_createItem(e,t,i,s){if(0===t)return null;Math.abs(t)>this._maxAbsValue&&(this._maxAbsValue=Math.abs(t));const n=t>0;let o;if(n){const t=this._getSeriesVal(s,e);if(null===t)return null;o=t}else{const t=this._getSeriesVal(i,e);if(null===t)return null;o=t}return new d(e,o,t,n)}_convertItemsToCoordinates(){var e,t,i,n;const o=this._model.timeScale(),r=(0,s.ensureNotNull)(this._study.priceScale());o.timedValuesToCoordinates(this._items),r.pointsArrayToCoordinates(this._items,(0,s.ensureNotNull)(this._study.firstValue()));const a=this._study.properties().childs().styles.childs();let l=Math.abs((0,s.ensureDefined)(null!==(t=null===(e=a[this._plotName].childs().minHeight)||void 0===e?void 0:e.value())&&void 0!==t?t:this._plotStyleInfo.minHeight)),h=Math.abs((0,s.ensureDefined)(null!==(n=null===(i=a[this._plotName].childs().maxHeight)||void 0===i?void 0:i.value())&&void 0!==n?n:this._plotStyleInfo.maxHeight));if(l>h){const e=l;l=h,h=e}const d=(h-l)/this._maxAbsValue,c=this._items;for(let e=0;e<c.length;e++){const t=c[e],i=Math.abs(t.height);t.height=i*d+l}}}},912404:(e,t,i)=>{i.d(t,{StudyBackgroundPaneView:()=>_});var s=i(650151),n=i(86441),o=i(758337),r=i(114123),a=i(812363),l=i(87476),h=i(28035);class d{constructor(e){this._data=e}draw(e,t){}drawBackground(e,t){e.save();const i=this._data,s=t.pixelRatio;let n=null;const o=Math.round(this._data.w*s)
;for(let t=0;t<i.items.length;++t){const r=i.items[t];if(null==r.color){n=null;continue}e.fillStyle=r.color;const a=Math.round(r.x*s);let l=a;if(t>0){i.items[t-1].index===r.index-1&&null!==n&&(l=n+1)}const h=a+o,d=h-l+1;e.fillRect(l,Math.round(i.y*s),d,Math.round(i.h*s)),n=h}e.restore()}hitTest(e){return null}}var c=i(519872),u=i(755695);class _{constructor(e,t,i,n){this._items=[],this._invalidated=!0,this._isMarkersEnabled=l.enabled("source_selection_markers"),this._study=e,this._series=t,this._model=i,this._plotName=n;const o=this._study.metaInfo().plots;for(let e=0;e<o.length;e++){const t=o[e];t.id===this._plotName&&(this._plotIndex=e,(0,s.assert)((0,c.isBgColorerPlot)(t),"Plot '"+this._plotName+"' is not a background colorer!"))}this._colorProvider=(0,u.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),n)}items(){return this._items}update(){this._invalidated=!0}renderer(){if(1!=(1&(0,s.ensureDefined)(this._study.properties().childs().styles.childs()[this._plotName]).childs().display.value()))return null;if(!this._scalesReady())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e={items:this._items,y:0,h:(0,s.ensureNotNull)(this._study.priceScale()).height(),w:this._model.timeScale().barSpacing()},t=new h.CompositeRenderer;return t.append(new d(e)),t}_scalesReady(){const e=this._model.timeScale(),t=this._study.priceScale();return e&&!e.isEmpty()&&null!==t&&!t.isEmpty()}_getTranspValue(){const e=(0,s.ensureDefined)(this._study.properties().childs().styles.childs()[this._plotName]).childs();let t=0;return e.transparency&&(t=e.transparency.value(),t=(0,o.isNumber)(t)?t:40),t}_updateImpl(){this._items=[],(0,s.assert)(this._scalesReady(),"Scales must be ready!");const e=this._model.timeScale().visibleBarsStrictRange();if(null===e)return;const t=this._getTranspValue();let i=(0,s.ensureDefined)(this._series.nearestIndex(e.firstBar(),a.PlotRowSearchMode.NearestRight)),l=(0,s.ensureDefined)(this._series.nearestIndex(e.lastBar(),a.PlotRowSearchMode.NearestLeft));const h=this._study.offset(this._plotName);h>0?(i-=h,l+=h):(i+=h,l-=h);const d=this._study.getMinFirstBarIndexForPlot(this._plotName);if(d>l)return;i=Math.max(d,i);const c=this._study.data().rangeIterator(i,l);for(;c.hasNext();){const e=c.next();let i=e.index;const a=e.value;i+=h;const l=new n.Point(Math.floor(i)-.5,NaN);let d=(0,o.isNumber)(t)?t:50;d=Math.min(d,100),d=Math.max(d,0);const u=this._colorProvider.getPlotPointStyle(a);void 0!==u.colors[1]&&(l.color=(0,r.generateColor)((0,s.ensureDefined)(u.colors[1]),d)),l.index=i,this._items.push(l)}this._model.timeScale().timedValuesToCoordinates(this._items)}}},526904:(e,t,i)=>{i.d(t,{StudyPlotCharsPaneView:()=>g});var s=i(650151),n=i(809350),o=i(114123),r=i(28035),a=i(583110),l=i(687795),h=i.n(l),d=i(86441),c=i(438230),u=i(858063),_=i(837291),p=i(623331),f=i(482152);class m extends c.PaneRendererAbstractShape{constructor(e,t){super(null,t),this._fontSizeEnsured=0,this._ch="",this._fontFamily=p.CHART_FONT_FAMILY,this._charCache=null,null!==e&&this.setData(e)}setData(e){
super.setData(e),this._fontSizeEnsured=(0,s.ensureDefined)(this._height);const t=e.char.slice(0,40);this._ch=h()(t)[0]||" ",this._fontFamily=e.fontFamily||p.CHART_FONT_FAMILY}hitTest(e){const t=(0,_.interactionTolerance)().series+this._fontSizeEnsured/2;for(const i of this._items){if(new d.Point(i.x,i.y+i.vertOffset).subtract(e).length()<=t)return new u.HitTestResult(u.HitTestResult.REGULAR)}return null}_drawItemShape(e,t,i){const s=i.x,n=i.vertOffset>0?1:-1,o=i.y+i.vertOffset-n*Math.round(this._fontSizeEnsured/2);let r;r=i.style&&void 0!==i.style.color?i.style.color:this._color;const a=this._textImageCache(),l=t.pixelRatio;if(this._fontSizeEnsured<=4/l){e.save();const t=Math.max(1,Math.floor(l));let n=Math.max(1,Math.floor(a.textImageWidth*l));n%2!=t%2&&(n+=n>1?-1:1);const h=Math.round(o*l)+(i.vertOffset>=0?0:-n);return e.fillStyle=r,e.fillRect(Math.round(s*l)+(l%2?.5:0)-n/2,h,n,n),void e.restore()}const h={style:{fillStyle:r},location:{x:s,y:o,horzAlign:f.HorizontalAlign.Center,vertAlign:i.vertOffset>0?f.VerticalAlign.Top:f.VerticalAlign.Bottom}};a.paintTo(e,t,h)}_startPath(e,t,i,s){}_endPath(e){}_textImageCache(){return null!==this._charCache&&this._charCache.fontFamily===this._fontFamily&&this._charCache.fontSize===this._fontSizeEnsured||(this._charCache={fontSize:this._fontSizeEnsured,fontFamily:this._fontFamily,cache:new f.TextImageCache(this._ch,!1,!1,this._fontFamily,this._fontSizeEnsured,"center",0)}),this._charCache.cache}}var v=i(722922);class g extends v.StudyPlotShapesPaneViewBase{constructor(){super(...arguments),this._compositeRenderer=new r.CompositeRenderer,this._charRenderer=new m(null)}renderer(){return this._isPlotVisible()&&this._scalesReady()?(this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._compositeRenderer):null}_updateImpl(){var e,t;if(this._compositeRenderer.clear(),super._updateImpl(),0===this._items.length)return;const i=this._getTranspValue(),r=this._model.timeScale().barSpacing();let l;const h=this._study.properties().childs().styles.childs()[this._plotName].childs();l=this._plotStyleInfo.size?this._calculateShapeHeight(50,this._plotStyleInfo.size):Math.round(r);const d=h.location.value(),c=(0,o.generateColor)(h.color.value(),i),u=this._calculateVerticalOffset(d,l),_={items:this.items(),barSpacing:r,char:(0,s.ensureDefined)(null!==(t=null===(e=h.char)||void 0===e?void 0:e.value())&&void 0!==t?t:this._plotStyleInfo.char),height:l,vertOffset:u,color:c},p=this._plotStyleInfo.text;if(void 0!==p&&""!==p.trim()){let e=p.trim().replace(/\\n/gm,"\n");e=(0,n.cleanButAmpersand)(e,!0),_.text=e,_.fontSize=12;const t=h.textColor?h.textColor.value():void 0;_.textColor=t?(0,o.generateColor)(t,i):c}this._charRenderer.setData(_),this._compositeRenderer.append(this._charRenderer),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&null!==this._selectionData&&(this._selectionData.vertOffset=u,this._compositeRenderer.append(new a.SelectionRenderer(this._selectionData)))}}},394683:(e,t,i)=>{function s(e){e.lineWidth=void 0,e.lineStyle=void 0
;for(let t=0;t<e.colors.length;t++)e.colors[t]=void 0;return e}function n(){return{colors:[void 0,void 0,void 0,void 0,void 0,void 0,void 0],lineWidth:void 0,lineStyle:void 0}}i.d(t,{clearStyle:()=>s,createEmptyStyle:()=>n})},910008:(e,t,i)=>{i.d(t,{PaneRendererColumns:()=>n});var s=i(858063);class n{constructor(e){this._data=null,this._precalculatedCache=[],this.setData(e)}setData(e){this._data=e,this._precalculatedCache=[]}draw(e,t){var i,s,n,o;if(null===this._data||0===this._data.items.length)return;const r=t.pixelRatio;this._precalculatedCache.length||this._fillPrecalculatedCache(r);const a=Math.max(1,Math.floor(r)),l=Math.round(this._data.histogramBase*r)-Math.floor(a/2),h=l+a,d=this._data.lineColor,c=null!==(s=null===(i=this._data.visibleItemsRange)||void 0===i?void 0:i.startItemIndex)&&void 0!==s?s:0,u=(null!==(o=null===(n=this._data.visibleItemsRange)||void 0===n?void 0:n.endItemIndex)&&void 0!==o?o:this._data.items.length)-1;for(let t=c;t<=u;t++){const i=this._data.items[t],s=this._precalculatedCache[t-c],n=Math.round(i.y*r),o=i.style?i.style.color:d;let u,_;e.fillStyle=o,n<=l?(u=n,_=h):(u=l,_=n-Math.floor(a/2)+a),e.fillRect(s.left,u,s.right-s.left+1,_-u)}}hitTest(e){var t,i,n,o;if(null===this._data)return null;const r=.5*this._data.barSpacing,a=e.x-r,l=e.x+r,h=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,d=(null!==(o=null===(n=this._data.visibleItemsRange)||void 0===n?void 0:n.endItemIndex)&&void 0!==o?o:this._data.items.length)-1;for(let t=h;t<=d;t++){const i=this._data.items[t],n=i.x;if(n>=a&&n<=l){const t=i.y;if(e.y>=Math.min(t,this._data.histogramBase)&&e.y<=Math.max(t,this._data.histogramBase))return new s.HitTestResult(s.HitTestResult.REGULAR)}}return null}_fillPrecalculatedCache(e){var t,i,s,n;if(null===this._data||0===this._data.items.length)return void(this._precalculatedCache=[]);const o=Math.ceil(this._data.barSpacing*e)<=1?0:Math.max(1,Math.floor(e)),r=Math.round(this._data.barSpacing*e)-o,a=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,l=(null!==(n=null===(s=this._data.visibleItemsRange)||void 0===s?void 0:s.endItemIndex)&&void 0!==n?n:this._data.items.length)-1,h=l-a+1;if(h<=0)return void(this._precalculatedCache=[]);this._precalculatedCache=new Array(h);for(let t=a;t<=l;t++){const i=this._data.items[t],s=Math.round(i.x*e);let n,o;if(r%2){const e=(r-1)/2;n=s-e,o=s+e}else{const e=r/2;n=s-e,o=s+e-1}this._precalculatedCache[t-a]={left:n,right:o,roundedCenter:s,center:i.x*e,time:i.timePointIndex}}for(let e=a+1;e<=l;e++){const t=this._precalculatedCache[e-a],i=this._precalculatedCache[e-a-1];t.time===i.time+1&&(t.left-i.right!==o+1&&(i.roundedCenter>i.center?i.right=t.left-o-1:t.left=i.right+o+1))}let d=Math.ceil(this._data.barSpacing*e);for(let e=a+1;e<=l;e++){const t=this._precalculatedCache[e-a];t.right<t.left&&(t.right=t.left);const i=t.right-t.left+1;d=Math.min(i,d)}if(o>0&&d<4)for(let e=a+1;e<=l;e++){const t=this._precalculatedCache[e-a]
;t.right-t.left+1>d&&(t.roundedCenter>t.center?t.right-=1:t.left+=1)}}}},627425:(e,t,i)=>{i.d(t,{StudyPlotPaneView:()=>A});var s=i(650151),n=i(86441),o=i(724377),r=i(87476),a=i(43329),l=i(758337),h=i(114123),d=i(835343);function c(e,t){const i=new Map;return function(...s){const n=""+(t?t.apply(null,s):s[0]);if(!i.has(n)){const t=e.apply(this,s);return i.set(n,t),t}return i.get(n)}}var u=i(858063),_=i(906778),p=i(28035),f=i(943498),m=i(764372),v=i(847314),g=i(583110),y=i(394683),x=i(386482),b=i(837291),w=i(638456);class S{constructor(e){this._data=e}draw(e,t){var i,s,n,o;const r=this._data,a=t.pixelRatio,h=Math.max(1,Math.floor(a))%2?.5:0,d=r.vertOffset||0,c=r.lineColor||r.color,u=r.lineWidth||r.height/2;let _="",p=!1;const f=null!==(s=null===(i=r.visibleItemsRange)||void 0===i?void 0:i.startItemIndex)&&void 0!==s?s:0,m=null!==(o=null===(n=r.visibleItemsRange)||void 0===n?void 0:n.endItemIndex)&&void 0!==o?o:r.items.length;for(let t=f;t<m;t++){const i=r.items[t],s=i.x,n=i.y+d;if((0,l.isNaN)(s)||(0,l.isNaN)(n))continue;let o,f;null!=i.style?(o=i.style.color,f=i.style.width):(o=c,f=u),(o!==_||w.isSafari)&&(_=o,p&&e.fill(),e.beginPath(),e.fillStyle=o);const m=Math.round(s*a)+h,v=Math.round(n*a)+h,g=Math.round(f*a)+h;e.moveTo(m+g,v),e.arc(m,v,g,0,2*Math.PI,!1),p=!0}p&&e.fill()}hitTest(e){var t,i,s,o;const r=this._data,a=r.lineWidth||r.height/2,l=r.vertOffset||0,h=(0,b.interactionTolerance)().series+a,d=null!==(i=null===(t=r.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,c=null!==(o=null===(s=r.visibleItemsRange)||void 0===s?void 0:s.endItemIndex)&&void 0!==o?o:r.items.length;for(let t=d;t<c;t++){const i=r.items[t];if(new n.Point(i.x,i.y+l).subtract(e).length()+a<=h)return new u.HitTestResult(u.HitTestResult.REGULAR)}return null}}var P=i(910008),I=i(204652);class C{constructor(e){this._data=e}draw(e,t){var i,s,n,o,r,a,h,d;const c=t.pixelRatio;let u="",_=!1;const p=null!==(s=null===(i=this._data.visibleItemsRange)||void 0===i?void 0:i.startItemIndex)&&void 0!==s?s:0,f=(null!==(o=null===(n=this._data.visibleItemsRange)||void 0===n?void 0:n.endItemIndex)&&void 0!==o?o:this._data.items.length)-1;for(let t=p;t<=f;t++){const i=this._data.items[t];if((0,l.isNaN)(i.x)||(0,l.isNaN)(i.y))continue;const s=null!==(a=null===(r=i.style)||void 0===r?void 0:r.color)&&void 0!==a?a:this._data.lineColor,n=Math.max(1,Math.floor((null!==(d=null===(h=i.style)||void 0===h?void 0:h.width)&&void 0!==d?d:this._data.lineWidth)*c));(s!==u||w.isSafari)&&(u=s,_&&e.fill(),e.beginPath(),e.fillStyle=s);let o=3*n;o%2!=n%2&&(o+=1);const p=Math.round(Math.round(i.x*c)-o/2),f=Math.round(Math.round(i.y*c)-o/2),m=p+Math.floor(o/2-n/2),v=f+Math.floor(o/2-n/2);e.rect(p,v,o,n),e.rect(m,f,n,o),_=!0}_&&e.fill()}hitTest(e){const t=(0,b.interactionTolerance)().series+this._data.lineWidth/2;let i,s,o,r;for(let a=1;a<this._data.items.length;++a){i=this._data.items[a-1],s=this._data.items[a],o=i.x,r=s.x;if((0,
I.distanceToSegment)(new n.Point(o,i.y),new n.Point(r,s.y),new n.Point(e.x,e.y)).distance<=t)return new u.HitTestResult(u.HitTestResult.REGULAR)}return null}}class M{constructor(e){this._data=e}draw(e,t){var i,s,n,o;if(0===this._data.items.length)return;const r=t.pixelRatio;e.fillStyle=this._data.lineColor;const a=Math.max(1,Math.floor(this._data.lineWidth*r)),l=a/2,h=Math.max(1,Math.floor(r)),d=Math.round(this._data.histogramBase*r)-Math.floor(h/2),c=d+h,u=null!==(s=null===(i=this._data.visibleItemsRange)||void 0===i?void 0:i.startItemIndex)&&void 0!==s?s:0,_=(null!==(o=null===(n=this._data.visibleItemsRange)||void 0===n?void 0:n.endItemIndex)&&void 0!==o?o:this._data.items.length)-1;for(let t=u;t<=_;t++){const i=this._data.items[t];let s=a,n=l;i.style?(e.fillStyle=i.style.color,s=Math.max(1,Math.floor(i.style.width*r)),n=s/2):e.fillStyle=this._data.lineColor;const o=s%2?.5:0,u=Math.round(i.x*r)+o,_=Math.round(i.y*r);let p,f;_<=d?(p=_,f=c):(p=d,f=_-Math.floor(h/2)+h),e.fillRect(Math.floor(u-n),p,s,f-p)}}hitTest(e){const t=(0,b.interactionTolerance)().series+this._data.lineWidth/2,i=new Map;for(const o of this._data.items){const r=o.x,a=o.y;let l=t;o.style&&(i.has(o.style.width)?l=(0,s.ensureDefined)(i.get(o.style.width)):i.set(this._data.lineWidth,l));if((0,I.distanceToSegment)(new n.Point(r,a),new n.Point(r,this._data.histogramBase),new n.Point(e.x,e.y)).distance<=l)return new u.HitTestResult(u.HitTestResult.REGULAR)}return null}}var R=i(519872),T=i(755695),B=i(923195),V=i(812363);const D=e=>{const t=(0,o.rgbToHsl)((0,o.parseRgb)(e)),i=t[0]+.05;return t[0]=i-Math.floor(i),(0,o.rgbToHexString)((0,o.hslToRgb)(t))},L=c(D);function N(e,t){if(null===e)return t;const i=e.firstIndex,s=t.firstIndex,n=e.clearData||t.clearData;return{firstIndex:n||void 0===i||void 0===s?void 0:Math.min(i,s),clearData:n}}const k=new Set([R.LineStudyPlotStyle.Line,R.LineStudyPlotStyle.Area,R.LineStudyPlotStyle.Circles,R.LineStudyPlotStyle.Cross,R.LineStudyPlotStyle.StepLine,R.LineStudyPlotStyle.StepLineWithDiamonds]);class A{constructor(e,t,i,s,n=!1){this._histogramBase=null,this._items=[],this._lastConfirmedSeriesBarCoordinate=NaN,this._selectionData=null,this._lineColor="",this._lineWidth=1,this._color1="",this._color2="",this._dataInvalidated=null,this._viewportInvalidated=!1,this._renderer=new p.CompositeRenderer,this._isMarkersEnabled=r.enabled("source_selection_markers"),this._study=e,this._series=t,this._model=i,this._plotName=s,this._plotIndex=e.metaInfo().plots.findIndex((e=>e.id===s)),this._colorProvider=(0,T.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),s),this._selectionIndexer=new v.SelectionIndexes(i.timeScale()),this._extendStepLineToBarsEndings=n,this._useFirstUnplottableRow=(0,x.isFundamentalStudyMetaInfo)(e.metaInfo())}items(){return this._items}update(e){if("global-change"===e.type)return this._dataInvalidated=N(this._dataInvalidated,{}),void(this._viewportInvalidated=!0);if("data-source-change"!==e.type)this._viewportInvalidated=!0;else{if(e.sourceId===this._study.id()){const t=N(this._dataInvalidated,{
firstIndex:e.firstUpdatedTimePointIndex,clearData:e.clearData});this._dataInvalidated=t}}}renderer(){return this._dataInvalidated?this._updateImplFull(this._viewportInvalidated)&&(this._dataInvalidated=null):this._viewportInvalidated&&this._updateImplLight(),this._viewportInvalidated=!1,this._renderer}_getTranspValue(){const e=this._study.properties(),t=e.styles[this._plotName];let i=0;const s=this._study.metaInfo();return"Volume@tv-basicstudies"===s.id&&s.version<=46&&"transparency"in e?(i=e.transparency.value(),i=(0,l.isNumber)(i)?i:0,i):(t.transparency&&(i=t.transparency.value(),i=(0,l.isNumber)(i)?i:0),i)}_updateImplFull(e){var t,i,o,r,l;if(this._renderer.clear(),(null===(t=this._dataInvalidated)||void 0===t?void 0:t.clearData)&&(this._items=[]),!this._study.isPlotVisibleAt(this._plotName,1))return!1;if(!this._study.priceScale())return!1;const d=this._study.firstValue();if(null===d)return!1;const c=this._study.priceScale();if(null===c)return!1;this._histogramBase=null;const u=this._study.properties().styles[this._plotName],_=(0,s.ensureDefined)(null===(i=this._study.metaInfo().styles)||void 0===i?void 0:i[this._plotName]),p=u.plottype.value(),f=this._useFirstUnplottableRow&&(p===R.LineStudyPlotStyle.StepLine||p===R.LineStudyPlotStyle.StepLineWithDiamonds),m=this._study.data().plottableRange(f),v=m.size();if(0===v)return!1;const g=this._study.offset(this._plotName);let x=null===(o=this._dataInvalidated)||void 0===o?void 0:o.firstIndex;const b=k.has(p);if(v!==this._items.length){const e=void 0!==x?x+g:void 0;if(void 0===e||0===this._items.length||e<(0,s.ensureDefined)(this._items[0].timePointIndex))this._items=[],m.each(((e,t)=>{const i=t[this._plotIndex+1];if(b&&null==i)return!1;const s=new n.Point(NaN,NaN);return s.origPrices=new n.Point(NaN,NaN),s.timePointIndex=e+g,this._items.push(s),!1})),x=this._items.length?(0,s.ensureDefined)(this._items[0].timePointIndex)-g:void 0;else{const e=this._items[this._items.length-1].timePointIndex,t=(0,s.ensureDefined)(e)-g,i=(0,s.ensureNotNull)(m.lastIndex())+1,o=m.rangeIterator(t+1,i);for(;o.hasNext();){const e=o.next(),t=e.value[this._plotIndex+1],i=null==t;if(b&&i)continue;const s=new n.Point(NaN,NaN);s.origPrices=new n.Point(NaN,NaN),s.timePointIndex=e.index+g,this._items.push(s)}}}let w=NaN,S=NaN;const P=new Map,I=(e,t)=>{let i=P.get(e);void 0===i&&(i=new Map,P.set(e,i));let s=i.get(t);if(void 0===s){const n=!this._plotName||"vol"!==this._plotName;s=(0,h.generateColor)(e,t,n),i.set(t,s)}return s},C=(0,y.createEmptyStyle)(),M=(0,a.clamp)(this._getTranspValue(),0,100),T=this._model.timeScale().visibleBarsStrictRange();if(null===T)return!1;const{startBar:V,endBar:D}=this._calculateStartEnd(T);if(null===V||null===D||0===this._items.length)return!1;const L=null!=x?x:(0,s.ensureNotNull)(m.firstIndex()),N=m.rangeIterator(L,(0,s.ensureNotNull)(m.lastIndex())+1),A=(0,B.lowerbound)(this._items,L+g,((e,t)=>e.timePointIndex<t));let O=A;for(;N.hasNext();){const e=N.next();let t=e.index;const i=e.value;t+=g,t=Math.floor(t);let o=i[this._plotIndex+1];const a=null==o;if(o=a?NaN:o,b&&a){
S=o;continue}const d=new n.Point(t,(0,s.ensure)(o));d.timePointIndex=t,d.valIsNotSameAsPrev=o!==S||t-1!==w;if(this._colorProvider.isColorDefined()&&(d.style={color:I(u.color.value(),100),width:u.linewidth.value(),style:u.linestyle.value()},null!=o)){const e=this._colorProvider.getPlotPointStyle(i,C),t=e.colors[0];void 0!==t&&(d.style.color=(0,h.isHexColor)(t)?I(t,M):t),d.style.width=null!==(r=e.lineWidth)&&void 0!==r?r:d.style.width,d.style.style=null!==(l=e.lineStyle)&&void 0!==l?l:d.style.style}if(!b&&!isNaN(w)&&w!==t-1&&O>0){const e=this._items[O-1].timePointIndex,i=new n.Point(t-1,NaN);i.origPrices=new n.Point(t-1,NaN),i.timePointIndex=e,O<this._items.length?this._items[O]=i:this._items.push(i),O++}w=t,S=o;{const e=d;e.origPrices=new n.Point(d.x,d.y),O<this._items.length?this._items[O]=e:this._items.push(e),O++}}if(this._items.length){const t=this._model.mainSeries().data().bars().lastIndex();null!==t&&(this._lastConfirmedSeriesBarCoordinate=this._model.timeScale().indexToCoordinate(t));const i=Math.max(0,(0,B.lowerbound)(this._items,V,((e,t)=>e.timePointIndex<t))),s=Math.min(this._items.length,(0,B.upperbound)(this._items,D,((e,t)=>e<t.timePointIndex))),n=e?i:Math.max(i,A),o=s;for(let e=n;e<o;e++){const t=this._items[e];t.x=t.origPrices.x,t.y=t.origPrices.y}c.pointsArrayToCoordinates(this._items,d,{startItemIndex:n,endItemIndex:o}),this._model.timeScale().timedValuesToCoordinates(this._items,{startItemIndex:n,endItemIndex:o},!0),void 0!==_.histogramBase&&(this._histogramBase=c.priceToCoordinate(_.histogramBase,d)),this._createSelection(d),this._createRenderer(i,s)}return!0}_updateImplLight(){var e;const t=this._study.firstValue();if(null===t)return this._selectionData=null,void this._createRenderer(0,-1);const i=this._study.priceScale();if(null===i)return this._selectionData=null,void this._createRenderer(0,-1);const n=this._model.timeScale().visibleBarsStrictRange();if(null===n)return this._selectionData=null,void this._createRenderer(0,-1);const{startBar:o,endBar:r}=this._calculateStartEnd(n);if(null===o||null===r||0===this._items.length)return this._selectionData=null,void this._createRenderer(0,-1);const a=Math.max(0,(0,B.lowerbound)(this._items,o,((e,t)=>e.timePointIndex<t))),l=Math.min(this._items.length,(0,B.upperbound)(this._items,r,((e,t)=>e<t.timePointIndex)));for(let e=a;e<l;e++){const t=this._items[e];t.x=t.origPrices.x,t.y=t.origPrices.y}i.pointsArrayToCoordinates(this._items,t,{startItemIndex:a,endItemIndex:l}),this._model.timeScale().timedValuesToCoordinates(this._items,{startItemIndex:a,endItemIndex:l},!0);const h=(0,s.ensureDefined)(null===(e=this._study.metaInfo().styles)||void 0===e?void 0:e[this._plotName]);void 0!==h.histogramBase&&(this._histogramBase=i.priceToCoordinate(h.histogramBase,t)),this._createSelection(t);const d=this._model.mainSeries().data().bars().lastIndex();null!==d&&(this._lastConfirmedSeriesBarCoordinate=this._model.timeScale().indexToCoordinate(d)),this._createRenderer(a,l)}_calculateStartEnd(e){const t=this._study.offset(this._plotName)
;let i=e.firstBar()-Math.abs(t)-1,s=e.lastBar()+Math.abs(t)+1;const n=this._study.data(),o=n.search(i,V.PlotRowSearchMode.NearestLeft,this._plotIndex+1),r=n.search(s,V.PlotRowSearchMode.NearestRight,this._plotIndex+1);null!==o&&(i=o.index),null!==r&&(s=r.index);const a=this._study.getMinFirstBarIndexForPlot(this._plotName)+t;return a>s+1?{startBar:null,endBar:null}:(i=Math.max(a,i),{startBar:i,endBar:s})}_createRenderer(e,t){var i,n;this._renderer.clear();const o=this._study.properties().styles.childs()[this._plotName].childs(),r=(0,s.ensureDefined)(null===(i=this._study.metaInfo().styles)||void 0===i?void 0:i[this._plotName]),c=(0,a.clamp)(this._getTranspValue(),0,100);this._lineColor=(0,h.generateColor)(o.color.value(),c),this._lineWidth=o.linewidth.value();let u=o.color.value();const p=this._colorProvider.getDefaultPlotPointStyle();p&&(u=p.colors[0]||u,this._lineWidth=null!==(n=p.lineWidth)&&void 0!==n?n:this._lineWidth,this._lineColor=u?(0,h.generateColor)(u,c):this._lineColor),this._color2=(0,h.generateColor)(u,c);const v=this._study.metaInfo(),y=v.isRGB?D(u):L(u);this._color1=(0,h.generateColor)(y,c);const b={};b.barSpacing=this._model.timeScale().barSpacing(),b.items=this._items,b.histogramBase=this._histogramBase?this._histogramBase:(0,s.ensureNotNull)(this._study.priceScale()).height(),b.lineIndex=0,b.lineStyle=o.linestyle.value(),b.lineColor=this._lineColor,b.lineWidth=this._lineWidth,b.lineWidth=(0,l.isNumber)(b.lineWidth)?b.lineWidth:1,b.color1=this._color1,b.color2=this._color2,b.bottom=b.histogramBase,b.visibleItemsRange={startItemIndex:e,endItemIndex:t},b.lastConfirmedSeriesBarCoordinate=this._lastConfirmedSeriesBarCoordinate,b.simpleMode=this._colorProvider.singleColor();const w=this._renderer,I=r.joinPoints;switch(o.plottype.value()){case R.LineStudyPlotStyle.Line:case R.LineStudyPlotStyle.LineWithBreaks:w.append(new f.PaneRendererLine(b));break;case R.LineStudyPlotStyle.Area:case R.LineStudyPlotStyle.AreaWithBreaks:w.append(new _.PaneRendererArea(b));break;case R.LineStudyPlotStyle.Histogram:w.append(new M(b));break;case R.LineStudyPlotStyle.Columns:w.append(new P.PaneRendererColumns(b));break;case R.LineStudyPlotStyle.Cross:if(w.append(new C(b)),I){const e=(0,d.deepCopy)(b);e.lineWidth=1,e.forceLineWidth=!0,w.append(new f.PaneRendererLine(e))}break;case R.LineStudyPlotStyle.Circles:if(w.append(new S(b)),I){const e=(0,d.deepCopy)(b);e.lineWidth=1,e.ignorePaletteLineWidth=!0,w.append(new f.PaneRendererLine(e))}break;case R.LineStudyPlotStyle.StepLine:case R.LineStudyPlotStyle.StepLineWithBreaks:case R.LineStudyPlotStyle.StepLineWithDiamonds:{b.decoration=o.plottype.value()===R.LineStudyPlotStyle.StepLineWithDiamonds?m.StepLineDecoration.Diamonds:m.StepLineDecoration.None,b.extendToBarsEndings=this._extendStepLineToBarsEndings;const e=new m.PaneRendererStepLine(void 0,(0,x.isFundamentalStudyMetaInfo)(v));e.setData(b),w.append(e);break}default:w.append(new f.PaneRendererLine(b))}
this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&this._selectionData&&w.append(new g.SelectionRenderer(this._selectionData))}_createSelection(e){const t=this._study.priceScale();if(null!==t)if(this._model.selection().isSelected(this._study)){const i=this._selectionIndexer.indexes();this._selectionData={points:[],bgColors:[],visible:!0,hittestResult:u.HitTestResult.REGULAR,barSpacing:this._model.timeScale().barSpacing()};const o=(0,s.ensureNotNull)(this._model.paneForSource(this._study)).height(),r=this._study.offset(this._plotName);for(let s=0;s<i.length;s++){let a=i[s];const l=this._study.data().valueAt(a);if(a+=r,null===l)continue;const h=l[this._plotIndex+1];if(null==h)continue;const d=this._model.timeScale().indexToCoordinate(Math.floor(a)),c=t.priceToCoordinate(h,e);this._selectionData.points.push(new n.Point(d,c)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(c/o))}}else this._selectionIndexer.clear()}}},294775:(e,t,i)=>{i.d(t,{StudyPlotBarCandlesPaneView:()=>_});var s=i(86441),n=i(650151),o=i(87476),r=i(114123),a=i(847314),l=i(812363),h=i(858063),d=i(519872),c=i(394683),u=i(755695);class _{constructor(e,t,i,s){this._bars=[],this._invalidated=!1,this._isMarkersEnabled=o.enabled("source_selection_markers"),this._selectionData=null,this._ohlcPlotIndexes=new Map,this._study=e,this._series=t,this._model=i,this._plotName=s,this._isMarkersEnabled=o.enabled("source_selection_markers"),this._colorProvider=(0,u.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),s),this._selectionIndexer=new a.SelectionIndexes(i.timeScale());const n=this._study.metaInfo().plots;for(let e=0;e<n.length;e++){const t=n[e];"target"in t&&(t.target===this._plotName&&((0,d.isOhlcOpenPlot)(t)&&this._ohlcPlotIndexes.set(1,e),(0,d.isOhlcHighPlot)(t)&&this._ohlcPlotIndexes.set(2,e),(0,d.isOhlcLowPlot)(t)&&this._ohlcPlotIndexes.set(3,e),(0,d.isOhlcClosePlot)(t)&&this._ohlcPlotIndexes.set(4,e)))}}update(){this._invalidated=!0}items(){return this._bars}_updateImpl(){this._bars.length=0;const e=this._study.priceScale();if(this._model.timeScale().isEmpty()||null===e||e.isEmpty())return;const t=this._model.timeScale().visibleBarsStrictRange();if(null===t)return;let i=this._series.nearestIndex(t.firstBar(),l.PlotRowSearchMode.NearestRight);const o=this._series.nearestIndex(t.lastBar(),l.PlotRowSearchMode.NearestLeft);if(void 0===i||void 0===o)return;const a=this._study.getMinFirstBarIndexForPlot(this._plotName);if(a>o)return;i=Math.max(a,i);const d=this._study.data(),u=this._study.firstValue();if(null===u)return;const _=d.rangeIterator(i,o),p=(0,n.ensureDefined)(this._study.properties().childs().ohlcPlots).childs()[this._plotName].childs(),f=new Map,m=(e,t)=>{const i=e+"@"+t;if(!f.has(i)){const s=(0,r.generateColor)(e,t);return f.set(i,s),s}return f.get(i)},v=(0,c.createEmptyStyle)();for(;_.hasNext();){const e=_.next();let t=e.index;const i=e.value;t=Math.floor(t);let s=!0;const o=new Map;for(let e=1;e<=4;++e){const t=this._ohlcPlotIndexes.get(e);if(void 0===t){s=!1;break}const n=i[t+1]
;if(null==n){s=!1;break}o.set(e,n)}if(!s)continue;const r=(0,n.ensureDefined)(o.get(1)),a=(0,n.ensureDefined)(o.get(4)),l=(0,n.ensureDefined)(o.get(2)),h=(0,n.ensureDefined)(o.get(3)),d=Math.max(r,l,h,a),c=Math.min(r,l,h,a);let u=(0,n.ensureDefined)(m(p.color.value(),0));const f=this._colorProvider.getPlotPointStyle(i,v);void 0!==f.colors[0]&&(u=(0,n.ensureDefined)(f.colors[0]));const g={time:Math.round(t),open:r,high:d,low:c,close:a,color:u,wickColor:f.colors[4],borderColor:f.colors[3],hollow:null};this._bars.push(g)}if(e.barPricesToCoordinates(this._bars,u),this._model.timeScale().barIndexesToCoordinates(this._bars),this._model.selection().isSelected(this._study)){const t=this._selectionIndexer.indexes();this._selectionData={points:[],hittestResult:h.HitTestResult.REGULAR,bgColors:[],visible:!0,barSpacing:this._model.timeScale().barSpacing()};const i=(0,n.ensureNotNull)(this._model.paneForSource(this._study)).height(),o=(0,n.ensureDefined)(this._ohlcPlotIndexes.get(4));for(let n=0;n<t.length;n++){const r=t[n],a=this._study.data().valueAt(r);if(null===a)continue;const l=a[o+1];if(null==l)continue;const h=this._model.timeScale().indexToCoordinate(Math.floor(r)),d=e.priceToCoordinate(l,u);this._selectionData.points.push(new s.Point(h,d)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(d/i))}}else this._selectionIndexer.clear()}_isOHLCPlotVisible(){return this._study.isPlotVisibleAt(this._plotName,1)}}},356051:(e,t,i)=>{i.d(t,{StudyPlotBarsPaneView:()=>a});var s=i(28035),n=i(583110),o=i(352566),r=i(294775);class a extends r.StudyPlotBarCandlesPaneView{renderer(){if(!this._isOHLCPlotVisible())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e={bars:this._bars,barSpacing:this._model.timeScale().barSpacing(),dontDrawOpen:this._series.properties().childs().barStyle.childs().dontDrawOpen.value(),thinBars:this._series.properties().childs().barStyle.childs().thinBars.value()},t=new s.CompositeRenderer;return t.append(new o.PaneRendererBars(e)),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&this._selectionData&&t.append(new n.SelectionRenderer(this._selectionData)),t}}},602190:(e,t,i)=>{i.d(t,{StudyPlotCandlesPaneView:()=>h});var s=i(650151),n=i(28035),o=i(837291),r=i(583110),a=i(916716),l=i(294775);class h extends l.StudyPlotBarCandlesPaneView{renderer(){if(!this._isOHLCPlotVisible())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e=(0,s.ensureDefined)(this._study.properties().childs().ohlcPlots).childs()[this._plotName].childs(),t=this._model.timeScale().barSpacing(),i={bars:this._bars,barSpacing:t,wickVisible:e.drawWick.value(),bodyVisible:!0,borderVisible:e.drawBorder.value(),barWidth:(0,o.optimalBarWidth)(t),borderColor:e.borderColor.value(),wickColor:e.wickColor.value()},l=new n.CompositeRenderer;return l.append(new a.PaneRendererCandles(i)),this._model.selection().isSelected(this._series)&&this._isMarkersEnabled&&this._selectionData&&l.append(new r.SelectionRenderer(this._selectionData)),l}}},
438230:(e,t,i)=>{i.d(t,{PaneRendererAbstractShape:()=>u,PaneRendererAbstractStrokeShape:()=>_,PaneRendererAbstractFillStrokeShape:()=>p});var s=i(650151),n=i(86441),o=i(934026),r=i(858063),a=i(332679),l=i(482152),h=i(623331),d=i(741341),c=i(638456);class u{constructor(e,t={skipRenderingOptimizations:!1}){this._items=[],this._barSpacing=0,this._vertOffset=0,this._textCache=t.textCache||new a.TextImageCachesContainer(5e3),this._drawOperation=t.skipRenderingOptimizations?this._drawWithoutOptimizations.bind(this):this._drawWithOptimizations.bind(this),null!==e&&this.setData(e)}draw(e,t){this._preDrawInit(),this._drawOperation(e,t)}hitTest(e){const t=r.HitTestResult.REGULAR;let i=null;for(const s of this._items){if(!s)continue;const n=this._calcBoundingBox(s);if(n&&(0,o.pointInBox)(e,n)){const e={tooltip:this._getTooltip(s,n)};i=new r.HitTestResult(t,e)}}return i}setData(e){this._height=void 0!==e.height?e.height:e.width,this._width=void 0!==e.width?e.width:e.height,this._color=e.color,this._borderColor=e.borderColor,this._vertOffset=e.vertOffset||0,e.text&&(this._text=e.text,this._fontSize=e.fontSize,this._lineSpacing=e.lineSpacing,this._textColor=e.textColor,this._textAlign=e.textAlign||"center"),void 0!==e.items&&void 0!==e.barSpacing&&this.setItems(e.items,e.barSpacing)}setItems(e,t){this._setBaseData(e,t)}_calcBoundingBox(e){const t=e.vertOffset,i=this._getTextCache(e);if(!i)return;const s=i.textImageWidth,o=i.textImageHeight,r=s/2,a=e.y+t+e.textVertOffset,l=t>0?0:-o,h=t>0?o:0,d=new n.Point(e.x-r,a+l),c=new n.Point(e.x+r,a+h);return(0,n.box)(d,c)}_unionBox(e,t){const i=Math.min(e.min.x,t.min.x),s=Math.max(e.max.x,t.max.x),o=Math.min(e.min.y,t.min.y),r=Math.max(e.max.y,t.max.y),a=new n.Point(i,o),l=new n.Point(s,r);return(0,n.box)(a,l)}_getTooltip(e,t){if(e.tooltip)return{content:{type:"text",data:e.tooltip},tooltipDelay:200,extendMargin:!0,rect:{x:t.min.x,y:t.min.y,w:Math.abs(t.max.x-t.min.x),h:Math.abs(t.max.y-t.min.y)}}}_setBaseData(e,t){this._items.length=0,this._barSpacing=t;for(const t of e){const e=void 0===t.width?(0,s.ensureDefined)(this._width):t.width,i=void 0===t.height?(0,s.ensureDefined)(this._height):t.height,n=void 0===t.vertOffset?this._vertOffset:t.vertOffset,o=n>0?i:-i;this._items.push({width:e,height:i,vertOffset:n,textVertOffset:o,shapeWidth:0,shapeHeight:0,stepX:0,stepY:0,...t})}}_drawItemText(e,t,i){const s=this._getTextCache(i);if(null===s)return;const n=i.x,o=i.vertOffset,r=i.y+o+i.textVertOffset;let a;a=i.style&&void 0!==i.style.textColor?i.style.textColor:this._textColor;const h={style:{fillStyle:a},location:{x:n,y:r,horzAlign:l.HorizontalAlign.Center,vertAlign:o>0?l.VerticalAlign.Top:l.VerticalAlign.Bottom}};s.paintTo(e,t,h)}_drawWithOptimizations(e,t){let i,s,n=null,o=!1;for(const r of this._items)r.style&&void 0!==r.style.color?(i=r.style.color||"rgba(0, 0, 0, 0)",s=r.style.borderColor||"rgba(0, 0, 0, 0)"):(i=this._color,s=this._borderColor),(n!==i||c.isSafari)&&(n=i,o&&this._endPath(e),this._startPath(e,t,i,s)),this._drawItemShape(e,t,r),o=!0;o&&this._endPath(e)
;for(const i of this._items)this._drawItemText(e,t,i)}_drawWithoutOptimizations(e,t){let i,n;for(const o of this._items){const r=(0,s.ensureDefined)(o.style);i=r.color||"rgba(0, 0, 0, 0)",n=r.borderColor||"rgba(0, 0, 0, 0)",this._startPath(e,t,i,n),this._drawItemShape(e,t,o),this._endPath(e),this._drawItemText(e,t,o)}}_drawItemShape(e,t,i){(0,d.drawScaled)(e,t.pixelRatio,(()=>this._drawItemShapeUsingCSSPixels(e,i)))}_drawItemShapeUsingCSSPixels(e,t){}_preDrawInit(){}_startPath(e,t,i,s){}_endPath(e){}_getTextCache(e){var t,i;const s=e.text||this._text,n=e.fontSize||this._fontSize,o=null!==(t=e.lineSpacing)&&void 0!==t?t:this._lineSpacing,r=e.textAlign||this._textAlign,a=null!==(i=e.font)&&void 0!==i?i:h.CHART_FONT_FAMILY;return this._textCache.get({text:s,bold:!1,italic:!1,font:a,fontSize:n,lineSpacing:o,align:r})}}class _ extends u{_startPath(e,t,i,s){e.beginPath(),e.lineWidth=this._lineWidth(t),e.lineCap="butt",e.strokeStyle=i}_endPath(e){e.stroke()}_lineWidth(e){return Math.max(1,Math.floor(2*e.pixelRatio))}}class p extends u{_startPath(e,t,i,s){e.beginPath(),e.lineWidth=this._lineWidth(t),e.lineCap="butt",e.fillStyle=i,e.strokeStyle=s}_endPath(e){e.fill(),e.stroke()}_lineWidth(e){return Math.max(1,Math.floor(e.pixelRatio))}}},664348:(e,t,i)=>{i.d(t,{PaneRendererArrowUp:()=>a,PaneRendererArrowDown:()=>l});var s=i(438230),n=i(86441),o=i(43329);class r extends s.PaneRendererAbstractFillStrokeShape{constructor(){super(...arguments),this._sign=0,this._thinArrow=!1,this._thinArrowLineWidth=0,this._headHeight=0,this._arrowWidth=0}setItems(e,t){this._setBaseData(e,t)}_drawItemShape(e,t,i){const s=t.pixelRatio,n=this._lineWidth(t)%2?.5:0,r=this._sign,a=this._arrowWidth,l=this._headHeight,h=Math.abs(i.height),d=Math.round(i.x*s)+n,c=i.vertOffset,u=Math.round((i.y+c+r*h/2)*s)+n,_=(0,o.ceiledEven)(a*s),p=_/2,f=Math.round(h*s),m=Math.round(l*s);e.translate(d,u),this._thinArrow?(e.moveTo(0,0),e.lineTo(-p,-p*r),e.moveTo(0,0),e.lineTo(p,-p*r),e.moveTo(0,0),e.lineTo(0,-f*r),e.moveTo(-p,-f*r),e.lineTo(p,-f*r)):(e.moveTo(0,0),f<m?(e.lineTo(_,-f*r),e.lineTo(-_,-f*r)):(e.lineTo(_,-m*r),e.lineTo(p,-m*r),e.lineTo(p,-f*r),e.lineTo(-p,-f*r),e.lineTo(-p,-m*r),e.lineTo(-_,-m*r)),e.lineTo(0,0)),e.translate(-d,-u)}_preDrawInit(){const e=this._calculateWidth();this._arrowWidth=e,this._sign=this._isUp()?-1:1,this._thinArrow=e<4,this._thinArrowLineWidth=Math.max(e/2,1),this._headHeight=Math.round(e)}_startPath(e,t,i,s){e.beginPath(),e.fillStyle=i,e.strokeStyle=s,e.lineWidth=this._lineWidth(t)}_lineWidth(e){return this._thinArrow?this._thinArrowLineWidth:super._lineWidth(e)}_calcBoundingBox(e){const t=e.vertOffset,i=this._sign,s=this._arrowWidth,o=this._headHeight,r=Math.abs(e.height),a=e.x-s,l=a+2*s,h=e.y+t+i*Math.round(r/2),d=h+(-r-o)*i,c=new n.Point(a,h),u=new n.Point(l,d);let _=(0,n.box)(c,u);const p=super._calcBoundingBox(e);return p&&(_=this._unionBox(_,p)),_}_calculateWidth(){return Math.round(this._barSpacing/4)}}class a extends r{_isUp(){return!0}}class l extends r{_isUp(){return!1}}},385470:(e,t,i)=>{i.d(t,{PaneRendererCircleShape:()=>r
});var s=i(86441),n=i(438230);const o=2*Math.PI;class r extends n.PaneRendererAbstractFillStrokeShape{_drawItemShapeUsingCSSPixels(e,t){const i=Math.max(t.width,t.height)/2,s=t.x,n=t.vertOffset,r=t.y+n;e.moveTo(s+i,r),e.arc(s,r,i,0,o,!1)}_calcBoundingBox(e){const t=Math.max(e.width,e.height)/2,i=e.x,n=e.vertOffset,o=e.y+n,r=i-t,a=i+t,l=o-t,h=o+t,d=new s.Point(r,l),c=new s.Point(a,h);let u=(0,s.box)(d,c);const _=super._calcBoundingBox(e);return _&&(u=this._unionBox(u,_)),u}}},753346:(e,t,i)=>{i.d(t,{PaneRendererCrossShape:()=>o});var s=i(438230),n=i(86441);class o extends s.PaneRendererAbstractStrokeShape{_drawItemShape(e,t,i){const s=i.width,n=i.height,o=i.x-s/2,r=i.vertOffset,a=i.y-n/2+r,l=t.pixelRatio,h=this._lineWidth(t),d=h%2?.5:0,c=Math.round(o*l);let u=Math.round((o+s)*l);(u-c)%2!=h%2&&(u+=1);const _=Math.floor((c+u)/2)+d,p=Math.round(a*l);let f=Math.round((a+n)*l);(f-p)%2!=h%2&&(f+=1);const m=Math.floor((p+f)/2)+d;e.moveTo(_,p),e.lineTo(_,f),e.moveTo(c,m),e.lineTo(u,m)}_calcBoundingBox(e){const t=e.width,i=e.height,s=e.x-t/2,o=e.vertOffset,r=e.y-i/2+o,a=s,l=s+t,h=r,d=r+i,c=new n.Point(a,h),u=new n.Point(l,d);let _=(0,n.box)(c,u);const p=super._calcBoundingBox(e);return p&&(_=this._unionBox(_,p)),_}}},644001:(e,t,i)=>{i.d(t,{PaneRendererDiamond:()=>o});var s=i(86441),n=i(438230);class o extends n.PaneRendererAbstractFillStrokeShape{_drawItemShapeUsingCSSPixels(e,t){const i=Math.round(t.height/2),s=t.x,n=t.vertOffset,o=t.y+n;e.moveTo(s,o-i),e.lineTo(s+i,o),e.lineTo(s,o+i),e.lineTo(s-i,o),e.lineTo(s,o-i)}_calcBoundingBox(e){const t=Math.round(e.height/2),i=e.x,n=e.vertOffset,o=e.y+n,r=i-t,a=i+t,l=o-t,h=o+t,d=new s.Point(r,l),c=new s.Point(a,h);let u=(0,s.box)(d,c);const _=super._calcBoundingBox(e);return _&&(u=this._unionBox(u,_)),u}}},32895:(e,t,i)=>{i.d(t,{PaneRendererFlagShape:()=>o});var s=i(86441),n=i(438230);class o extends n.PaneRendererAbstractFillStrokeShape{_drawItemShapeUsingCSSPixels(e,t){const i=t.width,s=t.height,n=s/2,o=(i-3)/3,r=t.x-i/2,a=t.vertOffset,l=t.y-n+a;e.moveTo(r,l),e.lineTo(r+3,l),e.bezierCurveTo(r+o,l-o,r+2*o,l+o,r+i,l),e.lineTo(r+i,l+n),e.bezierCurveTo(r+i-o,l+n+o,r+i-2*o,l+n-o,r+3,l+n),e.lineTo(r+3,l+s),e.lineTo(r,l+s),e.lineTo(r,l)}_calcBoundingBox(e){const t=e.width,i=e.height,n=i/2,o=e.x-t/2,r=e.vertOffset,a=e.y-n+r,l=o,h=o+t,d=a,c=a+i,u=new s.Point(l,d),_=new s.Point(h,c);let p=(0,s.box)(u,_);const f=super._calcBoundingBox(e);return f&&(p=this._unionBox(p,f)),p}}},929434:(e,t,i)=>{i.d(t,{PaneRendererLabelBase:()=>a,CornerVectorsClockwise:()=>s});var s,n=i(650151),o=i(438230),r=i(482152);class a extends o.PaneRendererAbstractFillStrokeShape{setItems(e,t){this._setBaseData(e,t);for(const e of this._items){const t=e.height;e.stepX=Math.round(t/2*.65)+.5,e.stepY=e.stepX;const i=e.stepX/2,s=this._getTextCache(e);if(null===s){e.shapeWidth=2*e.stepX,e.shapeHeight=2.5*e.stepY,e.vertOffset=this._calcVertOffset(e);continue}const n=s.textImageWidth,o=s.textImageHeight;e.shapeWidth=n+2*e.stepX,e.shapeHeight=o+2*i+e.stepY,e.vertOffset=this._calcVertOffset(e),
e.textHorizOffset=this._getHorizontalTextOffset(e),e.textVertOffset=this._getVerticalTextOffset(e)}}_calcVertOffset(e){return e.vertOffset}_drawCorner(e,t,i,s,n){const o=Math.max(1,Math.floor(2*n));e.lineTo(t-o*s.prevPointSignX,i-o*s.prevPointSignY),e.arcTo(t,i,t+o*s.nextPointSignX,i+o*s.nextPointSignY,o)}_getArrowSize(e){return e.stepX}_getHorizontalTextOffset(e){return 0}_getVerticalTextOffset(e){return 0}_hasText(e){return Boolean(e.text)||Boolean(this._text)}_drawItemText(e,t,i){var s;const o=this._getTextCache(i);if(null===o)return;const a=i.textHorizOffset||0,l=i.x+a,h=i.vertOffset,d=i.y+h+i.textVertOffset,c=(null===(s=i.style)||void 0===s?void 0:s.textColor)||this._textColor,u={style:{fillStyle:(0,n.ensureDefined)(c)},location:{x:l,y:d,horzAlign:r.HorizontalAlign.Center,vertAlign:r.VerticalAlign.Middle}};o.paintTo(e,t,u)}}class l{constructor(e,t,i,s){this.prevPointSignX=e,this.prevPointSignY=t,this.nextPointSignX=i,this.nextPointSignY=s}}!function(e){e.rightUp=new l(1,0,0,1),e.rightDown=new l(0,1,-1,0),e.leftDown=new l(-1,0,0,-1),e.leftUp=new l(0,-1,1,0)}(s||(s={}))},696720:(e,t,i)=>{i.d(t,{PaneRendererLabelUp:()=>o,PaneRendererLabelDown:()=>r,PaneRendererLabelLeft:()=>a,PaneRendererLabelRight:()=>l,PaneRendererLabelCenter:()=>h});var s=i(86441),n=i(929434);class o extends n.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.x-e.shapeWidth/2,i=e.x+e.shapeWidth/2,n=e.y+e.vertOffset,o=e.y+e.shapeHeight+e.vertOffset,r=new s.Point(t,n),a=new s.Point(i,o);return(0,s.box)(r,a)}_drawItemShape(e,t,i){const s=t.pixelRatio,o=this._lineWidth(t)%2?.5:0,r=Math.max(1,Math.floor(s))%2?.5:0,a=this._getArrowSize(i);let l=Math.round(a*s);(r+l)%1!=o%1&&(l+=.5);let h=Math.round(i.shapeWidth/2*s);(r+h)%1!=o%1&&(h+=.5);const d=Math.round(i.x*s)+r,c=Math.round((i.y+i.vertOffset)*s)+o,u=d-l,_=Math.round((i.y+i.vertOffset+a)*s)+o,p=d+l,f=d+h,m=Math.round((i.y+i.vertOffset+i.shapeHeight)*s)+o,v=d-h;e.moveTo(u,_),e.lineTo(d,c),e.lineTo(p,_),i.shapeWidth<=2*a?(e.lineTo(f,_),this._drawCorner(e,f,m,n.CornerVectorsClockwise.rightDown,s),this._drawCorner(e,v,m,n.CornerVectorsClockwise.leftDown,s),e.lineTo(v,_)):(this._drawCorner(e,f,_,n.CornerVectorsClockwise.rightUp,s),this._drawCorner(e,f,m,n.CornerVectorsClockwise.rightDown,s),this._drawCorner(e,v,m,n.CornerVectorsClockwise.leftDown,s),this._drawCorner(e,v,_,n.CornerVectorsClockwise.leftUp,s)),e.lineTo(u,_)}_getVerticalTextOffset(e){return e.shapeHeight/2+this._getArrowSize(e)/2}_calcVertOffset(e){return Math.sign(e.vertOffset)>=0?e.vertOffset:e.vertOffset-e.shapeHeight}}class r extends n.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.x-e.shapeWidth/2,i=e.x+e.shapeWidth/2,n=e.y-e.shapeHeight+e.vertOffset,o=e.y+e.vertOffset,r=new s.Point(t,n),a=new s.Point(i,o);return(0,s.box)(r,a)}_drawItemShape(e,t,i){const s=t.pixelRatio,o=this._lineWidth(t)%2?.5:0,r=Math.max(1,Math.floor(s))%2?.5:0,a=this._getArrowSize(i);let l=Math.round(a*s);(r+l)%1!=o%1&&(l+=.5);let h=Math.round(i.shapeWidth/2*s);(r+h)%1!=o%1&&(h+=.5)
;const d=Math.round(i.x*s)+r,c=Math.round((i.y+i.vertOffset)*s)+o,u=d+l,_=Math.round((i.y+i.vertOffset-a)*s)+o,p=d-l,f=d+h,m=Math.round((i.y+i.vertOffset-i.shapeHeight)*s)+o,v=d-h;e.moveTo(u,_),e.lineTo(d,c),e.lineTo(p,_),i.shapeWidth<=2*a?(e.lineTo(v,_),this._drawCorner(e,v,m,n.CornerVectorsClockwise.leftUp,s),this._drawCorner(e,f,m,n.CornerVectorsClockwise.rightUp,s),e.lineTo(f,_)):(this._drawCorner(e,v,_,n.CornerVectorsClockwise.leftDown,s),this._drawCorner(e,v,m,n.CornerVectorsClockwise.leftUp,s),this._drawCorner(e,f,m,n.CornerVectorsClockwise.rightUp,s),this._drawCorner(e,f,_,n.CornerVectorsClockwise.rightDown,s)),e.lineTo(u,_)}_getVerticalTextOffset(e){return-e.shapeHeight/2-this._getArrowSize(e)/2}_calcVertOffset(e){return Math.sign(e.vertOffset)<=0?e.vertOffset:e.vertOffset+e.shapeHeight}}class a extends n.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.x,i=e.x+e.shapeWidth,n=e.y-e.shapeHeight/2+e.vertOffset,o=e.y+e.shapeHeight/2+e.vertOffset,r=new s.Point(t,n),a=new s.Point(i,o);return(0,s.box)(r,a)}_drawItemShape(e,t,i){const s=t.pixelRatio,o=this._lineWidth(t)%2?.5:0,r=this._getArrowSize(i),a=this._hasText(i),l=a?i.shapeHeight/2:r,h=Math.round(i.x*s)+o,d=Math.round((i.y+i.vertOffset)*s)+o,c=Math.round((i.x+r)*s)+o,u=Math.round((i.y+i.vertOffset+r)*s)+o,_=Math.round((i.y+i.vertOffset-r)*s)+o,p=Math.round((i.y+i.vertOffset-l)*s)+o,f=Math.round((i.x+i.shapeWidth)*s)+o,m=Math.round((i.y+i.vertOffset+l)*s)+o;e.moveTo(c,u),e.lineTo(h,d),e.lineTo(c,_),a?this._drawCorner(e,c,p,n.CornerVectorsClockwise.leftUp,s):e.lineTo(c,p),this._drawCorner(e,f,p,n.CornerVectorsClockwise.rightUp,s),this._drawCorner(e,f,m,n.CornerVectorsClockwise.rightDown,s),a?this._drawCorner(e,c,m,n.CornerVectorsClockwise.leftDown,s):e.lineTo(c,m),e.lineTo(c,u)}_getHorizontalTextOffset(e){return e.shapeWidth/2+this._getArrowSize(e)/2}}class l extends n.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.x-e.shapeWidth,i=e.x,n=e.y-e.shapeHeight/2+e.vertOffset,o=e.y+e.shapeHeight/2+e.vertOffset,r=new s.Point(t,n),a=new s.Point(i,o);return(0,s.box)(r,a)}_drawItemShape(e,t,i){const s=t.pixelRatio,o=this._lineWidth(t)%2?.5:0,r=this._getArrowSize(i),a=this._hasText(i),l=a?i.shapeHeight/2:r,h=Math.round(i.x*s)+o,d=Math.round((i.y+i.vertOffset)*s)+o,c=Math.round((i.x-r)*s)+o,u=Math.round((i.y+i.vertOffset-r)*s)+o,_=Math.round((i.y+i.vertOffset+r)*s)+o,p=Math.round((i.y+i.vertOffset-l)*s)+o,f=Math.round((i.x-i.shapeWidth)*s)+o,m=Math.round((i.y+i.vertOffset+l)*s)+o;e.moveTo(c,u),e.lineTo(h,d),e.lineTo(c,_),a?this._drawCorner(e,c,m,n.CornerVectorsClockwise.rightDown,s):e.lineTo(c,m),this._drawCorner(e,f,m,n.CornerVectorsClockwise.leftDown,s),this._drawCorner(e,f,p,n.CornerVectorsClockwise.leftUp,s),a?this._drawCorner(e,c,p,n.CornerVectorsClockwise.rightUp,s):e.lineTo(c,p),e.lineTo(c,u)}_getHorizontalTextOffset(e){return-e.shapeWidth/2-this._getArrowSize(e)/2}}class h extends n.PaneRendererLabelBase{_calcBoundingBox(e){
const t=e.x-e.shapeWidth/2,i=e.x+e.shapeWidth/2,n=e.y-e.shapeHeight/2+e.vertOffset,o=e.y+e.shapeHeight/2+e.vertOffset,r=new s.Point(t,n),a=new s.Point(i,o);return(0,s.box)(r,a)}_drawItemShape(e,t,i){const s=t.pixelRatio,o=this._lineWidth(t)%2?.5:0,r=i.shapeHeight/2,a=i.shapeWidth/2,l=Math.round(i.x*s)+o,h=Math.round((i.x-a)*s)+o,d=Math.round((i.x+a)*s)+o,c=Math.round((i.y+i.vertOffset-r)*s)+o,u=Math.round((i.y+i.vertOffset+r)*s)+o;e.moveTo(l,c),this._drawCorner(e,d,c,n.CornerVectorsClockwise.rightUp,s),this._drawCorner(e,d,u,n.CornerVectorsClockwise.rightDown,s),this._drawCorner(e,h,u,n.CornerVectorsClockwise.leftDown,s),this._drawCorner(e,h,c,n.CornerVectorsClockwise.leftUp,s),e.lineTo(l,c)}}},877168:(e,t,i)=>{i.d(t,{StudyPlotShapesPaneView:()=>h});var s=i(809350),n=i(114123),o=i(28035),r=i(583110),a=i(392462),l=i(722922);class h extends l.StudyPlotShapesPaneViewBase{_updateRenderer(e){const t=e.childs();this._updateImpl();const i=this._model.timeScale(),l={},h=this._getTranspValue(),d=i.barSpacing();let c;c=this._plotStyleInfo.size?this._calculateShapeHeight(25,this._plotStyleInfo.size):Math.round(d/2),c=Math.max(c,1);const u=t.location.value(),_=(0,n.generateColor)(t.color.value(),h),p=h>19?h-10:0,f=this._calculateVerticalOffset(u,Math.round(1.5*c));l.barSpacing=d,l.items=this.items(),l.color=_,l.borderColor=(0,n.generateColor)(t.color.value(),p),l.height=c,l.vertOffset=f;const m=t.plottype.value(),v=a.plotShapesData[m],g=new o.CompositeRenderer,y=this._plotStyleInfo.text;if(void 0!==y&&""!==y.trim()){let e=y.trim().replace(/\\n/gm,"\n");e=(0,s.cleanButAmpersand)(e,!0),l.text=e,l.fontSize=12;const i=t.textColor?t.textColor.value():void 0;l.textColor=i?(0,n.generateColor)(i,h):_}g.append(super._createRenderer(v.paneRendererClass,l)),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&null!==this._selectionData&&(this._selectionData.vertOffset=f,g.append(new r.SelectionRenderer(this._selectionData))),this._renderer=g}}},472068:(e,t,i)=>{i.d(t,{PaneRendererSquare:()=>o});var s=i(438230),n=i(86441);class o extends s.PaneRendererAbstractFillStrokeShape{_drawItemShape(e,t,i){const s=t.pixelRatio,n=Math.max(1,Math.floor(s))%2?.5:0,o=this._lineWidth(t)%2?.5:0;let r=Math.round(i.height/2*s);(n+r)%1!=o%1&&(r+=.5);const a=Math.round(i.x*s)+n,l=Math.round((i.y+i.vertOffset)*s)+n,h=a-r,d=l-r,c=a+r,u=l+r;e.rect(h,d,c-h,u-d)}_calcBoundingBox(e){const t=e.height,i=Math.round(t/2),s=e.x-i,o=e.vertOffset,r=e.y+o-i,a=s,l=s+t,h=r,d=r+t,c=new n.Point(a,h),u=new n.Point(l,d);let _=(0,n.box)(c,u);const p=super._calcBoundingBox(e);return p&&(_=this._unionBox(_,p)),_}}},21720:(e,t,i)=>{i.d(t,{PaneRendererTriangleApexUp:()=>r,PaneRendererTriangleApexDown:()=>a});var s=i(438230),n=i(86441);class o extends s.PaneRendererAbstractFillStrokeShape{_calcBoundingBox(e){const t=e.width,i=e.height,s=t/2,o=Math.round(i/3),r=e.x,a=e.vertOffset-2*o,l=e.y+a,h=r-s,d=r+s,c=l,u=l+i,_=new n.Point(h,c),p=new n.Point(d,u);let f=(0,n.box)(_,p);const m=super._calcBoundingBox(e);return m&&(f=this._unionBox(f,m)),f}}class r extends o{
_drawItemShape(e,t,i){const s=i.width,n=i.height,o=Math.round(n/3),r=i.vertOffset-2*o,a=t.pixelRatio,l=this._lineWidth(t)%2?.5:0,h=Math.max(1,Math.floor(a)),d=h%2?.5:0;let c=Math.round(s*a);c%2!=h%2&&(c+=1);const u=Math.round(i.x*a)+d,_=Math.round((i.y+r)*a),p=u+c/2,f=Math.round((i.y+r+n)*a)+l,m=u-c/2;e.moveTo(u,_),e.lineTo(p,f),e.lineTo(m,f),e.lineTo(u,_)}}class a extends o{_drawItemShape(e,t,i){const s=i.width,n=i.height,o=Math.round(n/3),r=i.vertOffset-o,a=t.pixelRatio,l=this._lineWidth(t)%2?.5:0,h=Math.max(1,Math.floor(a)),d=h%2?.5:0;let c=Math.round(s*a);c%2!=h%2&&(c+=1);const u=Math.round(i.x*a)+d,_=Math.round((i.y+r)*a)+l,p=u+c/2,f=Math.round((i.y+r+n)*a),m=u-c/2;e.moveTo(m,_),e.lineTo(p,_),e.lineTo(u,f),e.lineTo(m,_)}}},8075:(e,t,i)=>{i.d(t,{PaneRendererXCross:()=>o});var s=i(86441),n=i(438230);class o extends n.PaneRendererAbstractStrokeShape{_drawItemShapeUsingCSSPixels(e,t){const i=t.width,s=t.height,n=t.x-i/2,o=t.vertOffset,r=t.y-s/2+o;e.moveTo(n,r),e.lineTo(n+i,r+s),e.moveTo(n,r+s),e.lineTo(n+i,r)}_calcBoundingBox(e){const t=e.width,i=e.height,n=e.x-t/2,o=e.vertOffset,r=e.y-i/2+o,a=n,l=n+t,h=r,d=r+i,c=new s.Point(a,h),u=new s.Point(l,d);let _=(0,s.box)(c,u);const p=super._calcBoundingBox(e);return p&&(_=this._unionBox(_,p)),_}}},755695:(e,t,i)=>{i.d(t,{createStudyPlotColorProvider:()=>_});var s=i(519872),n=i(650151),o=i(394683);const r=new Map([[0,"color"],[2,"textColor"],[3,"borderColor"],[4,"wickColor"],[5,"colorup"],[6,"colordown"]]);class a{constructor(e){this._plotStyle=e}getPlotPointStyle(e,t){const i=t?(0,o.clearStyle)(t):(0,o.createEmptyStyle)();return r.forEach(((e,t)=>{this._plotStyle[e]&&(i.colors[t]=this._plotStyle[e].value())})),i.lineWidth=this._plotStyle.linewidth?this._plotStyle.linewidth.value():void 0,i.lineStyle=this._plotStyle.linestyle?this._plotStyle.linestyle.value():void 0,i}isColorDefined(){return!0}singleColor(){return!0}getDefaultPlotPointStyle(){return null}}const l=[0,1,2,3,4,5,6];class h{constructor(e,t,i,s){this._palettesColors=new Map,this._defaultPlotColors=new Map,this._indexes=s;const o=t.styles[i];if(o)for(const[e,t]of r)this._defaultPlotColors.set(e,o[t]);const a=(0,n.ensureDefined)(e.palettes),l=e.plots;s.forEach(((e,i)=>{const s=l[e];if(s&&"palette"in s){const e=a[s.palette],n=t.palettes[s.palette];if(e&&n){const{valToIndex:t}=e,{colors:s}=n,o={...s};t&&Object.keys(t).forEach((e=>{const i=t[e];void 0!==i&&(o[e]=s[i])})),this._palettesColors.set(i,o)}}}))}getPlotPointStyle(e,t){const i=t?(0,o.clearStyle)(t):(0,o.createEmptyStyle)();return l.forEach((t=>{var s,o;if(this._palettesColors.has(t)){const o=e[(0,n.ensureDefined)(this._indexes.get(t))+1];if("number"==typeof o){const e=null===(s=this._palettesColors.get(t))||void 0===s?void 0:s[o];0===t&&e&&(i.lineWidth=e.width.value(),i.lineStyle=e.style.value()),i.colors[t]=null==e?void 0:e.color.value()}else i.colors[t]="transparent"}else i.colors[t]=null===(o=this._defaultPlotColors.get(t))||void 0===o?void 0:o.value()})),i}getDefaultPlotPointStyle(){var e
;const t=null===(e=this._palettesColors.get(0))||void 0===e?void 0:e[0];if(void 0!==t){return{colors:[t.color.value(),void 0,void 0,void 0,void 0,void 0,void 0],lineStyle:void 0,lineWidth:t.width.value()}}return null}isColorDefined(){return!!this._palettesColors.size}singleColor(){return!1}}var d=i(114123);class c{constructor(e){this._indexes=e}getPlotPointStyle(e,t){const i=t?(0,o.clearStyle)(t):(0,o.createEmptyStyle)();return this._indexes.forEach(((t,s)=>{const n=e[t+1];if(null!=n){const e=(0,d.rgbaFromInteger)(n);i.colors[s]=e}else i.colors[s]="transparent"})),i}isColorDefined(){return!0}singleColor(){return!1}getDefaultPlotPointStyle(){return null}}const u=new Map([[0,function(e,t){const i=(0,s.isColorerPlot)(t)||(0,s.isOhlcColorerPlot)(t);return"target"in t&&t.target===e&&i}],[2,function(e,t){const i=(0,s.isTextColorerPlot)(t);return"target"in t&&t.target===e&&i}],[1,function(e,t){return(0,s.isBgColorerPlot)(t)&&t.id===e}],[3,function(e,t){const i=(0,s.isCandleBorderColorerPlot)(t);return"target"in t&&t.target===e&&i}],[4,function(e,t){const i=(0,s.isCandleWickColorerPlot)(t);return"target"in t&&t.target===e&&i}],[5,function(e,t){const i=(0,s.isUpColorerPlot)(t);return"target"in t&&t.target===e&&i}],[6,function(e,t){const i=(0,s.isDownColorerPlot)(t);return"target"in t&&t.target===e&&i}]]);function _(e,t,i){const{colorers:s}=function(e,t){const i=e.plots,s=i.findIndex((e=>e.id===t)),n=new Map;return i.forEach(((e,i)=>{u.forEach(((s,o)=>{s(t,e)&&n.set(o,i)}))})),{plotIndex:-1===s?null:s,colorers:n}}(e,i);if(s.size)return e.isRGB?new c(s):new h(e,t,i,s);{const e=t.ohlcPlots;if(e&&e[i])return new a(e[i]);const s=t.styles[i];return new a(s)}}},722922:(e,t,i)=>{i.d(t,{StudyPlotShapesPaneViewBase:()=>B});var s=i(650151),n=i(86441),o=i(87476),r=i(43329),a=i(758337),l=i(114123),h=i(858063),d=i(28035),c=i(812363),u=i(847314),_=i(583110),p=i(311854),f=i(392462),m=i(96841),v=i(394683),g=i(664348),y=i(385470),x=i(753346),b=i(644001),w=i(32895),S=i(696720),P=i(472068),I=i(21720),C=i(8075),M=i(519872),R=i(755695);const T=new Map;T.set("PaneRendererArrowUp",g.PaneRendererArrowUp),T.set("PaneRendererArrowDown",g.PaneRendererArrowDown),T.set("PaneRendererCircleShape",y.PaneRendererCircleShape),T.set("PaneRendererCrossShape",x.PaneRendererCrossShape),T.set("PaneRendererDiamond",b.PaneRendererDiamond),T.set("PaneRendererFlagShape",w.PaneRendererFlagShape),T.set("PaneRendererLabelUp",S.PaneRendererLabelUp),T.set("PaneRendererLabelDown",S.PaneRendererLabelDown),T.set("PaneRendererSquare",P.PaneRendererSquare),T.set("PaneRendererTriangleApexUp",I.PaneRendererTriangleApexUp),T.set("PaneRendererTriangleApexDown",I.PaneRendererTriangleApexDown),T.set("PaneRendererXCross",C.PaneRendererXCross);class B{constructor(e,t,i,n){var r;this._items=[],this._invalidated=!1,this._renderer=null,this._isMarkersEnabled=o.enabled("source_selection_markers"),this._selectionData=null,this._plotIndex=null,this._topCoord=0,this._bottomCoord=0,this._study=e,this._series=t,this._model=i,this._plotName=n;const a=e.metaInfo().plots
;for(let e=0;e<a.length;e++)if(a[e].id===this._plotName){this._plotIndex=e;break}this._plotStyleInfo=(0,s.ensureDefined)(null===(r=e.metaInfo().styles)||void 0===r?void 0:r[this._plotName]),this._colorProvider=(0,R.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),n),this._selectionIndexer=new u.SelectionIndexes(i.timeScale())}items(){return this._items}update(){this._invalidated=!0}renderer(){if(!this._isPlotVisible()||!this._scalesReady())return null;if(this._invalidated){const e=this._study.properties().childs().styles.childs()[this._plotName];this._updateRenderer(e),this._invalidated=!1}return this._renderer}_isPlotVisible(){return this._study.isPlotVisibleAt(this._plotName,1)}_scalesReady(){const e=this._model.timeScale(),t=this._study.priceScale();return e&&null!==t&&!e.isEmpty()&&!t.isEmpty()}_updateImpl(){if(this._items=[],!this._scalesReady())return;const e=this._model.timeScale(),t=this._study.priceScale(),i=e.visibleBarsStrictRange();if(null===i||null===t)return;let n=this._series.nearestIndex(i.firstBar(),c.PlotRowSearchMode.NearestRight),o=this._series.nearestIndex(i.lastBar(),c.PlotRowSearchMode.NearestLeft);if(void 0===n||void 0===o)return;const r=this._study.offset(this._plotName);r>0?(n-=r,o+=r):(n+=r,o-=r);const a=this._study.getMinFirstBarIndexForPlot(this._plotName);if(a>o)return;n=Math.max(a,n);const l=this._study.data(),d=this._study.firstValue();if(null===d)return;const u=l.rangeIterator(n,o),_=this._getTranspValue();let p=[];const f=this._model.selection().isSelected(this._study);f?(p=this._selectionIndexer.indexes(),this._selectionData={points:[],hittestResult:h.HitTestResult.REGULAR,vertOffset:0,bgColors:[],barSpacing:e.barSpacing(),visible:!0}):(this._selectionIndexer.clear(),this._selectionData=null);const m=this._series.properties().childs().style.value(),g=2===m?"lineStyle":3===m?"areaStyle":null;let y,x;g?(y=this._series.properties().childs()[g].childs().priceSource.value(),x=y):(y="high",x="low");const b=t.isInverted(),w=t.coordinateToPrice(t.height()*t.topMargin(),d),S=t.coordinateToPrice(t.height()*(1-t.bottomMargin()),d);this._topCoord=b?S:w,this._bottomCoord=b?w:S;const P=(0,s.ensureNotNull)(this._model.paneForSource(this._study)).height(),I=this._study.properties().childs().styles.childs()[this._plotName].childs(),C=I.color.value(),M=I.textColor?I.textColor.value():void 0,R=C,T=C,B=void 0===M?void 0:M,V=(0,s.ensureNotNull)(this._plotIndex),D=(0,v.createEmptyStyle)();for(;u.hasNext();){const e=u.next(),t=e.index,i=e.value,s=Math.floor(t+r),n=i[V+1];if(null==n)continue;const o=this._createItem(s,n,y,x);if(null!==o){if(this._colorProvider.isColorDefined()){o.style={color:R,borderColor:T,textColor:B};const e=this._colorProvider.getPlotPointStyle(i,D);this._fillItemWithPointStyle(o,e,_)}f&&-1!==p.indexOf(t)&&null!==this._selectionData&&(this._selectionData.points.push(o),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(o.y/P))),this._items.push(o)}}this._convertItemsToCoordinates()}_fillItemWithPointStyle(e,t,i){const n=(0,s.ensureDefined)(e.style)
;if(void 0!==t.colors[0]){n.color=(0,l.generateColor)((0,s.ensureDefined)(t.colors[0]),i);const e=i>9?i-10:0;n.borderColor=(0,l.generateColor)(n.color,e)}void 0!==t.colors[2]&&(n.textColor=(0,l.generateColor)((0,s.ensureDefined)(t.colors[2]),i))}_updateRenderer(e){this._updateImpl();const t=this._model.timeScale(),i={},s=this._getTranspValue(),n=t.barSpacing(),o=this._calculateShapeHeight(n),r=this._study.properties().childs().styles.childs()[this._plotName].childs(),a=r.location.value(),h=this._calculateVerticalOffset(a,o+o/2);i.barSpacing=n,i.items=this._items,i.color=(0,l.generateColor)(r.color.value(),s),i.height=o,i.vertOffset=h;const c=r.plottype.value(),u=f.plotShapesData[c],p=new d.CompositeRenderer;u&&p.append(this._createRenderer(u.paneRendererClass,i)),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&null!==this._selectionData&&(this._selectionData.vertOffset=h,p.append(new _.SelectionRenderer(this._selectionData))),this._renderer=p}_createRenderer(e,t){const i=T.get(e);return new((0,s.ensureDefined)(i))(t)}_getSeriesVal(e,t){const i=(0,p.barFunction)(e),s=this._series.data().valueAt(t);return null===s?null:i(s)}_getTranspValue(){let e=0;const t=this._study.properties().childs();t.transparency&&(e=t.transparency.value(),e=(0,a.isNumber)(e)?e:50);const i=t.styles.childs()[this._plotName].childs();return i.transparency&&(e=i.transparency.value(),e=(0,a.isNumber)(e)?e:50),(0,r.clamp)(e,0,100)}_createItem(e,t,i,o){const r=this._study.properties().childs().styles.childs()[this._plotName].childs().location.value();if((null===t||0===t)&&r!==m.MarkLocation.Absolute)return null;let a;switch(r){case m.MarkLocation.AboveBar:const n=this._getSeriesVal(i,e);if(null===n)return null;a=n;break;case m.MarkLocation.BelowBar:const l=this._getSeriesVal(o,e);if(null===l)return null;a=l;break;case m.MarkLocation.Top:a=this._topCoord;break;case m.MarkLocation.Bottom:a=this._bottomCoord;break;case m.MarkLocation.Absolute:a=(0,s.ensureNotNull)(t);break;default:throw new Error("Bad value: "+r)}return new n.Point(e,a)}_convertItemsToCoordinates(){const e=this._model.timeScale(),t=this._study.priceScale();e.timedValuesToCoordinates(this._items);const i=(0,s.ensureNotNull)(this._study.firstValue());(0,s.ensureNotNull)(t).pointsArrayToCoordinates(this._items,i)}_calculateVerticalOffset(e,t){let i=0;switch(e){case m.MarkLocation.AboveBar:case m.MarkLocation.Bottom:i=-t;break;case m.MarkLocation.BelowBar:case m.MarkLocation.Top:i=t}return(0,s.ensureNotNull)(this._study.priceScale()).isInverted()&&(i*=-1),i}_calculateShapeHeight(e,t){let i=e;switch(t){case M.PlotSymbolSize.Tiny:i=.3*e;break;case M.PlotSymbolSize.Small:i=.6*e;break;case M.PlotSymbolSize.Normal:i=e;break;case M.PlotSymbolSize.Large:i=1.5*e;break;case M.PlotSymbolSize.Huge:i=2*e}return i}}},45195:(e,t,i)=>{i.d(t,{StudyBaseWindowView:()=>n});var s=i(194405);class n extends s.DataWindowView{constructor(e,t){super(),this._invalidated=!0,this._study=e,this._model=t,this._valueProvider=this._createValuesProvider(e,t),
this._items=this._valueProvider.getItems().map((e=>new s.DataWindowItem(e.id,e.title,""))),this.update()}update(){this._invalidated=!0}items(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._items}study(){return this._study}_updateImpl(){this._header=this._study.title(!0),this._title=this._study.title();const e=this._valueProvider.getValues(this._currentIndex());for(let t=0;t<e.length;++t){const i=e[t],s=this._items[t];s.setValue(i.value),s.setVisible(i.visible),s.setColor(i.color),s.setTitle(i.title)}}_currentIndex(){const e=this._model.crossHairSource().lockedIndex;if(void 0!==e)return e;const t=this._model.crossHairSource().appliedIndex();return isNaN(t)?null:t}}},4836:(e,t,i)=>{i.d(t,{StudyDataWindowView:()=>a});var s=i(45195),n=i(216392),o=i(621803);class r{constructor(e,t){this._study=e,this._model=t,this._hhistBasedStudy=void 0!==e.metaInfo().graphics.hhists,this._valuesProvider=this._createValuesProvider(e,t)}getItems(){return this._valuesProvider.getItems()}getValues(e){const t=this._valuesProvider.getValues(e),i=e=>!!this._hhistBasedStudy||this._study.isPlotVisibleAt(e,2);for(const e of t)e.visible=e.visible&&i(e.id);return t}_createValuesProvider(e,t){return this._hhistBasedStudy?new o.HHistBasedValuesProvider(e,t):new n.StudyValuesProvider(e,t)}}class a extends s.StudyBaseWindowView{_createValuesProvider(e,t){return new r(e,t)}}},155268:(e,t,i)=>{i.d(t,{StudyLegendValuesProvider:()=>o});var s=i(216392),n=i(621803);class o{constructor(e,t){this._study=e,this._model=t,this._showStudyValues=t.properties().childs().paneProperties.childs().legendProperties.childs().showStudyValues,this._hhistBasedStudy=void 0!==e.metaInfo().graphics.hhists,this._valuesProvider=this._createValuesProvider(e,t)}getItems(){return this._valuesProvider.getItems()}getValues(e){const t=this._valuesProvider.getValues(e),i=this._study.properties(),s=this._showStudyValues.value()&&i.childs().showLegendValues.value(),n=e=>!!this._hhistBasedStudy||this._study.isPlotVisibleAt(e,8);for(const e of t)e.visible=e.visible&&s&&n(e.id);return t}_createValuesProvider(e,t){return this._hhistBasedStudy?new n.HHistBasedValuesProvider(e,t):new s.StudyValuesProvider(e,t)}}},726820:(e,t,i)=>{i.d(t,{StudyLegendView:()=>r});var s=i(45195),n=i(155268),o=i(519872);class r extends s.StudyBaseWindowView{constructor(e,t){super(e,t),this._showStudyValues=t.properties().childs().paneProperties.childs().legendProperties.childs().showStudyValues,this._showStudyValues.subscribe(this,this.update);const i=this._study.properties();i.childs().showLegendValues.subscribe(this,this.update);const s=this._study.metaInfo().plots,n=new Set;s.forEach((e=>{var t;if((0,o.isOhlcPlot)(e)){const t=e.target;if(n.has(t))return;n.add(t),i.childs().ohlcPlots.childs()[t].childs().display.subscribe(this,this.update)}else(0,o.isPlotSupportDisplay)(e)&&(null===(t=i.childs().styles.childs()[e.id])||void 0===t||t.childs().display.subscribe(this,this.update))}))}areValuesVisible(){return this._showStudyValues.value()}additional(){return null}destroy(){
this._showStudyValues.unsubscribeAll(this);const e=this._study.properties();e.childs().showLegendValues.unsubscribeAll(this);const t=this._study.metaInfo().plots,i=new Set;t.forEach((t=>{var s;if((0,o.isOhlcPlot)(t)){const s=t.target;if(i.has(s))return;i.add(s),e.childs().ohlcPlots.childs()[s].childs().display.unsubscribe(this,this.update)}else(0,o.isPlotSupportDisplay)(t)&&(null===(s=e.childs().styles.childs()[t.id])||void 0===s||s.childs().display.unsubscribe(this,this.update))}))}_createValuesProvider(e,t){return new n.StudyLegendValuesProvider(e,t)}}},386482:(e,t,i)=>{i.d(t,{fundamentalsPrefix:()=>s,isFundamentalStudyMetaInfo:()=>n,studyNameByMetaInfo:()=>o});const s="study_Internal$STD;Fund_";function n(e){return o(e)===s}function o(e){const t="study_"+(e.classId||e.shortId);return t.startsWith(s)?s:t}},431235:(e,t,i)=>{i.d(t,{StudyStatusProvider:()=>l});var s=i(777754),n=i(482358),o=i(971417),r=i(161106);const a=s.t(null,void 0,i(947542));class l extends r.StudyStatusProviderBase{constructor(e,t){super(e,t),this._study=e}color(){return this._study.isFailed()||this._study.metaInfo&&this._study.metaInfo().isTVScriptStub?"#ff0000":super.color()}sourceStatusText(){if(this._study.status().type===n.StudyStatusType.Error){const e=this._study.metaInfo(),t=(0,o.extractPineId)(e.fullId);if(e.scriptIdPart&&(0,o.isEdgrPineId)(e.scriptIdPart)||t&&(0,o.isEdgrPineId)(t))return a}return super.sourceStatusText()}}},397581:(e,t,i)=>{i.d(t,{StudyStatusView:()=>n});var s=i(337720);class n extends s.StatusView{constructor(e){super(e.statusProvider())}color(){return this._statusProvider.color()}getSplitTitle(){return this._statusProvider.getSplitTitle()}update(){this._text=this._statusProvider.text()}}},917516:(e,t,i)=>{i.d(t,{StudyTrackPricePaneView:()=>o});var s=i(594358),n=i(631586);class o extends s.HorizontalLinePaneView{constructor(e,t){super(),this._lineRendererData.linestyle=n.LINESTYLE_DOTTED,this._study=e,this._plotName=t}_updateImpl(){this._lineRendererData.visible=!1;const e=this._study.properties().childs().styles.childs()[this._plotName].childs();if(!e.trackPrice.value()||!this._study.isPlotVisibleAt(this._plotName,1))return;const t=this._study.lastValueData(this._plotName,!0);t.noData||(this._lineRendererData.visible=!0,this._lineRendererData.y=t.coordinate,this._lineRendererData.color=t.color,this._lineRendererData.linewidth=e.linewidth.value())}}},216392:(e,t,i)=>{i.d(t,{StudyValuesProvider:()=>g});var s=i(150335),n=i(638456),o=i(114123),r=i(87476),a=i(812363),l=i(414805),h=i(480071),d=i(519872),c=i(755695),u=i(386482),_=i(801750),p=i(650151),f=i(943546);const m=n.CheckMobile.any(),v=r.enabled("hide_last_na_study_output");class g{constructor(e,t){this._emptyValues=[],this._colorProviders=new Map,this._study=e,this._model=t,this._studyMetaInfo=this._study.metaInfo(),this._studyProperties=this._study.properties().childs(),this._isFundamental=(0,u.isFundamentalStudyMetaInfo)(this._studyMetaInfo);const i=this._studyMetaInfo.plots;i&&i.forEach(((e,t)=>{if((0,d.isPlotWithTechnicalValues)(e))return;const i=e.id
;this._emptyValues.push(function(e,t="",i=""){return{id:t,index:e,title:i,value:"",visible:!1}}(t,i,this._study.guiPlotName(i)));const s=(0,d.isOhlcPlot)(e)?e.target:i;this._colorProviders.set(s,(0,c.createStudyPlotColorProvider)(this._studyMetaInfo,this._study.properties(),s))}))}getItems(){return this._emptyValues}getPlotColor(e,t){var i;const n=t[e+1];if(!(0,s.isNumber)(n))return"";const o=n>0;let r;const a=this._studyMetaInfo.plots[e];let l=a.id;const h=this._studyProperties;if((0,d.isOhlcPlot)(a))l=a.target||l,r=(0,p.ensureDefined)(h.ohlcPlots.childs()[l].childs().color).value();else if((0,d.isArrowsPlot)(a)){const e=(0,p.ensureDefined)(h.styles.childs()[l]);r=o?e.childs().colorup.value():e.childs().colordown.value()}else r=(0,p.ensureDefined)(null===(i=h.styles.childs()[l])||void 0===i?void 0:i.child("color")).value();let c=r;const u=this._colorProviders.get(l),_=u&&u.getPlotPointStyle(t);return _&&((0,d.isArrowsPlot)(a)?(o&&void 0!==_.colors[5]&&(c=_.colors[5]),o||void 0===_.colors[6]||(c=_.colors[6])):void 0!==_.colors[0]&&(c=_.colors[0])),"transparent"===c&&(c=r),c}getValues(e){var t,i;const n=this._emptyValues.map((e=>({...e})));let r=null;const l=this._study.data().lastIndex(),h=this._studyProperties;if(null!==l)for(const e of n){if(0===(null===(t=h.styles.childs()[e.id])||void 0===t?void 0:t.childs().display.value()))continue;const i=this._study.nearestIndex(l,a.PlotRowSearchMode.NearestLeft,e.index+1);if(void 0===i)continue;const s=i+this._study.offset(e.id);r=null!==r?Math.max(s,r):s}(null===e||null!==r&&e>r)&&(e=r);const c=this._hideValues(),u=this._study.isVisible()&&!c?f.notAvailable:"";for(const e of n)e.value=u;if(c)return n;v&&n.length&&(n[n.length-1].value="");const m=this._study.priceScale();if(!this._study.isVisible()||null===e||null===m||m.isEmpty()||this._model.timeScale().isEmpty())return n;const g=(0,_.getPriceValueFormatterForSource)(this._study),y={};for(const t of n){const n=t.id,r=(0,p.ensureDefined)(h.styles.childs()[n]),c=r.childs().display.value();if(t.visible=0!==c,!t.visible)continue;const u=r.hasChild("plottype")?null===(i=r.child("plottype"))||void 0===i?void 0:i.value():null,_=this._isFundamental&&(u===d.LineStudyPlotStyle.StepLine||u===d.LineStudyPlotStyle.StepLineWithDiamonds),f=t.index,m=e-this._study.offset(n),v=_||null!==l&&m>l?a.PlotRowSearchMode.NearestLeft:a.PlotRowSearchMode.Exact,x=this._study.nearestIndex(m,v);if(void 0===x)continue;let b=y[n];if(void 0===b&&(b=this._study.getMinFirstBarIndexForPlot(n),Number.isFinite(b)&&(y[n]=b)),b>x)continue;const w=this._study.data().last(),S=this._study.data().valueAt(x)||(null!==w?w.value:null);if(null===S)continue;const P=S[f+1];(0,s.isNumber)(P)&&(t.value=g(P),t.color=(0,o.resetTransparency)(this.getPlotColor(f,S)))}return n}_hideValues(){return m&&(null===this._model.crossHairSource().pane||(0,l.isLineToolName)(h.tool.value())||null!==this._model.lineBeingEdited())}}},147257:(e,t,i)=>{i.d(t,{buildTurnaround:()=>r,buildTreeForStudy:()=>a});var s=i(650151);function n(e,t){return e.studyId.localeCompare(t.studyId)}function o(e){
const t=new Set,i=[];return e.forEach((e=>{t.has(e.studyId)||(t.add(e.studyId),i.push(e))})),i}function r(e,t){let i=t.turnaround,s=[t];for(;s.length>0;){let e=[];const t=[];s.forEach((i=>{const s=o(i.sourceStudies).sort(n);if(s.length>0){e=e.concat(s);const i=s.map((e=>e.turnaround)).join("_");t.push(i)}})),t.length&&(i=t.join("_")+"_"+i),s=e}return e+"_"+i}function a(e){const t=e.model().mainSeries();return{studyId:(0,s.ensureNotNull)(e.sourceId()),turnaround:e.turnaround(),sourceStudies:e.parentSources().filter((e=>e!==t)).map((e=>a(e)))}}},83387:(e,t,i)=>{i.d(t,{StudyPriceAxisView:()=>r});var s=i(650151),n=i(841404),o=i(114123);class r extends n.PriceAxisView{constructor(e,t){super(),this._model=e.model(),this._source=e,this._data=t}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const n=this._source.model(),r=this._source.priceScale();if(null===r)return;if(!n.isPriceScaleVisible(r))return;const a=this._source.lastValueData(this._data.plotIndex,!1);if(a.noData)return;const l=n.timeScale().visibleBarsStrictRange(),h=n.mainSeries().bars().lastIndex();if(null!==l&&null!==h){if(h<=l.lastBar()){i.background=(0,o.resetTransparency)(a.color);let s=a.color;"transparent"===s&&(s=this._model.properties().childs().scalesProperties.childs().backgroundColor.value()),i.textColor=this.generateTextColor(s),i.borderColor=void 0,e.borderVisible=!1,t.borderVisible=!1}else{const r=n.backgroundColorAtYPercentFromTop(a.coordinate/(0,s.ensureNotNull)(n.paneForSource(this._source)).height());i.background=r,i.textColor=(0,o.resetTransparency)(a.color),i.borderColor=(0,o.resetTransparency)(i.textColor),e.borderVisible=!0,t.borderVisible=!0}i.coordinate=a.coordinate,i.floatCoordinate=a.floatCoordinate,this._showAxisLabel()&&(e.text=a.text,e.visible=!0),this._updatePaneRendererData(t)}}_showPaneLabel(){const e=this._model.properties().childs().scalesProperties.childs();return(e.showStudyPlotLabels.value()||e.showFundamentalNameLabel.value())&&this._source.properties().childs().showLabelsOnPriceScale.value()&&this._source.isPlotVisibleAt(this._data.plotIndex,4)}_showAxisLabel(){const e=this._model.properties().childs().scalesProperties.childs();return(e.showStudyLastValue.value()||e.showFundamentalLastValue.value())&&this._source.properties().childs().showLabelsOnPriceScale.value()&&this._source.isPlotVisibleAt(this._data.plotIndex,4)}_updatePaneRendererData(e){e.text="",this._showPaneLabel()&&(e.text=this._source.priceLabelText(this._data.plotIndex),e.visible=!0)}}},392462:(e,t,i)=>{i.d(t,{plotShapesData:()=>n});var s=i(777754);const n={shape_arrow_down:{guiName:s.t(null,void 0,i(348732)),id:"shape_arrow_down",paneRendererClass:"PaneRendererArrowDown",pineName:"shape.arrowdown",icon:"arrow_down"},shape_arrow_up:{guiName:s.t(null,void 0,i(610650)),id:"shape_arrow_up",paneRendererClass:"PaneRendererArrowUp",pineName:"shape.arrowup",icon:"arrow_up"},shape_circle:{guiName:s.t(null,void 0,i(490068)),id:"shape_circle",paneRendererClass:"PaneRendererCircleShape",pineName:"shape.circle",icon:"circle"},shape_cross:{
guiName:s.t(null,void 0,i(429908)),id:"shape_cross",paneRendererClass:"PaneRendererCrossShape",pineName:"shape.cross",icon:"cross"},shape_diamond:{guiName:s.t(null,void 0,i(773720)),id:"shape_diamond",paneRendererClass:"PaneRendererDiamond",pineName:"shape.diamond",icon:"diamond"},shape_flag:{guiName:s.t(null,void 0,i(121524)),id:"shape_flag",paneRendererClass:"PaneRendererFlagShape",pineName:"shape.flag",icon:"flag"},shape_label_down:{guiName:s.t(null,void 0,i(318528)),id:"shape_label_down",paneRendererClass:"PaneRendererLabelDown",pineName:"shape.labeldown",icon:"label_down"},shape_label_up:{guiName:s.t(null,void 0,i(513046)),id:"shape_label_up",paneRendererClass:"PaneRendererLabelUp",pineName:"shape.labelup",icon:"label_up"},shape_square:{guiName:s.t(null,void 0,i(944904)),id:"shape_square",paneRendererClass:"PaneRendererSquare",pineName:"shape.square",icon:"square"},shape_triangle_down:{guiName:s.t(null,void 0,i(483356)),id:"shape_triangle_down",paneRendererClass:"PaneRendererTriangleApexDown",pineName:"shape.triangledown",icon:"triangle_down"},shape_triangle_up:{guiName:s.t(null,void 0,i(928340)),id:"shape_triangle_up",paneRendererClass:"PaneRendererTriangleApexUp",pineName:"shape.triangleup",icon:"triangle_up"},shape_xcross:{guiName:s.t(null,void 0,i(707050)),id:"shape_xcross",paneRendererClass:"PaneRendererXCross",pineName:"shape.xcross",icon:"x_cross"}}},837512:(e,t,i)=>{i.d(t,{TextWidthCache:()=>s});class s{constructor(e=150){this._actualSize=0,this._usageTick=1,this._oldestTick=1,this._tick2Labels=new Map,this._cache=new Map,this._maxSize=e}reset(){this._actualSize=0,this._cache.clear(),this._usageTick=1,this._oldestTick=1,this._tick2Labels.clear()}measureText(e,t){return this.getMetrics(e,t).width}yMidCorrection(e,t){const i=this.getMetrics(e,t);return"actualBoundingBoxAscent"in i&&"actualBoundingBoxDescent"in i?(i.actualBoundingBoxAscent-i.actualBoundingBoxDescent)/2:0}getMetrics(e,t){const i=this._cache.get(t);if(void 0!==i)return i.metrics;if(this._actualSize===this._maxSize){const e=this._tick2Labels.get(this._oldestTick);this._tick2Labels.delete(this._oldestTick),this._cache.delete(e),this._oldestTick++,this._actualSize--}e.save(),e.textBaseline="middle";const s=e.measureText(t);return e.restore(),0===s.width&&t.length||(this._cache.set(t,{metrics:s,tick:this._usageTick}),this._tick2Labels.set(this._usageTick,t),this._actualSize++,this._usageTick++),s}}},149590:(e,t,i)=>{i.d(t,{INVALID_TIME_POINT_INDEX:()=>s,UNPLOTTABLE_TIME_POINT_INDEX:()=>n});const s=-2e6,n=-1e6},831356:(e,t,i)=>{i.d(t,{createVisibilityController:()=>l});var s=i(777754),n=i(778785),o=i(506845),r=i(62802);function a(e){return"alwaysOn"===e||"alwaysOff"===e?e:"visibleOnMouseOver"}function l(e,t){let l,h;function d(){if(!l){l=(0,o.createPrimitiveProperty)();let i=r.getValue(e);void 0===i&&void 0!==t&&(i=r.getValue(t)),l.setValue(a(i)),l.subscribe(l,(t=>{r.setValue(e,a(t.value()))}))}return l}return{property:d,availableValues:function(){return[{id:"visibleOnMouseOver",value:"visibleOnMouseOver",title:s.t(null,void 0,i(689960))},{
id:"alwaysOn",value:"alwaysOn",title:s.t(null,void 0,i(471997))},{id:"alwaysOff",value:"alwaysOff",title:s.t(null,void 0,i(109408))}]},actualBehavior:function(){if(!h){h=(0,o.createPrimitiveProperty)();const e=d(),t=()=>{let t=e.value();"alwaysOn"!==t&&"alwaysOff"!==t&&(t=n.mobiletouch?"alwaysOn":"visibleOnMouseOver"),h&&h.setValue(t)};e.subscribe(h,t),t()}return h}}}},334844:(e,t,i)=>{i.d(t,{getStudyDangerReason:()=>n});var s=i(26045);function n(e){const t=e.metaInfo();if(!0===t.historyCalculationMayChange)return s.DataSourceDangerReason.PineRepainting;const i=t.inputs.filter((e=>"symbol"===e.type)).map((e=>e.id));for(const t of i){const i=e.properties().childs().inputs.childs()[t].value(),n=e.resolvedSymbolInfoBySymbol(i);if(n){if("spread"===n.type)return s.DataSourceDangerReason.Spread;if("CRYPTOCAP"===n.exchange)return s.DataSourceDangerReason.CryptoCap}}const o=e.ownerSource();return e.isChildStudy()&&o?n(o):null}}}]);