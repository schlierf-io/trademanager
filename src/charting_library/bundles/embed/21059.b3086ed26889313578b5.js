(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[21059,73580,58724,84566],{167175:(e,t,i)=>{"use strict";i.d(t,{mobiletouch:()=>r,touch:()=>o,isChrome:()=>l,isFF:()=>a,isEdge:()=>u,isSafari:()=>d,isMac:()=>c,isWindows:()=>h,isLinux:()=>p,isAndroid:()=>_,isBlackBerry:()=>y,isIOS:()=>S,isOperaMini:()=>f,isIPad:()=>m,isAnyMobile:()=>g});const s="undefined"!=typeof window&&"undefined"!=typeof navigator,n=s&&"ontouchstart"in window,r=s&&n&&"onorientationchange"in window,o=s&&(n||!!navigator.maxTouchPoints),l=s&&window.chrome&&window.chrome.runtime,a=s&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,u=s&&/\sEdge\/\d\d\b/.test(navigator.userAgent),d=s&&Boolean(navigator.vendor)&&navigator.vendor.indexOf("Apple")>-1&&-1===navigator.userAgent.indexOf("CriOS")&&-1===navigator.userAgent.indexOf("FxiOS"),c=s&&/mac/i.test(navigator.platform),h=s&&/Win32|Win64/i.test(navigator.platform),p=s&&/Linux/i.test(navigator.platform),_=s&&/Android/i.test(navigator.userAgent),y=s&&/BlackBerry/i.test(navigator.userAgent),S=s&&/iPhone|iPad|iPod/.test(navigator.platform),f=s&&/Opera Mini/i.test(navigator.userAgent),m=s&&("MacIntel"===navigator.platform&&navigator.maxTouchPoints>1||/iPad/.test(navigator.platform)),g=_||y||S||f},554433:(e,t,i)=>{"use strict";i.d(t,{VisibilityApi:()=>r});var s=i(988411),n=i.n(s);class r{constructor(e){let t;this.isVisible=new(n())(!0);let i=null;for(const s of["","moz","ms","webkit"]){const n=s?`${s}Hidden`:"hidden";if(n in e){t=`${s}visibilitychange`,i=()=>{this.isVisible.setValue(!e[n])},i(),e.addEventListener(t,i,!1);break}}this.destroy=()=>{i&&(e.removeEventListener(t,i,!1),i=null)}}}},424450:(e,t,i)=>{"use strict";i.d(t,{themes:()=>a});var s=i(86746),n=i(777754),r=i(629006),o=i(407319),l=i(551238);const a={[s.StdTheme.Light]:{name:s.StdTheme.Light,label:()=>n.t(null,{context:"colorThemeName"},i(669841)),order:2,getThemedColor:e=>(0,l.getHexColorByName)(e)},[s.StdTheme.Dark]:{name:s.StdTheme.Dark,label:()=>n.t(null,{context:"colorThemeName"},i(14642)),order:1,getThemedColor:e=>{const t=r[e]||e;return(0,l.getHexColorByName)(t)}}};a.sa={isPrivate:!0,noChartTheme:!0,name:"sa",getThemedColor:e=>{const t=o[e]||e;return(0,l.getHexColorByName)(t)}}},440498:(e,t,i)=>{"use strict";i.d(t,{DELETED_SYMBOLS_LIST_ID:()=>s,isDeletedSymbolsList:()=>n});i(49437),i(738600);const s="deleted_symbols_list_id",n=e=>e===s},441101:e=>{e.exports={loaderContainer:"loaderContainer-H0b_GI0Y"}},212686:(e,t,i)=>{"use strict";function s(e,t){return(null==t?void 0:t.includes("cfd"))&&["commodity","futures","index","stock","fund"].includes(e)||"cfd"===e}i.d(t,{isCFDSymbol:()=>s})},973580:(e,t,i)=>{"use strict";i.d(t,{TVAction:()=>n,TVActionAsync:()=>r,TVLoader:()=>o});var s=i(310399);class n extends s.Action{constructor(e,t){super({...e,actionId:"TVActionId"},t)}getState(){return{...super.getState(),jsxLabel:this._options.jsxLabel}}}class r extends s.ActionAsync{constructor(e){super("TVActionId",e)}}class o extends n{constructor(){super({})}isLoading(){return!0}getSize(){return"big"}}},771236:(e,t,i)=>{
"use strict";i.d(t,{InvalidationLevel:()=>s,defaultInvalidationLevel:()=>o,InvalidationMask:()=>l});var s,n=i(650151),r=i(194106);!function(e){e[e.None=0]="None",e[e.Cursor=1]="Cursor",e[e.Light=2]="Light",e[e.Full=3]="Full"}(s||(s={}));const o=s.None;class l{constructor(e=o){this._panesOrderChanged=!1,this._keepVisibleTimeRangeOnResize=!1,this._timeAxisInvalidationLevel=o,this._invalidatedPanes=new Map,this._additionalActions=[],this._timeScaleInvalidations=[],this._invalidationLevel=e}invalidateAll(e){this._invalidationLevel!==e&&(this._invalidationLevel=Math.max(this._invalidationLevel,e),this._invalidatedPanes.forEach((e=>{e.invalidateAll(this._invalidationLevel)})))}invalidateAllPane(e,t){this._invalidatedPanes.has(e)||this._invalidatedPanes.set(e,new r.PaneInvalidationMask(this._invalidationLevel)),(0,n.ensureDefined)(this._invalidatedPanes.get(e)).invalidateAll(t)}invalidatePriceScale(e,t,i,s){this._invalidatedPanes.has(e)||this._invalidatedPanes.set(e,new r.PaneInvalidationMask(this._invalidationLevel)),(0,n.ensureDefined)(this._invalidatedPanes.get(e)).invalidatePriceScale(t,i,s)}invalidateTimeScale(e){this._timeAxisInvalidationLevel=Math.max(this._timeAxisInvalidationLevel,e)}invalidatePanesOrder(){this._panesOrderChanged=!0}lockVisibleTimeRangeOnResize(){this._keepVisibleTimeRangeOnResize=!0}fullInvalidation(){return this._invalidationLevel}maxPaneInvalidation(){const e=[];return this._invalidatedPanes.forEach((t=>{e.push(t.fullInvalidation())})),Math.max(...e,this._invalidationLevel)}invalidateForPane(e){return this._invalidatedPanes.get(e)||new r.PaneInvalidationMask(this._invalidationLevel)}invalidateForTimeScale(){return Math.max(this._timeAxisInvalidationLevel,this._invalidationLevel)}validationActions(){return this._additionalActions}addValidationAction(e){this._additionalActions.push(e)}merge(e){this._invalidationLevel=Math.max(this._invalidationLevel,e._invalidationLevel),this._panesOrderChanged=this._panesOrderChanged||e._panesOrderChanged,this._keepVisibleTimeRangeOnResize=this._keepVisibleTimeRangeOnResize||e._keepVisibleTimeRangeOnResize,this._invalidatedPanes.forEach((e=>{e.invalidateAll(this._invalidationLevel)})),e._invalidatedPanes.forEach(((e,t)=>{this._invalidatedPanes.has(t)||this._invalidatedPanes.set(t,new r.PaneInvalidationMask(this._invalidationLevel)),(0,n.ensureDefined)(this._invalidatedPanes.get(t)).merge(e)})),this._timeAxisInvalidationLevel=Math.max(this._timeAxisInvalidationLevel,e._timeAxisInvalidationLevel);for(let t=0;t<e._additionalActions.length;t++)this._additionalActions.push(e._additionalActions[t]);for(const t of e._timeScaleInvalidations)this._applyTimeScaleInvalidation(t)}panesOrderInvalidated(){return this._panesOrderChanged}isVisibleTimeRangeLockedOnResize(){return this._keepVisibleTimeRangeOnResize}setTimeScaleAnimation(e){this._removeTimeScaleAnimation(),this._timeScaleInvalidations.push({type:0,value:e})}stopTimeScaleAnimation(){this._removeTimeScaleAnimation(),this._timeScaleInvalidations.push({type:1})}timeScaleInvalidations(){
return this._timeScaleInvalidations}static cursor(){return new l(s.Cursor)}static light(){return new l(s.Light)}static full(){return new l(s.Full)}static panesOrder(){const e=l.full();return e.invalidatePanesOrder(),e}static invalidateLegendWidgetLayout(e){var t;const i=new l;return i._invalidatedPanes.set(e,new r.PaneInvalidationMask),null===(t=i._invalidatedPanes.get(e))||void 0===t||t.invalidateLegendWidgetLayout(),i}static validateAction(e){const t=new l;return t._additionalActions.push(e),t}_applyTimeScaleInvalidation(e){switch(e.type){case 0:this.setTimeScaleAnimation(e.value);break;case 1:this._removeTimeScaleAnimation()}}_removeTimeScaleAnimation(){const e=this._timeScaleInvalidations.findIndex((e=>0===e.type));if(-1!==e){const[t]=this._timeScaleInvalidations.splice(e,1);t.value.terminate()}}}},472032:(e,t,i)=>{"use strict";i.d(t,{SessionInfo:()=>o.SessionInfo,newBarBuilder:()=>l,getPeriodsBetweenDates:()=>a});i(747342);var s=i(568450),n=i(104329),r=i(319127),o=i(726322);function l(e,t,i,o=!1){const l=s.Interval.parse(e),a=l.multiplier();return l.isMinutes()?new n.IntradayBarBuilder(60*a,t):l.isSeconds()?new n.IntradayBarBuilder(a,t):l.isTicks()?new n.IntradayBarBuilder(1,t):l.isRange()?new n.IntradayBarBuilder(60*a,t):new r.MultidayBarBuilder(t,i,a,function(e,t){switch(e){case s.ResolutionKind.Days:return new r.DailyBuilder(t);case s.ResolutionKind.Weeks:return new r.WeeklyBuilder(t);case s.ResolutionKind.Months:return new r.MonthlyBuilder}throw new Error(`Unknown dwm resolution: ${e}`)}(l.kind(),t),o)}function a(e,t,i,n,r,l,a){const u=s.Interval.parse(r+n);if(u.isMonths()){const e=new Date(l),t=new Date(a);let i=12*(t.getUTCFullYear()-e.getUTCFullYear());return i+=t.getUTCMonth()-e.getUTCMonth(),Math.ceil(i/u.multiplier())}const d=new o.SessionInfo("Etc/UTC",e,t,i),c=u.inMilliseconds();let h;h=u.isDWM()?864e5:60*d.spec.maxTradingDayLength()*1e3;let p=0;p=u.isWeeks()?7:7-d.spec.weekEndsCount();const _=a-l,y=h/c,S=p*y;let f=_/864e5*y;f>=S&&(f=_/6048e5*S);return f%1<=Number.EPSILON*Math.ceil(f)?Math.round(f):Math.ceil(f)}},424061:(e,t,i)=>{"use strict";var s=i(812363).PlotRowSearchMode,n=i(519872).STUDYPLOTDISPLAYTARGET,r=i(114123).rgbaFromInteger;function o(){this.backColorers=[]}function l(e){o.call(this),this._series=e}function a(e,t){o.call(this),this._study=e,this._plotIndex=t}o.prototype.barStyle=function(e,t,i){for(var s={},n=this.backColorers.length-1;n>=0;n--)this.backColorers[n].applyBarStyle(e,t,s,i);return this.applyBarStyle(e,t,s,i),s},o.prototype.pushBackBarColorer=function(e){this.backColorers.push(e)},o.prototype.applyBarStyle=function(e,t,i){throw new Error("This function is supposed to be reimplemented in a subclass")},inherit(l,o),l.upColor=function(e,t){var i=e.style.value();switch(i){case TradingView.Series.STYLE_LINE:return e.lineStyle.color.value();case TradingView.Series.STYLE_AREA:return e.areaStyle.linecolor.value();case TradingView.Series.STYLE_BARS:return e.barStyle.upColor.value();case TradingView.Series.STYLE_CANDLES:return e.candleStyle.upColor.value()
;case TradingView.Series.STYLE_HOLLOW_CANDLES:return e.hollowCandleStyle.upColor.value();case TradingView.Series.STYLE_HEIKEN_ASHI:return e.haStyle.upColor.value();case TradingView.Series.STYLE_BASELINE:return e.baselineStyle.topLineColor.value();case TradingView.Series.STYLE_HILO:return e.hiloStyle.color.value();case TradingView.Series.STYLE_COLUMNS:return e.columnStyle.upColor.value()}switch(i){case TradingView.Series.STYLE_RENKO:return t?e.renkoStyle.upColorProjection.value():e.renkoStyle.upColor.value();case TradingView.Series.STYLE_PB:return t?e.pbStyle.upColorProjection.value():e.pbStyle.upColor.value();case TradingView.Series.STYLE_KAGI:return t?e.kagiStyle.upColorProjection.value():e.kagiStyle.upColor.value();case TradingView.Series.STYLE_PNF:return t?e.pnfStyle.upColorProjection.value():e.pnfStyle.upColor.value()}if(TradingView.Series.STYLE_RANGE===i)return t?e.rangeStyle.upColorProjection.value():e.rangeStyle.upColor.value();throw new Error("Unknown series style")},l.downColor=function(e,t){var i=e.style.value();switch(i){case TradingView.Series.STYLE_LINE:return e.lineStyle.color.value();case TradingView.Series.STYLE_AREA:return e.areaStyle.linecolor.value();case TradingView.Series.STYLE_BARS:return e.barStyle.downColor.value();case TradingView.Series.STYLE_CANDLES:return e.candleStyle.downColor.value();case TradingView.Series.STYLE_HOLLOW_CANDLES:return e.hollowCandleStyle.downColor.value();case TradingView.Series.STYLE_HEIKEN_ASHI:return e.haStyle.downColor.value();case TradingView.Series.STYLE_BASELINE:return e.baselineStyle.bottomLineColor.value();case TradingView.Series.STYLE_HILO:return e.hiloStyle.color.value();case TradingView.Series.STYLE_COLUMNS:return e.columnStyle.downColor.value()}switch(i){case TradingView.Series.STYLE_RENKO:return t?e.renkoStyle.downColorProjection.value():e.renkoStyle.downColor.value();case TradingView.Series.STYLE_PB:return t?e.pbStyle.downColorProjection.value():e.pbStyle.downColor.value();case TradingView.Series.STYLE_KAGI:return t?e.kagiStyle.downColorProjection.value():e.kagiStyle.downColor.value();case TradingView.Series.STYLE_PNF:return t?e.pnfStyle.downColorProjection.value():e.pnfStyle.downColor.value()}if(TradingView.Series.STYLE_RANGE===i)return t?e.rangeStyle.downColorProjection.value():e.rangeStyle.downColor.value();throw new Error("Unknown series style")},l.prototype._applyLineStyle=function(e,t,i,s,n){i.barColor=l.upColor(n)},l.prototype._applyAreaStyle=function(e,t,i,s,n){i.barColor=l.upColor(n)},l.prototype._applyBarStyle=function(e,t,i,s,n){var r=l.upColor(n),o=l.downColor(n),a=this.findBar(e,!1,s);if(n.barStyle.barColorsOnPrevClose.value()){var u=this.findPrevBar(e,!1,s);i.barColor=u[TradingView.CLOSE_PLOT]<=a[TradingView.CLOSE_PLOT]?r:o,i.barBorderColor=u[TradingView.CLOSE_PLOT]<=a[TradingView.CLOSE_PLOT]?r:o}else i.barColor=a[TradingView.OPEN_PLOT]<=a[TradingView.CLOSE_PLOT]?r:o,i.barBorderColor=a[TradingView.OPEN_PLOT]<=a[TradingView.CLOSE_PLOT]?r:o},l.prototype._applyRangeStyle=function(e,t,i,s,n){
var r=l.upColor(n,t),o=l.downColor(n,t),a=this.findBar(e,!1,s);i.barColor=a[TradingView.OPEN_PLOT]<=a[TradingView.CLOSE_PLOT]?r:o,i.barBorderColor=i.barColor},l.prototype._applyCandleStyle=function(e,t,i,s,n){var r,o=l.upColor(n,t),a=l.downColor(n,t),u=n.candleStyle.borderUpColor?n.candleStyle.borderUpColor.value():n.candleStyle.borderColor.value(),d=n.candleStyle.borderDownColor?n.candleStyle.borderDownColor.value():n.candleStyle.borderColor.value(),c=n.candleStyle.wickUpColor?n.candleStyle.wickUpColor.value():n.candleStyle.wickColor.value(),h=n.candleStyle.wickDownColor?n.candleStyle.wickDownColor.value():n.candleStyle.wickColor.value(),p=this.findBar(e,!1,s);n.candleStyle.barColorsOnPrevClose.value()&&this._series.data().first().index!==e?r=this.findPrevBar(e,!1,s)[TradingView.CLOSE_PLOT]<=p[TradingView.CLOSE_PLOT]:r=p[TradingView.OPEN_PLOT]<=p[TradingView.CLOSE_PLOT];i.barColor=r?o:a,i.barBorderColor=r?u:d,i.barWickColor=r?c:h},l.prototype._applyHollowCandleStyle=function(e,t,i,s,n){var r,o=l.upColor(n,t),a=l.downColor(n,t),u=n.hollowCandleStyle.borderUpColor?n.hollowCandleStyle.borderUpColor.value():n.hollowCandleStyle.borderColor.value(),d=n.hollowCandleStyle.borderDownColor?n.hollowCandleStyle.borderDownColor.value():n.hollowCandleStyle.borderColor.value(),c=n.hollowCandleStyle.wickUpColor?n.hollowCandleStyle.wickUpColor.value():n.hollowCandleStyle.wickColor.value(),h=n.hollowCandleStyle.wickDownColor?n.hollowCandleStyle.wickDownColor.value():n.hollowCandleStyle.wickColor.value(),p=this.findBar(e,!1,s),_=this.findPrevBar(e,!1,s);r=this._series.data().first().index!==e?_[TradingView.CLOSE_PLOT]<=p[TradingView.CLOSE_PLOT]:p[TradingView.OPEN_PLOT]<=p[TradingView.CLOSE_PLOT],i.barColor=r?o:a,i.barBorderColor=r?u:d,i.barWickColor=r?c:h,i.isBarHollow=p[TradingView.OPEN_PLOT]<=p[TradingView.CLOSE_PLOT]},l.prototype._applyHAStyle=function(e,t,i,s,n){var r,o=l.upColor(n,t),a=l.downColor(n,t),u=n.haStyle.borderUpColor.value(),d=n.haStyle.borderDownColor.value(),c=n.haStyle.wickUpColor.value(),h=n.haStyle.wickDownColor.value(),p=this.findBar(e,t,s);n.haStyle.barColorsOnPrevClose.value()?r=this.findPrevBar(e,t,s)[TradingView.CLOSE_PLOT]<=p[TradingView.CLOSE_PLOT]:r=p[TradingView.OPEN_PLOT]<=p[TradingView.CLOSE_PLOT];i.barColor=r?o:a,i.barBorderColor=r?u:d,i.barWickColor=r?c:h},l.prototype._applyRenkoStyle=function(e,t,i,s,n){var r=this.findBar(e,t,s),o=r[TradingView.OPEN_PLOT]<=r[TradingView.CLOSE_PLOT],a=l.upColor(n,t),u=l.downColor(n,t),d=t?n.renkoStyle.borderUpColorProjection.value():n.renkoStyle.borderUpColor.value(),c=t?n.renkoStyle.borderDownColorProjection.value():n.renkoStyle.borderDownColor.value(),h=n.renkoStyle.wickUpColor.value(),p=n.renkoStyle.wickDownColor.value();i.barColor=o?a:u,i.barBorderColor=o?d:c,i.barWickColor=o?h:p,i.isBarUp=o},l.prototype._applyPBStyle=function(e,t,i,s,n){i.barColor=l.upColor(n)
;var r=this.findBar(e,t,s),o=r[TradingView.OPEN_PLOT]<=r[TradingView.CLOSE_PLOT],a=l.upColor(n,t),u=l.downColor(n,t),d=t?n.pbStyle.borderUpColorProjection.value():n.pbStyle.borderUpColor.value(),c=t?n.pbStyle.borderDownColorProjection.value():n.pbStyle.borderDownColor.value();i.barColor=o?a:u,i.barBorderColor=o?d:c,i.isBarUp=o},l.prototype._applyKagiStyle=function(e,t,i,s,n){i.upColor=l.upColor(n,t),i.downColor=l.downColor(n,t);var r=null,o=this.findBar(e,t,s);o[TradingView.LOW_PLOT]<o[TradingView.ADT_PLOT]&&o[TradingView.ADT_PLOT]<o[TradingView.HIGH_PLOT]?(r=o[TradingView.OPEN_PLOT]<=o[TradingView.CLOSE_PLOT],i.isTwoColorBar=!0):(r=o[TradingView.OPEN_PLOT]<=o[TradingView.CLOSE_PLOT]?o[TradingView.OPEN_PLOT]===o[TradingView.ADT_PLOT]:o[TradingView.OPEN_PLOT]!==o[TradingView.ADT_PLOT],i.isTwoColorBar=!1),i.barColor=r?i.upColor:i.downColor,i.isBarUp=o[TradingView.OPEN_PLOT]<=o[TradingView.CLOSE_PLOT]},l.prototype._applyPnfStyle=function(e,t,i,s,n){var r=this.findBar(e,t,s)[TradingView.ADT_PLOT],o=r>0,a=l.upColor(n,t),u=l.downColor(n,t);i.isBarUp=o,i.isMergedBar=2===Math.abs(r),i.upColor=a,i.downColor=u,i.barColor=o?a:u},l.prototype._applyBaseLineStyle=function(e,t,i,s,n){var r=this.findBar(e,t,s),o=n.baselineStyle,a=this._series.priceScale(),u=Math.round(a.height()*(Math.abs(100-o.baseLevelPercentage.value())/100)),d=this._series.firstValue(),c=a.coordinateToPrice(u,d);r[TradingView.CLOSE_PLOT]>c?i.barColor=l.upColor(n,t):i.barColor=l.downColor(n,t)},l.prototype._applyHiLoStyle=function(e,t,i,s,n){i.barColor=l.upColor(n,t),i.barBorderColor=n.hiloStyle.borderColor.value()},l.prototype._applyColumnStyle=function(e,t,i,s,n){var r=l.upColor(n),o=l.downColor(n),a=this.findBar(e,!1,s);if(n.columnStyle.barColorsOnPrevClose.value()){var u=this.findPrevBar(e,!1,s);i.color=u[TradingView.CLOSE_PLOT]<=a[TradingView.CLOSE_PLOT]?r:o}else i.color=a[TradingView.OPEN_PLOT]<=a[TradingView.CLOSE_PLOT]?r:o;i.barColor=i.color},l.prototype.applyBarStyle=function(e,t,i,s){i||(i={}),i.barColor=null,i.barBorderColor=null,i.barWickColor=null,i.isBarHollow=null,i.isBarUp=null,i.upColor=null,i.downColor=null,i.isTwoColorBar=null,i.isMergedBar=null;var n=this._series.properties(),r=n.style.value();switch(r){case TradingView.Series.STYLE_LINE:this._applyLineStyle(e,t,i,s,n);break;case TradingView.Series.STYLE_AREA:this._applyAreaStyle(e,t,i,s,n);break;case TradingView.Series.STYLE_BARS:this._applyBarStyle(e,t,i,s,n);break;case TradingView.Series.STYLE_CANDLES:this._applyCandleStyle(e,t,i,s,n);break;case TradingView.Series.STYLE_HOLLOW_CANDLES:this._applyHollowCandleStyle(e,t,i,s,n);break;case TradingView.Series.STYLE_HEIKEN_ASHI:this._applyHAStyle(e,t,i,s,n);break;case TradingView.Series.STYLE_BASELINE:this._applyBaseLineStyle(e,t,i,s,n);break;case TradingView.Series.STYLE_HILO:this._applyHiLoStyle(e,t,i,s,n);break;case TradingView.Series.STYLE_COLUMNS:this._applyColumnStyle(e,t,i,s,n)}switch(r){case TradingView.Series.STYLE_RENKO:this._applyRenkoStyle(e,t,i,s,n);break;case TradingView.Series.STYLE_PB:this._applyPBStyle(e,t,i,s,n);break
;case TradingView.Series.STYLE_KAGI:this._applyKagiStyle(e,t,i,s,n);break;case TradingView.Series.STYLE_PNF:this._applyPnfStyle(e,t,i,s,n)}return TradingView.Series.STYLE_RANGE===r&&this._applyRangeStyle(e,t,i,s,n),i},l.prototype.getSeriesBars=function(e){return e?this._series.nsBars():this._series.bars()},l.prototype._findBarFieldValue=function(e,t,i){var s=this.getSeriesBars(i).valueAt(e);if(null!==s)return s[t]},l.prototype.findBar=function(e,t,i){return i?i.value:this.getSeriesBars(t).valueAt(e)||[]},l.prototype.findPrevBar=function(e,t,i){if(i&&i.previousValue)return i.previousValue;var n=this._series.bars().search(e-1,s.NearestLeft,TradingView.CLOSE_PLOT);return null!==n?n.value:[]},inherit(a,o),a.prototype.getBars=function(){return this._study.series().bars()},a.prototype.firstColoredBar=function(e){for(var t=e,i=0;i<this.backColorers.length;i++)t=Math.min(t,this.backColorers[i].firstColoredBar(e));var s=this.getOffset(this._plotIndex);t=Math.min(t,e+s);var n=this.getBars().firstIndex();return Math.max(t,n)},a.prototype.getOffset=function(){var e=this._study.metaInfo().plots[this._plotIndex];return this._study.offset(e.id)},a.prototype.applyBarStyle=function(e,t,i){if(i||(i={}),t)return i;var s=this._study.properties();if(!s.visible.value())return i;var o=this._study.metaInfo(),l=this._study.data();if(!l||0===l.size())return i;var a=o.plots[this._plotIndex],u=this.getOffset();if(this._study.getMinFirstBarIndexForPlot(a.id)>e+u)return i;if(s.styles[a.id].display.value()===n.None)return i;var d=l.valueAt(e-u);if(null===d)return i;var c=d[this._plotIndex+1];if(null==c)return i;if(c=Math.round(c),o.isRGB)i.barColor=r(c),i.upColor=i.barColor,i.downColor=i.barColor;else{var h=o.plots[this._plotIndex].palette,p=s.palettes[h],_=o.palettes[h].valToIndex?o.palettes[h].valToIndex[c]:c,y=p.colors[_].color.value();i.barColor=y,i.upColor=y.color,i.downColor=y.color}return i},t.SeriesBarColorer=l,t.StudyBarColorer=a},7628:(e,t,i)=>{"use strict";function s(e){return"="+JSON.stringify(n(e))}function n(e){return Object.keys(e).sort().reduce(((t,i)=>("[object Object]"===Object.prototype.toString.call(e[i])?t[i]=n(e[i]):t[i]=e[i],t)),{})}function r(e){return Boolean(e.inputs)||function(e){return Boolean(e.replay)}(e)||e.session||e.adjustment||e["currency-id"]||e["unit-id"]?s(e):e.symbol}function o(e){return"="===e[0]}function l(e){if(!o(e))return{symbol:e};try{return JSON.parse(e.slice(1))}catch(t){return{symbol:e}}}function a(e){return"string"==typeof e?e:a(e.symbol)}i.d(t,{encodeExtendedSymbolOrGetSimpleSymbolString:()=>r,isEncodedExtendedSymbol:()=>o,decodeExtendedSymbol:()=>l,unwrapSimpleSymbol:()=>a})},801750:(e,t,i)=>{"use strict";i.d(t,{shouldBeFormattedAsPercent:()=>r,shouldBeFormattedAsIndexedTo100:()=>o,getPriceValueFormatterForSource:()=>l});var s=i(720444),n=i(354145);function r(e){const t=e.priceScale();return!(null===t||!t.isPercentage())&&(!(0,n.isActingAsSymbolSource)(e)||(0,s.isPriceSourceStyle)(e.style()))}function o(e){const t=e.priceScale();return!(null===t||!t.isIndexedTo100())&&(!(0,
n.isActingAsSymbolSource)(e)||(0,s.isPriceSourceStyle)(e.style()))}function l(e){const t=e.priceScale();if(o(e)&&null!==t)return i=>{var s;return t.formatPriceIndexedTo100(i,null!==(s=e.firstValue())&&void 0!==s?s:100)};if(r(e)&&null!==t)return i=>{var s;return t.formatPricePercentage(i,null!==(s=e.firstValue())&&void 0!==s?s:100)};const i=e.formatter();return i.format.bind(i)}},323017:(e,t,i)=>{"use strict";i.d(t,{makeIntervalsVisibilitiesVisibleAtInterval:()=>a,isActualInterval:()=>d,nonDefaultIntervalsVisibilities:()=>c,mergeIntervalVisibilitiesDefaults:()=>h,getIntervalsVisibilitiesForMode:()=>p});var s=i(712433),n=i(822914),r=i(650151),o=i(568450),l=i(488792);function a(e,t){let i=t.multiplier();if(t.isTicks()&&(e.ticks=!0),t.isSeconds()&&(i<60?(e.seconds=!0,e.secondsFrom=Math.min(e.secondsFrom,i),e.secondsTo=Math.max(e.secondsTo,i)):(i=Math.floor(i/60),t=new o.Interval(o.ResolutionKind.Minutes,i))),t.isMinutes())if(i<60)e.minutes=!0,e.minutesFrom=Math.min(e.minutesFrom,i),e.minutesTo=Math.max(e.minutesTo,i);else{const t=Math.floor(i/60);e.hours=!0,e.hoursFrom=Math.min(e.hoursFrom,t),e.hoursTo=Math.max(e.hoursTo,t)}t.isDays()&&(e.days=!0,e.daysFrom=Math.min(e.daysFrom,i),e.daysTo=Math.max(e.daysTo,i)),t.isWeeks()&&(e.weeks=!0,e.weeksFrom=Math.min(e.weeksFrom,i),e.weeksTo=Math.max(e.weeksTo,i)),t.isMonths()&&(e.months=!0,e.monthsFrom=Math.min(e.monthsFrom,i),e.monthsTo=Math.max(e.monthsTo,i)),t.isRange()&&(e.ranges=!0)}function u(e,t,i,s){return e&&s>=t&&s<=i}function d(e,t){const i=t.childs();switch(e.kind()){case o.ResolutionKind.Ticks:return i.ticks.value();case o.ResolutionKind.Seconds:if(e.multiplier()<60)return u(i.seconds.value(),i.secondsFrom.value(),i.secondsTo.value(),e.multiplier());{const t=Math.floor(e.multiplier()/60);return u(i.minutes.value(),i.minutesFrom.value(),i.minutesTo.value(),t)}case o.ResolutionKind.Minutes:if(e.multiplier()<60)return u(i.minutes.value(),i.minutesFrom.value(),i.minutesTo.value(),e.multiplier());{const t=Math.floor(e.multiplier()/60);return u(i.hours.value(),i.hoursFrom.value(),i.hoursTo.value(),t)}case o.ResolutionKind.Days:return u(i.days.value(),i.daysFrom.value(),i.daysTo.value(),e.multiplier());case o.ResolutionKind.Weeks:return u(i.weeks.value(),i.weeksFrom.value(),i.weeksTo.value(),e.multiplier());case o.ResolutionKind.Months:return u(i.months.value(),i.monthsFrom.value(),i.monthsTo.value(),e.multiplier());case o.ResolutionKind.Range:return i.ranges.value()}return(0,r.assert)(!1,`Unsupported resolution: ${e.value()}`),!1}function c(e){const t=Object.keys(e).filter((t=>l.intervalsVisibilitiesDefaults[t]!==e[t]));return 0===t.length?null:t.reduce(((t,i)=>(t[i]=e[i],t)),{})}function h(e){return(0,s.default)((0,n.default)(l.intervalsVisibilitiesDefaults),null!=e?e:{})}function p(e,t){if(0===t||e.isTicks()&&3===t||e.isRange()&&2===t)return h();let i=!1;const s={ticks:!1,seconds:!1,minutes:!1,hours:!1,days:!1,weeks:!1,months:!1,ranges:!1},n=e=>e.multiplier();return[{checker:e=>e.isTicks(),getIntervalMultiplier:n,markIntervalAsVisible:(e,t)=>{s.ticks=!0}},{
checker:e=>e.isSeconds()&&e.multiplier()<60,getIntervalMultiplier:n,markIntervalAsVisible:(e,t)=>{s.seconds=!0,s.secondsFrom=e,s.secondsTo=t}},{checker:e=>e.isSeconds()&&e.multiplier()>=60,getIntervalMultiplier:e=>Math.floor(e.multiplier()/60),markIntervalAsVisible:(e,t)=>{s.minutes=!0,s.minutesFrom=e,s.minutesTo=t}},{checker:e=>e.isMinutes()&&e.multiplier()<60,getIntervalMultiplier:n,markIntervalAsVisible:(e,t)=>{s.minutes=!0,s.minutesFrom=e,s.minutesTo=t}},{checker:e=>e.isMinutes()&&e.multiplier()>=60,getIntervalMultiplier:e=>Math.floor(e.multiplier()/60),markIntervalAsVisible:(e,t)=>{s.hours=!0,s.hoursFrom=e,s.hoursTo=t}},{checker:e=>e.isDays(),getIntervalMultiplier:n,markIntervalAsVisible:(e,t)=>{s.days=!0,s.daysFrom=e,s.daysTo=t}},{checker:e=>e.isWeeks(),getIntervalMultiplier:n,markIntervalAsVisible:(e,t)=>{s.weeks=!0,s.weeksFrom=e,s.weeksTo=t}},{checker:e=>e.isMonths(),getIntervalMultiplier:n,markIntervalAsVisible:(e,t)=>{s.months=!0,s.monthsFrom=e,s.monthsTo=t}},{checker:e=>e.isRange(),getIntervalMultiplier:n,markIntervalAsVisible:(e,t)=>{s.ranges=!0}}].forEach((s=>{if(s.checker(e)){i=!0;const n=s.getIntervalMultiplier(e);1===t?s.markIntervalAsVisible(n,n):3===t?s.markIntervalAsVisible(n,void 0):s.markIntervalAsVisible(void 0,n)}else(!i&&2===t||i&&3===t)&&s.markIntervalAsVisible(void 0,void 0)})),h(s)}},414805:(e,t,i)=>{"use strict";var s;i.d(t,{isStudyLineToolName:()=>o,isLineToolName:()=>l,isLineDrawnWithPressedButton:()=>a,isLineToolFinishRequiredWhenCreatedByApi:()=>u,isLineToolDrawWithoutPoints:()=>d,isImageToolName:()=>c,isTextToolName:()=>h});var n=i(272124);const r=new Set(["LineStudyMtpAnalysis","LineStudyMtpDecisionPoint","LineStudyMtpRiskReward","LineStudyMtpElliotWaveMain","LineStudyMtpElliotWaveMajor","LineStudyMtpElliotWaveMinor","LineStudyMtpDownWave1OrA","LineStudyMtpDownWave2OrB","LineStudyMtpDownWave3","LineStudyMtpDownWave4","LineStudyMtpDownWave5","LineStudyMtpDownWaveC","LineStudyMtpUpWave1OrA","LineStudyMtpUpWave2OrB","LineStudyMtpUpWave3","LineStudyMtpUpWave4","LineStudyMtpUpWave5","LineStudyMtpUpWaveC"]);function o(e){let t="LineToolRegressionTrend"===e||"LineToolVbPFixed"===e||"LineToolFixedRangeVolumeProfile"===e;return t||(t="LineToolAnchoredVWAP"===e||function(e){return r.has(e)}(e)),t}function l(e){return e in(s||(s=i.t(n,2)))||o(e)}function a(e){return"LineToolBrush"===e||"LineToolHighlighter"===e}function u(e){return a(e)||"LineToolPath"===e||"LineToolPolyline"===e||"LineToolGhostFeed"===e}function d(e){return"LineToolTweet"===e||"LineToolIdea"===e||"LineToolImage"===e}function c(e){return"LineToolImage"===e}function h(e){switch(e){case"LineToolBalloon":case"LineToolComment":case"LineToolText":case"LineToolTextAbsolute":case"LineToolCallout":case"LineToolNote":case"LineToolNoteAbsolute":case"LineToolSignpost":return!0}return!1}},249527:(e,t,i)=>{"use strict";i.d(t,{LineDataSource:()=>H})
;var s=i(86441),n=i(650151),r=i(251954),o=i(272001),l=i(87476),a=i(869403),u=i.n(a),d=i(835343),c=i(930981),h=i(190096),p=i(844106),_=i(988411),y=i.n(_),S=i(771236),f=i(991826),m=i(323017),g=i(488792),v=i(720444),b=i(992001),P=i(568450),C=i(40210),w=i.n(C),T=i(480071),I=i(282151),A=i(450556),L=i(758337),x=i(404822),V=i(354145),E=i(493100),M=i(746135),O=i(231193),k=i(861765),D=i(241056),R=i(51782);const F=(0,o.getLogger)("Chart.LineDataSource"),N=l.enabled("datasource_copypaste");class B{constructor(){this._states=[]}start(e){this._states.push(e)}finish(e){const t=(0,n.ensureDefined)(this._states.pop());return s=t,(i=e).length!==s.length?{indexesChanged:!0,pricesChanged:!0}:i.reduce(((e,t,i)=>{const n=s[i];return e.indexesChanged=e.indexesChanged||t.index!==n.index,e.pricesChanged=e.pricesChanged||t.price!==n.price,e}),{indexesChanged:!1,pricesChanged:!1});var i,s}isEmpty(){return 0===this._states.length}}let U=0;class H extends I.DataSource{constructor(e,t,i,s){if(super(s),this.version=1,this.toolname="",this.customization={forcePriceAxisLabel:!1,disableErasing:!1,disableSave:!1,showInObjectsTree:!0},this._currentPointsetAndSymbolId=null,this._pointChanged=new(u()),this._pointAdded=new(u()),this._priceAxisViews=[],this._timeAxisViews=[],this._timePoint=[],this._points=[],this._lastPoint=null,this._paneViews=new Map,this._normalizedPointsChanged=new(u()),this._fixedPointsChanged=new(u()),this._changeStatesStack=new B,this._startMovingPoint=null,this._currentMovingPoint=null,this._isActualSymbol=!1,this._isActualInterval=!1,this._isActualCurrency=!1,this._isActualUnit=!1,this._isDestroyed=!1,this._sharingMode=new(y())(0),this._onTemplateApplying=new(u()),this._onTemplateApplied=new(u()),this._syncStateExclusions=[],this._definitionsViewModel=null,this._syncLineStyleMuted=!1,this._onIsActualIntervalChange=new(u()),this._linkKey=new(y())(null),this._serverUpdateTime=null,this._boundCalcIsActualSymbol=this.calcIsActualSymbol.bind(this),this._alertUndoMode=!1,this._model=e,this._properties=t,this._localAndServerAlertsMismatch=!1,this._properties.hasChild("interval")||this._properties.addChild("interval",new(w())(e.mainSeries().interval())),this.calcIsActualSymbol(),this._properties.childs().intervalsVisibilities.listeners().subscribe(this,this.calcIsActualSymbol),this._properties.subscribe(this,(()=>this.propertiesChanged())),this._createPointsProperties(),this.pointsCount()>0)for(let e=0;e<this.pointsCount();e++)this._priceAxisViews.push(this.createPriceAxisView(e)),this._timeAxisViews.push(new O.LineDataSourceTimeAxisView(this,e));this._properties.childs().visible.subscribe(this,(e=>{const t=!1===(0,T.hideAllDrawings)().value();e.value()?e.value()&&t&&r.emit("drawing_event",this._id,"show"):(this._model.selection().isSelected(this)&&this._model.selectionMacro((e=>{e.removeSourceFromSelection(this)})),t&&r.emit("drawing_event",this._id,"hide")),this._onSourceHiddenMayChange()})),(0,T.hideAllDrawings)().subscribe(this,this._onSourceHiddenMayChange),this._definitionsViewModel=null,this._isDestroyed=!1}destroy(){
this._paneViews.forEach(((e,t)=>this._destroyPanePaneViews(t))),this.stop(),null!==this._definitionsViewModel&&(this._definitionsViewModel.destroy(),this._definitionsViewModel=null),null!==this._ownerSource&&(this._ownerSource.currencyChanged().unsubscribeAll(this),this._ownerSource.unitChanged().unsubscribeAll(this),(0,V.isSymbolSource)(this._ownerSource)&&(this._ownerSource.symbolResolved().subscribe(this,this._boundCalcIsActualSymbol),this._ownerSource.isActingAsSymbolSource().unsubscribe(this._boundCalcIsActualSymbol))),this.ownerSourceChanged().unsubscribeAll(this),(0,T.hideAllDrawings)().unsubscribeAll(this),this.deleteAlert(),this._isDestroyed=!0}priceScale(){return this._ownerSource?this._ownerSource.priceScale():null}createPriceAxisView(e){return new k.LineToolPriceAxisView(this,{pointIndex:e})}model(){return this._model}symbol(){return this._properties.childs().symbol.value()}linkKey(){return this._linkKey}serverUpdateTime(){return this._serverUpdateTime}setServerUpdateTime(e){this._serverUpdateTime=e}boundToSymbol(){return!0}isAvailableInFloatingWidget(){return!0}points(){const e=[];for(let t=0;t<this._points.length;t++){const i=this._points[t];e.push({index:i.index,price:i.price,time:i.time})}return this._lastPoint&&e.push(this._correctLastPoint(this._lastPoint)),!this.isFixed()&&this._currentMovingPoint&&this._startMovingPoint&&this._correctPoints(e),e}timeAxisPoints(){return this.points()}priceAxisPoints(){return this.points()}fixedPoint(){var e;let t;const i=this.priceScale();if(this._positionPercents&&null!==i&&!i.isEmpty()){const e=this._positionPercents,n=this._model.timeScale().width()*e.x,r=i.height()*e.y;t=new s.Point(n,r)}else void 0!==this._fixedPoint&&(t=null===(e=this._fixedPoint)||void 0===e?void 0:e.clone());if(this._currentMovingPoint&&this._startMovingPoint&&void 0!==t){const e=this._correctFixedPoint(t);e.didCorrect&&(t=e.point)}return t}positionPercents(){return this._positionPercents}normalizedPoints(){return this._timePoint}normalizedPointsChanged(){return this._normalizedPointsChanged}fixedPointChanged(){return this._fixedPointsChanged}geometry(){const e=(0,n.ensureNotNull)(this.priceScale());return this.points().map((t=>{const i=(0,n.ensureNotNull)(this.pointToScreenPoint(t)),r=i.x/this._model.timeScale().width(),o=i.y/e.height();return new s.Point(r,o)}))}widthsProperty(){var e;return null!==(e=this._properties.childs().linesWidths)&&void 0!==e?e:null}lineColorsProperty(){var e;return null!==(e=this._properties.childs().linesColors)&&void 0!==e?e:null}backgroundColorsProperty(){var e;return null!==(e=this._properties.childs().backgroundsColors)&&void 0!==e?e:null}textColorsProperty(){var e;return null!==(e=this._properties.childs().textsColors)&&void 0!==e?e:null}pointsProperty(){return this._pointsProperty}hasEditableCoordinates(){return!0}startMoving(e,t,i,s){this.isFixed()&&this.restoreFixedPoint(),this._startMovingPoint=e}move(e,t,i,s){if(i&&(i.shiftOnly()||i.modShift()))if(this.isFixed()){const t=this._alignScreenPointHorizontallyOrVertically((0,n.ensureDefined)(e.screen))
;this._currentMovingPoint={screen:t}}else{const t=this._alignPointHorizontallyOrVertically((0,n.ensureDefined)(e.logical)),i=(0,n.ensureNotNull)(this.pointToScreenPoint(t));this._currentMovingPoint={logical:t,screen:i}}else this._currentMovingPoint=e;this.updateAllViews((0,x.sourceChangeEvent)(this.id()))}endMoving(e,t,i){let s=!1,o=!1;if(this._currentMovingPoint&&this._startMovingPoint){if(this.isFixed()){const e=this._correctFixedPoint((0,n.ensureDefined)(this._fixedPoint));e.didCorrect&&(this._fixedPoint=e.point,this._fixedPointsChanged.fire())}else{const e=(0,n.ensureDefined)(this._currentMovingPoint.logical),t=(0,n.ensureDefined)(this._startMovingPoint.logical);s=e.index!==t.index,o=e.price!==t.price;if(this._correctPoints(this._points,i)){r.emit("drawing_event",this._id,"move"),r.emit("drawing_event",this._id,"points_changed");for(let e=0;e<this._points.length;e++)this._pointChanged.fire(e)}}this._startMovingPoint=null,this._currentMovingPoint=null}const l={indexesChanged:s,pricesChanged:o};return this.isFixed()?(this.calcPositionPercents(),this.updateAllViews((0,x.sourceChangeEvent)(this.id())),l):(this.updateAllViews((0,x.sourceChangeEvent)(this.id())),s&&!e?(this._properties.childs().interval.setValue(this._model.mainSeries().interval()),this.normalizePoints(),this.createServerPoints()):(this._copyPricesWithoutNormalization(),this._normalizedPointsChanged.fire()),t||!o&&!s||this.synchronizeAlert(!this._alertUndoMode),l)}startMovingPoint(){return this._startMovingPoint?{...this._startMovingPoint}:null}currentMovingPoint(){return this._currentMovingPoint?{...this._currentMovingPoint}:null}startChanging(e,t){void 0!==e&&void 0!==t&&(e<this._priceAxisViews.length&&this._priceAxisViews[e].setActive(!0),e<this._timeAxisViews.length&&this._timeAxisViews[e].setActive(!0)),this._changeStatesStack.start(this.points())}endChanging(e,t,i){const s=this._changeStatesStack.finish(this.points());s.indexesChanged&&this._changeStatesStack.isEmpty()?(this._properties.childs().interval.setValue(this._model.mainSeries().interval()),this.normalizePoints(),t||this.createServerPoints()):(this._copyPricesWithoutNormalization(),this._normalizedPointsChanged.fire()),r.emit("drawing_event",this._id,"points_changed");for(let e=0;e<this._priceAxisViews.length;e++)this._priceAxisViews[e].setActive(!1);for(let e=0;e<this._timeAxisViews.length;e++)this._timeAxisViews[e].setActive(!1);return i||this.synchronizeAlert(!e),s}setPoint(e,t,i,s){if(i&&i.shift()&&this._snapTo45DegreesAvailable()){const i=0===e?1:e-1;this._snapPoint45Degree(t,this.points()[i])}this._setPoint(e,t)}getPoint(e){return this.points()[e]||null}alignCrossHairToAnchor(e){return!0}setLastPoint(e,t){return this._lastPoint=this._preparePoint(e,t),this.updateAllViews((0,x.sourceChangeEvent)(this.id())),this._lastPoint}lastPoint(){return this._lastPoint}getChangePointForSync(e){return this.getPoint(e)}setPoints(e){this._points=e}isForcedDrawPriceAxisLabel(){return this.customization.forcePriceAxisLabel}clearData(){this._points=[]}denormalizeTimePoints(){let e=[]
;for(let t=0;t<this._timePoint.length;t++){const i=this._model.timeScale().denormalizeTimePoint(this._timePoint[t]);if(void 0===i){e=[];break}e.push({index:i,price:this._timePoint[t].price})}e.length>0&&(this._points=e)}restorePoints(e,t,i){const s=this._timePoint.length>0&&!(0,L.deepEquals)(this._timePoint,e)[0];this._timePoint=(0,d.deepCopy)(e),this._points=t,i||this.denormalizeTimePoints(),s&&this._normalizedPointsChanged.fire()}restorePositionPercents(e){this._positionPercents=e}calcIsActualSymbol(){const e=this.ownerSource();if(null===e)this._isActualSymbol=!1;else{const t=(0,n.ensureNotNull)(e.symbolSource());this._migrateSymbolProperty();const i=this._properties.childs().symbol,s=i.value();if(this._isActualSymbol=t.symbolSameAsCurrent(s),this._isActualSymbol){const e=t.symbol();(0,b.areEqualSymbols)(s,e)||(F.logWarn('Possible drawing "migrating" detected from "'+s+'" to "'+e+'"'),F.logWarn("Series symbolInfo: "+JSON.stringify(t.symbolInfo())),F.logWarn(`${(new Error).stack}`)),i.setValue(e)}}this.calcIsActualInterval(),this.calcIsActualCurrency(),this.calcIsActualUnit(),this._onSourceHiddenMayChange()}calcIsActualCurrency(){const e=this.ownerSource();if(null===e)return void(this._isActualCurrency=!1);let t=this._properties.childs().currencyId.value();if(null!==t){const i=e.symbolSource();"pct"===t&&(this._properties.childs().currencyId.setValue(null),t=null),this._isActualCurrency=t===(0,v.symbolCurrency)(i.symbolInfo(),void 0,!0)}else{const t=(0,n.ensureNotNull)(e.symbolSource()).symbolInfo();this._isActualCurrency=null!==t&&(0,v.symbolCurrency)(t)===(0,v.symbolOriginalCurrency)(t)}this._onSourceHiddenMayChange()}calcIsActualUnit(){const e=this.ownerSource();if(null===e)return void(this._isActualUnit=!1);const t=this._properties.childs().unitId.value();if(null!==t)this._isActualUnit=t===(0,n.ensureNotNull)(e.symbolSource()).unit();else{const t=(0,n.ensureNotNull)(e.symbolSource()).symbolInfo(),i=this._model.unitConversionEnabled();this._isActualUnit=null!==t&&(0,v.symbolUnit)(t,i)===(0,v.symbolOriginalUnit)(t,i)}this._onSourceHiddenMayChange()}calcIsActualInterval(){const e=this._isActualInterval,t=this._properties,i=this._model.mainSeries();this._isActualInterval=(0,m.isActualInterval)(P.Interval.parse(i.interval()),t.childs().intervalsVisibilities),!this._isActualInterval&&this._model.selection().isSelected(this)&&this._model.selectionMacro((e=>e.removeSourceFromSelection(this))),this._isActualInterval!==e&&this._onIsActualIntervalChange.fire(),this._onSourceHiddenMayChange()}paneViews(e){if(this.isSourceHidden())return null;const t=this._getPaneViews(this.isMultiPaneAvailable()?e:void 0);if(null===t)return null;if(1===t.length)return[t[0]];const i=[];for(let e=t.length-1;e>=0;--e)i.push(t[e]);return i}priceAxisViews(e,t){if(t!==this.priceScale()||this.isSourceHidden())return null;if(this._model.lineBeingEdited()===this){const e=this._model.linePointBeingEdited();if(null!==e&&e<this._priceAxisViews.length){const t=this._priceAxisViews.slice(),i=t[e];return t.splice(e,1),t.push(i),t}
return this._priceAxisViews}return this._priceAxisViews}timeAxisViews(){if(this.isSourceHidden())return null;if(this._model.lineBeingEdited()===this){const e=this._model.linePointBeingEdited();if(null!==e&&e<this._timeAxisViews.length){const t=this._timeAxisViews.slice(),i=t[e];return t.splice(e,1),t.push(i),t}return this._timeAxisViews}return this._timeAxisViews}isSavedInChart(){return!this.customization.disableSave}isSavedInStudyTemplates(){return!1}setSavingInChartEnabled(e){this.customization.disableSave=!e}shouldBeRemovedOnDeselect(){return!1}getOrderTemplate(){return null}getSourceIcon(){return{type:"loadSvg",svgId:"linetool."+this.toolname}}alertId(){return this._alertId}setAlert(e,t){const i=t&&t.sync;return this.canHasAlert()?(this._alertId=e,this.hasAlert.setValue(!0),this.getAlert().then((e=>{const t=this._model.selection().isSelected(this);return e?(this._removeAlertSubscriptions(),this._addAlertSubscriptions(e),e.setSelected(t),this._onAlertData(e),e):(F.logError("Failed to get alert, alert will not be saved with drawing in chart"),Promise.reject("got_no_alert"))})).then((()=>{const t=this.linkKey().value();null===t||i||(0,T.changeLineStyle)({linkKey:t,model:this._model,state:{},alertId:e})})).catch((t=>{this._removeAlertSubscriptions(),"not_exists"===t?(0,c.getChartAlertsFacade)().then((t=>{t.removeAlertFromAllChartsSilently(this.id(),e)})):F.logError("Getting alert or Saving chart failed: "+t)}))):Promise.reject("Line data source can not has alert")}editAlert(e){this.hasAlert.value()&&(0,c.getChartAlertsFacade)().then((t=>{t.openEditDialog((0,n.ensureDefined)(this._alertId),{actionSource:e,error:e=>{"not_exists"===e&&this.removeAlert()}})}))}getAlert(){return new Promise((async(e,t)=>{(await(0,c.getChartAlertsFacade)()).getAlert((0,n.ensureDefined)(this._alertId),{success:e,error:t})}))}getAlertSync(){var e;if(!this._alertId)return null;const t=(0,c.getChartAlertsFacadeIfCreatedBefore)();return null===t?null:null!==(e=t.getAlertSync(this._alertId))&&void 0!==e?e:null}synchronizeAlert(e){this.hasAlert.value()&&setTimeout((()=>{this._isDestroyed||this._synchronizeAlert(e)}),0)}syncAlert(e){this.hasAlert.value()||this.setAlert(e,{sync:!0})}stateForAlert(){if(!this.canHasAlert())return null;const e={...this.state(),id:this.idForAlert(),uniqueId:this.idForAlert(),title:this.translatedType(),interval:this._model.mainSeries().interval()},t=this._getAlertPlots();return t&&t.length>0&&(e.plots=t),e}getAlertIsActive(){if(!this._alertId)return!1;const e=this.getAlertSync();return Boolean(e&&e.isActive())}detachAlert(){this._removeAlertSubscriptions(),this.hasAlert.setValue(!1),this._alertId=void 0}removeAlert(){this._alertId=void 0,this.hasAlert.setValue(!1),this._removeAlertSubscriptions()}deleteAlert(){if(!this.hasAlert.value()||void 0===this._alertId)return;const e=(0,c.getChartAlertsFacadeIfCreatedBefore)();e&&e.deleteAlert(this._alertId),this.removeAlert()}areLocalAndServerAlertsMismatch(){return this._localAndServerAlertsMismatch}showInObjectTree(){return this.customization.showInObjectsTree}
setShowInObjectsTreeEnabled(e){this.customization.showInObjectsTree=e}start(){this.createServerPoints()}processHibernate(){this.isSourceHidden()?this.isStarted()&&this.stop():this.isStarted()||this.start()}onData(e){"pointset_error"!==e.method?e.params.customId===this._currentPointsetIdWithPrefix()&&this._onPointsetUpdated(e.params.plots):F.logError(`Error getting pointset: ${e.params[0]} ${e.params[1]}`)}isBeingEdited(){return this===this._model.lineBeingEdited()}isActualSymbol(){return this._isActualSymbol}isActualCurrency(){return this._isActualCurrency}isActualInterval(){return this._isActualInterval}isActualUnit(){return this._isActualUnit}onIsActualIntervalChange(){return this._onIsActualIntervalChange}setOwnerSource(e){null!==this._ownerSource&&(this._ownerSource.currencyChanged().unsubscribeAll(this),this._ownerSource.unitChanged().unsubscribeAll(this)),null!==this._ownerSource&&(0,V.isSymbolSource)(this._ownerSource)&&(this._ownerSource.symbolResolved().unsubscribe(this,this._boundCalcIsActualSymbol),this._ownerSource.isActingAsSymbolSource().unsubscribe(this._boundCalcIsActualSymbol)),super.setOwnerSource(e),e&&(this.setPriceScale(e.priceScale()),e.currencyChanged().subscribe(this,this.calcIsActualCurrency),e.unitChanged().subscribe(this,this.calcIsActualUnit),this.calcIsActualSymbol(),this._migrateZOrder()),(0,V.isSymbolSource)(e)&&(e.symbolResolved().subscribe(this,this._boundCalcIsActualSymbol),e.isActingAsSymbolSource().subscribe(this._boundCalcIsActualSymbol))}dataAndViewsReady(){return this._paneViews.size>0}pointAdded(){return this._pointAdded}pointChanged(){return this._pointChanged}pointToScreenPoint(e){var t;const i=this._model.timeScale(),n=this.priceScale(),r=null===(t=this.ownerSource())||void 0===t?void 0:t.firstValue();if(!n||n.isEmpty()||i.isEmpty()||null==r)return null;const o=i.indexToCoordinate(e.index),l=n.priceToCoordinate(e.price,r);return new s.Point(o,l)}screenPointToPoint(e){var t;const i=this.priceScale(),s=null===(t=this.ownerSource())||void 0===t?void 0:t.firstValue();if(null==s||!isFinite(s)||null===i)return null;const n=this._model.timeScale().coordinateToIndex(e.x);return{price:i.coordinateToPrice(e.y,s),index:n}}calcMiddlePoint(e,t){return new s.Point((e.x+t.x)/2,(e.y+t.y)/2)}addPoint(e,t,i){const s=this._preparePoint(e,t);return this._addPointIntenal(s,t,i)}addFixedPoint(e){return this._fixedPoint=e,this.calcPositionPercents(),!0}calcPositionPercents(){const e=this.priceScale();if(!e||e.isEmpty()||void 0===this._fixedPoint)return;const t=this._fixedPoint.x/this._model.timeScale().width(),i=this._fixedPoint.y/e.height();return this._positionPercents={x:t,y:i},this._positionPercents}restoreFixedPoint(){this._fixedPoint=this.fixedPoint()}propertiesChanged(e){this.calcIsActualInterval(),this.updateAllViewsAndRedraw((0,x.sourceChangeEvent)(this.id())),e||this._syncLineStyleIfNeeded(),void 0===this._pendingPropertyChangedEvent&&(this._pendingPropertyChangedEvent=setTimeout((()=>{this._pendingPropertyChangedEvent=void 0,r.emit("drawing_event",this._id,"properties_changed")}),0))}
state(e){var t,i;const s={type:this.toolname,id:this.id(),state:this.properties().state(null!==(t=this._propertiesStateExclusions())&&void 0!==t?t:void 0),points:(0,d.deepCopy)(this._timePoint),zorder:this.zorder(),ownerSource:null===(i=this.ownerSource())||void 0===i?void 0:i.id()};return this.linkKey().value()&&(s.linkKey=this.linkKey().value()),0!==this._sharingMode.value()&&(s.sharingMode=this._sharingMode.value()),delete s.state.points,e&&(s.indexes=this._points),this.isFixed()&&(s.positionPercents=this._positionPercents||this.calcPositionPercents()),"version"in this&&1!==this.version&&(s.version=this.version),this._saveAlertIdInState()&&this.hasAlert.value()&&void 0!==this._alertId&&(s.alertId=this._alertId),s}updateAllViews(e){this._isActualSymbol&&this._isActualCurrency&&this._isActualUnit&&this._isActualInterval&&this._properties.childs().visible.value()&&(this._updateAllPaneViews(e),this._priceAxisViews.forEach((t=>t.update(e))),this._timeAxisViews.forEach((t=>t.update(e))))}updateAllViewsAndRedraw(e){this.updateAllViews(e),this._model.updateSource(this)}tags(){return[this.toolname]}properties(){return this._properties}restoreExternalPoints(e,t){if(this._timePoint=(0,d.deepCopy)(e.points),t.indexesChanged){if(this.properties().childs().interval.setValue(e.interval),!this.isActualSymbol())return this._clearServerPoints(),void this._normalizedPointsChanged.fire();this.createServerPoints()}else{const t=Math.min(this._points.length,e.points.length);for(let i=0;i<t;i++)this._points[i].price=e.points[i].price}this._normalizedPointsChanged.fire()}restoreExternalState(e){this.properties().mergeAndFire(e)}applyTemplate(e){this._onTemplateApplying.fire(e),this._applyTemplateImpl(e),this.calcIsActualSymbol(),this.updateAllViews((0,x.sourceChangeEvent)(this.id())),this.model().lightUpdate(),this._onTemplateApplied.fire()}template(){return this.properties().preferences()}isFixed(){return!1}isLocked(){const e=this.properties().child("frozen");return void 0!==e&&e.value()}isSourceHidden(){return!this._properties.childs().visible.value()||(0,T.hideAllDrawings)().value()&&this.canBeHidden()||!this._isActualInterval||!this._isActualSymbol||!this._isActualCurrency||!this._isActualUnit}isSynchronizable(){return this.priceScale()===this._model.mainSeries().priceScale()}copiable(){return N}cloneable(){return null!==this._ownerSource&&null!==this._ownerSource.firstValue()}movable(){return!0}async getPropertyDefinitionsViewModel(){if(null===this._definitionsViewModel){const e=await this._getPropertyDefinitionsViewModelClass();return null===e||this._isDestroyed?null:(this._definitionsViewModel=new e(this._model.undoModel(),this),this._definitionsViewModel)}return this._definitionsViewModel}title(){return this.translatedType()}translatedType(){var e;return null!==(e=R.lineToolsLocalizedNames[this.toolname])&&void 0!==e?e:"Line Tool"}name(){return"Line Tool"}createServerPoints(){if(!this._isActualSymbol)return;if(!this._model.chartApi().isConnected().value())return;if(this._clearServerPoints(),this._model.timeScale().isEmpty())return
;if(0===this._timePoint.length&&this._points.length>0&&this.normalizePoints(),!this._readyToCreatePointset())return;const e=this._pointsForPointset();if(0===e.length)return;++U,this._currentPointsetAndSymbolId={pointsetId:U,symbolId:(0,n.ensureNotNull)(this._model.mainSeries().seriesSource().symbolInstanceId())};const t=(0,f.getServerInterval)(this.properties().childs().interval.value());this._model.chartApi().createPointset(this._currentPointsetIdWithPrefix(),"turnaround",this._currentPointsetAndSymbolId.symbolId,t,e,this.onData.bind(this))}finish(){}realign(){var e;this.calcIsActualSymbol(),this.isFixed()||this.isSourceHidden()||this._model.lineBeingCreated()===this||this._model.lineBeingEdited()===this||(null===(e=this._currentPointsetAndSymbolId)||void 0===e?void 0:e.symbolId)===this._model.mainSeries().seriesSource().symbolInstanceId()||this._clearServerPoints(),this.updateAllViews((0,x.sourceChangeEvent)(this.id()))}stop(){this._clearServerPoints()}restart(){this.isFixed()||(this._currentPointsetAndSymbolId=null,this.createServerPoints())}isStarted(){return null!==this._currentPointsetAndSymbolId}convertYCoordinateToPriceForMoving(e,t){var i;const s=(0,n.ensureNotNull)(this.priceScale());if(s.isEmpty())return null;const r=this.ownerSource(),o=(0,n.ensure)(null===(i=r||t)||void 0===i?void 0:i.firstValue());return s.coordinateToPrice(e,o)}syncMultichartState(e){const t={points:this._timePoint,interval:this._model.mainSeries().interval()},i=this.linkKey().value();if(null!==i&&this.isSynchronizable()){const s={model:this._model,linkKey:i,symbol:this._model.mainSeries().symbol(),finalState:t,changes:e};(0,T.finishChangingLineTool)(s)}}enableCurrentIntervalVisibility(){const e=this.properties().childs().intervalsVisibilities.state();void 0!==e&&((0,m.makeIntervalsVisibilitiesVisibleAtInterval)(e,P.Interval.parse(this._model.mainSeries().interval())),this.properties().childs().intervalsVisibilities.mergeAndFire(e))}clonePositionOffset(){return this.isFixed()?{barOffset:0,xCoordOffset:20,yCoordOffset:20}:{barOffset:0,xCoordOffset:0,yCoordOffset:-40}}sharingMode(){return this._sharingMode}share(e){this.isSynchronizable()&&this._sharingMode.setValue(e)}syncLineStyleState(){const e=this.properties().state(this._syncStateExclusions);return delete e.interval,e.intervalsVisibilities=(0,m.mergeIntervalVisibilitiesDefaults)(e.intervalsVisibilities),e}moveLineTool(e){e.forEach(((e,t)=>this._setPoint(t,e))),this.normalizePoints()}_setPoint(e,t){this._points[e].index===t.index?this._points[e].price=t.price:this._points[e]=t,this._pointChanged.fire(e)}_correctLastPoint(e){return(0,L.clone)(e)}_pointsForPointset(){return this._timePoint.map((e=>[e.time_t,e.offset]))}_snapPoint45Degree(e,t,i){const s=this._model.timeScale(),r=s.indexToCoordinate(t.index),o=s.indexToCoordinate(e.index)-r,l=(0,n.ensureNotNull)(this.priceScale()),a=t.price,u=e.price,d=(0,n.ensureNotNull)((0,n.ensureNotNull)(this.ownerSource()).firstValue()),c=l.priceToCoordinate(a,d),h=l.priceToCoordinate(u,d)-c,p=Math.round(Math.atan2(o,h)/Math.PI*4)
;if(2===Math.abs(p))i||(e.price=a);else if(0===Math.abs(p)||4===Math.abs(p))i||(e.index=t.index);else{const t=Math.sqrt(o*o+h*h),i=o<0?-1:1,n=h<0?-1:1;let a=Math.max(Math.abs(h),Math.abs(o));a/=a*Math.sqrt(2)/t;const u=Math.round(s.coordinateToIndex(r+a*i)),p=Math.abs(s.indexToCoordinate(u)-r),_=l.coordinateToPrice(c+p*n,d);e.index=u,e.price=_}}normalizePoint(e){return{...this._model.timeScale().normalizeBarIndex(e.index),price:e.price}}normalizePoints(){this._timePoint=[];for(let e=0;e<this._points.length;e++)if(void 0!==this._points[e].index){const t=this.normalizePoint(this._points[e]);if(!t.time_t){this._timePoint=[];break}this._timePoint.push(t)}this._normalizedPointsChanged.fire()}_setPaneViews(e,t,i){if(this._isDestroyed)for(const t of e)t.destroy&&t.destroy();else this._paneViews.set(t,e),void 0!==t&&i&&t.onDestroyed().subscribe(this,(()=>this._destroyPanePaneViews(t))),this._model.lightUpdate()}_getPaneViews(e){return this._paneViews.get(e)||null}_updateAllPaneViews(e){this._paneViews.forEach((t=>{for(const i of t)i.update(e)}))}_alignPointHorizontallyOrVertically(e){const t=(0,n.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,n.ensureDefined)((0,n.ensureNotNull)(this._startMovingPoint).logical),s=(0,n.ensureDefined)((0,n.ensureNotNull)(this._startMovingPoint).screen),r=Math.abs(s.x-t.x),o=Math.abs(s.y-t.y);if(r<10&&o<10)return e;return{index:r<o?i.index:e.index,price:r<o?e.price:i.price}}_alignScreenPointHorizontallyOrVertically(e){const t=(0,n.ensureDefined)((0,n.ensureNotNull)(this._startMovingPoint).screen),i=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);return i<10&&r<10?e:i<r?new s.Point(t.x,e.y):new s.Point(e.x,t.y)}_correctPoints(e,t){const i=(0,n.ensureDefined)((0,n.ensureNotNull)(this._currentMovingPoint).screen),s=(0,n.ensureDefined)((0,n.ensureNotNull)(this._startMovingPoint).screen),r=i.subtract(s);if(r.length()<1&&!t)return!1;for(let t=0;t<e.length;t++){const i=e[t],s=(0,n.ensureNotNull)(this.pointToScreenPoint(i)).add(r),o=(0,n.ensureNotNull)(this.screenPointToPoint(s));e[t].index=o.index,e[t].price=o.price}return!0}_correctFixedPoint(e){if(void 0===this._fixedPoint)return{didCorrect:!1,point:e};const t=(0,n.ensureDefined)((0,n.ensureNotNull)(this._currentMovingPoint).screen),i=(0,n.ensureDefined)((0,n.ensureNotNull)(this._startMovingPoint).screen),s=t.subtract(i);return s.length()>=1?{didCorrect:!0,point:e.add(s)}:{didCorrect:!1,point:e}}_currentPointsetIdWithPrefix(){return"pointset_"+(0,n.ensureNotNull)(this._currentPointsetAndSymbolId).pointsetId}_clearServerPoints(){null!==this._currentPointsetAndSymbolId&&this._model.chartApi().isConnected().value()&&this._model.chartApi().removePointset(this._currentPointsetIdWithPrefix()),this._currentPointsetAndSymbolId=null}_createPointProperty(e){const t=this._pointsProperty.childs().points;t.addProperty(""+e,{});const i=t[e];i.addChild("price",new M.LineDataSourcePointPriceProperty(this,e)),i.addChild("bar",new E.LineDataSourcePointIndexProperty(this,e))}_createPointsProperties(){this._pointsProperty=new(w()),
this._pointsProperty.addChild("points",new(w()));for(let e=0;e<this.pointsCount();e++)this._createPointProperty(e)}_alignPointToRangeOfActualData(e){const t=(0,n.ensureNotNull)(this._model.mainSeries().bars().firstIndex()),i=(0,n.ensureNotNull)(this._model.mainSeries().bars().lastIndex());let s=Math.max(e.index,t);return s=Math.min(s,i),{...e,index:s}}_migrateSymbolProperty(){const e=this._properties.childs();if(e.symbolStateVersion.value()<2){const t=(0,n.ensureNotNull)(this.ownerSource()),i=(0,n.ensureNotNull)(t.symbolSource()),s=this._model.mainSeries();if(i===s)return void e.symbolStateVersion.setValueSilently(2);if(null===s.symbolInfo())return;if(null===i.symbolInfo())return;s.symbolSameAsCurrent(e.symbol.value())&&e.symbol.setValueSilently(i.symbol()),e.symbolStateVersion.setValueSilently(2)}}_migrateZOrder(){const e=this._properties.childs();e.zOrderVersion.value()<2&&(this.ownerSource()===this.model().mainSeries()&&this.setZorder(this.zorder()-this.model().mainSeries().obsoleteZOrder()),e.zOrderVersion.setValueSilently(2))}_preparePoint(e,t){const i=e;return t&&t.shift()&&this.points().length>=2&&this._snapTo45DegreesAvailable()&&this._snapPoint45Degree(i,this.points()[this.points().length-2]),i}_addPointIntenal(e,t,i){this._points.push(e);const s=this._points.length===this.pointsCount();return s?(this._lastPoint=null,i||(this.normalizePoints(),this.createServerPoints())):this._lastPoint=e,this._pointAdded.fire(this._points.length-1),s}_onSourceHiddenMayChange(){this._model.invalidate(S.InvalidationMask.validateAction((()=>{this!==this._model.lineBeingCreated()&&(this._isDestroyed||this.processHibernate())})))}_saveAlertIdInState(){return!0}_onPointsetUpdated(e){if(0!==e.length){for(let t=0;t<e.length;t++){const i=e[t],s=this._timePoint[i.index],n={index:i.value[0],time:new Date(1e3*i.value[1]),price:s.price};this._points.length<=i.index?(this._points.push(n),this._pointAdded.fire(this._points.length-1)):(this._points[i.index]=n,this._pointChanged.fire(i.index))}{const e=this;e.recalculateStateByData&&e.recalculateStateByData()}this.updateAllViewsAndRedraw((0,x.sourceChangeEvent)(this.id()))}}_snapTo45DegreesAvailable(){return!1}_onMainSeriesSymbolResolved(){const e=this.ownerSource();null===e||this._model.mainSeries()===e.symbolSource()||this.isSourceHidden()||this.createServerPoints()}_readyToCreatePointset(){return this._timePoint.length>0}_onAlertData(e){}_propertiesStateExclusions(){return null}_syncLineStyleIfNeeded(){const e=this.linkKey().value();!this._syncLineStyleMuted&&e&&(0,T.changeLineStyle)({linkKey:e,state:this.syncLineStyleState(),model:this._model})}_muteSyncLineStyle(){this._syncLineStyleMuted=!0}_unmuteSyncLineStyleWithoutApplyingChanges(){this.propertiesChanged(),this._syncLineStyleMuted=!1}_applyTemplateImpl(e){e.intervalsVisibilities=(0,m.mergeIntervalVisibilitiesDefaults)(e.intervalsVisibilities);const t=this.properties();t.mergePreferences(e),t.saveDefaults(),this.propertiesChanged()}_getPropertyDefinitionsViewModelClass(){return Promise.resolve(null)}_getAlertPlots(){return[]}
_getUndoHistory(){return this._model.undoModel().undoHistory()}_synchronizeAlert(e){const t=this._getUndoHistory();if(!this._undoCheckpointAlert&&!this._alertUndoMode){const e=t.undoStack().pop();this._undoCheckpointAlert=t.createUndoCheckpoint(),e&&t.undoStack().push(e)}const i=e=>{const t=e.description()!==e.defaultDescription(),i=(0,n.ensureNotNull)(e.seriesState()),s=this._model.mainSeries().stateForAlert();"MainSeries"===i.type&&s.actualSymbol===i.actualSymbol&&e.setSeriesState(s),e.setMainSeriesState(s),e.setSymbol(s.symbolString);const r=(0,n.ensureNotNull)(this.stateForAlert());e.setResolution(r.interval),e.setLineState(r),t||e.resetToDefaultDescription(),this._localAndServerAlertsMismatch=!0},s=()=>{this._alertUndoMode=!0,t.undoToCheckpoint((0,n.ensureDefined)(this._undoCheckpointAlert)),setTimeout((()=>{this._alertUndoMode=!1,this._localAndServerAlertsMismatch=!1}),0)},r=e=>{"not_exists"!==e&&(F.logError("Getting alert failed: "+e),s())},o=async e=>{(await(0,c.getChartAlertsFacade)()).restartAlert(e,{success:()=>this._localAndServerAlertsMismatch=!1,error:r,complete:()=>delete this._undoCheckpointAlert,actionSource:"drawing_sync"})};(0,h.canPlaceAlertOnResolution)(this.stateForAlert().interval)?this.getAlert().then((t=>{t?(i(t),e&&(o(t),this._onAlertData(t))):F.logError("Failed to get alert, drawing and alert are not synchronized")})).catch(r):this._alertUndoMode||((0,p.showGoProAlertsOnSecondsDialog)(),s(),delete this._undoCheckpointAlert)}_linePointsToAlertPlot(e,t,i,s){if(2!==e.length)return F.logError("[Drawing Alert] Wrong points"),null;const r=this._model.timeScale();return!r||r.isEmpty()?null:{type:"LinePlot",title:t||this.translatedType(),timestamp:(0,n.ensureNotNull)(r.indexToTimePoint(0)),offset1:e[0].index,offset2:e[1].index,price1:e[0].price,price2:e[1].price,extendBackward:i||!1,extendForward:s||!1}}static _configureProperties(e){if(H._addCollectedProperties(e),e.hasChild("symbolStateVersion")||e.addChild("symbolStateVersion",new(w())(1)),e.hasChild("zOrderVersion")||e.addChild("zOrderVersion",new(w())(1)),e.hasChild("visible")||e.addChild("visible",new(w())(!0)),e.hasChild("frozen")||e.addChild("frozen",new(w())(!1)),e.hasChild("symbol")||e.addChild("symbol",new(w())("")),e.hasChild("currencyId")||e.addChild("currencyId",new(w())(null)),e.hasChild("unitId")||e.addChild("unitId",new(w())(null)),e.addExclusion("symbolStateVersion"),e.addExclusion("zOrderVersion"),e.addExclusion("visible"),e.addExclusion("frozen"),e.addExclusion("symbol"),e.addExclusion("currencyId"),e.addExclusion("unitId"),e.hasChild("intervalsVisibilities")){const t=(0,L.merge)((0,L.clone)(g.intervalsVisibilitiesDefaults),e.childs().intervalsVisibilities.state());e.removeProperty("intervalsVisibilities"),e.addChild("intervalsVisibilities",new A.IntervalsVisibilitiesProperty(t))}else e.addChild("intervalsVisibilities",new A.IntervalsVisibilitiesProperty(g.intervalsVisibilitiesDefaults));e.hasChild("title")||e.addChild("title",new(w())("")),e.addExclusion("symbolInfo"),e.addExclusion("points"),e.addExclusion("interval"),
e.addExclusion("title"),e.hasChild("singleChartOnly")&&e.removeProperty("singleChartOnly"),e.hasChild("font")&&e.removeProperty("font")}static _addCollectedProperties(e){e.hasChild("linewidth")&&e.addChild("linesWidths",new D.LineToolWidthsProperty([(0,n.ensureDefined)(e.child("linewidth"))])),e.hasChild("linecolor")&&e.addChild("linesColors",new D.LineToolColorsProperty([(0,n.ensureDefined)(e.child("linecolor"))])),e.hasChild("backgroundColor")&&e.addChild("backgroundsColors",new D.LineToolColorsProperty([(0,n.ensureDefined)(e.child("backgroundColor"))])),e.hasChild("textColor")&&e.addChild("textsColors",new D.LineToolColorsProperty([(0,n.ensureDefined)(e.child("textColor"))])),e.addExclusion("linesWidths"),e.addExclusion("linesColors"),e.addExclusion("backgroundsColors"),e.addExclusion("textsColors")}_removeAlertSubscriptions(){var e;null===(e=this._unsubscribeAlertCallbacks)||void 0===e||e.call(this),this._unsubscribeAlertCallbacks=void 0}_addAlertSubscriptions(e){if(void 0!==this._unsubscribeAlertCallbacks)return;const t=this.properties().child("extendLeft"),i=this.properties().child("extendRight"),s=e.destroyed().spawn(),n=e.selected().spawn(),r=e.hovered().spawn();s.subscribe(this.removeAlert.bind(this)),n.subscribe((e=>{this._model.selectionMacro((t=>{e?t.addSourceToSelection(this):t.removeSourceFromSelection(this)}))})),r.subscribe((e=>{const t=this._model.hoveredSource();e&&t!==this?this._model.setHoveredSource(this,null):e||t!==this||this._model.setHoveredSource(null,null)})),void 0!==t&&t.subscribe(this,(()=>this.synchronizeAlert(!1))),void 0!==i&&i.subscribe(this,(()=>this.synchronizeAlert(!1))),this._unsubscribeAlertCallbacks=()=>{s.destroy(),r.destroy(),n.destroy(),void 0!==t&&t.unsubscribeAll(this),void 0!==i&&i.unsubscribeAll(this)}}_destroyPanePaneViews(e){const t=this._paneViews.get(e);if(void 0!==t)for(const e of t)e.destroy&&e.destroy();void 0!==e&&e.onDestroyed().unsubscribeAll(this),this._paneViews.delete(e)}_copyPricesWithoutNormalization(){const e=Math.min(this._points.length,this._timePoint.length);for(let t=0;t<e;t++)this._timePoint[t].price=this._points[t].price}}},272124:(e,t,i)=>{"use strict";t.LineToolFibRetracement=i(913480).LineToolFibRetracement,t.LineToolFibChannel=i(714657).LineToolFibChannel,t.LineToolFibSpeedResistanceArcs=i(700465).LineToolFibSpeedResistanceArcs,t.LineToolProjection=i(632465).LineToolProjection,t.LineToolTrendBasedFibExtension=i(901708).LineToolTrendBasedFibExtension,t.LineToolElliott=i(759499).LineToolElliott,t.LineToolFibCircles=i(798628).LineToolFibCircles,t.LineToolVertLine=i(157116).LineToolVertLine,t.LineToolCrossLine=i(506717).LineToolCrossLine,t.LineToolBarsPattern=i(804585).LineToolBarsPattern,t.LineToolTrendBasedFibTime=i(27601).LineToolTrendBasedFibTime,t.LineToolFibTimeZone=i(304935).LineToolFibTimeZone,t.LineToolCircleLines=i(515950).LineToolCircleLines,t.LineToolDateRange=i(887326).LineToolDateRange,t.LineToolPriceRange=i(569654).LineToolPriceRange,t.LineToolDateAndPriceRange=i(402430).LineToolDateAndPriceRange,
t.LineToolParallelChannel=i(989658).LineToolParallelChannel,t.LineToolTrendAngle=i(447067).LineToolTrendAngle,t.LineToolTrendLine=i(732747).LineToolTrendLine,t.LineToolInfoLine=i(10753).LineToolInfoLine,t.LineToolArrowMark=i(856073).LineToolArrowMark,t.LineToolImage=i(780264).LineToolImage,t.LineToolPitchfan=i(133823).LineToolPitchfan,t.LineToolGannSquare=i(743102).LineToolGannSquare,t.LineToolFibSpeedResistanceFan=i(182229).LineToolFibSpeedResistanceFan,t.LineToolGannComplex=i(380950).LineToolGannComplex,t.LineToolGannFixed=i(420263).LineToolGannFixed,t.LineToolGannFan=i(145383).LineToolGannFan,t.LineToolFibWedge=i(113101).LineToolFibWedge,t.LineToolPitchfork=i(822296).LineToolPitchfork,t.LineToolDisjointAngle=i(564883).LineToolDisjointChannel,t.LineToolFlatBottom=i(202645).LineToolFlatBottom,t.LineToolIcon=i(200330).LineToolIcon,t.LineToolEmoji=i(650604).LineToolEmoji,t.LineToolSticker=i(824067).LineToolSticker,t.LineToolRotatedRectangle=i(820914).LineToolRotatedRectangle,t.LineToolFibSpiral=i(889056).LineToolFibSpiral,t.LineToolHeadAndShoulders=i(479336).LineToolHeadAndShoulders,t.LineToolTriangle=i(521188).LineToolTriangle,t.LineToolTrianglePattern=i(96684).LineToolTrianglePattern,t.LineTool5PointsPattern=i(333652).LineTool5PointsPattern,t.LineToolThreeDrivers=i(672874).LineToolThreeDrivers,t.LineToolABCD=i(539104).LineToolABCD,t.LineToolPolyline=i(794888).LineToolPolyline,t.LineToolPath=i(132455).LineToolPath,t.LineToolPrediction=i(113534).LineToolPrediction,t.LineToolPriceLabel=i(207889).LineToolPriceLabel,t.LineToolArrowMarker=i(681348).LineToolArrowMarker,t.LineToolNote=i(752110).LineToolNote,t.LineToolNoteAbsolute=i(752110).LineToolNoteAbsolute,t.LineToolSignpost=i(80342).LineToolSignpost,t.LineToolBrush=i(42878).LineToolBrush,t.LineToolArc=i(386646).LineToolArc,t.LineToolCallout=i(900921).LineToolCallout,t.LineToolBalloon=i(998275).LineToolBalloon,t.LineToolComment=i(420365).LineToolComment,t.LineToolText=i(194167).LineToolText,t.LineToolHorzLine=i(514620).LineToolHorzLine,t.LineToolHorzRay=i(699334).LineToolHorzRay,t.LineToolRectangle=i(311625).LineToolRectangle,t.LineToolCircle=i(420496).LineToolCircle,t.LineToolEllipse=i(854446).LineToolEllipse,t.LineToolTimeCycles=i(341880).LineToolTimeCycles,t.LineToolSineLine=i(864780).LineToolSineLine,t.LineToolGhostFeed=i(244561).LineToolGhostFeed,t.LineToolBezierQuadro=i(717797).LineToolBezierQuadro,t.LineToolBezierCubic=i(214168).LineToolBezierCubic,t.LineToolArrow=i(910788).LineToolArrow,t.LineToolRay=i(638655).LineToolRay,t.LineToolExtended=i(42374).LineToolExtended,t.LineToolSchiffPitchfork=i(48589).LineToolSchiffPitchfork,t.LineToolSchiffPitchfork2=i(901700).LineToolSchiffPitchfork2,t.LineToolInsidePitchfork=i(874572).LineToolInsidePitchfork,t.LineToolTextAbsolute=i(194167).LineToolTextAbsolute,t.LineToolArrowMarkLeft=i(856073).LineToolArrowMarkLeft,t.LineToolArrowMarkRight=i(856073).LineToolArrowMarkRight,t.LineToolArrowMarkUp=i(856073).LineToolArrowMarkUp,t.LineToolArrowMarkDown=i(856073).LineToolArrowMarkDown,t.LineToolFlagMark=i(256957).LineToolFlagMark,
t.LineToolCypherPattern=i(228552).LineToolCypherPattern,t.LineToolElliottImpulse=i(759499).LineToolElliottImpulse,t.LineToolElliottTriangle=i(759499).LineToolElliottTriangle,t.LineToolElliottTripleCombo=i(759499).LineToolElliottTripleCombo,t.LineToolElliottCorrection=i(759499).LineToolElliottCorrection,t.LineToolElliottDoubleCombo=i(759499).LineToolElliottDoubleCombo,t.LineToolRiskRewardLong=i(445821).LineToolRiskRewardLong,t.LineToolRiskRewardShort=i(445821).LineToolRiskRewardShort,t.LineToolPosition=i(969876).LineToolPosition,t.LineToolOrder=i(74149).LineToolOrder,t.LineToolHighlighter=i(957884).LineToolHighlighter,t.LineToolPriceNote=i(155075).LineToolPriceNote,t.LineToolTweet=i(310495).LineToolTweet,t.LineToolIdea=i(700950).LineToolIdea},659914:(e,t,i)=>{"use strict";i.d(t,{StudyLineDataSource:()=>C});var s=i(650151),n=i(758337),r=i(884566),o=i(249527),l=i(87225),a=i(108184),u=i(915062),d=i(573774),c=i(74266),h=i(450557),p=i(353469),_=i(800113),y=i(747342),S=i(651723),f=i(404822),m=i(482358),g=i(618258);class v extends g.StatusProviderBase{constructor(e){super(e.model().properties().childs().scalesProperties.childs().textColor),this._source=e}color(){return"#ff0000"}errorStatus(){const e=this._source.status();return e.type===m.StudyStatusType.Error?{error:this.sourceStatusText(),solutionId:(0,m.studyStatusSolutionId)(e),title:(0,m.studyStatusTitle)(e),studyFeature:(0,m.studyStatusFeature)(e)}:null}getSplitTitle(){return this._source.titleInParts()}text(){return this._source.translatedType()}sourceStatusText(){return(0,m.convertStudyStatusToString)(this._source.status(),!0)}}var b=i(771236),P=i(724973);class C extends o.LineDataSource{constructor(e,t,s,n,r,o){super(e,n,r,o),this._indexes=null,this._inputs=null,this._definitionsViewModel=null,this._pointsetPoints=null,this._loadedPlots=null,this._loadedGraphics=null,this._beingCreatedPaneView=null,this._anchorsPaneView=null,this._isLegendDisplayed=!1,this._alignerCache=null,Promise.all([Promise.all([i.e(37989),i.e(81679),i.e(51583)]).then(i.bind(i,987425)),Promise.all([i.e(37989),i.e(81679),i.e(51583)]).then(i.bind(i,677894))]).then((t=>{const{LineToolBeingCreatedPaneView:i}=t[0],{StudyLineDataSourceAnchorsPaneView:s}=t[1];this._beingCreatedPaneView=new i(this,e),this._anchorsPaneView=new s(this,this.model()),this._model.lightUpdate()})),this._metaInfo=t,this._dataSource=new c.StudyDataSource(e.chartApi(),e.mainSeries().seriesSource(),s,t),this._dataSource.dataCleared().subscribe(this,this._onDataCleared),this._dataSource.dataUpdated().subscribe(this,this._onDataUpdated),this._dataSource.studyStatusChanged().subscribe(this,this._onStudyStatusChanged),this._statusProvider=new v(this),this._statusView=new P.LineToolStudyStatusView(this),this._showStudyArgumentsProperty=e.properties().childs().paneProperties.childs().legendProperties.childs().showStudyArguments}isDisplayedInLegend(){return this._isLegendDisplayed}titleInParts(){const e=[];if(this._showStudyArgumentsProperty.value()&&this._inputs)for(const t of this._metaInfo.inputs){
if(!0===t.isHidden||"bool"===t.type)continue;const i=this._inputs[t.id];e.push(i.toString())}return[this.name(),e]}destroy(){this._dataSource.dataUpdated().unsubscribeAll(this),this._dataSource.dataCleared().unsubscribeAll(this),this._dataSource.studyStatusChanged().unsubscribeAll(this),this._dataSource.destroy(),null!==this._definitionsViewModel&&(this._definitionsViewModel.destroy(),this._definitionsViewModel=null),this._unsubscribeApplyInputsOnSeriesCompleted(),this._isDestroyed=!0,super.destroy()}stop(){super.stop(),this._isDestroyed||(this._dataSource.stop(),this.clearData())}start(){super.start(),this._isDestroyed||null===this._inputs||this._dataSource.start()}metaInfo(){return this._metaInfo}graphicsInfo(){return this._metaInfo.graphics}series(){return this._model.mainSeries()}translatedType(){return this._metaInfo.description}name(){return this._metaInfo.description}studyId(){return this._metaInfo.id}setPoint(e,t,i){super.setPoint(e,this._preparePoint(t,i))}move(e){}clearData(){this._clearAllDataExceptPointsetPoints(),this._pointsetPoints=null,this.updateAllViews((0,f.sourceChangeEvent)(this.id()))}data(){return this.plots()}plots(){return this._loadedPlots||this._dataSource.plots()}graphics(){return this._loadedGraphics||this._dataSource.graphics()}firstValue(){return this._model.mainSeries().firstValue()}state(e){const t=super.state(e);let i;this.metaInfo()instanceof a.StudyMetaInfo?i=this.metaInfo().state():(i=(0,n.clone)(this.metaInfo()),i.id=a.StudyMetaInfo.parseIdString(i.id+(i.version?"-"+i.version:"")).fullId);const s={...t,metaInfo:i};return e&&(s.data=this.plots().state(),s.nonseriesindexes=this._indexes,s.graphics=(0,u.saveStudyGraphics)(this.graphics(),null)),s}restoreData(e){var t;void 0!==e.data&&(this._loadedPlots=new r.PlotList((0,p.studyPlotFunctionMap)(this._metaInfo),p.studyEmptyPlotValuePredicate),this._loadedPlots.restoreState(e.data)),this._indexes=null!==(t=e.nonseriesindexes)&&void 0!==t?t:this._indexes,this._loadedGraphics=e.graphics?(0,u.loadStudyGraphics)(e.graphics):this._loadedGraphics}getPropertyDefinitionsViewModel(){return null===this._definitionsViewModel?this._getPropertyDefinitionsViewModelClass().then((e=>null===e||this._isDestroyed?null:(null===this._definitionsViewModel&&(this._definitionsViewModel=new e(this._model.undoModel(),this)),this._definitionsViewModel))):Promise.resolve(this._definitionsViewModel)}paneViews(e){let t=[];if(this.isSourceHidden())return t;if(this._isReady()&&this._changeStatesStack.isEmpty()){const i=super.paneViews(e);null!==i&&(t=t.concat(i))}else null!==this._beingCreatedPaneView&&t.push(this._beingCreatedPaneView);return null!==this._anchorsPaneView&&t.push(this._anchorsPaneView),t}propertiesChanged(e){super.propertiesChanged(e),this._onStudyInputsMayChange()}dataAndViewsReady(){return super.dataAndViewsReady()&&this._isReady()}endChanging(e,t){const i=super.endChanging(e,t);return i.indexesChanged?this.clearData():this._updateAnchorsPrice(!0),i}moveData(e){this._dataSource.moveData(e)}restorePoints(e,t,i){super.restorePoints(e,t,i),
this._updateAnchorsPrice(!0)}realign(){super.realign(),null===this._model.mainSeries().symbolInfo()&&(this._alignerCache=null)}statusProvider(e){return this._statusProvider}statusView(){return this._statusView}legendView(){return null}dataProblemModel(){return null}dataUpdatedModeModel(){return null}marketStatusModel(){return null}onStatusChanged(){return this._dataSource.studyStatusChanged()}status(){return this._dataSource.studyStatus()}recalcStudyIfNeeded(){}static createPropertiesFromStudyMetaInfoAndState(e,t,i,s){const n=(0,_.prepareStudyPropertiesForLoadChart)(e,t,i,s);return this._configureProperties(n),n}_onStudyStatusChanged(e,t){let i;switch(t.type){case h.StudyStatusType.Error:i=!0;break;case h.StudyStatusType.Completed:i=!1;break;default:return}if(i===this._isLegendDisplayed)return;this._isLegendDisplayed=i;const s=this._model.paneForSource(this);if(s){const e=this._model.panes().indexOf(s),t=b.InvalidationMask.invalidateLegendWidgetLayout(e);this.model().invalidate(t)}}_studyId(){return this._dataSource.studyId()}_isReady(){return!0}_updateAllPaneViews(e){var t,i;super._updateAllPaneViews(e),null===(t=this._beingCreatedPaneView)||void 0===t||t.update(),null===(i=this._anchorsPaneView)||void 0===i||i.update(e)}_getPointTime(e,t){const i=e.index,s=this._model.timeScale().indexToTimePoint(i);if(null!==s)return s;if(t||void 0===e.time)return null;const n=this._model.mainSeries().symbolInfo();if(null===n)return null;let r=this._model.properties().childs().timezone.value();"exchange"===r&&(r=n.timezone);const o=(0,y.cal_to_utc)((0,y.get_timezone)(r),e.time);return this._getStartBarAligner()(o)/1e3}_updateAnchorsPrice(e){}_onPointsetUpdated(e){super._onPointsetUpdated(e),this._pointsetPoints=this._points.map((e=>({price:e.price,index:e.index,time:e.time}))),this._onStudyInputsMayChange()}_onDataCleared(){this.updateAllViews((0,f.sourceChangeEvent)({sourceId:this.id(),clearData:!0})),this._model.updateSource(this)}_onDataUpdated(e,t,i){var s;this._updateAnchorsPrice(),this.updateAllViews((0,f.sourceChangeEvent)({sourceId:this.id(),firstUpdatedTimePointIndex:null===(s=e[0])||void 0===s?void 0:s.index})),this._model.updateSource(this)}_onStudyInputsMayChange(){let e=null;if(null!==this._pointsetPoints&&this._pointsetPoints.length===this.pointsCount()&&(e=this._studyInputs(this._pointsetPoints),null===e&&(this._clearAllDataExceptPointsetPoints(),this.updateAllViews((0,f.sourceChangeEvent)(this.id())))),null!==e){const t=this.metaInfo().inputs.map((e=>e.id)),i=Object.keys(e);for(const s of i)t.includes(s)||delete e[s]}this._areInputsEqual(this._inputs,e)||this._applyStudyInputs(e)}_preparePoint(e,t){return super._preparePoint(this._alignPointToRangeOfActualData(e),t)}_getPropertyDefinitionsViewModelClass(){return Promise.resolve(null)}_subscribeApplyInputsOnSeriesCompleted(){this._unsubscribeApplyInputsOnSeriesCompleted(),this._model.mainSeries().dataEvents().completed().subscribe(this,(()=>this._onStudyInputsMayChange()),!0)}_unsubscribeApplyInputsOnSeriesCompleted(){
this._model.mainSeries().dataEvents().completed().unsubscribeAll(this)}_onInputsChanged(){this.hasAlert.value()&&(this._localAndServerAlertsMismatch=!0)}static _createPropertiesFromStudyIdAndState(e,t){const i=a.StudyMetaInfo.getStudyPropertyRootNameById(e),s=new l.DefaultProperty(i,t);return this._configureProperties(s),s}static _configureProperties(e){super._configureProperties(e),e.removeExclusion("intervalsVisibilities")}_areInputsEqual(e,t){return null===t?null===e:null!==e&&(0,d.areStudyInputsEqual)(this._metaInfo.inputs,e,t)}_applyStudyInputs(e){const t=this._inputs;this._inputs=e,null!==e&&(this._unsubscribeApplyInputsOnSeriesCompleted(),this._dataSource.setInputs(e),null===t&&this.isStarted()&&!this._dataSource.isStarted()&&this._dataSource.start()),this._onInputsChanged()}_clearAllDataExceptPointsetPoints(){this._inputs=null,this._dataSource.clearData(),this._loadedPlots=null,this._indexes=null,this._loadedGraphics=null}_getStartBarAligner(){const e=this._model.mainSeries().interval();return null!==this._alignerCache&&this._alignerCache.resolution===this._model.mainSeries().interval()||(this._alignerCache={resolution:e,aligner:(0,S.createTimeToBarTimeAligner)(e,(0,s.ensureNotNull)(this._model.mainSeries().symbolInfo()))}),this._alignerCache.aligner}}},327867:(e,t,i)=>{"use strict";const s=i(249527).LineDataSource,n=i(437181).alignToStep;class r extends s{constructor(e,t){super(e,t),this.customization.forcePriceAxisLabel=!0,this.customization.disableErasing=!0,this.customization.showInObjectsTree=!1,this.setSelectionEnabled(!1)}isSynchronizable(){return!1}pointsCount(){return r.POINTS_COUNT}hasContextMenu(){return!1}state(){return null}startMoving(){super.startMoving.apply(this,arguments),this._cursorMoved=!1}endMoving(){super.endMoving.apply(this,arguments),this._cursorMoved=!1}_correctPoints(e,t){this._currentMovingPoint&&this._startMovingPoint?this._currentMovingPoint.logical.price-this._startMovingPoint.logical.price&&(this._cursorMoved=!0):this._cursorMoved=!1;for(var i=1/this.priceScale().mainSource().base(),s=0;s<e.length;s++){var r=e[s];this._cursorMoved&&(r.price=this._currentMovingPoint.logical.price),r.price=n(r.price,i),e[s]=r}}userEditEnabled(){return!0}movable(){return!1}canBeHidden(){return!1}isUserDeletable(){return!1}showInObjectTree(){return!1}doesMovingAffectsUndo(){return!1}isAvailableInFloatingWidget(){return!1}timeAxisViews(){return null}cloneable(){return!1}copiable(){return!1}}r.POINTS_COUNT=1,e.exports.LineToolTrading=r},884566:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PlotList:()=>h,mergeMinMax:()=>p,mergePlotRows:()=>_});var s=i(650151),n=i(923195),r=i(149590),o=i(272001),l=i(812363);const a=(0,o.getLogger)("Chart.PlotList"),u=30;function d(e){return e.index}function c(e){return e.value[0]}class h{constructor(e=null,t=null){this._items=[],this._start=0,this._end=0,this._shareRead=!1,this._minMaxCache=new Map,this._rowSearchCacheByIndex=new Map,this._rowSearchCacheByIndexWithoutEmptyValues=new Map,this._rowSearchCacheByTime=new Map,this._rowSearchCacheByTimeWithoutEmptyValues=new Map,
this._plotFunctions=e||new Map,this._emptyValuePredicate=t}clear(){this._items=[],this._start=0,this._end=0,this._shareRead=!1,this._minMaxCache.clear(),this._invalidateSearchCaches()}first(){return this.size()>0?this._items[this._start]:null}last(){return this.size()>0?this._items[this._end-1]:null}firstIndex(){return this.size()>0?this._indexAt(this._start):null}lastIndex(){return this.size()>0?this._indexAt(this._end-1):null}size(){return this._end-this._start}isEmpty(){return 0===this.size()}contains(e){return null!==this.search(e,l.PlotRowSearchMode.Exact)}valueAt(e){const t=this.search(e);return null!==t?t.value:null}add(e,t){if(this._shareRead)return a.logDebug("add: readonly collection modification attempt"),!1;const i={index:e,value:t},s=this._nonCachedSearch(e,l.PlotRowSearchMode.Exact,d);return this._invalidateSearchCaches(),null===s?(this._items.splice(this._lowerbound(e,d),0,i),this._start=0,this._end=this._items.length,!0):(this._items[s]=i,!1)}search(e,t=l.PlotRowSearchMode.Exact,i){return this._searchImpl(e,t,this._rowSearchCacheByIndex,this._rowSearchCacheByIndexWithoutEmptyValues,d,i)}searchByTime(e,t=l.PlotRowSearchMode.Exact,i){return this._searchImpl(e,t,this._rowSearchCacheByTime,this._rowSearchCacheByTimeWithoutEmptyValues,c,i)}fold(e,t){let i=t;for(let t=this._start;t<this._end;++t){i=e(this._indexAt(t),this._valueAt(t),i)}return i}findFirst(e,t){const i=void 0!==t&&Math.min(this._start+t,this._end)||this._end;for(let t=this._start;t<i;++t){const i=this._indexAt(t),s=this._valueAt(t);if(e(i,s))return{index:i,value:s}}return null}findLast(e,t){const i=void 0!==t&&Math.max(this._end-t,this._start)||this._start;for(let t=this._end-1;t>=i;--t){const i=this._indexAt(t),s=this._valueAt(t);if(e(i,s))return{index:i,value:s}}return null}each(e){for(let t=this._start;t<this._end;++t){if(e(this._indexAt(t),this._valueAt(t)))break}}reduce(e,t){let i=t;for(let t=this._start;t<this._end;++t){i=e(i,this._indexAt(t),this._valueAt(t))}return i}range(e,t){const i=new h(this._plotFunctions,this._emptyValuePredicate);return i._items=this._items,i._start=this._lowerbound(e,d),i._end=this._upperbound(t),i._shareRead=!0,i}plottableRange(e){const t=new h(this._plotFunctions,this._emptyValuePredicate);return t._items=this._items,t._start=this._upperbound(r.UNPLOTTABLE_TIME_POINT_INDEX),t._end=this._end,t._shareRead=!0,!0===e&&t._start>this._start&&(t._start-=1),t}rangeIterator(e,t){const i=this._lowerbound(e,d),s=this._upperbound(t);if(i===s)return{hasNext:()=>!1,next:()=>{throw new Error("Invalid operation")}};let n=i-1;return{hasNext:()=>n<s-1,next:()=>(n+=1,this._items[n])}}minMaxOnRangeCached(e,t,i){if(this.isEmpty())return null;let s=null;for(const n of i){s=p(s,this._minMaxOnRangeCachedImpl(e-n.offset,t-n.offset,n.name))}return s}minMaxOnRange(e,t,i){if(this.isEmpty())return null;let s=null;for(const n of i){s=p(s,this._minMaxOnRange(e-n.offset,t-n.offset,n.name))}return s}merge(e){return this._shareRead?(a.logDebug("merge: readonly collection modification attempt"),
null):0===e.length?null:this.isEmpty()||e[e.length-1].index<this._items[0].index?this._prepend(e):e[0].index>this._items[this._items.length-1].index?this._append(e):1===e.length&&e[0].index===this._items[this._items.length-1].index?(this._updateLast(e[0]),e[0]):this._merge(e)}addTail(e,t=!1){if(0===e.length)return;let i=0;t&&this._end-this._start>0&&(i=1,this._items[this._end-this._start-1].value=e[0].value);for(let t=i;t<e.length;++t){const i=e[t],s=this.lastIndex();if(null===s){a.logError("Can't add tail to the empty plotlist");break}this.add(s+1,i.value)}this._invalidateSearchCaches()}move(e){if(this._shareRead)return void a.logDebug("move: readonly collection modification attempt");if(0===e.length)return;const t=this._items.slice();for(const i of e){const e=this._bsearch(i.old,d);if(null!==e&&void 0!==t[e])if(i.new===r.INVALID_TIME_POINT_INDEX)t[e]=void 0;else{t[e]={index:i.new,value:t[e].value};const s=this._bsearch(i.new,d);if(null!==s){const e=t[s];void 0!==e&&e.index===i.new&&(t[s]=void 0)}}}this._items=t.filter((e=>void 0!==e)).sort(((e,t)=>e.index-t.index)),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._start=0,this._end=this._items.length}remove(e){if(this._shareRead)return a.logDebug("remove: readonly collection modification attempt"),null;const t=this._nonCachedSearch(e,l.PlotRowSearchMode.NearestRight,d);if(null===t)return null;const i=this._items.splice(t);return this._end=this._items.length,this._minMaxCache.clear(),this._invalidateSearchCaches(),i.length>0?i[0]:null}state(){const e=this._items.slice(this._start,this._end);return{start:0,end:e.length,data:e}}restoreState(e){e?(this._start=e.start,this._end=e.end,this._shareRead=!1,this._items=e.data,this._minMaxCache.clear(),this._invalidateSearchCaches()):this.clear()}_indexAt(e){return this._items[e].index}_valueAt(e){return this._items[e].value}_length(){return this._items.length}_searchImpl(e,t,i,s,n,r){const o=void 0!==r?i:s,l=void 0!==r?1e4*(t+1)+r:t;let a=o.get(e);if(void 0!==a){const e=a.get(l);if(void 0!==e)return e}const u=this._nonCachedSearch(e,t,n,r);if(null===u)return null;const d={index:this._indexAt(u),value:this._valueAt(u)};return void 0===a&&(a=new Map,o.set(e,a)),a.set(l,d),d}_nonCachedSearch(e,t,i,s){const n=this._lowerbound(e,i),r=n===this._end||e!==i(this._items[n]);if(r&&t!==l.PlotRowSearchMode.Exact)switch(t){case l.PlotRowSearchMode.NearestLeft:return this._searchNearestLeft(n,s);case l.PlotRowSearchMode.NearestRight:return this._searchNearestRight(n,s);default:throw new TypeError("Unknown search mode")}if(void 0===s||r||t===l.PlotRowSearchMode.Exact)return r?null:n;switch(t){case l.PlotRowSearchMode.NearestLeft:return this._nonEmptyNearestLeft(n,s);case l.PlotRowSearchMode.NearestRight:return this._nonEmptyNearestRight(n,s);default:throw new TypeError("Unknown search mode")}}_nonEmptyNearestRight(e,t){const i=(0,s.ensure)(this._emptyValuePredicate),n=(0,s.ensure)(t);for(;e<this._end&&i(this._valueAt(e),n);)e+=1;return e===this._end?null:e}_nonEmptyNearestLeft(e,t){const i=(0,
s.ensureNotNull)(this._emptyValuePredicate),n=(0,s.ensure)(t);for(;e>=this._start&&i(this._valueAt(e),n);)e-=1;return e<this._start?null:e}_searchNearestLeft(e,t){if(e===this._start)return null;const i=e-1,s=i!==this._end?i:null;return void 0!==t&&null!==s?this._nonEmptyNearestLeft(s,t):s}_searchNearestRight(e,t){const i=e,s=i!==this._end?i:null;return void 0!==t&&null!==s?this._nonEmptyNearestRight(s,t):s}_bsearch(e,t){const i=this._lowerbound(e,t);return i!==this._end&&e===t(this._items[i])?i:null}_lowerbound(e,t){return(0,n.lowerbound)(this._items,e,((e,i)=>t(e)<i),this._start,this._end)}_upperbound(e){return(0,n.upperbound)(this._items,e,((e,t)=>t.index>e),this._start,this._end)}_plotMinMax(e,t,i){let s=null;const n=this._plotFunctions.get(i);if(void 0===n)throw new Error(`Plot "${i}" is not registered`);for(let i=e;i<t;i++){const e=n(this._items[i].value);null==e||Number.isNaN(e)||(null===s?s={min:e,max:e}:(e<s.min&&(s.min=e),e>s.max&&(s.max=e)))}return s}_invalidateCacheForRow(e){const t=Math.floor(e.index/u);this._minMaxCache.forEach((e=>e.delete(t)))}_prepend(e){return(0,s.assert)(!this._shareRead,"collection should not be readonly"),(0,s.assert)(0!==e.length,"plotRows should not be empty"),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._items=e.concat(this._items),this._start=0,this._end=this._items.length,e[0]}_append(e){return(0,s.assert)(!this._shareRead,"collection should not be readonly"),(0,s.assert)(0!==e.length,"plotRows should not be empty"),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._items=this._items.concat(e),this._start=0,this._end=this._items.length,e[0]}_updateLast(e){(0,s.assert)(!this.isEmpty(),"plot list should not be empty");const t=this._items[this._end-1];(0,s.assert)(t.index===e.index,"last row index should match new row index"),this._invalidateCacheForRow(e),this._invalidateSearchCaches(),this._items[this._end-1]=e}_merge(e){return(0,s.assert)(0!==e.length,"plot rows should not be empty"),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._items=_(this._items,e),this._start=0,this._end=this._items.length,e[0]}_minMaxOnRangeCachedImpl(e,t,i){if(this.isEmpty())return null;let n=null;const r=(0,s.ensureNotNull)(this.firstIndex()),o=(0,s.ensureNotNull)(this.lastIndex()),l=Math.max(e,r),a=Math.min(t,o),d=Math.ceil(l/u)*u,c=Math.max(d,Math.floor(a/u)*u);n=p(n,this._minMaxOnRange(l,Math.min(d,t,a),i));let h=this._minMaxCache.get(i);void 0===h&&(h=new Map,this._minMaxCache.set(i,h));for(let e=Math.max(d+1,l);e<c;e+=u){const t=Math.floor(e/u);let s=h.get(t);if(void 0===s){const e=t*u,n=(t+1)*u-1;s=this._minMaxOnRange(e,n,i),h.set(t,s)}n=p(n,s)}n=p(n,this._minMaxOnRange(c,a,i));return n}_minMaxOnRange(e,t,i){return this._plotMinMax(this._lowerbound(e,d),this._upperbound(t),i)}_invalidateSearchCaches(){this._rowSearchCacheByIndex.clear(),this._rowSearchCacheByIndexWithoutEmptyValues.clear(),this._rowSearchCacheByTime.clear(),this._rowSearchCacheByTimeWithoutEmptyValues.clear()}}function p(e,t){if(null===e)return t;if(null===t)return e;return{
min:Math.min(e.min,t.min),max:Math.max(e.max,t.max)}}function _(e,t){const i=function(e,t){const i=e.length,s=t.length;let n=i+s,r=0,o=0;for(;r<i&&o<s;)e[r].index<t[o].index?r++:e[r].index>t[o].index?o++:(r++,o++,n--);return n}(e,t),s=new Array(i);let n=0,r=0;const o=e.length,l=t.length;let a=0;for(;n<o&&r<l;)e[n].index<t[r].index?(s[a]=e[n],n++):e[n].index>t[r].index?(s[a]=t[r],r++):(s[a]=t[r],n++,r++),a++;for(;n<o;)s[a]=e[n],n++,a++;for(;r<l;)s[a]=t[r],r++,a++;return s}},730293:(e,t,i)=>{"use strict";i.d(t,{isPriceDataSource:()=>l,PriceDataSource:()=>a});var s=i(282151),n=i(869403),r=i.n(n),o=i(354145);function l(e){return e instanceof a}class a extends s.DataSource{constructor(e,t){super(t),this._formatterChanged=new(r()),this._priceStepChanged=new(r()),this._currencyChanged=new(r()),this._unitChanged=new(r()),this._priceRangeReadyChanged=new(r()),this._priceStep=null,this._priceRangeReady=!0,this._model=e}base(){return 0}model(){return this._model}currencyChanged(){return this._currencyChanged}isCurrencySource(){return!0}isDisplayedInLegend(){return!0}unitChanged(){return this._unitChanged}isUnitSource(){return!0}priceRange(e,t){return null}isDraggable(){return!0}priceLineColor(e){return e}formatterChanged(){return this._formatterChanged}priceStep(e){return this._priceStep}priceStepChanged(){return this._priceStepChanged}isIncludedInAutoScale(){return!0}correctScaleMargins(e){return e}priceRangeReady(){return this._priceRangeReady}priceRangeReadyChanged(){return this._priceRangeReadyChanged}disablePriceRangeReady(){const e=this.priceScale();null===e||e.isAutoScale()||e.mainSource()!==this||(this._priceRangeReady=!1,e.recalculatePriceRangeOnce()),this._priceRangeReadyChanged.fire(!1)}statusView(){return null}legendView(){return null}marketStatusModel(){return null}dataUpdatedModeModel(){return null}dataProblemModel(){return null}_enablePriceRangeReady(){this._priceRangeReady=!0,this._priceRangeReadyChanged.fire(!0)}_onSourceCurrencyChanged(){(0,o.isActingAsSymbolSource)(this)||this._currencyChanged.fire()}_onSourceUnitChanged(){(0,o.isActingAsSymbolSource)(this)||this._unitChanged.fire()}_onSourcePriceRangeReadyChanged(e){(0,o.isActingAsSymbolSource)(this)||e||this.disablePriceRangeReady()}}},933813:(e,t,i)=>{"use strict";i.r(t),i.d(t,{STATUS_OFFLINE:()=>s,STATUS_RESOLVING:()=>n,STATUS_LOADING:()=>r,STATUS_READY:()=>o,STATUS_INVALID_SYMBOL:()=>l,STATUS_SNAPSHOT:()=>a,STATUS_EOD:()=>u,STATUS_PULSE:()=>d,STATUS_DELAYED:()=>c,STATUS_DELAYED_STREAMING:()=>h,STATUS_NO_BARS:()=>p,STATUS_REPLAY:()=>_,STATUS_ERROR:()=>y,SERIES_STATUS_TEXT:()=>S,STYLE_LINE_TYPE_MARKERS:()=>f,STYLE_LINE_TYPE_STEP:()=>m,STYLE_LINE_TYPE_SIMPLE:()=>g,STYLE_BARS:()=>v,STYLE_CANDLES:()=>b,STYLE_LINE:()=>P,STYLE_AREA:()=>C,STYLE_RENKO:()=>w,STYLE_KAGI:()=>T,STYLE_PNF:()=>I,STYLE_PB:()=>A,STYLE_HEIKEN_ASHI:()=>L,STYLE_HOLLOW_CANDLES:()=>x,STYLE_BASELINE:()=>V,STYLE_RANGE:()=>E,STYLE_HILO:()=>M,STYLE_COLUMNS:()=>O,STYLE_SHORT_NAMES:()=>k,SYMBOL_STRING_DATA:()=>D});const s=0,n=1,r=2,o=3,l=4,a=5,u=6,d=7,c=8,h=9,p=10,_=11,y=12,S={[s]:"connecting",
[n]:"loading",[r]:"loading",[o]:"realtime",[l]:"invalid",[a]:"snapshot",[u]:"endofday",[d]:"endofday",[c]:"delayed",[h]:"delayed_streaming",[p]:"forbidden",[_]:"replay",[y]:"error"},f=0,m=1,g=2,v=0,b=1,P=2,C=3,w=4,T=5,I=6,A=7,L=8,x=9,V=10,E=11,M=12,O=13,k={0:"bar",1:"candle",9:"hollowCandle",2:"line",3:"area",4:"renko",7:"pb",5:"kagi",6:"pnf",8:"ha",10:"baseline",11:"range",12:"hilo",13:"column"},D={4:{type:"BarSetRenko@tv-prostudies",basicStudyVersion:64},7:{type:"BarSetPriceBreak@tv-prostudies",basicStudyVersion:34},5:{type:"BarSetKagi@tv-prostudies",basicStudyVersion:34},6:{type:"BarSetPnF@tv-prostudies",basicStudyVersion:34},8:{type:"BarSetHeikenAshi@tv-basicstudies",basicStudyVersion:60},11:{type:"BarSetRange@tv-basicstudies",basicStudyVersion:72}}},915062:(e,t,i)=>{"use strict";i.d(t,{isStudyGraphicsEmpty:()=>n.isStudyGraphicsEmpty,emptyStudyGraphics:()=>r.emptyStudyGraphics,loadStudyGraphics:()=>r.loadStudyGraphics,saveStudyGraphics:()=>r.saveStudyGraphics,LiveStudyGraphics:()=>o.LiveStudyGraphics,createGraphicsPaneViews:()=>c,createGraphicsPriceAxisViews:()=>p});var s=i(272001),n=i(186731),r=i(529327),o=i(3801),l=i(772827);const a=(0,s.getLogger)("Chart.StudyGraphics"),u=new Set(["dwgtablecells"]);async function d(e,t,s,n){switch(e){case"hlines":return new((await Promise.all([i.e(81679),i.e(20507)]).then(i.bind(i,298258))).LevelPaneView)(t,s,n);case"lines":return new((await Promise.all([i.e(81679),i.e(20507)]).then(i.bind(i,684607))).LinePaneView)(t,s,n);case"shapemarks":return new((await Promise.all([i.e(81679),i.e(20507)]).then(i.bind(i,700327))).ShapeMarkPaneView)(t,s,n);case"textmarks":return new((await Promise.all([i.e(81679),i.e(20507)]).then(i.bind(i,514331))).TextMarkPaneView)(t,s,n);case"trendchannels":return new((await Promise.all([i.e(81679),i.e(20507)]).then(i.bind(i,482268))).TrendChannelPaneView)(t,s,n);case"dwglabels":return new((await Promise.all([i.e(81679),i.e(20507)]).then(i.bind(i,953617))).DwgLabelPaneView)(t,s,n);case"dwglines":return new((await Promise.all([i.e(81679),i.e(20507)]).then(i.bind(i,939692))).DwgLinePaneView)(t,s,n);case"dwgboxes":return new((await Promise.all([i.e(81679),i.e(20507)]).then(i.bind(i,938783))).DwgBoxPaneView)(t,s,n);case"dwgtables":return new((await Promise.all([i.e(81679),i.e(20507)]).then(i.bind(i,450208))).DwgTablePaneView)(t,s,n);case"dwglinefills":return new((await Promise.all([i.e(81679),i.e(20507)]).then(i.bind(i,354822))).DwgLineFillPaneView)(t,s,n)}switch(e){case"hhists":return new((await Promise.all([i.e(81679),i.e(20507)]).then(i.bind(i,327514))).HHistPaneView)(t,s,n);case"horizlines":return new((await Promise.all([i.e(81679),i.e(20507)]).then(i.bind(i,491810))).HorizLinePaneView)(t,s,n);case"vertlines":return new((await Promise.all([i.e(81679),i.e(20507)]).then(i.bind(i,331860))).VertLinePaneView)(t,s,n);case"polygons":return new((await Promise.all([i.e(81679),i.e(20507)]).then(i.bind(i,860940))).PolygonPaneView)(t,s,n);case"backgrounds":return new((await Promise.all([i.e(81679),i.e(20507)]).then(i.bind(i,319942))).BackgroundPaneView)(t,s,n)}
return null}async function c(e,t,i){const s=[],n=Object.keys(e.graphicsInfo());n.sort(((e,t)=>h(e)-h(t)));for(const r of n){const n=await d(r,e,t,i);null!==n?s.push(n):u.has(r)||a.logWarn(`${r} is not supported by this build of graphics subsystem, skipping`)}return s}function h(e){var t;return null!==(t=n.primitivesZOrders.get(e))&&void 0!==t?t:0}function p(e){const t=Object.keys(e.graphicsInfo()),i=[];for(const s of t)switch(s){case"hlines":e.graphics().hlines().forEach(((t,n)=>{t.forEach((t=>{void 0!==t.level&&i.push(new l.LevelPriceAxisView(e,{line:{level:t.level},styleId:n,lineType:s}))}))}));break;case"horizlines":e.graphics().horizlines().forEach(((t,n)=>{t.forEach((t=>{void 0!==t.level&&i.push(new l.LevelPriceAxisView(e,{line:{level:t.level},styleId:n,lineType:s}))}))}))}return i}},450557:(e,t,i)=>{"use strict";var s;i.d(t,{StudyStatusType:()=>s}),function(e){e[e.Undefined=0]="Undefined",e[e.Loading=1]="Loading",e[e.Completed=2]="Completed",e[e.Error=3]="Error"}(s||(s={}))},573774:(e,t,i)=>{"use strict";i.d(t,{isExtendedInput:()=>r,isExtendedInputSource:()=>o,getInputValue:()=>l,isStudyInputOptionsInfo:()=>a,areStudyInputsEqual:()=>u,RangeDependentStudyInputNames:()=>s,rangeDependentStudyInputsToTimeRange:()=>d,isTimeOrPriceNotHiddenInput:()=>c,editableStudyInputs:()=>h});var s,n=i(598279);function r(e){return(0,n.default)(e)}function o(e){return"source"===e.t}function l(e){return r(e)?e.v:e}function a(e){return["text","integer","float","price","session","resolution"].includes(e.type)&&e.hasOwnProperty("options")}function u(e,t,i){for(const s of e)if(t[s.id]!==i[s.id])return!1;return!0}function d(e){return{from:Math.round(e.first_visible_bar_time/1e3),to:Math.round(e.last_visible_bar_time/1e3)}}function c(e){return("time"===e.type||"price"===e.type)&&!0!==e.isHidden}function h(e){const t=e.filter(c);if(0===t.length)return[];const i=new Map,s=[];t.forEach((e=>{var t;const{group:n,inline:r}=e;if(void 0===r)return void s.push(e);const o=r+(n||"");if(i.has(o))null===(t=i.get(o))||void 0===t||t.push(e);else{const t=[e];i.set(o,t),s.push(t)}}));const n=[];for(let e=0;e<s.length;e++){const t=s[e];Array.isArray(t)?2===t.length&&t[0].type!==t[1].type?n.push(t):n.push(...t):n.push(t)}return n}!function(e){e.FirstBar="first_visible_bar_time",e.LastBar="last_visible_bar_time",e.Realtime="subscribeRealtime"}(s||(s={}))},161106:(e,t,i)=>{"use strict";i.d(t,{StudyStatusProviderBase:()=>l});var s=i(618258),n=i(482358);const r={NONE:"Default"},o=!0;class l extends s.StatusProviderBase{constructor(e,t){super(t),this._source=e}getSplitTitle(){return this._source.titleInParts(!0,r,void 0,o)}text(){return this._source.isActualInterval()?this._source.isFailed()?`${this._source.title(!0,r,void 0,o)}: ${this.sourceStatusText()}`:`${this._source.title(!0,r,void 0,o)} ${this.sourceStatusText()}`:this._source.title(!0,r,void 0,o)}sourceStatusText(){return(0,n.convertStudyStatusToString)(this._source.status(),!0)}errorStatus(){if(!this._source.isActualInterval()||this._source.isSymbolInvalid())return null;const e=this._source.status()
;return e.type===n.StudyStatusType.Error?{error:this.sourceStatusText(),solutionId:(0,n.studyStatusSolutionId)(e),title:(0,n.studyStatusTitle)(e),studyFeature:(0,n.studyStatusFeature)(e)}:null}}},482358:(e,t,i)=>{"use strict";i.d(t,{StudyStatusType:()=>d,convertStudyStatusToString:()=>c,studyStatusSolutionId:()=>h,studyStatusTitle:()=>p,studyStatusFeature:()=>_});var s=i(777754),n=i(166097),r=i(286293);const o=s.t(null,void 0,i(916971)),l=new Map([["Pine cannot determine the referencing length of a series. Try using max_bars_back",r.solutionIds.PINE_CANNOT_DETERMINE],["Memory limits exceeded",r.solutionIds.MEMORY_LIMITS_EXCEEDED],["This script is invite-only",r.solutionIds.PUBLIC_INVITE_ONLY_SCRIPTS]]),a=new Map([["Volume Profile indicator available only on our upgraded plans","volumeProfile"]]),u=s.t(null,void 0,i(930295));var d;function c(e,t){if(e.type===d.Loading)return t?u:"loading...";if(e.type===d.Error){const i=e.errorDescription,s=t?(0,n.triesTranslateError)(i.error):i.error;if(i.ctx){const e={};return Object.entries(i.ctx).forEach((([t,i])=>{e[t]=i.toString()})),s.format(e)}return s}return""}function h(e){if(e.type===d.Error)return e.errorDescription.solution_id?e.errorDescription.solution_id:function(e){for(const t of Array.from(l.keys()))if(e.includes(t))return l.get(t)}(e.errorDescription.error)}function p(e){if(e.type===d.Error)return-1!==e.errorDescription.error.toLowerCase().indexOf("the data vendor doesn't provide volume data for this symbol.")?o:void 0}function _(e){const{errorDescription:{error:t}}=e;for(const[e,i]of a)if(t.startsWith(e))return i}!function(e){e[e.Undefined=0]="Undefined",e[e.Loading=1]="Loading",e[e.Completed=2]="Completed",e[e.Error=3]="Error"}(d||(d={}))},306963:(e,t,i)=>{"use strict";i.d(t,{StudyStubStatusProvider:()=>n});var s=i(161106);class n extends s.StudyStatusProviderBase{text(){return this._source.isActualInterval()?`${this._source.title()} ${this.sourceStatusText()}`:this._source.title()}}},800113:(e,t,i)=>{"use strict";i.d(t,{prepareStudyProperties:()=>He,prepareStudyPropertiesForLoadChart:()=>Ge,StudyBase:()=>$e});var s=i(316230),n=i(822914),r=i(650151),o=i(777754),l=i(272001),a=i(638456),u=i(809350),d=i(212110),c=i(921303),h=i(765477),p=i(334844),_=i(933024),y=i(293689),S=i(508846),f=i(527538),m=i(960254),g=i(869403),v=i.n(g),b=i(586299),P=i(730293),C=i(168210),w=i(884566),T=i(108184),I=i(915062),A=i(812363),L=i(96841),x=i(726820),V=i(480071),E=i(397581),M=i(7628),O=i(200821),k=i(477679),D=i(155268),R=i(431235),F=i(40210),N=i.n(F),B=i(758337),U=i(951512),H=i(519872),z=i(24668),j=i(125226),W=i(147257),G=i(573774),Y=i(87476),$=i(912404),K=i(877168),X=i(526904),J=i(393937),q=i(356051),Z=i(602190),Q=i(733352),ee=i(627425),te=i(917516),ie=i(224186),se=i(708412),ne=i(4836),re=i(307928),oe=i(708832),le=i(891526),ae=i(482358),ue=i(323017),de=i(771236),ce=i(404822),he=i(988411),pe=i.n(he),_e=(i(720444),
i(736887)),ye=i(83387),Se=i(471502),fe=i(424061),me=i(251954),ge=i(16665),ve=i(631586),be=i(488792),Pe=i(87225),Ce=i(450556),we=i(309123),Te=i(216392),Ie=i(831471),Ae=i(738023),Le=i(561068);const xe=(0,l.getLogger)("Chart.Study"),Ve=o.t(null,void 0,i(814177)),Ee=(0,j.isFeatureEnabled)("multiple_SoS");const Me={symbolsForDisplay:!1,symbolsForChartApi:!0,skipHiddenInputs:!1,skipFakeInputs:!1,skipBooleanInputs:Y.enabled("dont_show_boolean_study_arguments"),asObject:!0,skippedGroups:[],skippedInputs:[],noExchanges:!1,noResolution:!1,keepOptionalSymbolsEmpty:!1,skipColorInputs:!1,skipTimeInputs:!1,skipOptionalEmptySymbolInputs:!1,skipTextareaInputs:!0,priceInputsForDisplay:!1},Oe=Y.enabled("study_symbol_ticker_description"),ke=Y.enabled("hide_main_series_symbol_from_indicator_legend");function De(e,t){const i=e.plots[t];if(!i||!(0,H.isOhlcPlot)(i))return!1;const s=i.target,n=e.defaults.styles&&e.defaults.styles[s],r=e.defaults.ohlcPlots&&e.defaults.ohlcPlots[s],o=e.ohlcPlots&&e.ohlcPlots[s];return n&&(0,H.isOhlcPlotStyleBars)(n)||r&&(0,H.isOhlcPlotStyleBars)(r)||!!o&&(0,H.isOhlcPlotStyleBars)(o)}function Re(e,t){const i=e.plots[t];if(!i||!(0,H.isOhlcPlot)(i))return!1;const s=i.target,n=e.defaults.styles&&e.defaults.styles[s],r=e.defaults.ohlcPlots&&e.defaults.ohlcPlots[s],o=e.ohlcPlots&&e.ohlcPlots[s];return n&&(0,H.isOhlcPlotStyleCandles)(n)||r&&(0,H.isOhlcPlotStyleCandles)(r)||!!o&&(0,H.isOhlcPlotStyleCandles)(o)}function Fe(e,t){(0,r.assert)(void 0!==e,"zOrder must be defined"),(0,r.assert)(!t.has(e),"zOrder must be unique")}function Ne(e,t){return e.plots.some((e=>((0,H.isColorerPlot)(e)||(0,H.isDataPlot)(e))&&e.target===t))}function Be(e,t){var i;if(t.plots)for(let s=0;s<t.plots.length;s++){const n=t.plots[s],o=n.id;if((0,H.isColorerPlot)(n))continue;const l={display:15,color:"#0496FF",linestyle:ve.LINESTYLE_SOLID,linewidth:2,plottype:H.LineStudyPlotStyle.Line,transparency:50,trackPrice:!1};(0,H.isBarColorerPlot)(n)&&(l.transparency=0),l.plottype=n.type,l.title=o,e.styles&&o in e.styles&&(0,B.merge)(l,null!==(i=e.styles[o])&&void 0!==i?i:{}),(0,r.ensureDefined)(e.styles)[o]=l}}function Ue(e,t,i,s){var n,o;if(T.StudyMetaInfo.versionOf(e)<1)throw new Error("This function cannot work with metainfo of the old format version. Required format version >= 1");let l=(0,B.clone)((0,ge.defaults)("study"));Be(l,e);const a=T.StudyMetaInfo.getStudyPropertyRootName(e);let u=(0,B.clone)((0,ge.defaults)(a,s));u.intervalsVisibilities=(0,B.clone)(be.intervalsVisibilitiesDefaults),"Overlay"!==e.shortId&&"Compare"!==e.shortId||(u.currencyId=null,u.unitId=null),e.isTVScript&&e.TVScriptSourceCode!==u.TVScriptSourceCode&&(u=(0,B.clone)((0,ge.factoryDefaults)(a))),(0,B.merge)(l,u),t&&((0,r.assert)(!(t instanceof N()),"propsState should not be an instance of Property"),(0,B.merge)(l,t));const d=(0,B.clone)(e.defaults),c={};we.StudyVersioning.mergeInputsObjPart(c,null!==(n=d.inputs)&&void 0!==n?n:{}),we.StudyVersioning.mergeInputsObjPart(c,l.inputs),l.inputs=c,delete d.inputs;const h={};if((0,B.merge)(h,d),(0,B.merge)(h,(0,
ge.factoryDefaults)(a)),(0,B.merge)(h,l),l=h,null!==i){const t=i.model().studiesColorRotatorFactory().getColorRotator(e);null!==t&&("Overlay@tv-basicstudies"===e.id?l.lineStyle.color=t.getColor(l.lineStyle.color):(0,B.merge)(l,function(e,t){for(const i of Object.keys(e.styles)){const s=e.styles[i];if(s&&"color"in s){const e=s.color;s.color=t.getColor(e)}}return e}(l,t)))}return t&&(0,B.merge)(l.styles,null!==(o=t.styles)&&void 0!==o?o:{}),l}function He(e,t,i,s,n){return function(e,t,i,s,n,r){const o=Ue(e,t,i,s);return T.StudyMetaInfo.getSourceInputIds(e).forEach(((e,t)=>{const i=o.inputs[e];t<r.length?o.inputs[e]=`${r[t].id()}$0`:(0,B.isString)(i)&&i.includes("$")&&(o.inputs[e]="close")})),je(e,n,o)}(e,t,i,s,T.StudyMetaInfo.getStudyPropertyRootName(e),n)}const ze=["id","description","description_localized","shortDescription","_metainfoVersion","is_price_study","is_hidden_study","priceScale","fullId","shortId","scriptIdPart","version","packageId","productId","isTVScriptStub","defaults","symbolSource","historyCalculationMayChange","format","linkedToSeries","isTVLibrary","docs","exports","exportTypes","extra","usesPrivateLib","financialPeriod","groupingKey","pine","isRGB","isTVScript","TVScriptMetaInfoExprs","usePlotsZOrder","isTVScriptStrategy","TVScriptSourceCode","lookaheadFutureData","hasAlertFunction","defaultStrategyAlertMessage","tags","canBeChild","canNotBeChild","_serverMetaInfoVersion","warnings"];function je(e,t,i){for(const e of ze)delete i[e];const s=new Pe.DefaultProperty(t,i,!0);s.removeProperty("intervalsVisibilities"),s.addChild("intervalsVisibilities",new Ce.IntervalsVisibilitiesProperty(i&&i.intervalsVisibilities)),s.addExclusion("visible"),s.addExclusion("precision"),s.addExclusion("minTick"),s.addExclusion("intervalsVisibilities");for(let t=0;t<e.inputs.length;++t){const i=e.inputs[t];i.isHidden&&(s.addExclusion("inputs."+t.toString()),s.addExclusion("inputs."+i.id))}return"PivotPointsStandard@tv-basicstudies"!==e.id&&"PivotPointsHighLow@tv-basicstudies"!==e.id||!s.hasChild("font")||s.removeProperty("font"),s}function We(e,t,i,s,n,r){const o=function(e,t,i,s,n){var r;e.version&&i.version&&e.version!==i.version&&xe.logWarn("Serialized metaInfo version "+e.version+" is not equal to the saved state version "+i.version);let o=(0,B.clone)((0,ge.defaults)("study"));o.intervalsVisibilities=(0,B.clone)(be.intervalsVisibilitiesDefaults),(0,B.merge)(o,(0,ge.factoryDefaults)(T.StudyMetaInfo.getStudyPropertyRootName(e))),Be(o,e),(0,B.merge)(o,i),o=s.updateStudyState(o,e,t),void 0!==n&&t&&(o=n(i,o,e,t));const l=t||e,a=(0,B.clone)(l.defaults);if(l&&T.StudyMetaInfo.versionOf(l)>=1){const e={};we.StudyVersioning.mergeInputsObjPart(e,null!==(r=a.inputs)&&void 0!==r?r:{}),we.StudyVersioning.mergeInputsObjPart(e,o.inputs),o.inputs=e,a&&delete a.inputs;const t={};(0,B.merge)(t,a),(0,B.merge)(t,(0,ge.factoryDefaults)(T.StudyMetaInfo.getStudyPropertyRootName(l))),(0,B.merge)(t,o),o=t}return o}(e,t,i,s,r);return je(t||e,n,o)}function Ge(e,t,i,s,n){return We(e,t,i,s,T.StudyMetaInfo.getStudyPropertyRootName(e),n)}
function Ye(e,t,i){let s=0,n=0;return e.inputs.filter((e=>"source"===e.type)).forEach((e=>{(0,G.getInputValue)(i[e.id]).includes("$")&&s++,(0,G.getInputValue)(t[e.id]).includes("$")&&n++})),Math.sign(n)-Math.sign(s)}class $e extends P.PriceDataSource{constructor(e,t,i,s){var n,o,l;super(e),this._onStart=new(v()),this._onHibernationStateChange=new(v()),this._symbolsResolved=new(v()),this._statusChanged=new(v()),this._restarting=!1,this._paneViews=[],this._legendView=null,this._priceAxisViews=[],this._inputsAnchorsPaneView=null,this._inputsLinesPaneView=null,this._inputsTimeAxisPaneViews=[],this._inputsPriceAxisPaneViews=[],this._resolvedSymbols={},this._resolvedSymbolsByInput={},this._sources=[],this._status={type:ae.StudyStatusType.Undefined},this._wasCompletedBefore=!1,this._studyId=null,this._isSubscribedToSessionId=!1,this._titleStrCache={},this._titleInPartsCache={},this._children=[],this._numericFormatter=new U.NumericFormatter,this._priceAxisViewsBase=[],this._priceLinesAxisViews=[],this._graphicsPriceAxisViews=[],this._labelPaneViews=[],this._ownFirstValue=null,this._plotOffsets={},this._formatter=null,this._ongoingDataUpdate=Promise.resolve(),this._studyModified=!1,this._isDestroyed=!1,this._graphics=new I.LiveStudyGraphics,this._dataUpdated=new(v()),this._tagsChanged=new(v()),this._studyName="",this._turnaround="st0",this._currencySourceSymbolInputProperty=null,this._pendingResolveSymbols=new Map,this._onIsActualIntervalChange=new(v()),this._childStudyByRebind=new(v()),this._lastNonEmptyPlotRowCache={},this._startMovingPoint=null,this._processHibernateBound=this.processHibernate.bind(this,1),this._maxOffset=new(pe())(0),this._currencySourceSymbolInfo=null,this._turnaroundCounter=0,this._deferredPinePatchProps=!1,this._chartApi=e.chartApi(),this._properties=t,this._metaInfo=s,this._series=this._model.mainSeries(),this._series.onIntervalChanged().subscribe(this,this._calcIsActualInterval),this._showStudyArgumentsProperty=e.properties().childs().paneProperties.childs().legendProperties.childs().showStudyArguments,e.collapsed().subscribe(this._processHibernateBound),this._sources=i,T.StudyMetaInfo.setChildStudyMetaInfoPropertiesSourceId(s,null===(n=this._sources[0])||void 0===n?void 0:n.id(),t),i.forEach((e=>{e.setChild(this)})),[this._series,...i].forEach((e=>{e.currencyChanged().subscribe(this,this._onSourceCurrencyChanged),e.unitChanged().subscribe(this,this._onSourceUnitChanged),e.priceRangeReadyChanged().subscribe(this,this._onSourcePriceRangeReadyChanged),e.formatterChanged().subscribe(this,this._onSourceFormatterChanged),e.priceStepChanged().subscribe(this,this._onSourcePriceStepChanged)})),Oe&&this._model.mainSeries().properties().childs().statusViewStyle.childs().symbolTextSource.listeners().subscribe(this,(()=>{this.invalidateTitleCache(!0)}));const a=this._properties.childs();for(const e of T.StudyMetaInfo.getSourceInputIds(s))null===(o=a.inputs.childs()[e])||void 0===o||o.subscribe(this,this._onSourceInputChanged);this._properties.subscribe(this,this._onPropertiesChanged),
a.visible.subscribe(this,this._visibleChanged),a.visible.subscribe(this,(()=>this.processHibernate())),a.intervalsVisibilities.subscribe(this,this._calcIsActualInterval),a.inputs.listeners().subscribe(this,this._updateMaxOffsetValue),void 0!==a.offsets&&a.offsets.listeners().subscribe(this,this._updateMaxOffsetValue),void 0!==a.offset&&a.offset.listeners().subscribe(this,this._updateMaxOffsetValue),V.hideAllIndicators().subscribe(this,this._visibleChanged);for(let e=0;e<this._metaInfo.plots.length;e++){const t=this._metaInfo.plots[e].id,i=this._properties.childs().styles.childs()[t];null==i||i.childs().display.subscribe(this,(()=>this.processHibernate()))}for(const e of Object.keys(this._metaInfo.graphics))for(const t of Object.keys(this._metaInfo.graphics[e])){const i=null===(l=a.graphics.childs()[e])||void 0===l?void 0:l.childs()[t];i&&i.childs().visible&&(0,r.ensureDefined)(i.childs().visible).subscribe(this,(()=>this.processHibernate()))}this._isActualInterval=(0,ue.isActualInterval)(this._series.intervalObj(),this._properties.childs().intervalsVisibilities),this._initializeStudyInputsPaneViews(),this._handler=e=>this.onData(e),this._handler.isTVScriptStrategy=this._metaInfo.isTVScriptStrategy,this._valuesProvider=new Te.StudyValuesProvider(this,e)}destroy(){var e;this.parentSources().forEach((e=>{e.currencyChanged().unsubscribeAll(this),e.unitChanged().unsubscribeAll(this),e.priceRangeReadyChanged().unsubscribeAll(this),e.formatterChanged().unsubscribeAll(this),e.priceStepChanged().unsubscribeAll(this)})),this._series.properties().childs().statusViewStyle.childs().symbolTextSource.unsubscribeAll(this),this._series.onIntervalChanged().unsubscribeAll(this),this.formatterChanged().unsubscribe(this,this.invalidateTitleCache),V.hideAllIndicators().unsubscribe(this,this._visibleChanged),this._model.collapsed().unsubscribe(this._processHibernateBound),null!==this._currencySourceSymbolInputProperty&&this._currencySourceSymbolInputProperty.unsubscribeAll(this),null===(e=this._legendView)||void 0===e||e.destroy()}properties(){return this._properties}isDraggable(){return!this._metaInfo.linkedToSeries}lastValueData(e,t,i){const s={noData:!0},n=this.priceScale();if(this._model.timeScale().isEmpty()||null===n||n.isEmpty()||this.data().isEmpty())return s;const r=this._model.timeScale().visibleBarsStrictRange(),o=this.firstValue(!0);if(null===r||null===o)return s;if(!this._properties.childs().visible.value())return s;const l=this._properties.childs().styles,a=this._properties.childs().ohlcPlots;let u,d;if(l&&l.childs()[e]&&(u=l.childs()[e]),a&&a.childs()[e]&&(u=a.childs()[e]),!u||0===u.childs().display.value())return s;const c=this.metaInfo().plots;for(d=0;d<c.length;d++){const t=c[d];if(t.id===e||(0,H.isOhlcClosePlot)(t)&&t.target===e)break}const h=d+1,p=this.offset(e),_=this.nearestIndex(r.lastBar()-p,A.PlotRowSearchMode.NearestLeft,h);if(void 0===_)return s;const y=this._lastNonEmptyPlotRow(h),S=null!==y&&r.contains(y.index),f=null!==y?y.value:null,m=t||S?f:this.data().valueAt(_);if(!m||!(0,B.isNumber)(m[h]))return s
;const g=m[h],v=this._valuesProvider.getPlotColor(d,m),b=n.priceToCoordinate(g,o),P={...n.getFormattedValues(g,o),noData:!1,color:v,floatCoordinate:b,coordinate:b};return i&&(P.price=g),P}isFailed(){return this._status.type===ae.StudyStatusType.Error}isLoading(){return this._status.type===ae.StudyStatusType.Loading}isSymbolInvalid(){return this._status.type===ae.StudyStatusType.Error&&this._status.errorDescription.error===Ve}state(e,t){var i,s;const n=(0,r.ensureNotNull)((0,a.className)(this.constructor)),o=this.metaInfo();let l;o instanceof T.StudyMetaInfo?l=(0,B.clone)(o.state()):(l=(0,B.clone)(this.metaInfo()),l.id=T.StudyMetaInfo.parseIdString(l.id+(l.version?"-"+l.version:"")).fullId);const u={type:n,id:this.id(),state:this.properties().state(),zorder:this.zorder(),ownFirstValue:this.isVisible()?null:this._ownFirstValue,metaInfo:l},d=this._sources.map((e=>e.id()));if(d.length&&(u.parentSources=d),e){let e=this.data();const t=this._model.timeScale(),i=this._seriesDataRangeToSave(e);null!==i&&(e=e.range(i.firstBar(),i.lastBar())),u.data=e.state(),u.data.symbols=this._resolvedSymbols,u.data.graphics=(0,I.saveStudyGraphics)(this.graphics(),t.visibleBarsStrictRange()),u.data.plotOffsets=this._plotOffsets}this.ownerSource()&&(u.ownerSource=null===(i=this.ownerSource())||void 0===i?void 0:i.id());for(let e=0;e<o.inputs.length;e++)if("bar_time"===o.inputs[e].type){const t=o.inputs[e].id,i=u.state.inputs[t];if(i<0){const e=this._rightOffsetToUnixTime(-i);u.state.inputs[t]=e&&e>=0?e:0}}if(null===(s=u.state)||void 0===s?void 0:s.inputs){const e=u.metaInfo.inputs.find((e=>"ILScript"===e.name));e&&delete u.state.inputs[e.id]}var c;return t&&(c=u).metaInfo&&c.metaInfo.scriptIdPart&&c.metaInfo.scriptIdPart.startsWith("USER;")&&(function(e){if(!e.metaInfo)return;const t=e.metaInfo.scriptIdPart;if(!t)return;const i=t.split(";")[0],s=e.metaInfo;s.id=(s.id||"").replace(t,i),s.fullId=(s.fullId||"").replace(t,i),s.name=(s.name||"").replace(t,i),s.shortId=(s.shortId||"").replace(t,i),s.scriptIdPart=(s.scriptIdPart||"").replace(t,i),e.state&&(e.state.id=(e.state.id||"").replace(t,i),e.state.name=(e.state.name||"").replace(t,i),e.state.scriptIdPart=(e.state.scriptIdPart||"").replace(t,i))}(c),function(e){const t=(e.metaInfo&&e.metaInfo.inputs||[]).find((e=>"ILScript"===e.name));t&&(t.defval="",e.state&&e.state.inputs&&(e.state.inputs[t.id]=""),e.metaInfo.defaults.inputs&&(e.metaInfo.defaults.inputs[t.id]=""))}(c)),u}restoreData(e){var t,i;this._invalidateLastNonEmptyPlotRowCache(),this.data().restoreState(e),this._resolvedSymbols=null!==(t=e.symbols)&&void 0!==t?t:{},this._graphics=e.graphics?(0,I.loadStudyGraphics)(e.graphics):(0,I.emptyStudyGraphics)(),this._postProcessGraphics(),this._plotOffsets=null!==(i=e.plotOffsets)&&void 0!==i?i:{},this._setStatus({type:ae.StudyStatusType.Completed},!0)}hasStateForAlert(){return Y.enabled("alerts")&&!this.isFailed()&&(this.metaInfo().isTVScript?this._hasAlertConditions()||this._hasAvailableAlertPlots()||this._hasAlertFunction():this._hasAlertablePlots())}stateForAlert(){
const e=this.metaInfo(),t=this._plotsForAlert(),i=this._collectDepsForAlert(),s=i.idForAlert,n=i.studyDependencies,o=i.inputsForAlert,l=(this.priceScale()||this.model().mainSeries().priceScale()).formatter(),a=l?h.FormattersSerializer.serialize(l):null,c={id:s,uniqueId:s,type:(0,r.ensureNotNull)(window.TradingView.className(this.constructor)),title:(0,u.clean)(this._title(!1,{},!1),!0),shortTitle:(0,u.clean)(this._title(!0,{},!1),!0),shortDescription:(0,u.clean)(e.shortDescription||"Study",!0),fullId:e.fullId,isTVScript:Boolean(e.isTVScript),isTVScriptStrategy:Boolean(e.isTVScriptStrategy),isTVLibrary:Boolean(e.isTVLibrary),hasAlertFunction:Boolean(e.hasAlertFunction),plots:t,inputs:o,alerts:e.alerts,scriptIdPart:e.scriptIdPart,scriptVersion:e.pine?e.pine.version:"-1",callStudyDependencies:(0,d.formatCallstudyArg)(this._dependenciesForAlerts()),studyDependencies:n,formatter:a},_=(0,p.getStudyDangerReason)(this);_&&(c.dangerReason=_);const y=e.defaultStrategyAlertMessage;return y&&(c.defaultStrategyAlertMessage=(0,u.clean)(y,!0)),c}idForAlert(){return this._collectDepsForAlert().idForAlert}alertCreationAvailable(){return new(pe())(!this.metaInfo().isTVLibrary&&super.alertCreationAvailable().value()).readonly()}hasBarColorer(){return(0,r.ensureNotNull)(this._metaInfo).plots.some(H.isBarColorerPlot)}barColorer(){const e=this._metaInfo.plots;let t=null;for(let i=0;i<e.length;++i)if((0,H.isBarColorerPlot)(e[i])){const e=new fe.StudyBarColorer(this,i);null===t?t=e:t.pushBackBarColorer(e)}return t}restart(e){this._restarting=!0,this.clearData(),(e||Y.enabled("stop_study_on_restart"))&&this.stop(),setTimeout(this.start.bind(this),0)}stop(e,t){if(!0===e&&this._children)for(const e of this._children)e.stop(!0);this._stopStudyOnServer(),this.clearData(),this._unsubscribeToSessionId(),this.recalculate()}disconnect(){this._studyId=null,this._model.isSnapshot()||(this._resolvedSymbols={},this._resolvedSymbolsByInput={})}sourceId(){return this._studyId}parentSources(){return this._sources}symbolSource(){return this._firstSourceOrSeries().symbolSource()}barsProvider(){return this._firstSourceOrSeries().barsProvider()}ownerSource(){return this.isChildStudy()?this._sources[0]:super.ownerSource()}isChildStudy(){return this._sources.length>0}hasChildren(){return this._children.length>0}isStarted(){return Boolean(this._studyId)}isRestarting(){return this._restarting}isActualInterval(){return this._isActualInterval}onIsActualIntervalChange(){return this._onIsActualIntervalChange}isVisible(){var e,t,i;const s=this._properties.childs();if(this._model.collapsed().value()||!s.visible.value()||!this.isActualInterval())return!1;const n=this.metaInfo();if(n.plots.length>0)for(let e=0;e<n.plots.length;e++){const t=n.plots[e].id,i=s.styles.childs()[t];if(void 0===i)continue;if(0!==i.childs().display.value())return!0}if(n.bands)for(let e=0;e<n.bands.length;e++)if(s.bands.childs()[e].childs().visible.value())return!0;for(const r of Object.keys(n.graphics))for(const o of Object.keys(n.graphics[r])){
const n=null===(e=s.graphics.childs()[r])||void 0===e?void 0:e.childs()[o];if(void 0!==n&&(null===(i=null===(t=n.child("visible"))||void 0===t?void 0:t.value())||void 0===i||i))return!0}if(n.filledAreas)for(let e=0;e<n.filledAreas.length;e++)if(s.filledAreasStyle.childs()[n.filledAreas[e].id].childs().visible.value())return!0;return!(!n.isTVScriptStrategy&&!n.hasAlertFunction)}start(e,t,i){const s=this._model.mainSeries();if(!s.isStarted())return void s.dataEvents().completed().subscribe(this,(()=>this.start(e,t)),!0);this._sources.forEach((e=>{e.isHibernated()&&e.start()}));const n=!(this.isHibernationAllowed()&&!this.isVisible())||!0===t;this._chartApi&&this._chartApi.isConnected().value()&&n&&this._allSymbolsAreResolved().then((()=>this._startAfterSymbolsResolved(e,t))).catch((e=>{xe.logError("ERROR: "+this._debugId()+" start failed, "+e),this._restarting=!1}))}inputs(e){const t=(0,B.merge)((0,B.clone)(Me),e||{});t.skipOptionalEmptySymbolInputs&&(t.keepOptionalSymbolsEmpty=!0);const i=(0,n.default)(this._buildInputs(t));return t.patchSosInputs&&T.StudyMetaInfo.patchSoSInputs(i,(e=>{var t,i;return null!==(i=null===(t=this._sources.find((t=>t.id()===e)))||void 0===t?void 0:t.sourceId())&&void 0!==i?i:null})),i}metaInfo(){return this._metaInfo}status(){return this._status}name(e){return e?this.metaInfo().shortDescription||"Study":this.metaInfo().description||"Study"}title(e,t,i,s){i=void 0===i?!this._showStudyArgumentsProperty.value():i;const n=JSON.stringify([e,t,i,s]);if(this._titleStrCache[n])return this._titleStrCache[n];if(this._titleInPartsCache[n])return this._joinTitlesParts(this._titleInPartsCache[n]);const r=this._title(e,t,i,s);return this._titleStrCache[n]=r,r}titleInParts(e,t,i,s){i=void 0===i?!this._showStudyArgumentsProperty.value():i;const n=JSON.stringify([e,t,i,s]);if(this._titleInPartsCache[n])return this._titleInPartsCache[n];const r=this._titleInParts(e,t,i,s);return this._titleInPartsCache[n]=r,r}invalidateTitleCache(e){if(this._titleStrCache={},this._titleInPartsCache={},!0===e&&this._children)for(let t=0;t<this._children.length;++t)this._children[t].invalidateTitleCache(e)}graphicsInfo(){return this._metaInfo.graphics}setOwnFirstValue(e){this._ownFirstValue=e}firstValue(e){if(!this.isChildStudy()&&"Compare@tv-basicstudies"===this._metaInfo.id||!this._metaInfo.is_price_study){const t=this._model.timeScale().visibleBarsStrictRange();if(null===t)return null;const i=this.properties().childs();if(!i.visible.value()||!this.isActualInterval()||null!==this._startMovingPoint)return this._ownFirstValue;const s=t.firstBar(),n=t.lastBar();let o=(0,z.studyGraphicsFirstValue)(this);const l=this._metaInfo.plots||[];if(null===o){const t=new Set,a=this._metaInfo.filledAreas||[];for(let e=0;e<a.length;e++){const s=a[e];i.filledAreasStyle.childs()[s.id].childs().visible.value()&&(t.add(s.objAId),t.add(s.objBId))}const u=this.data().rangeIterator(s,n);for(;u.hasNext();){const s=u.next().value;for(let n=0;n<l.length;++n){if((0,H.isColorerPlot)(l[n]))continue;const a=s[n+1];if(null==a)continue;const u=l[n].id
;if((0!==(0,r.ensureDefined)(i.styles.childs()[u]).childs().display.value()||t.has(u))&&!(e&&Math.abs(a)<1e-10)){o=a;break}}if(null!==o)break}}return this._ownFirstValue=o,null!==o?o:this._bandsFirstValue(e)}if(this.isChildStudy()){const e=this._getNonPriceParent();if(e&&this.priceScale()===e.priceScale())return null!==e._ownFirstValue?e._ownFirstValue:e.firstValue()}return this._series.firstValue()}priceRange(e,t){let i=null;const s=this._metaInfo,n=this._fillPrecalculatedAutoscaleInfo(e,t);let o=this.data().minMaxOnRangeCached(e,t,n.fields);if(o=(0,w.mergeMinMax)(n.baseValueMinMax,o),n.useMainSeriesRange){const i=[{name:"low",offset:0},{name:"high",offset:0}],s=this.series().data().bars().minMaxOnRangeCached(e,t,i);o=(0,w.mergeMinMax)(o,s)}if(null!==o&&(i=new C.PriceRange(o.min,o.max)),s.bands)for(let e=0;e<s.bands.length;e++){const t=(0,r.ensureDefined)(this._properties.childs().bands.childs()[e]).childs();if(t.visible.value()){const e=t.value.value();if(!(0,B.isNumber)(e))continue;i?i.apply(e,e):i=new C.PriceRange(e,e)}}{const s=(0,z.studyGraphicsPriceRange)(this,e,t);s&&(i=i?i.merge(s):s)}return this._postProcessPriceRange(i)}autoScaleInfo(e,t){const i=this.priceRange(e,t),s=(0,z.studyGraphicsPixelsMargins)(this,e,t);return{range:i,topPixelMargin:s.topPixelMargin,bottomPixelMargin:s.bottomPixelMargin}}formatter(){return this._formatter?this._formatter:this._firstSourceOrSeries().formatter(!1)}updateAllViews(e){var t,i,s,n,r;this._paneViews.forEach((t=>t.update(e))),this._labelPaneViews.forEach((t=>t.update(e))),null===(t=this._dataWindowView)||void 0===t||t.update(),null===(i=this._legendView)||void 0===i||i.update(),null===(s=this._statusView)||void 0===s||s.update(),this._priceAxisViews.forEach((t=>t.update(e))),this._priceLinesAxisViews.forEach((t=>t.update(e))),null===(n=this._inputsLinesPaneView)||void 0===n||n.update(e),null===(r=this._inputsAnchorsPaneView)||void 0===r||r.update(e),this._inputsTimeAxisPaneViews.forEach((t=>t.update(e))),this._inputsPriceAxisPaneViews.forEach((t=>t.update(e)))}getStudyName(){return this._studyName}getMinFirstBarIndexForPlot(e){var t,i,s,n,r,o,l,a,u,d,c,h,p,_,y;const S=this._properties.childs(),f=this._metaInfo,m=null!==(y=null!==(h=null!==(u=null!==(o=null!==(s=null===(i=null===(t=S.styles.childs()[e])||void 0===t?void 0:t.child("showLast"))||void 0===i?void 0:i.value())&&void 0!==s?s:null===(r=null===(n=S.filledAreasStyle.childs()[e])||void 0===n?void 0:n.child("showLast"))||void 0===r?void 0:r.value())&&void 0!==o?o:null===(a=null===(l=f.styles)||void 0===l?void 0:l[e])||void 0===a?void 0:a.showLast)&&void 0!==u?u:null===(c=null===(d=S.ohlcPlots.childs()[e])||void 0===d?void 0:d.child("showLast"))||void 0===c?void 0:c.value())&&void 0!==h?h:null===(_=null===(p=f.ohlcPlots)||void 0===p?void 0:p[e])||void 0===_?void 0:_.showLast)&&void 0!==y?y:null;if(null===m)return-1/0;const g=this.data().lastIndex();return null===g?-1/0:g-m+1}guiPlotName(e){var t,i,s
;return null!==(s=null===(i=null===(t=this._metaInfo.styles)||void 0===t?void 0:t[e])||void 0===i?void 0:i.title)&&void 0!==s?s:this.title()}childStudyByRebind(){return this._childStudyByRebind}isPine(){return void 0!==this._metaInfo.pine}isStandardPine(){return this.isPine()&&T.StudyMetaInfo.isStandardPine(this._metaInfo.id)}isLinkedToSeries(){return!0===this._metaInfo.linkedToSeries}defaultPlotIdForAlert(){return this._metaInfo.plots.length?this._metaInfo.plots[0].id:null}resolvedSymbolInfoBySymbol(e){return this._resolvedSymbols&&e&&this._resolvedSymbols[this._getSymbolForResolve(e)]||null}currency(){const e=this.metaInfo();return Boolean(e)&&e.is_price_study?this._firstSourceOrSeries().currency():null}currencySourceSymbolInfo(){var e,t,i;return null!==(e=this._currencySourceSymbolInfo)&&void 0!==e?e:null!==(i=null===(t=this.symbolSource())||void 0===t?void 0:t.symbolInfo())&&void 0!==i?i:null}unit(){const e=this.metaInfo();return Boolean(e)&&e.is_price_study?this._firstSourceOrSeries().unit():null}dataWindowView(){return this._dataWindowView}statusView(){return this._statusView}legendView(){return this._legendView}inputsForAlertState(){return this.inputs()}sessionId(){return this._firstSourceOrSeries().sessionId()}sessionIdChanged(){return this._firstSourceOrSeries().sessionIdChanged()}getSymbolString(e){return""===e?"":(0,M.encodeExtendedSymbolOrGetSimpleSymbolString)(this._getSymbolObject(e))}onStatusChanged(){return this._statusChanged}symbolsResolved(){return this._symbolsResolved}onHibernationStateChange(){return this._onHibernationStateChange}valuesProvider(){return new D.StudyLegendValuesProvider(this,this.model())}statusProvider(e){return new R.StudyStatusProvider(this,this._model.properties().childs().scalesProperties.childs().textColor)}correctScaleMargins(e){if("Volume"===this.metaInfo().shortId){const t=this.model().paneForSource(this);return null!==t&&t.isOverlay(this)&&t.containsMainSeries()?{top:.75,bottom:0}:{top:e.top,bottom:0}}return e}canBeHiddenByGlobalFlag(){return!0}isSourceHidden(){return!this.isVisible()||this.canBeHiddenByGlobalFlag()&&V.hideAllIndicators().value()}paneViews(e){if(this.isSourceHidden()||!e.hasPriceDataSource(this))return null;const t=[];return!this._startMovingPoint&&this._wasCompletedBefore&&t.push(...this._paneViews),this._inputsLinesPaneView&&(this._startMovingPoint||this._model.selection().isSelected(this))&&t.push(this._inputsLinesPaneView),this._inputsAnchorsPaneView&&t.push(this._inputsAnchorsPaneView),t}labelPaneViews(){return this.isSourceHidden()?null:this._labelPaneViews}timeAxisViews(){return this._model.selection().isSelected(this)?this._inputsTimeAxisPaneViews:null}priceAxisViews(e,t){const i=this._properties.childs().oldShowLastValue;if(i&&!i.value())return null;let s=this._priceAxisViews.slice();return this._model.selection().isSelected(this)&&(s=s.concat(this._inputsPriceAxisPaneViews)),e.findTargetPriceAxisViews(this,t,s,this._priceLinesAxisViews)}movable(){return null!==this._inputsAnchorsPaneView}startMoving(e,t,i,s){this._startMovingPoint=e,
this.stop()}move(e,t,i,s){if(void 0!==e.logical&&null!==this._startMovingPoint){if(Array.isArray(t)){const i=t;this._updateInputValue(e.logical,i[0]),this._updateInputValue(e.logical,i[1])}else this._updateInputValue(e.logical,t);this.updateAllViews((0,ce.sourceChangeEvent)(this.id()))}}endMoving(e,t){return this._startMovingPoint=null,this.start(),{indexesChanged:!1,pricesChanged:!1}}clearData(){var e;this._invalidateLastNonEmptyPlotRowCache(),this.data().clear(),this._graphics instanceof I.LiveStudyGraphics&&(null===(e=this._graphics)||void 0===e||e.clear()),this._plotOffsets={},this.hasBarColorer()&&this._model.mainSeries().invalidateBarStylesCache(),this.updateAllViews((0,ce.sourceChangeEvent)({sourceId:this.id(),clearData:!0}))}convertYCoordinateToPriceForMoving(e,t){const i=this.priceScale();if(!t||!i||i.isEmpty())return null;const s=t.firstValue();return null===s?null:i.coordinateToPrice(e,s)}processHibernate(e){const t=this.isVisible();if(!this.isStarted()&&t&&(this._sources.forEach((e=>{e.processHibernate()})),this.start(void 0,void 0,e),this._onHibernationStateChange.fire(!1)),this.isHibernationAllowed()&&this.isStarted()&&!t){for(const e of this._children)e.processHibernate();this.stop(void 0,e),this._onHibernationStateChange.fire(!0)}}isHibernationAllowed(){return!this.metaInfo().historyCalculationMayChange&&(!this.hasChildren()||!!this._model.collapsed().value()&&this._children.every((e=>e.isHibernationAllowed())))}isPlotVisibleAt(e,t){let i;const s=this.metaInfo().plots.find((t=>t.id===e));if(i=void 0!==s?(0,H.isOhlcPlot)(s)?this._properties.childs().ohlcPlots.childs()[s.target]:this._properties.childs().styles.childs()[e]:this._properties.childs().ohlcPlots.childs()[e],void 0===i)throw new Error(`Study does not contain ${e} plot`);const n=i.childs().display.value();return null!==n&&(n&t)===t}recalculate(){const e=this._model.paneForSource(this);this._model.recalculatePane(e,(0,ce.sourceChangeEvent)(this.id())),this._model.updateSource(this)}maxOffset(){return this._maxOffset}onStart(){return this._onStart}isHibernated(){return!this.isVisible()&&!this.isStarted()}turnaround(e){if(!e)return this._turnaround;const t=this._series.seriesSource().turnaround(),i=(0,W.buildTreeForStudy)(this);return(0,W.buildTurnaround)(t,i)}canHaveChildren(){var e;return this._canHaveChildren=null!==(e=this._canHaveChildren)&&void 0!==e?e:T.StudyMetaInfo.canHaveChildren(this._metaInfo),this._canHaveChildren}setChild(e){-1===this._children.indexOf(e)&&this._children.push(e)}unsetChild(e){const t=this._children.indexOf(e);~t&&this._children.splice(t,1)}getAllChildren(){const e=this._children.slice();for(let t=0;t<e.length;++t){const i=e[t].getAllChildren();for(let t=0;t<i.length;++t)~e.indexOf(i[t])||e.push(i[t])}return e}parentSourceForInput(e){var t;if(e.includes("$")){const i=e.split("$")[0];return null!==(t=this._sources.find((e=>e.id()===i)))&&void 0!==t?t:null}return this._series}priceStep(){return this._priceStep||this._firstSourceOrSeries().priceStep(!1)}_incrementTurnaround(){
this._turnaround="st"+ ++this._turnaroundCounter}_checkTurnaround(e){return e===this._turnaround||e===this._model.mainSeries().seriesSource().turnaround()||e===this.turnaround(!0)}_createStudyOnServer(){if(this._isDestroyed)return;const e=this._getStudyIdWithLatestVersion();this._studyId=(0,O.makeNextStudyId)(),this._incrementTurnaround(),this._studyName=e;const t=(0,B.clone)((0,r.ensureDefined)(this._inputs));T.StudyMetaInfo.patchSoSInputs(t,(e=>{var t,i;return null!==(i=null===(t=this._sources.find((t=>t.id()===e)))||void 0===t?void 0:t.sourceId())&&void 0!==i?i:null})),Ee?this._chartApi.createStudy(this._studyId,this._turnaround,(0,r.ensureNotNull)(this._series.seriesSource().instanceId()),this._studyName,t,this._handler,this.isChildStudy()):this._chartApi.createStudy(this._studyId,this._turnaround,this.isChildStudy()?(0,r.ensureNotNull)(this._sources[0].sourceId()):(0,r.ensureNotNull)(this._series.seriesSource().instanceId()),this._studyName,t,this._handler,this.isChildStudy()),this._deferredPinePatchProps&&this._pinePatchPropsAllowed()&&this._pinePatchProps()}_stopStudyOnServer(){this._chartApi&&this._chartApi.isConnected().value()&&this.isStarted()&&(this._chartApi.removeStudy((0,r.ensureNotNull)(this._studyId),this.isChildStudy()),this._setStatus({type:ae.StudyStatusType.Undefined})),this._studyId=null}_modifyStudyOnServer(e,t){const i=(0,B.clone)((0,r.ensureDefined)(e));T.StudyMetaInfo.patchSoSInputs(i,(e=>{var t,i;return null!==(i=null===(t=this._sources.find((t=>t.id()===e)))||void 0===t?void 0:t.sourceId())&&void 0!==i?i:null})),this._chartApi.modifyStudy((0,r.ensureNotNull)(this._studyId),this._turnaround,i,this._handler,t)}_transformData(e){}_updateMaxOffsetValue(){let e=-1/0;for(const t of this._metaInfo.plots)e=Math.max(this.offset(t.id),e);this._maxOffset.setValue(e)}_rightOffsetToUnixTime(e){if(this._series.bars().size()>=e){const t=(0,r.ensureNotNull)(this._series.bars().lastIndex())-e;return(0,r.ensureNotNull)(this._series.bars().valueAt(t))[0]}return null}_invalidateLastNonEmptyPlotRowCache(){this._lastNonEmptyPlotRowCache={}}_collectDepsForAlert(){const e=[this,...this._getAllOwnerSources().filter((e=>e instanceof $e))];return(0,_.collectDepsForAlert)(e)}_allInputsAreValid(){for(const e of this._metaInfo.inputs)if("bar_time"===e.type){const t=e.id;if(null==this._properties.childs().inputs.childs()[t].value())return!1}return!0}_startAfterSymbolsResolved(e,t){if(this.isStarted()&&!this._restarting)return;if(!this._sources.some((e=>!(e.isStarted()&&!e.isRestarting())&&(e.onStart().subscribe(this,this._startAfterSymbolsResolved,!0),!0)))&&(this._restarting=!1,this._allInputsAreValid()&&(this._inputs=this._apiInputs(),this._createStudyOnServer(),this._subscribeToSessionId(),this._onStart.fire(),!0===e&&this._children)))for(const e of this._children)e.start(!0,t)}_changeInputsImpl(e,t){var s;const n=this._calcSources();let l=!0;const a=Ye(this._metaInfo,e,t);if(Ee||n.length===this._sources.length&&n[0]===this._sources[0]){
if(this.isStarted()&&this._chartApi.isConnected().value()&&a>0&&!this._chartApi.canCreateStudy(!0)){const s=window.user.pro_plan;(0,S.createGoProDialog)({feature:"studyOnStudy",actions:s&&[m.ProPlans.ProPremium,m.ProPlans.ProPremiumTrial].includes(s)?[{text:o.t(null,void 0,i(875139)),action:f.PredefinedAction.Close}]:void 0});for(const i of this._metaInfo.inputs){if("source"!==i.type)continue;const s=e[i.id].v,n=t[i.id].v;if(s!==n){(0,r.ensureDefined)(this._properties.childs().inputs.child(i.id)).setValue(n)}}return}this._inputs=e;let s=!1;const l=Object.values(G.RangeDependentStudyInputNames);for(const i of Object.keys(e))if(JSON.stringify(e[i])!==JSON.stringify(t[i])&&!l.includes(i)){s=!0;break}this._incrementTurnaround(),s&&this.disablePriceRangeReady(),this._updateParentSources(n,a),this._modifyStudyOnServer(e,a)}else l=this._rebindToSourceOrRestorePreviousValue(null!==(s=n[0])&&void 0!==s?s:this._series,e,t),l&&(this._inputs=e);this.invalidateTitleCache(),l&&(this._studyModified=l)}createPriceAxisView(e){return new ye.StudyPriceAxisView(this,{plotIndex:e})}createPriceLineAxisView(e){return new Se.StudyPriceLineAxisView(this,e)}_createStudyPlotPaneView(e){return new ee.StudyPlotPaneView(this,this._series,this._model,e)}_createViews(){var e,t,i,s;this._priceAxisViewsBase=[],this._priceLinesAxisViews=[],this._paneViews=[],this._labelPaneViews=[];const n=new Set,o=this.metaInfo(),l=Boolean(o.usePlotsZOrder),a=new Map,u=this._properties.childs();if(u.filledAreasStyle&&o.filledAreas)for(let e=0;e<o.filledAreas.length;++e){const t=o.filledAreas[e],i=(0,r.ensureDefined)(u.filledAreasStyle.childs()[t.id]),s=Ne(o,t.id);let n;if("plot_plot"===t.type||s?n=new se.PlotFillPaneView(this,this.model(),t,i):"hline_hline"===t.type?n=new le.HlineFillPaneView(this,t,i):xe.logWarn("Unsupported filledArea type: "+t.type),void 0!==n){const e=l?(0,r.ensureDefined)(t.zorder):a.size;Fe(e,a),a.set(e,{paneViews:[n]})}}{let s=-1e5;for(let u=0;u<o.plots.length;u++){const d=o.plots[u];let c,h,p,_,y;if((0,H.isNonVisualPlot)(d))continue;let S=d.id,f=o.styles;const m=(0,H.isBgColorerPlot)(d);if(m)c=new $.StudyBackgroundPaneView(this,this._series,this._model,S);else if((0,H.isShapesPlot)(d))c=new K.StudyPlotShapesPaneView(this,this._series,this._model,S);else if((0,H.isCharsPlot)(d))c=new X.StudyPlotCharsPaneView(this,this._series,this._model,S);else if((0,H.isArrowsPlot)(d))c=new J.StudyPlotArrowsPaneView(this,this._series,this._model,S);else if((0,H.isOhlcPlot)(d)){const e=d.target;if(n.has(e))continue;if(n.add(e),De(o,u))c=new q.StudyPlotBarsPaneView(this,this._series,this._model,e);else{if(!Re(o,u)){xe.logError(`plot ${d.id} looks to be invalid`);continue}c=new Z.StudyPlotCandlesPaneView(this,this._series,this._model,e)}_=this.createPriceAxisView(e),p=new Q.PanePriceAxisView(_,this,this._model),S=e,f=o.ohlcPlots}else(0,H.isDataPlot)(d)||(_=this.createPriceAxisView(S),y=this.createPriceLineAxisView(S),c=this._createStudyPlotPaneView(S),
(null===(t=null===(e=this._properties.childs().styles.childs()[S])||void 0===e?void 0:e.child("trackPrice"))||void 0===t?void 0:t.value())&&(h=new te.StudyTrackPricePaneView(this,S)),p=new Q.PanePriceAxisView(_,this,this._model));const g=l?m?s++:(0,r.ensureDefined)(null===(i=null==f?void 0:f[S])||void 0===i?void 0:i.zorder):a.size;Fe(g,a);const v={paneViews:void 0!==c?[c]:[],labelView:p,priceAxisView:_,priceLineAxisView:y};void 0!==h&&v.paneViews.push(h),a.set(g,v)}}(null!==(s=this._metaInfo.bands)&&void 0!==s?s:[]).forEach(((e,t)=>{const i=u.bands.childs()[t];if(i&&i.childs().visible.value()){const t=new re.BandPaneView(i,this),s=l?(0,r.ensureDefined)(e.zorder):a.size;Fe(s,a),a.set(s,{paneViews:[t]})}})),u.bandsBackground&&((0,r.assert)(!l,"'usePlotsZOrder' flag does not supported"),a.set(a.size,{paneViews:[new oe.BandBackgroundPaneView(this)]}));const d=this._paneViews;this._createGraphicsPaneViews().then((e=>{for(let t=0;t<e.length;t++)d.push(e[t]);this._model.lightUpdate()})),u.areaBackground&&((0,r.assert)(!l,"'usePlotsZOrder' flag does not supported"),a.set(a.size,{paneViews:[new ie.AreaBackgroundPaneView(this,this.model())]}));const c=Array.from(a.keys()).sort(((e,t)=>e-t));for(let e=0;e<c.length;e++){const t=(0,r.ensureDefined)(a.get(c[e]));this._paneViews.push(...t.paneViews),t.labelView&&this._labelPaneViews.push(t.labelView),t.priceAxisView&&this._priceAxisViewsBase.push(t.priceAxisView),t.priceLineAxisView&&this._priceLinesAxisViews.push(t.priceLineAxisView)}this._dataWindowView||(this._dataWindowView=new ne.StudyDataWindowView(this,this._model)),this._legendView||(this._legendView=new x.StudyLegendView(this,this._model)),this._statusView||(this._statusView=new E.StudyStatusView(this)),this._concatPriceAxisViews()}_concatPriceAxisViews(){this._priceAxisViews=[...this._priceAxisViewsBase,...this._graphicsPriceAxisViews]}onData(e){switch(e.method){case"study_loading":this._onStudyLoading();break;case"study_error":this._onStudyError(e.params[2]);break;case"study_completed":if(!this._checkTurnaround(e.params[1]))return;this._onStudyCompleted(e.params[e.params.length-1]);break;case"data_update":if(e.params.customId!==this.sourceId()||!this._checkTurnaround(e.params.turnaround))return;(0,r.assert)(!!e.params.nonseries,"data.params.nonseries is missing"),this._onDataUpdate(e.params.plots,(0,r.ensureDefined)(e.params.nonseries),e.params.lastBar);break;case"clear_data":this._checkTurnaround(e.params.turnaround)&&this.clearData()}}_onStudyLoading(){var e;this._setStatus({type:ae.StudyStatusType.Loading,startTime:Date.now()}),null===(e=this._statusView)||void 0===e||e.update(),this._model.updateSource(this)}_getTelemetryObjectName(){return"study"}_handleStudyError(e){var t,i,s;this.clearData(),this._setStatus(e);{const s=(0,ae.convertStudyStatusToString)(e),n=this._getTelemetryAdditionalData(),r=s.indexOf("Command info");n.reason=r>=0?s.slice(0,r).trim():s
;if(!/study in error state|the data vendor doesn\'t provide volume data for this symbol.|error in series|unsupported resolution/gi.test(null!==(i=null===(t=n.reason)||void 0===t?void 0:t.toLowerCase())&&void 0!==i?i:"")){const e=this._getTelemetryObjectName();this._sendTelemetryCounter(e+"_error",n)}}null===(s=this._statusView)||void 0===s||s.update(),this._model.updateSource(this)}_onStudyError(e){const t="string"==typeof e?{error:this._getStudyErrorText(e)}:e;this._handleStudyError({type:ae.StudyStatusType.Error,errorDescription:t}),this._enablePriceRangeReady()}_onStudyCompleted(e){var t;this._studyModified&&(this.clearData(),this._studyModified=!1),this._sendTelemetryCounter(this._getTelemetryObjectName()+"_loaded"),this._setStatus({type:ae.StudyStatusType.Completed}),null===(t=this._statusView)||void 0===t||t.update();const i=this._model.paneForSource(this);this._model.recalculatePane(i,(0,ce.sourceChangeEvent)(this.id())),this._updateSources();const s=de.InvalidationMask.full();null!==this._model.appliedTimeFrame().value()&&s.lockVisibleTimeRangeOnResize(),this._model.invalidate(s)}_onDataUpdated(e,t,i,s){if(this.hasBarColorer()&&e.length>0){const t=(0,r.ensureNotNull)(this.barColorer()).firstColoredBar(e[0].index);this._model.mainSeries().invalidateBarStylesCache(t)}null!==t&&this._postProcessGraphics();const n=this._model.paneForSource(this);this._model.recalculatePane(n,(0,ce.sourceChangeEvent)({sourceId:this.id(),firstUpdatedTimePointIndex:null!=s?s:void 0})),this._updateSources()}_updateSources(){this._model.updateSource(this),this.hasBarColorer()&&this._model.updateSource(this._model.mainSeries())}_titleInputs(e,t){return this.inputs(this._titleInputsOptions(e,t))}_titleInputsOptions(e,t){return{symbolsForDisplay:!0,skipHiddenInputs:!0,skipFakeInputs:!1,fakeInputsForDisplay:!0,asObject:!1,skippedGroups:[],noExchanges:e,noResolution:t,skipColorInputs:!0,skipTimeInputs:!0,priceInputsForDisplay:!0,skipOptionalEmptySymbolInputs:ke}}_postProcessGraphics(){this._graphicsPriceAxisViews=this._createGraphicsPriceAxisViews(),this._concatPriceAxisViews()}async _createGraphicsPaneViews(){return(0,I.createGraphicsPaneViews)(this,this.model())}_createGraphicsPriceAxisViews(){return(0,I.createGraphicsPriceAxisViews)(this)}_subscribeToSessionId(){!this._isSubscribedToSessionId&&this.hasSymbolInputs()&&(this.sessionIdChanged().subscribe(this,this._onSessionIdChanged),this._isSubscribedToSessionId=!0)}_unsubscribeToSessionId(){this._isSubscribedToSessionId&&(this.sessionIdChanged().unsubscribe(this,this._onSessionIdChanged),this._isSubscribedToSessionId=!1)}_onSessionIdChanged(){this.restart(!0)}_recreateFormatter(){this._formatter=this._tryCreateFormatter(),this._formatterChanged.fire();const e=this.priceScale();null!==e&&e.updateFormatter(),this._model.fullUpdate()}_recreatePriceStep(){var e;let t=null;const i=null!==(e=this._priceScaleByProperties())&&void 0!==e?e:this._priceScaleByMetaInfo();null!==i&&(t=1/i),this._priceStep!==t&&(this._priceStep=t,this._priceStepChanged.fire())}_recreatePriceFormattingDependencies(){
this._recreateFormatter(),this._recreatePriceStep()}_title(e,t,i,s){const n=this._titleInParts(e,t,i,s);return this._joinTitlesParts(n)}_formatterByProperties(){const e=this.metaInfo().format,t=this._priceScaleByProperties();if(null!==t)switch(e.type){case"inherit":case"price":return new Ie.PriceFormatter(t);case"volume":return new Ae.VolumeFormatter(Math.log10(t));case"percent":return new Le.PercentageFormatter(t)}return null}_formatterByMetaInfo(){const e=this.metaInfo().format;if("inherit"===e.type)return null;const t=this.series().symbolInfo(),i=(0,B.isNumber)(e.precision)?Math.pow(10,e.precision):void 0;switch(e.type){case"price":return new Ie.PriceFormatter(i);case"volume":{let i=e.precision;return void 0===i&&(i=t&&(0,B.isNumber)(t.volume_precision)?t.volume_precision:0),new Ae.VolumeFormatter(i)}case"percent":return new Le.PercentageFormatter(i);default:return xe.logWarn(`Unsupported format type: ${e.type}`),null}}_postProcessPriceRange(e){if(e&&e.minValue()===e.maxValue()&&!this.metaInfo().is_price_study){const t=.005*e.minValue();e=new C.PriceRange(e.minValue()-t,e.maxValue()+t)}const t=this.priceScale();return t&&t.isLog()&&e?new C.PriceRange(t.priceToLogical(e.minValue()),t.priceToLogical(e.maxValue())):e}_joinTitlesParts(e){const t=e[1]?e[1].join(", "):"";return e[0]+(t.length>0?" ("+t+")":"")}_titleInParts(e,t,s,n){var l;const a=this.name(e);t=t||{};const u=[o.t(a,{context:"study"},i(168716))];let d=[];if(!s){const i=this._getMTFResolutionInputTitle();null!==i&&i.length>0&&u.push(i);const s=this.metaInfo(),o=this._titleInputs(n,!0)||[];if(o.length>0){const i={};if(this.isChildStudy())for(let t=0;t<s.inputs.length;++t){const o=s.inputs[t];if(!T.StudyMetaInfo.isSourceInput(o))continue;const a=o.id,u=(0,r.ensureDefined)(this._properties.childs().inputs.child(a)).value();if(u.indexOf("$")>=0){const t=this.parentSourceForInput(u);if(t instanceof $e){const s=t.metaInfo(),r=t.title(e,{},!0,n);if(1===s.plots.length)i[u]=r;else{const e=u.split("$")[1],t=null===(l=s.plots[parseInt(e)])||void 0===l?void 0:l.id,n=s.styles&&s.styles[t],o=n&&n.title||t;i[u]=r+": "+o}}}}d=o.map((e=>{let s=(0,B.isNumber)(e)?this._numericFormatter.format(e):i&&i[e.toString()]||e.toString();return t&&t[s.toString()]&&(s=t[s.toString()]),s}))}}return[u.join(" · "),d]}_getMTFResolutionInputTitle(){const e=this.metaInfo();for(let t=0;t<e.inputs.length;t++){const i=e.inputs[t];if("resolution"===i.type&&i.isMTFResolution)return(0,r.ensureDefined)(this._properties.childs().inputs.child(i.id)).value()}return null}_seriesDataRangeToSave(e){return this._model.timeScale().visibleExtendedDataRange(e,0)}_hasAvailableAlertPlots(){const e=this.stateForAlert(),t=c.alertBandFactory.create(e).getPlots();return null!=t&&t.length>0}_hasAlertablePlots(){return(this.metaInfo().plots||[]).some((e=>"line"===e.type))}_hasAlertConditions(){if(this.metaInfo().plots.some(H.isAlertConditionPlot))return!0;const e=this.stateForAlert();return Boolean(e.alerts&&e.alerts.conditions)}_hasAlertFunction(){const e=this.metaInfo();return Boolean(e.hasAlertFunction)}
_onDataUpdate(e,t,i){this._studyModified&&(this.clearData(),this._studyModified=!1);const s=(0,b.unpackNonSeriesData)(t.d);return this._ongoingDataUpdate=this._ongoingDataUpdate.then((()=>s),(()=>s)).then(this._onDataUnpacked.bind(this,e,t.indexes,i)),this._ongoingDataUpdate}_mergeData(e){return this._invalidateLastNonEmptyPlotRowCache(),this.data().merge(e)}_getSymbolForResolve(e){return this.getSymbolString(this._getSymbolForApi(e))}_allSymbolsAreResolved(){const e=this.metaInfo(),t=[];let i=!1;for(let s=0;s<e.inputs.length;s++)if("symbol"===e.inputs[s].type){const n=e.inputs[s].id,o=(0,r.ensureDefined)(this._properties.childs().inputs.child(n)).value(),l=this._getSymbolForResolve(o);if(""!==l)if(this._resolvedSymbols[l])i=!0;else{const e=this._resolveSymbol(l,o);t.push(e)}}if(0===t.length){const e=Promise.resolve();return i?e.then((()=>this._symbolsResolved.fire())):e}return Promise.all(t).catch((e=>(this._setStatus({type:ae.StudyStatusType.Error,errorDescription:{error:Ve}}),this.stop(!0),this._model.updateSource(this),Promise.reject("Invalid symbol, "+e)))).then((()=>{null!==this._studyId&&this.stop(!0),this.start(!0),this._symbolsResolved.fire(),this._recheckLineToolsActuality()}))}_getSymbolForApi(e){return e}_resolveSymbol(e,t){if(""===e)return Promise.resolve();let i=this._pendingResolveSymbols.get(e);return void 0!==i||(i=new Promise(((i,s)=>{this._onSymbolResolvingStart(),this._chartApi.resolveSymbol((0,O.makeNextSymbolId)(),e,(n=>{switch(this._pendingResolveSymbols.delete(e),n.method){case"symbol_resolved":this._setStatus({type:ae.StudyStatusType.Undefined}),this._resolvedSymbols[e]=n.params[1],this._resolvedSymbolsByInput[t]=n.params[1],this._onSymbolResolved(e,t,n.params[1]),this.invalidateTitleCache(!0),i();break;case"symbol_error":if(this._setStatus({type:ae.StudyStatusType.Error,errorDescription:{error:n.params[1]}}),this._onSymbolError(),n.params[1]===k.permissionDenied&&n.params[2]){if(n.params[2]!==k.SymbolErrorPermissionDeniedReason.Symbol)return void this._resolveSymbol(n.params[2],t).then(i);if(n.params[3])return void this._resolveSymbol(n.params[3],t).then(i)}this._sendTelemetryCounter("symbol_error",Object.assign(this._getTelemetryAdditionalData(),{symbol:e,reason:n.params[1]})),s()}}))})),this._pendingResolveSymbols.set(e,i)),i}_recheckLineToolsActuality(){const e=this._model.paneForSource(this);null!==e&&e.sourcesByGroup().lineSourcesForAllSymbols().forEach((e=>{e.ownerSource()===this&&e.calcIsActualSymbol()}))}_getSymbolObject(e){const t={symbol:e},i=this.currency();return null!==this._currencySourceSymbolInputProperty&&null!==this._currencySourceSymbolInfo&&this._getSymbolForApi(this._currencySourceSymbolInputProperty.value())===e&&(t["currency-id"]=i),t.session=this.sessionId(),t}_onSymbolResolved(e,t,i){{const e=(0,r.ensureNotNull)(this._model.alertsWatcher());e.syncSourceAlertLabels(this);const t=this.getAllChildren();for(const i of t)e.syncSourceAlertLabels(i)}this._onCurrencyMayChange()}_onSymbolResolvingStart(){}_onSymbolError(){}_setStatus(e,t){var i;this._status=e,
e.type===ae.StudyStatusType.Completed?this._wasCompletedBefore=!0:e.type!==ae.StudyStatusType.Error&&e.type!==ae.StudyStatusType.Undefined||(this._wasCompletedBefore=!1),t||(null===(i=this._statusView)||void 0===i||i.update(),this._model.updateSource(this),this._statusChanged.fire(e))}_onPropertiesChanged(){this._restarting||(this._inputs?this._tryChangeInputs():this._chartApi&&this._chartApi.isConnected().value()&&this.restart()),this._metaInfo.isTVScript&&this._metaInfo.TVScriptMetaInfoExprs&&(this._pinePatchPropsAllowed()?this._pinePatchProps():this._deferredPinePatchProps=!0),this._recreatePaneViews(),(0,me.emit)("study_properties_changed",this._id)}_bandsFirstValue(e){const t=this._metaInfo;if(!t.bands)return null;for(let i=0;i<t.bands.length;i++){const t=(0,r.ensureDefined)(this._properties.childs().bands).childs()[i];if(t.childs().visible.value()){const i=t.childs().value.value();if(e&&0===i)continue;return i}}return null}_prepareInputs(e){(0,r.assert)(!!e,"options not set");const t=this.metaInfo(),i={},s=e.allowedInputTypes?new Set(e.allowedInputTypes):null;for(let n=0;n<t.inputs.length;n++){const r=t.inputs[n];if(null!==s&&!s.has(r.type))continue;if(r.isFake&&e.skipFakeInputs)continue;if(r.isMTFResolution&&e.noResolution)continue;if(e.skipHiddenInputs){let t=!1;switch(r.type){case"bool":t=e.skipBooleanInputs;break;case"color":t=e.skipColorInputs;break;case"time":t=e.skipTimeInputs;break;case"text_area":t=e.skipTextareaInputs;break;default:t=Boolean(r.isHidden)}if(t)continue}if(void 0!==r.groupId&&-1!==e.skippedGroups.indexOf(r.groupId))continue;if(-1!==e.skippedInputs.indexOf(r.id))continue;const o=this._prepareInput(r,e);"symbol"===r.type&&e.skipOptionalEmptySymbolInputs&&""===o||(i[r.id]=(0,B.clone)(o))}return i}_getAllOwnerSources(){const e=[];let t=this.ownerSource();for(;null!==t;)e.push(t),t=t.ownerSource();return e}_getStudyIdWithLatestVersion(){return T.StudyMetaInfo.getStudyIdWithLatestVersion(this.metaInfo())}_lastNonEmptyPlotRow(e){var t;if(!(0,B.isInteger)(e))return xe.logDebug("_lastNonEmptyPlotRow: incorrect plotIndex"),null;let i=null!==(t=this._lastNonEmptyPlotRowCache[e])&&void 0!==t?t:null;if(null!==i)return i;return i=this.data().findLast(((t,i)=>void 0!==i[e]),1e3),null===i?null:(this._lastNonEmptyPlotRowCache[e]=i,i)}_onCurrencyChanged(){"alwaysOff"!==(0,_e.currencyUnitVisibilityProperty)().value()&&this._model.fullUpdate(),this.isStarted()&&this._tryChangeInputs(),this._currencyChanged.fire()}_apiInputs(){return this.inputs({keepOptionalSymbolsEmpty:!0})}_tryChangeInputs(){var e;const t=this.isStarted()&&this._chartApi.isConnected().value();if(t&&this._allInputsAreValid())this._allSymbolsAreResolved().then((()=>{const e=this._apiInputs(),t=JSON.stringify(e)!==JSON.stringify(this._inputs);this._isStopped()?t&&this.disablePriceRangeReady():t&&(this._changeInputsImpl(e,(0,r.ensureDefined)((0,B.clone)(this._inputs))),(0,r.ensureNotNull)(this.model().alertsWatcher()).syncSourceAlertLabels(this))})).catch((e=>{xe.logError("ERROR: "+this._debugId()+" _tryChangeInputs: cannot modify study, "+e)
}));else{t&&this.stop(!0);const i=this._apiInputs(),s=(0,r.ensureDefined)((0,B.clone)(this._inputs));if(JSON.stringify(i)!==JSON.stringify(this._inputs)){const t=this._calcSources();if(Ee||t.length===this._sources.length&&t[0]===this._sources[0]){const e=Ye(this._metaInfo,i,s);this._updateParentSources(t,e)}else this._rebindToSourceOrRestorePreviousValue(null!==(e=t[0])&&void 0!==e?e:this._series,i,s);this._inputs=i}}this._tagsChanged.fire()}_debugId(){const e=[];return this._studyId&&e.push(this._studyId),e.push(this._metaInfo.fullId),e.push(this._metaInfo.description),JSON.stringify({study:e})}_onCurrencyMayChange(){if(null!==this._currencySourceSymbolInputProperty){const e=this.currency();this._updateCurrencySourceSymbolInfo(),e!==this.currency()&&this._onCurrencyChanged()}}_fillPrecalculatedAutoscaleInfo(e,t){const i=this._metaInfo,s=this.properties().childs(),n=new Set,r=this._metaInfo.filledAreas||[];for(let e=0;e<r.length;e++){const t=r[e];s.filledAreasStyle.childs()[t.id].childs().visible.value()&&(n.add(t.objAId),n.add(t.objBId))}return i.plots.filter((e=>!(0,H.isPlotWithTechnicalValues)(e))).filter((e=>n.has(e.id)||this.isPlotVisibleAt(e.id,1))).reduce(((i,s)=>this._applyPlotToPrecalculatedAutoscaleInfo(e,t,i,s)),{fields:[],useMainSeriesRange:!1,baseValueMinMax:null})}_firstSourceOrSeries(){var e;return null!==(e=this._sources[0])&&void 0!==e?e:this._series}_skipHistogramBaseOnAutoScale(){return!1}_tryCreateFormatter(){let e=this._formatterByProperties();return null===e&&(e=this._formatterByMetaInfo()),e}_updateParentSources(e,t){if(this._sources.forEach((e=>e.unsetChild(this))),e.forEach((e=>e.setChild(this))),this._sources=e,0!==t&&this._sources.length<=1){const e=this._firstSourceOrSeries(),t=this.m_priceScale,i=(0,r.ensureNotNull)(e.priceScale());if(t!==i){const t=this._model.paneForSource(this),s=(0,r.ensureNotNull)(this._model.paneForSource(e));t===s&&s.move(this,i,!0)}}}_calcSources(){const e=this._properties.childs().inputs.state();return T.StudyMetaInfo.getSourceIdsByInputs(this._metaInfo.inputs,e).map((e=>{if("high"===e||"open"===e||"low"===e||"close"===e||"hl2"===e||"ohl3"===e||"ohlc4"===e)return null;{const t=this._model.allStudies().find((t=>t.canHaveChildren()&&t.id()===e));return null!=t?t:null}})).filter(B.notNull)}_isStopped(){return!this.isStarted()}_onDataUnpacked(e,t,i,s){if(this._isDestroyed)return;"nochange"!==t&&this._processPlotOffsets(s),this._transformData(e);const n=this._mergeData(e);null!==s&&(s.indexes_replace?((0,r.assert)("nochange"!==t),this._graphics.replaceIndexesTo(t)):("nochange"!==t&&this._graphics.replaceIndexesTo(t),void 0!==s.graphicsCmds&&this._graphics.processCommands(s.graphicsCmds,this._metaInfo.graphics))),this._onDataUpdated(e,s,t,n&&n.index),this.priceRangeReady()||this._enablePriceRangeReady(),this._dataUpdated.fire(i,!1,n)}_processPlotOffsets(e){if(e&&e.indexes_replace)return;const t=this._plotOffsets;this._plotOffsets=e&&e.offsets||{},(0,s.default)(t,this._plotOffsets)||this.updateAllViews((0,ce.sourceChangeEvent)({sourceId:this.id(),clearData:!0})),
this._updateMaxOffsetValue()}_applyPlotToPrecalculatedAutoscaleInfo(e,t,i,s){var n;const o=s.id,l=this._properties.childs().styles.childs()[o],a=(0,H.isShapesPlot)(s)||(0,H.isCharsPlot)(s);i.useMainSeriesRange=i.useMainSeriesRange||(0,H.isArrowsPlot)(s);let u=(0,H.isLinePlot)(s)||(0,H.isOhlcPlot)(s);if(a){const e=(0,r.ensureDefined)(l).childs().location.value(),t=[L.MarkLocation.Absolute,L.MarkLocation.Top,L.MarkLocation.Bottom].indexOf(e)<0;i.useMainSeriesRange=i.useMainSeriesRange||a&&t,u=u||e===L.MarkLocation.Absolute}if(!u)return i;const d={name:o,offset:this.offset(o)},c=l.childs().plottype.value();if(!this._skipHistogramBaseOnAutoScale()&&[H.LineStudyPlotStyle.Histogram,H.LineStudyPlotStyle.Columns,H.LineStudyPlotStyle.Area].indexOf(c)>=0){const s=(0,r.ensureDefined)(null===(n=this._metaInfo.styles)||void 0===n?void 0:n[o]).histogramBase,l=this.data().minMaxOnRangeCached(e,t,[d]);return(0,B.isNumber)(s)&&null!==l&&(i.baseValueMinMax=(0,w.mergeMinMax)(i.baseValueMinMax,{min:s,max:s}),i.baseValueMinMax=(0,w.mergeMinMax)(i.baseValueMinMax,l)),i}return i.fields.push(d),i}_onSourceInputChanged(){if(!this.isStarted()){const e=this._calcSources();Ee||e[0]===this._sources[0]||this._rebindToSource(e[0],this._apiInputs())}}_rebindToSourceOrRestorePreviousValue(e,t,i){let s=!0;if(!this._rebindToSource(e,t)){const e=this._properties.childs().inputs.state(),n=T.StudyMetaInfo.getSourceIdsByInputs(this._metaInfo.inputs,e)[0];for(const e of Object.keys(i)){const o=(0,G.getInputValue)(i[e]),l=(0,G.getInputValue)(t[e]);if(i.hasOwnProperty(e)&&o!==l&&n&&(0,B.isString)(l)&&0===l.indexOf(n)){const t=(0,r.ensureDefined)(this._properties.childs().inputs.child(e)),n=(0,G.getInputValue)(i[e]);t.setValue(n),s=!1;break}}}return s}_rebindToSource(e,t){const s=this.isStarted()&&this._chartApi.isConnected().value(),n=this._firstSourceOrSeries();let l;const a=(0,B.clone)((0,r.ensureDefined)(t)),u=e instanceof $e?[e,...this._sources]:this._sources;if(T.StudyMetaInfo.patchSoSInputs(a,(e=>{var t,i;return null!==(i=null===(t=u.find((t=>t.id()===e)))||void 0===t?void 0:t.sourceId())&&void 0!==i?i:null})),this.isChildStudy()){let t;this._sources[0].unsetChild(this);let i=null;if(e===this._model.mainSeries())this._sources=[],this._ownerSource=null,t=this._series.seriesSource().instanceId(),i=2;else{if(!(e instanceof $e))return xe.logError("Unable to rebind study to source of this type"),!1;this._ownerSource=e,this._sources=[e],t=e.sourceId(),e.setChild(this),null===t&&(l=e)}s&&null!==t&&(this._incrementTurnaround(),this.disablePriceRangeReady(),this._chartApi.rebindStudy((0,r.ensureNotNull)(this._studyId),this._turnaround,t,this._studyName,a,this._handler,i))}else{if(!(e instanceof $e))return xe.logError("Unable to rebind study to source of this type"),!1;if(s){if(!this._chartApi.canCreateStudy(!0)){const e=window.user.pro_plan;return(0,S.createGoProDialog)({feature:"studyOnStudy",actions:e&&[m.ProPlans.ProPremium,m.ProPlans.ProPremiumTrial].includes(e)?[{text:o.t(null,void 0,i(875139)),action:f.PredefinedAction.Close}]:void 0}),!1}
const t=e.sourceId();if(null!==t){this._incrementTurnaround(),this.disablePriceRangeReady();const e=this._chartApi.rebindStudy((0,r.ensureNotNull)(this._studyId),this._turnaround,t,this._studyName,a,this._handler,1);(0,r.assert)(e)}else l=e}this._ownerSource=e,this._sources=[e],e.setChild(this),this._childStudyByRebind.fire()}l&&(this.isStarted()&&this.stop(),l.start(!0)),n instanceof $e&&n.processHibernate();const d=this.m_priceScale,c=(0,r.ensureNotNull)(e.priceScale());if(d!==c){const t=this._model.paneForSource(this),i=(0,r.ensureNotNull)(this._model.paneForSource(e));t===i&&i.move(this,c,!0)}const h=this._firstSourceOrSeries();return n.formatterChanged().unsubscribe(this,this._onSourceFormatterChanged),h.formatterChanged().subscribe(this,this._onSourceFormatterChanged),n.priceStepChanged().unsubscribe(this,this._onSourcePriceStepChanged),h.priceStepChanged().subscribe(this,this._onSourcePriceStepChanged),n.currencyChanged().unsubscribeAll(this),h.currencyChanged().subscribe(this,this._onSourceCurrencyChanged),n.unitChanged().unsubscribeAll(this),h.unitChanged().subscribe(this,this._onSourceUnitChanged),n.priceRangeReadyChanged().unsubscribeAll(this),h.priceRangeReadyChanged().subscribe(this,this._onSourcePriceRangeReadyChanged),this._recreatePriceFormattingDependencies(),!0}_buildInputs(e){(0,r.assert)(!!e,"options not set");let t={};try{t=this._prepareInputs(e)}catch(e){xe.logWarn("Failed to prepare study inputs: "+e)}if(e.asObject){const e={};return Object.keys(t).forEach((i=>{null!=t[i]&&(e[i]=t[i])})),e}{const e=[];return Object.keys(t).forEach((i=>{null!=t[i]&&e.push(t[i])})),e}}_prepareInput(e,t){const i=this._prepareInputValue(e,t);return!e.isFake||t.fakeInputsForDisplay||t.onlyAtomValues?i:{v:i,f:!0,t:e.type}}_plotsForAlert(){return(0,_.plotsForAlert)(this.metaInfo(),this.offset.bind(this))}_dependenciesForAlerts(){const e=this._getAllOwnerSources().filter((e=>e instanceof $e));return(0,_.dependenciesForAlerts)(e,this._model.studyMetaInfoRepository())}_calcIsActualInterval(){const e=this._isActualInterval;this._isActualInterval=(0,ue.isActualInterval)(this._series.intervalObj(),this._properties.childs().intervalsVisibilities),e!==this._isActualInterval&&(this._onIsActualIntervalChange.fire(),this._visibleChanged(),this.processHibernate())}_visibleChanged(){this._series.invalidateBarColorerCache()}_getNonPriceParent(){const e=this._sources;for(const t of e)if(t instanceof $e){const e=t.metaInfo();return e.is_price_study&&"Compare@tv-basicstudies"!==e.id?t._getNonPriceParent():t}return null}_updateInputValue(e,t){const i=this._properties.childs().inputs.childs();if(i[t.id])if("price"===t.type)i[t.id].setValue(e.price);else if("time"===t.type){const s=this._model.timeScale().indexToTimePoint(e.index);null!==s&&i[t.id].setValue(1e3*s)}}_initializeStudyInputsPaneViews(){const e=(0,G.editableStudyInputs)(this._metaInfo.inputs);if(0===e.length)return;const t={convertPriceToCoordinate:e=>{const t=this.priceScale();if(null!==t&&!t.isEmpty()){const i=this.firstValue();if(null!==i)return t.priceToCoordinate(e,i)}
return null},formatPrice:e=>{const t=this.priceScale();if(null!==t&&!t.isEmpty()){const i=this.firstValue();if(null!==i)return t.formatPrice(e,i)}return""},getInputValue:e=>{var t,i;return null!==(i=null===(t=this._properties.childs().inputs.child(e))||void 0===t?void 0:t.value())&&void 0!==i?i:null},isSelected:()=>this._model.selection().isSelected(this),isHovered:()=>this===this._model.hoveredSource()};Promise.all([i.e(62183).then(i.bind(i,852482)),i.e(62183).then(i.bind(i,367023)),i.e(62183).then(i.bind(i,212112)),i.e(62183).then(i.bind(i,10463))]).then((i=>{const[s,n,r,o]=i;this._inputsAnchorsPaneView=new s.StudyInputsAnchorsPaneView(e,this._model,t);const l=e.filter((e=>!Array.isArray(e)));this._inputsLinesPaneView=new n.StudyInputsLinesPaneView(l,this._model,t);let a=!1;e.forEach((e=>{if(Array.isArray(e)){const i="time"===e[0].type?e[0]:e[1],s="price"===e[0].type?e[0]:e[1];this._inputsTimeAxisPaneViews.push(new r.StudyInputTimeAxisPaneView(i,this._model,t.getInputValue)),this._inputsPriceAxisPaneViews.push(new o.StudyInputPriceAxisPaneView(s,t)),a=!0}else"time"===e.type?this._inputsTimeAxisPaneViews.push(new r.StudyInputTimeAxisPaneView(e,this._model,t.getInputValue)):(this._inputsPriceAxisPaneViews.push(new o.StudyInputPriceAxisPaneView(e,t)),a=!0)})),a&&this.formatterChanged().subscribe(this,this.invalidateTitleCache)}))}_updateCurrencySourceSymbolInfo(){}_initializeCurrencySource(){var e,t;const i=this.metaInfo(),s="symbolInputSymbolSource"===(null===(e=i.symbolSource)||void 0===e?void 0:e.type)&&(null===(t=i.symbolSource)||void 0===t?void 0:t.inputId),n=i.inputs.find((e=>e.id===s)),r="symbol"===(null==n?void 0:n.type);if("string"==typeof s&&r&&i.is_price_study){const e=this._properties.childs().inputs.childs()[s];void 0!==e&&(e.subscribe(this,this._onCurrencyMayChange),this._currencySourceSymbolInputProperty=e)}}_recreatePaneViews(){this.hasBarColorer()&&this._model.mainSeries().invalidateBarStylesCache(),this._createViews(),this.recalculate(),this.updateAllViews((0,ce.sourceChangeEvent)(this.id()))}_pinePatchPropsAllowed(){return(this.isStarted()||this._metaInfo.inputs.some((e=>"symbol"===e.type)))&&!this._restarting}_pinePatchProps(){this._deferredPinePatchProps=!1;const e=this._prepareInputs({fakeInputsForDisplay:!1,symbolsForDisplay:!1,symbolsForChartApi:!0,skipHiddenInputs:!0,skipFakeInputs:!1,onlyAtomValues:!0,skipBooleanInputs:!1,skipColorInputs:!1,skipTimeInputs:!1,skipOptionalEmptySymbolInputs:!1,skippedGroups:[],skippedInputs:[],noExchanges:!1,noResolution:!1,keepOptionalSymbolsEmpty:!1,skipTextareaInputs:!1,priceInputsForDisplay:!1,patchSosInputs:!1});if(!this._areStudyInputsModified(e))return;this._oldStudyInputs=e;const t=(0,y.patchPropertiesAsync)(this._properties,this._metaInfo,e),i=this._allSymbolsAreResolved();Promise.all([t,i]).then((()=>{this._createViews(),this.recalculate(),this.updateAllViews((0,ce.sourceChangeEvent)(this.id())),this.invalidateTitleCache()})).catch((e=>{xe.logError(`ERROR: ${this._debugId()} pine inputs patching failed, reason: ${e}`)}))}_areStudyInputsModified(e){
if(0===Object.keys(e).length)return!1;if(void 0===this._oldStudyInputs)return!0;const t=Object.keys(this._oldStudyInputs);(0,r.assert)(t.length===Object.keys(e).length,"keys quantity should be equal");for(const i of t)if((0,r.assert)(e.hasOwnProperty(i),`key '${i}' should exist in study inputs`),(0,r.ensureDefined)(this._oldStudyInputs)[i]!==e[i])return!0;return!1}_getStudyErrorText(e){var t;switch(null===(t=e.match(/^study_not_auth:(.*)?@.*/))||void 0===t?void 0:t[1]){case"Script":case"StrategyScript":return"This script is invite-only. To request access, please contact its author.";case"VbPSessions":case"VbPPeriodic":case"VbPVisible":return"Volume Profile indicator available only on our upgraded plans."}return e.split(":",2)[0]}_priceScaleByProperties(){if("default"===this.properties().childs().precision.value())return null;const e=parseInt(this.properties().childs().precision.value());return isFinite(e)?Math.pow(10,e):null}_priceScaleByMetaInfo(){const e=this.metaInfo().format,t="inherit"!==e.type?e.precision:void 0,i=(0,B.isNumber)(t)?Math.pow(10,t):void 0;if("price"===e.type||"percent"===e.type)return i||100;if("volume"===e.type){if(void 0===e.precision){const e=this.series().symbolInfo();if(null!==e&&(0,B.isNumber)(e.volume_precision))return Math.pow(10,e.volume_precision)}return 1}return"inherit"===e.type||xe.logWarn("Unsupported format type: "+e.type),null}}},211800:(e,t,i)=>{"use strict";i.d(t,{applyOverridesToStudyDefaults:()=>u});var s=i(650151),n=i(519872);const r=(0,i(272001).getLogger)("Chart.Model.StudyPropertiesOverrider");var o,l;function a(e,t,i,s){const n=i.split(".");if(0===n.length||0===n[0].length)return;const a=function(e){const t=e.split(":");return{name:t[0],type:2===t.length?t[1]:null}}(n[0]),u=a.name,d=a.type,c=null!==d,h=!c||"band"===d,p=!c||"area"===d,_=!c||"input"===d,y=!c||"plot"===d?l.getPlotIdByTitle(e,u):null,S=h?l.getBandIndexByName(e,u):null,f=p?l.getFilledAreaIdByTitle(e,u):null,m=_?l.getInputByName(e,u):null,g=t.hasOwnProperty(u);if((null!==y?1:0)+(null!==S?1:0)+(null!==f?1:0)+(null!==m?1:0)+(g?1:0)>1)return void r.logWarn(`Study '${e.description}' has ambiguous identifier '${u}'`);const v=n[1];if(null!==y){if(1===n.length)return void r.logWarn(`Path of sub-property of '${u}' plot for study '${e.description}' must be not empty`);const i=n.slice(1);o.applyPlotProperty(e,t,y,i,s)}else if(null!==m)o.applyInputValue(t,m,s);else if(null!==S){if(void 0===v)return void r.logWarn(`Property name of '${u}' band for study '${e.description}' must be set`);o.applyBandProperty(t,S,v,s)}else if(null!==f){if(void 0===v)return void r.logWarn(`Property name of '${u}' area for study '${e.description}' must be set`);o.applyFilledAreaProperty(t,f,v,s)}else g?o.setRootProperty(t,n,s):r.logWarn(`Study '${e.description}' has no plot or input '${u}'`)}function u(e,t,i){for(const s in e){if(!e.hasOwnProperty(s))continue;const n=s.indexOf(".");if(-1===n)continue;const o=s.substring(0,n),u=l.getMetaInfoByDescription(t,o);if(null===u){r.logWarn(`There is no such study ${o}`);continue}const d=i(u)
;null!==d?a(u,d,s.substring(n+1),e[s]):r.logWarn(`Cannot apply overrides for study ${o}`)}}!function(e){const t={line:n.LineStudyPlotStyle.Line,histogram:n.LineStudyPlotStyle.Histogram,cross:n.LineStudyPlotStyle.Cross,area:n.LineStudyPlotStyle.Area,columns:n.LineStudyPlotStyle.Columns,circles:n.LineStudyPlotStyle.Circles,line_with_breaks:n.LineStudyPlotStyle.LineWithBreaks,area_with_breaks:n.LineStudyPlotStyle.AreaWithBreaks,step_line:n.LineStudyPlotStyle.StepLine,step_line_with_breaks:n.LineStudyPlotStyle.StepLineWithBreaks};e.applyPlotProperty=function(e,i,o,l,a){if(void 0===i.styles)return void r.logWarn("Study does not have styles");const u=l[0];if("color"===u){const t=function(e,t,i){if(void 0===e.plots)return null;for(const s of e.plots){if(!(0,n.isPaletteColorerPlot)(s)||void 0===t.palettes)continue;const e=t.palettes[s.palette];if(s.target===i&&void 0!==e)return e}return null}(e,i,o);return void function(e,t,i,n,o){var l;void 0!==e.styles?null===t&&!isNaN(n)&&n>0?r.logWarn(`Study plot does not have color #${n}`):((0===n||isNaN(n))&&((0,s.ensureDefined)(e.styles[i]).color=String(o),n=0),null!==t&&((0,s.ensureDefined)(null===(l=t.colors)||void 0===l?void 0:l[n]).color=String(o))):r.logWarn("Study does not have styles")}(i,t,o,l.length>1?parseInt(l[1]):NaN,a)}const d=i.styles[o];if(void 0!==d&&d.hasOwnProperty(u)){if("plottype"===u){const e=t[String(a)];if(void 0===e)return void r.logWarn(`Unsupported plot type for plot: ${a}`);a=e}d[u]=a}else r.logWarn(`Study plot does not have property '${u}'`)},e.applyBandProperty=function(e,i,s,n){if(void 0===e.bands)return void r.logWarn("Study does not have bands");const o=e.bands[i];if(void 0!==o&&o.hasOwnProperty(s)){if("plottype"===s){const e=t[String(n)];if(void 0===e)return void r.logWarn(`Unsupported plot type for band: ${n}`);n=e}o[s]=n}else r.logWarn(`Study band does not have property '${s}'`)},e.applyFilledAreaProperty=function(e,t,i,s){if(void 0===e.filledAreasStyle)return void r.logWarn("Study does not have areas");const n=e.filledAreasStyle[t];void 0!==n&&n.hasOwnProperty(i)?n[i]=s:r.logWarn(`Study area does not have property '${i}'`)},e.applyInputValue=function(e,t,i){void 0!==e.inputs&&e.inputs.hasOwnProperty(t)?e.inputs[t]=i:r.logWarn(`Study does not have input '${t}'`)},e.setRootProperty=function(e,t,i){if(0===t.length)return;let s=e;for(const e of t.slice(0,-1)){if(null==s||!s.hasOwnProperty(e))break;s=s[e]}const n=t[t.length-1];null!=s&&s.hasOwnProperty(n)?s[n]=i:r.logWarn(`Study does not have property ${t.join(".")}`)}}(o||(o={})),function(e){e.getInputByName=function(e,t){if(void 0===e.inputs)return null;t=t.toLowerCase();for(const i of e.inputs)if(i.name.toLowerCase()===t)return i.id;return null},e.getPlotIdByTitle=function(e,t){if(void 0===e.styles)return null;t=t.toLowerCase();for(const i in e.styles){const s=e.styles[i];if((void 0!==s&&void 0!==s.title?s.title:i).toLowerCase()===t)return i}return null},e.getFilledAreaIdByTitle=function(e,t){if(void 0===e.filledAreas)return null;t=t.toLowerCase()
;for(const i of e.filledAreas)if(i.title.toLowerCase()===t)return i.id;return null},e.getBandIndexByName=function(e,t){if(void 0===e.bands)return null;t=t.toLowerCase();for(let i=0;i<e.bands.length;++i)if(e.bands[i].name.toLowerCase()===t)return i;return null},e.getMetaInfoByDescription=function(e,t){t=t.toLowerCase();for(const i of e)if(i.description.toLowerCase()===t||i.shortDescription.toLowerCase()===t)return i;return null}}(l||(l={}))},214582:(e,t,i)=>{"use strict";i.d(t,{StudyMetaInfoBase:()=>_});var s=i(827147),n=i(650151),r=i(573774),o=i(418147),l=i(125226);const a=new Set(["CorrelationCoefficient@tv-basicstudies","Correlation - Log@tv-basicstudies-1"]),u=(0,l.isFeatureEnabled)("multiple_SoS"),d=new Set([]),c=new Set(["line"]),h=new Map([["AnchoredVWAP@tv-basicstudies","linetoolanchoredvwap"],["RegressionTrend@tv-basicstudies","linetoolregressiontrend"]]),p=/^([^\$]+)\$\d+$/;class _{static getSourceIdsByInputs(e,t){if(!Array.isArray(e)||!t)return[];const i=[];for(const n of e)if(_.isSourceInput(n)&&(0,s.default)(t[n.id])){const e=t[n.id];e.includes("$")&&i.push(e.split("$")[0])}return i}static isSourceInput(e){return Boolean(e.id&&(("source"===e.id||"src"===e.id)&&("text"===e.type||"source"===e.type)||"source"===e.type))}static getSourceInputIds(e){const t=[];for(const i of e.inputs)_.isSourceInput(i)&&t.push(i.id);return t}static setChildStudyMetaInfoPropertiesSourceId(e,t,i){for(const s of e.inputs){if(!_.isSourceInput(s))continue;const e=i.childs().inputs&&i.childs().inputs.childs()[s.id];if(e){const i=e.value(),s=p.exec(i);if(2===(null==s?void 0:s.length)){if("{pid}"===s[1]){const s=i.replace(/^[^\$]+/,t);e.setValue(s)}}}}}static patchSoSInputs(e,t){const i=e=>{const i=p.exec(e);if(2===(null==i?void 0:i.length)){const s=i[1],r=`${(0,n.ensureNotNull)(t(s))}`;return e.replace(/^[^\$]+/,r)}return e};for(const t in e)if(/in_[\d+]/.test(t)||"source"===t){const n=e[t];(0,s.default)(n)?e[t]=i(n):(0,r.isExtendedInput)(n)&&(0,r.isExtendedInputSource)(n)&&(n.v=i(n.v))}}static canBeChild(e){if((0,s.default)(e))return!0;if(!e)return!1;if(e.extra&&!_.isAllowedSourceInputsCount(e.extra.sourceInputsCount)||!0===e.canNotBeChild||!1===e.canBeChild||a.has(e.id))return!1;let t=0;for(const i of e.inputs)_.isSourceInput(i)&&(t+=1);return _.isAllowedSourceInputsCount(t)}static isAllowedSourceInputsCount(e){return u&&e>0||1===e}static canHaveChildren(e){if(e){if(e.isTVScriptStrategy||e.TVScriptSourceCode&&(0,o.isStrategy)(e.TVScriptSourceCode))return!1;if(e.id&&!d.has(e.id)&&Array.isArray(e.plots))for(const t of e.plots)if(c.has(t.type))return!0}return!1}static getChildSourceInputTitles(e,t,i){var s;const n={};if(t.plots&&t.plots.length&&e.options&&e.options.length)for(const r of e.options){const e=r?+r.split("$")[1]:NaN,o=isFinite(e)&&t.plots[e];o&&c.has(o.type)&&(n[r]=t.styles&&t.styles[o.id]&&(null===(s=t.styles[o.id])||void 0===s?void 0:s.title)||o.id,i&&(n[r]=i+": "+n[r]))}return n}static canPlotBeSourceOfChildStudy(e){return c.has(e)}static getStudyPropertyRootName(e){const t=h.get(e.id);if(void 0!==t)return t
;let i="study_"+e.id;return e.pine&&e.pine.version&&(i+="_"+e.pine.version.replace(".","_")),i}static getStudyPropertyRootNameById(e){const t=h.get(e);return void 0!==t?t:"study_"+e}}},240158:(e,t,i)=>{"use strict";i.d(t,{getPriceAlertsDispatcher:()=>n});i(659863);let s=null;function n(){return new Promise((e=>{null===s?Promise.all([i.e(57901),i.e(58194),i.e(26445),i.e(25977),i.e(68647),i.e(58724),i.e(77025),i.e(58189),i.e(48158)]).then(i.bind(i,396796)).then((t=>{null===s&&(s=new t.AlertsDispatcher),e(s)})):e(s)}))}},196362:(e,t,i)=>{"use strict";i.d(t,{bulkStopLabel:()=>n,bulkRestartLabel:()=>r,bulkRemoveLabel:()=>o,bulkRemoveInactiveLabel:()=>l,bulkStopConfirmation:()=>a,bulkRestartConfirmation:()=>u,bulkRemoveConfirmation:()=>d,bulkRemoveInactiveConfirmation:()=>c});var s=i(777754);const n=e=>e?s.t(null,void 0,i(293786)):s.t(null,void 0,i(507991)),r=e=>e?s.t(null,void 0,i(517520)):s.t(null,void 0,i(377152)),o=e=>e?s.t(null,void 0,i(898098)):s.t(null,void 0,i(168710)),l=()=>s.t(null,void 0,i(508702)),a=e=>e?{title:s.t(null,void 0,i(742692)),text:s.t(null,void 0,i(528183))}:{title:s.t(null,void 0,i(73016)),text:s.t(null,void 0,i(343860))},u=e=>e?{title:s.t(null,void 0,i(733946)),text:s.t(null,void 0,i(548111))}:{title:s.t(null,void 0,i(639901)),text:s.t(null,void 0,i(530147))},d=e=>e?{title:s.t(null,void 0,i(830930)),text:s.t(null,void 0,i(764123))}:{title:s.t(null,void 0,i(879698)),text:s.t(null,void 0,i(597411))},c=()=>({title:s.t(null,void 0,i(447537)),text:s.t(null,void 0,i(669387))})},622765:(e,t,i)=>{"use strict";i.d(t,{THIN_SPACE_CHAR:()=>n,Currencies:()=>r,currencySignMap:()=>o,countryToCurrencyMap:()=>l,currencyEnumToCurrencyMap:()=>a,paypalSupportedCurrencies:()=>u,getPriceFormatConfig:()=>h});var s=i(777754);const n=" ";var r;!function(e){e.Usd="USD",e.Btc="BTC",e.Tvc="TVC",e.Myr="MYR",e.Gbp="GBP",e.Inr="INR"}(r||(r={}));const o={[r.Usd]:"$",[r.Myr]:"RM",[r.Gbp]:"£",[r.Inr]:"₹"},l={US:r.Usd,MY:r.Myr,GB:r.Gbp,IN:r.Inr},a={USD:r.Usd,MYR:r.Myr,GBP:r.Gbp,INR:r.Inr},u=(r.Usd,s.t(null,void 0,i(617480)),r.Myr,s.t(null,void 0,i(804162)),r.Gbp,s.t(null,void 0,i(440152)),r.Inr,s.t(null,void 0,i(136418)),[r.Gbp,r.Usd]),d={[r.Usd]:{fraction:".",thousands:",",space:""},[r.Gbp]:{fraction:".",thousands:",",space:""},[r.Myr]:{fraction:".",thousands:",",space:n},[r.Inr]:{fraction:".",thousands:",",space:n,isLongCurrency:!0}},c={fraction:".",thousands:",",space:n,signInTheEnd:!1,isLongCurrency:!1},h=e=>{var t;return null!==(t=d[e])&&void 0!==t?t:c}},267077:(e,t,i)=>{"use strict";i.d(t,{getCountries:()=>r});var s=i(890740);let n=null;async function r(){var e;if(null!==n)return n;const t=await(0,s.fetch)("/accounts/countries/",{credentials:"include"});if(!t.ok){const e=await t.json();throw Error(String(e))}const i=await t.json();return n={...i,current_country_code:null!==(e=i.current_country_code)&&void 0!==e?e:"US"},n}},425213:(e,t,i)=>{"use strict";i.d(t,{initOrderDialogLoader:()=>r});var s=i(441101);let n=null;async function r(){const e=document.querySelector("body");e.classList.add("i-no-scroll"),
n=document.createElement("div"),n.classList.add(s.loaderContainer),e.appendChild(n);const{Spinner:t}=await Promise.all([i.e(36037),i.e(78775)]).then(i.bind(i,941285)),r=new t;return r.spin(n),()=>{n&&r&&(r.destroy(),e.removeChild(n))}}},492630:(e,t,i)=>{"use strict";async function s(e){(await Promise.all([i.e(83578),i.e(58619),i.e(3437),i.e(94710),i.e(33363),i.e(88230),i.e(86256),i.e(91901),i.e(59333),i.e(63980),i.e(18619),i.e(7624),i.e(12275),i.e(36037),i.e(33335),i.e(71140),i.e(83772),i.e(85761),i.e(64884),i.e(37908),i.e(34145),i.e(78707),i.e(36720),i.e(33287),i.e(63737),i.e(20187),i.e(47507),i.e(51907),i.e(20849),i.e(62040),i.e(10302),i.e(47523),i.e(53262),i.e(89034),i.e(90133),i.e(36509),i.e(12768),i.e(24263),i.e(64566),i.e(56342),i.e(52669),i.e(61893),i.e(68849),i.e(32805),i.e(149),i.e(23879),i.e(36979),i.e(24955),i.e(50690),i.e(53734),i.e(40619),i.e(16665),i.e(31429),i.e(62073),i.e(61769),i.e(95204),i.e(86606),i.e(14014),i.e(78703)]).then(i.bind(i,358279))).openPaymentOrderDialog(e)}i.d(t,{showPaymentOrderDialog:()=>s})},619057:(e,t,i)=>{"use strict";i.d(t,{check:()=>n});var s=i(267077);async function n(){const{is_restricted:e}=await(0,s.getCountries)();return e}},997959:(e,t,i)=>{"use strict";i.r(t),i.d(t,{showRestrictedCountryNotificationDialog:()=>r});var s=i(777754),n=i(779923);function r(){(0,n.showWarning)({title:s.t(null,void 0,i(513111)),text:s.t(null,void 0,i(82352))})}},664224:(e,t,i)=>{"use strict";i.d(t,{showSupportDialog:()=>s});i(659863);function s(e){return Promise.all([i.e(43300),i.e(88230),i.e(59333),i.e(18619),i.e(7624),i.e(12275),i.e(36037),i.e(33335),i.e(71140),i.e(83772),i.e(85761),i.e(64884),i.e(36956),i.e(85783),i.e(4100),i.e(50251),i.e(37908),i.e(34145),i.e(78707),i.e(33287),i.e(96246),i.e(83186),i.e(62040),i.e(10302),i.e(51537),i.e(12768),i.e(13871),i.e(31872),i.e(30007),i.e(79448),i.e(50690),i.e(25977),i.e(23127),i.e(24951),i.e(40619),i.e(62237),i.e(41346),i.e(57842),i.e(57274)]).then(i.bind(i,89583)).then((t=>new t.SupportDialog(e).open()))}},222255:(e,t,i)=>{"use strict";i.d(t,{getSymbolPagePath:()=>r});var s=i(889267),n=i(519073);function r(e,t){if("spread"===e.type||"expression"===e.type){const t=e.shortName&&o(e.shortName),i=e.proName&&o(e.proName);e={...e,type:void 0,shortName:t,proName:i}}return a(u(e,t),l(e))}function o(e){var t;return null===(t=(0,s.tokenize)(e).find((e=>"symbol"===e.type)))||void 0===t?void 0:t.value}function l(e){const t={shortName:e.shortName,exchange:e.exchange,proName:e.proName,type:e.type};return e.proName&&e.proName.includes(":")&&([t.exchange,t.shortName]=e.proName.split(":")),t}function a(e,t){const i=encodeURIComponent(t.shortName||""),s=encodeURIComponent(t.exchange||""),n=encodeURIComponent(t.proName||"");return e.replace("{tvexchange}",s).replace("{tvsymbol}",i).replace("{tvprosymbol}",n)}function u(e,t=""){const i=["UKOIL","USOIL","XAGAUD","XAGCAD","XAGCHF","XAGEUR","XAGGBP","XAGHKD","XAGJPY","XAGUSD","XAUAUD","XAUCAD","XAUCHF","XAUEUR","XAUGBP","XAUHKD","XAUJPY","XAUNZD","XAUUSD","XPDUSD","XPTUSD","SPX"]
;return void 0===e.shortName&&void 0===e.proName?(console.warn("Params missed"),"/"):d(e)?e.exchange?"/symbols/{tvsymbol}/?exchange={tvexchange}":`/symbols/{tvsymbol}/${t}`:e.exchange||e.proName?e.shortName&&i.includes(e.shortName)?`/symbols/{tvsymbol}/${t}`:`/symbols/{tvexchange}-{tvsymbol}/${t}`:`/symbols/{tvsymbol}/${t}`}function d(e){const{type:t="",typespecs:i=[]}=e,s="forex"===t,r=(0,n.hasCryptoTypespec)(t,i);return s||r||(0,n.isCommodity)(t,i)}},152198:(e,t,i)=>{"use strict";i.d(t,{getMinimalProPlanForFeature:()=>d,getProPlanDetailsForUser:()=>c});var s=i(960254),n=i(778016),r=i(833813),o=i(919490),l=i(890740),a=i(897649);function u(e){return window.pro?e===s.ProPlans.Free?-1:window.pro.getProduct((0,o.getProductForTrial)(e)).upgrade_weight:0}function d(e){const t=function(e){return Object.values(s.ProPlans).filter((t=>{const i=(0,n.getConfig)(e,(0,o.getProductForTrial)(t));return i&&!((0,o.isTrialProduct)(t)&&i[r.ProductFeatures.DISABLE_ON_TRIAL])}))}(e).filter((e=>!(0,o.isTrialProduct)(e)));return function(e){return e.sort(((e,t)=>u(e)-u(t)))}(t)[0]||null}async function c(){const e=await(0,l.fetch)("/pro-plans/profile/"),t=await e.json();if(e.ok)return t;if(403===e.status){const i=t;throw new a.ApiError(i.detail,e.status,i.code)}throw new Error(`Unable to handle unexpected response: ${String(e.text())}`)}},733094:(e,t,i)=>{"use strict";i.d(t,{Pro:()=>h});var s,n=i(890740),r=i(51237),o=i(960489),l=i(869403),a=i.n(l),u=i(588948),d=i(622765);!function(e){e[e.ProPlan=1]="ProPlan",e[e.NewsFeed=3]="NewsFeed",e[e.Exchange=4]="Exchange",e[e.Connection=6]="Connection",e[e.Coins=8]="Coins"}(s||(s={}));const c=(0,u.getFreshInitData)();class h{constructor(e){var t;this.packagesUpdated=new(a()),this.currencies=[d.Currencies.Usd,d.Currencies.Myr,d.Currencies.Gbp,d.Currencies.Inr],this.PRODUCT_TYPES={pro_plan:1,exchange:4,connection:6,coins:8},this._products={},this._discounts={},this._offers=[],this._order=[],this._freeProductIds=["tv-scripting","tv-basicstudies","tv-prostudies","Script$USER","Script$EDGR","ESD$TV"],this._invalidShopConf=!1,e&&(this._offers=null!==(t=e.offers)&&void 0!==t?t:[],this._invalidShopConf=!0,"undefined"!=typeof window&&window.loginStateChange.subscribe(this,this.onLoginStateChange))}updateShopConf(e=!1){return this._shopConfPromise||(this._shopConfPromise=(0,n.fetch)("/market/shopconf/",{credentials:"include"}).then((e=>e.json())).then((t=>{this._products=t.all_products&&JSON.parse(t.all_products)||{},this._discounts=t.discounts&&JSON.parse(t.discounts)||{},this._offers=t.offers&&JSON.parse(t.offers)||[],this._order=t.order&&JSON.parse(t.order)||[],this._invalidShopConf=!1,delete this._shopConfPromise,e||this.packagesUpdated.fire()})).catch((()=>{delete this._shopConfPromise}))),this._shopConfPromise}invalidateShopConf(){this._invalidShopConf=!0}isInvalidShopConf(){return!!this._invalidShopConf}ensureValidShopConf(){return new Promise((e=>this.runOrUpdate(e)))}onLoginStateChange(e){e||this.updateShopConf()}runOrUpdate(e,t){this.isInvalidShopConf()?this.updateShopConf(t).then(e):e()}
getIDCExchanges(e){const t=this._products;if(c)if(e){if(c.idc_delay_exchanges_list)return c.idc_delay_exchanges_list}else if(c.idc_exchanges_list)return c.idc_exchanges_list;return Object.keys(t).filter((i=>{const s=t[i];return!!this.isExchange(s)&&(e?s.idc_service_codes_delay:s.idc_service_codes)})).map((e=>t[e].exchange))}getProduct(e){if(e in this._products)return this._products[e];if(this.isDiscountProductId(e)){const t=this._discounts[e],i={discount_text_id:e,...this._products[t.product]};return this.currencies.forEach((e=>{const s="USD"===e?"":`_${e}`;t[`cost${s}`]&&(i[`cost${s}`]=t[`cost${s}`]),t[`cost_annual${s}`]&&(i[`cost_annual${s}`]=t[`cost_annual${s}`]),t[`cost_biennial${s}`]&&(i[`cost_biennial${s}`]=t[`cost_biennial${s}`])})),void 0!==t.fixed_cost&&(i.fixed_cost=t.fixed_cost),void 0!==t.extra_days&&(i.extra_days=t.extra_days),void 0!==t.billing_cycle&&(i.billing_cycle=t.billing_cycle),i}return{}}async findProduct(e){if(this.isInvalidShopConf())try{await this.updateShopConf()}catch(e){}return this.getProduct(e)}isProductDefined(e){return!(!e||!Object.keys(e).length)}getDiscountProduct(e){var t;return null!==(t=this._discounts[e])&&void 0!==t?t:{}}isOffer(e,t){return Object.keys(this._discounts).filter((e=>!this._discounts[e].expired&&this._discounts[e].offer_type===t)).includes(e)}getProductId(e){var t,i,s;return e?this.isExchange(e)||this.isCoinsProduct(e)?null!==(t=e.text_id)&&void 0!==t?t:"":null!==(s=null!==(i=e.discount_text_id)&&void 0!==i?i:e.text_id)&&void 0!==s?s:"":""}isDiscountProductId(e){return e in this._discounts}isPlan(e){return e.type===this.PRODUCT_TYPES.pro_plan}isExchange(e){return e.type===this.PRODUCT_TYPES.exchange}isCoinsProduct(e){return e.type===this.PRODUCT_TYPES.coins}getActiveExchanges(){return this.getProductsByType(this.PRODUCT_TYPES.exchange).filter((e=>!e.disabled&&Boolean(e.cost)))}getExchange(e){const t=this.getProductsByType(this.PRODUCT_TYPES.exchange);let i;for(let s=0;s<t.length;s+=1)if(i=t[s],i.exchange===e||i.included_exchanges&&i.included_exchanges.includes(e))return i;return{}}getCost(e,t,i){let s="";void 0!==i&&i!==d.Currencies.Usd&&(s=`_${i}`);const n=`cost${s}`,r=`cost_annual${s}`,l=`cost_biennial${s}`;let a=1;if(o.BillingCycle.TwoYears===t){if(e.fixed_cost||(a=24),e[l])return e[l]*a;if(e[r])return e[r]*a}else if(o.BillingCycle.OneYear===t){if(e.fixed_cost||(a=12),e[r])return e[r]*a}else o.BillingCycle.ThreeMonths===t&&(e.fixed_cost||(a=3));return e[n]?e[n]*a:e.cost*a}getProductsByType(e){const t=Object.keys(this._products).filter((t=>this._products[t].type===e)).map((e=>this.getProduct(e)));return e===s.Exchange?t.sort(((e,t)=>Math.sign(e.order-t.order))):t}getProPlans(){return this.getProductsByType(this.PRODUCT_TYPES.pro_plan).map((e=>e.text_id))}getSuperProduct(e){}getStudiesOrder(){return[]}hasPackage(e){return this._offers.includes(e)||this._freeProductIds.includes(e)}updateUser(e){}isPro(){return!!this._getUser().pro_plan}isTrial(){return!!this._getUser().is_trial}isPaidPro(){return this.isPro()&&!this.isTrial()}userHasRealtimeForExchange(e){
const t=(null!=e?e:"").toLowerCase().replace("exchange-",""),i=this.getExchange(t);if(!this.isProductDefined(i))return!1;if(this._offers.includes("exchange-"+i.exchange))return!0;if(i.included_exchanges)for(let e=0;e<i.included_exchanges.length;e+=1)if(this._offers.includes("exchange-"+i.included_exchanges[e]))return!0;return!1}hasRealtimeForExchange(e,t){const i=this.getProductsByType(this.PRODUCT_TYPES.exchange);let s,n;const r=(null!=e?e:"").toLowerCase();for(let e=0;e<i.length;e+=1)if(s=i[e],s.exchange===r||(s.included_exchanges||[]).includes(r)){if(s.disabled&&!s.included_exchanges)return!1;if(!t)return!0;if(s.included_exchanges){let e;for(let i=0;i<s.included_exchanges.length;i+=1)if(n=this.getProduct("exchange-"+s.included_exchanges[i]),this.isProductDefined(n)&&this.isExchange(n)&&this._exHasRealtimeForType(n,t)){e=!0;break}if(!e)return!1}else if(!this._exHasRealtimeForType(s,t))return!1;return!0}return!1}visitExchangesPage(e={}){var t;let i=o.BillingCycle.Monthly,s=!0;const n=this._getUser();n.is_trial||(i=null!==(t=n.pro_plan_billing_cycle)&&void 0!==t?t:o.BillingCycle.OneYear,s=!1),(0,r.visitPaymentPage)(i,{exchangesOnly:!0,newWindow:e.newWindow,paymentMethod:e.paymentMethod,fixedCycle:s,selectedPackages:e.selectedPackages})}offers(){return this._offers}isSupportAvailable(){return Boolean(c.is_support_available)}discounts(){return this._discounts}hash(){const e=this._offers.slice(0);e.sort();const t={offers:e};return JSON.stringify(t)}_getUser(){return window.user}_exHasRealtimeForType(e,t){return!("stock"===t&&!e.is_stocks)&&(!("index"===t&&!e.is_indices)&&!("futures"===t&&!e.is_futures))}}"undefined"!=typeof window&&window.TradingView&&(window.TradingView.Pro=h)},51237:(e,t,i)=>{"use strict";i.d(t,{visitPaymentPage:()=>h});var s=i(777754),n=i(878134),r=i(492630),o=i(960489),l=i(125226),a=i(501578),u=i(619057),d=i(997959),c=i(425213);function h(e="y",t={}){var h;const p=null!==(h=t.productName)&&void 0!==h?h:"pro",_=t.paymentMethod||"paypal",y="bitcoin"===_?"Bitcoin payment":"Paypal payment",S=(0,c.initOrderDialogLoader)();window.runOrSignIn((async()=>{if(await(0,u.check)())return void(0,d.showRestrictedCountryNotificationDialog)();if("function"==typeof t.canVisit&&!t.canVisit())return void(t.reloadIfCantVisit?location.reload():location.href="/");if((0,l.isFeatureEnabled)("braintree-trial-implementation"))return void(0,r.showPaymentOrderDialog)({productId:t.productName,billingCycle:t.exchangesOnly?o.BillingCycle.Monthly:e,fixedCycle:t.fixedCycle,statusExtraData:t.exchangesExpanded?a.StatusExtraData.Opened:void 0,exchanges:t.selectedPackages}).then((async()=>{(await S)()}));const i=(0,
n.parseHtmlElement)(`<form action="/order/" method="post" ${t.newWindow?'target="_blank"':""}>\n\t\t\t\t\t<input type="hidden" name="product" value="${p}"/>\n\t\t\t\t\t<input type="hidden" name="billing_cycle" value="${e}"/>\n\t\t\t\t\t<input type="hidden" name="fixed_billing_cycle" value="${t.fixedCycle?"1":""}"/>\n\t\t\t\t\t<input type="hidden" name="exchanges_only" value="${t.exchangesOnly?"1":""}"/>\n\t\t\t\t\t<input type="hidden" name="exchanges_expanded" value="${t.exchangesExpanded?"1":""}"/>\n\t\t\t\t\t<input type="hidden" name="selected_packages" value="${(t.selectedPackages||[]).join(",")}"/>\n\t\t\t\t\t<input type="hidden" name="payment_method" value="${_}"/>\n\t\t\t\t</form>`);i&&(document.body.appendChild(i),i.submit())}),{source:y,paidAccountCheck:window.pro&&window.pro.getProduct(p).type===window.pro.PRODUCT_TYPES.pro_plan,paidAccountSuccessButtonText:s.t(null,void 0,i(976111))})}},746518:e=>{"use strict"
;e.exports=JSON.parse('{"content":{"chartProperties":{"scalesProperties":{"textColor":"#B2B5BE","lineColor":"rgba(240, 243, 250, 0)","backgroundColor":"#ffffff"},"paneProperties":{"vertGridProperties":{"color":"rgba(240, 243, 250, 0.06)"},"horzGridProperties":{"color":"rgba(240, 243, 250, 0.06)"},"crossHairProperties":{"color":"#9598A1"},"background":"#131722","backgroundGradientStartColor":"#181C27","backgroundGradientEndColor":"#131722","backgroundType":"gradient","separatorColor":"#2A2E39"}},"sessions":{"graphics":{"backgrounds":{"outOfSession":{"color":"#2962FF","transparency":92},"preMarket":{"color":"#FF9800","transparency":92},"postMarket":{"color":"#2962FF","transparency":92}},"vertlines":{"sessBreaks":{"color":"#4985e7","style":2,"width":1}}}},"mainSourceProperties":{"baseLineColor":"#5d606b","candleStyle":{"borderColor":"#378658","upColor":"#089981","wickColor":"#B5B5B8","wickUpColor":"#089981","wickDownColor":"#F23645","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645"},"haStyle":{"borderColor":"#378658","upColor":"#089981","wickColor":"#B5B5B8","wickUpColor":"#089981","wickDownColor":"#F23645","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645"},"barStyle":{"downColor":"#F23645","upColor":"#089981"},"pnfStyle":{"downColor":"#F23645","upColor":"#089981","upColorProjection":"#336854","downColorProjection":"#7f323f"},"baselineStyle":{"baselineColor":"#758696","topFillColor1":"rgba(8, 153, 129, 0.28)","topFillColor2":"rgba(8, 153, 129, 0.05)","bottomFillColor1":"rgba(242, 54, 69, 0.05)","bottomFillColor2":"rgba(242, 54, 69, 0.28)","topLineColor":"#089981","bottomLineColor":"#F23645"},"areaStyle":{"transparency":100,"color1":"rgba(41, 98, 255, 0.28)","color2":"#2962FF","linecolor":"#2962FF","linewidth":2,"linestyle":0},"hiloStyle":{"color":"#2962FF","borderColor":"#2962FF","labelColor":"#2962FF"},"columnStyle":{"upColor":"rgba(8, 153, 129, 0.5)","downColor":"rgba(242, 54, 69, 0.5)","priceSource":"close"},"renkoStyle":{"upColor":"#089981","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645","upColorProjection":"#336854","downColorProjection":"#7f323f","borderUpColorProjection":"#336854","borderDownColorProjection":"#7f323f","wickUpColor":"#089981","wickDownColor":"#F23645"},"lineStyle":{"color":"#2962FF","linewidth":2,"linestyle":0},"kagiStyle":{"downColor":"#F23645","upColor":"#089981","upColorProjection":"#336854","downColorProjection":"#7f323f"},"pbStyle":{"upColor":"#089981","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645","upColorProjection":"#336854","downColorProjection":"#7f323f","borderUpColorProjection":"#336854","borderDownColorProjection":"#7f323f"},"rangeStyle":{"upColor":"#089981","downColor":"#F23645","upColorProjection":"#336854","downColorProjection":"#7f323f"}}}}')},979706:e=>{"use strict"
;e.exports=JSON.parse('{"content":{"chartProperties":{"scalesProperties":{"textColor":"#131722","lineColor":"rgba(42, 46, 57, 0)","backgroundColor":"#ffffff"},"paneProperties":{"vertGridProperties":{"color":"rgba(42, 46, 57, 0.06)"},"horzGridProperties":{"color":"rgba(42, 46, 57, 0.06)"},"crossHairProperties":{"color":"#9598A1"},"background":"#ffffff","backgroundGradientStartColor":"#ffffff","backgroundGradientEndColor":"#ffffff","separatorColor":"#E0E3EB"}},"sessions":{"graphics":{"backgrounds":{"outOfSession":{"color":"#2962FF","transparency":92},"preMarket":{"color":"#FF9800","transparency":92},"postMarket":{"color":"#2962FF","transparency":92}},"vertlines":{"sessBreaks":{"color":"#4985e7","style":2,"width":1}}}},"mainSourceProperties":{"baseLineColor":"#B2B5BE","candleStyle":{"borderColor":"#378658","upColor":"#089981","wickColor":"#737375","wickUpColor":"#089981","wickDownColor":"#F23645","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645"},"haStyle":{"borderColor":"#378658","upColor":"#089981","wickColor":"#737375","wickUpColor":"#089981","wickDownColor":"#F23645","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645"},"barStyle":{"downColor":"#F23645","upColor":"#089981"},"pnfStyle":{"downColor":"#F23645","upColor":"#089981","upColorProjection":"#a9dcc3","downColorProjection":"#f5a6ae"},"baselineStyle":{"baselineColor":"#758696","topFillColor1":"rgba(8, 153, 129, 0.28)","topFillColor2":"rgba(8, 153, 129, 0.05)","bottomFillColor1":"rgba(242, 54, 69, 0.05)","bottomFillColor2":"rgba(242, 54, 69, 0.28)","topLineColor":"#089981","bottomLineColor":"#F23645"},"areaStyle":{"transparency":100,"color1":"rgba(41, 98, 255, 0.28)","color2":"#2962FF","linecolor":"#2962FF","linewidth":2,"linestyle":0},"hiloStyle":{"color":"#2962FF","borderColor":"#2962FF","labelColor":"#2962FF"},"columnStyle":{"upColor":"rgba(8, 153, 129, 0.5)","downColor":"rgba(242, 54, 69, 0.5)","priceSource":"close"},"renkoStyle":{"upColor":"#089981","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645","upColorProjection":"#a9dcc3","downColorProjection":"#f5a6ae","borderUpColorProjection":"#a9dcc3","borderDownColorProjection":"#f5a6ae","wickUpColor":"#089981","wickDownColor":"#F23645"},"lineStyle":{"color":"#2962FF","linewidth":2,"linestyle":0},"kagiStyle":{"downColor":"#F23645","upColor":"#089981","upColorProjection":"#a9dcc3","downColorProjection":"#f5a6ae"},"pbStyle":{"upColor":"#089981","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645","upColorProjection":"#a9dcc3","downColorProjection":"#f5a6ae","borderUpColorProjection":"#a9dcc3","borderDownColorProjection":"#f5a6ae"},"rangeStyle":{"upColor":"#089981","downColor":"#F23645","upColorProjection":"#a9dcc3","downColorProjection":"#f5a6ae"}}}}')}}]);